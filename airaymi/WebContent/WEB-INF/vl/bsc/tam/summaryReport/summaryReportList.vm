#*************************************************************************
* CLASS 명      : summaryReportList
* 작 업 자      : 김윤기
* 작 업 일      : 2012년 8월 6일 
* 기    능      : 부서별요약보고서관리 
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     김윤기      2012년 8월 6일             최 초 작 업
**************************************************************************# 
#set($curr_url = $!{context_path} + "/bsc/tam/summaryReport/summaryReportList.vw")
<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;
	
	J(document).ready(function(){
		/******************************************
		 * 조회
		 ******************************************/
		J("#formFind").submit(function(event) {
			//submit 하기전 작업추가
		});
        

		/******************************************
		 * 저장버튼 이벤트
		 ******************************************/
		J("#btnInsert").click(function(e) {
			e.preventDefault();
			saveChk();
		});

		/******************************************
		 * 삭제 버튼 클릭 이벤트
		 ******************************************/
		J("#btnDelete").click(function() {
			goDelete();
			return false;
		});
		
		/******************************************
		 * CKEDITOR1 byte 체크
		 ******************************************/
		/*
		J("#editor1").checkbyte({
			indicator:J("#indicator1"),
			limit:3500
		});
		J("#editor1").trigger("keyup");	
		*/
		/******************************************
		 * CKEDITOR2 byte 체크
		 ******************************************/
		/*
		J("#editor2").checkbyte({
			indicator:J("#indicator2"),
			limit:3500
		});
		J("#editor2").trigger("keyup");	
		*/
		
		/******************************************
    	 * 조직선택 팝업호출
    	 ******************************************/
    	J("#icSearch").fancybox();	
		
		/******************************************
		 * 엑셀다운로드 버튼 클릭 이벤트
		 ******************************************/
		J("#btnExcelDown").click(function() {
			excelDownload();
			return false;
		});
		
		/******************************************
		 * KPI표시 클릭 이벤트
		 ******************************************/
		J("#toggle").click(function() {
			var metricTab = J("#tbody div");
			var visibility = J(metricTab[0]).css("display"); 
    		if("none"!=visibility){
    			J(metricTab).css('display','none');
    		}else{
    			J(metricTab).css('display','');
    		}
		});
	});

	/******************************************
	 * jqGrid 수정페이지 링크
	 ******************************************/
	function linkUpdate(cellvalue, options, rowObject) { 
		return '<a href=javascript:goModify(' + options.rowId + ')>' + cellvalue + '<//a>';
	}
	
	/******************************************
	 * 수정
	 ******************************************/
	function goModify(rowId) {
		var ret = J("#list").jqGrid('getRowData',rowId);
		//J("#codeGrpId").val(ret.CODE_GRP_ID);
		J("#year").val(J("#findYear").val());
		J("#mode").val("MOD");
		J("#formList").attr("action", "$!{context_path}/bsc/tam/summaryReport/summaryReportModify.vw?type=template").submit();
	}
    
	/*****************************************************
	 * 조직선택 설정
	 *****************************************************/ 
	function setDeptInfoPop(scDeptId, scDeptNm) {

		scDeptNm = J(scDeptNm).text();
		J("#findScDeptId").val(scDeptId);
		J("#findScDeptNm").val(scDeptNm);
		J.fancybox.close();
	}
	
	/******************************************
	 * 필수입력 체크
	 ******************************************/
	function saveChk() {
		var summary = CKEDITOR.instances.editor1;
		var opinion = CKEDITOR.instances.editor2;
		if(summary.getData() == ''){   J.showMsgBox("요약보고서 내용을 입력해 주세요.", null, null);  summary.focus();   return false;}
		if((summary.getData()).length>=3500){   J.showMsgBox("요약보고서 내용은 3500자를 넘을 수 없습니다.", null, null);   summary.focus();   return false;}
		if((opinion.getData()).length>=3500){   J.showMsgBox("검토의견 내용은 3500자를 넘을 수 없습니다.", null, null);   opinion.focus();   return false;}
		
		J.showConfirmBox("저장하시겠습니까?", "saveDo"); //saveDo() 콜백함수 호출
	}
	
	/******************************************
	 * 저장
	 ******************************************/
	function saveDo() {
		J("#mode").val("ADD");
		J("#year").val(J("#findYear").val());
		J("#mon").val(J("#findMon").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		var oEditor1 = CKEDITOR.instances.editor1;
		var oEditor2 = CKEDITOR.instances.editor2;
		J("#review").val(oEditor1.getData());
		J("#opinion").val(oEditor2.getData());
		J("#formList").attr("action", "$!{context_path}/bsc/tam/summaryReport/summaryReportProcess.vw?type=template").submit();
	}
    			
	/******************************************
	 * 엑셀다운로드
	 ******************************************/
	function excelDownload(){
		
		J("#formFind").attr("action", "$!{context_path}/bsc/tam/summaryReport/summaryReportListExcel.vw?type=excel").submit();
		return false;
	}

//]]>
</script>

<div id="Table">
	<div id="Table_blockContainer">
		<h1 class="none">부서별요약보고서관리 </h1>
		<div class="tableTop">
			#parse("/WEB-INF/vl/common/template/tabs.vm")
    		<!-- search S -->
			<form id="formFind" name="formFind" method="post" action="$!{context_path}/bsc/tam/summaryReport/summaryReportList.vw?type=template">
				<input type="hidden"	id="findHighPgmId"	name="findHighPgmId"	value="$!{searchMap.txt2html("findHighPgmId")}" />
				<input type="hidden" 	id="findSubPgmId"	name="findSubPgmId"		value="$!{searchMap.txt2html("findSubPgmId")}" />
				<input type="hidden"    id="findPgmId"		name="findPgmId"		value="$!{searchMap.txt2html("findPgmId")}" />
				
				<div class="searchBox">
    				<div><div><div>
    				<table summary="부서별요약보고서관리 검색 조건">
						<caption class="none">부서별요약보고서관리  검색 조건</caption> 
						<thead><tr><th></th></tr></thead>
        				<tbody>
            				<tr>
								<td class="searchBox_tit w250">
            						<span><label for="findYear">$!{YEARMON}</label></span>
            						<span class="searchBar">
            							<select id="findYear" name="findYear" class="select w80">
            								$!CS_CODE.getCodeOption("017", $!{searchMap.txt2html("findYear")})
            							</select>
            						</span>
            						<span class="searchBar">
										<select id="findMon" name="findMon" class="select w55" title="findMon">
											$!CS_CODE.getCodeOption("024", $!{searchMap.txt2html("findMon")})
										</select>
            						</span>            						
            					</td>
								<td class="searchBox_tit w350">
            						<span><label for="findScDeptId">$!{SC_DEPT_NM}</label></span>
            						<span class="searchBar">
        								<input type="hidden" id="findScDeptId" name="findScDeptId" value="${CS_STATIC.nullToDefault($!{searchMap.txt2html("findScDeptId")},${CS_LOGIN.getSc_dept_id()})}" />
        								<input type="text" id="findScDeptNm" name="findScDeptNm" class="inputbox w170" value="${CS_STATIC.nullToDefault($!{searchMap.txt2html("findScDeptNm")},${CS_LOGIN.getSc_dept_nm()})}" maxlength="20" title="findScDeptNm"/>
        								<a id="icSearch" href="$!{context_path}/bsc/module/commModule/popScDeptTree.vw?findYear=$!{searchMap.txt2html("findYear")}&amp;findSearchCodeId=$!{searchMap.txt2html("findScDeptId")}"><img src="$!{img_path}/common/board/ic_search.gif" class="valign_middle" alt="조직검색"/></a> 
            						</span>
            					</td>
            				</tr>
        				</tbody>
    				</table>
                    <input type="image" class="btnSearch" src="$!{img_path}/common/btn_search.gif" align="middle" alt="검색" /> 
                    </div></div></div>
    	        </div>
    		</form>
    		<!-- search E -->
			<div class="clear"></div>
		</div>
		<form id="formList" name="formList" method="post" action="$!{context_path}/bsc/tam/summaryReport/summaryReportProcess.vw?type=template">
			<input type="hidden" id="mode"       name="mode" />
			<input type="hidden" id="year"		 name="year" />
			<input type="hidden" id="mon"		 name="mon" />
			<input type="hidden" id="scDeptId"	 name="scDeptId" />
			<input type="hidden" id="review"	 name="review" />
			<input type="hidden" id="opinion"	 name="opinion" />
			<input type="hidden" id="userId"	 name="userId" value="$!{CS_LOGIN.getUser_id()}"/>
			$!{searchMap.makeHiddenFind()}
			<div id="splitterBox"S>
				<div>
					<!-- CKEDITOR-->
                    <div class="tb_line"></div>
                    <textarea  id="editor1" name="editor1" rows="10" cols="10" title="요약보고서">$!{CS_HTML.txt2html($!{summary.REVIEW})}</textarea>
					<script type="text/javascript">
					//<![CDATA[
						// Replace the <textarea id="editor1"> with an CKEditor instance.

						CKEDITOR.replace( 'editor1',
							{
							
								//customConfig : '커스텀설정js파일위치',
							
								//extraPlugins : 'autogrow',
								// Remove the resize plugin, as it doesn't make sense to use it in conjunction with the AutoGrow plugin.
								//language: 'ko',
								//autoGrow_maxHeight : 800,
								//skin : 'v2', // Kama,v2
								//extraPlugins : 'devtools',
								//removePlugins : 'resize',
								//toolbar : 'MyToolBar',
								//enterMode		: CKEDITOR.ENTER_BR,
								/*
								ENTER_P - <p> paragraphs are created
								ENTER_BR - <br> elements
								ENTER_DIV - <div> blocks are created
								*/
								//shiftEnterMode	: CKEDITOR.ENTER_P
								/*
								ENTER_P - <p> paragraphs are created
								ENTER_BR - <br> elements
								ENTER_DIV - <div> blocks are created
								*/
								
								//extraPlugins : 'uicolor',
								//uiColor: '#14B8C4'
							});
					//]]>
					</script>	
					<!-- CKEDITOR-->
                    <div class="h10"></div>
                    <div class="textCenter" style="font-size:1.5em;text-decoration:underline; background-color:#F2F2F2; padding: 10px 10px 10px 10px;">
                        <b>$!{searchMap.txt2html("findMon")}월 $!{STRATEGY_NM} 진행현황</b>
					</div>
                    <div style="text-align:right;vertical-align:top;font-size:1em;  padding: 5px 5px 5px 5px;">
						<img src="$!{img_path}/arrow.gif" alt="KPI표시"/>
						<b id="toggle" style="cursor:pointer">$!{METRIC_NM}표시</b>
					</div>
                    <div class="blockDetail">
						<table>
        				<colgroup>
							#set($width=$!{vcMath.div(90, $!{CS_HTML.txt2html($strategyDirList.size())})})
        					<col width="10%" />
							#foreach($strategyDirList in $strategyDirList)
								<col width="$!{width}"/>
							#end
        				</colgroup>							
						
						#if($!{CS_HTML.txt2html($strategyDirList.size())}!=0)
							<thead >
								<tr>
									<th scope="row"></th>
                					#foreach($strategyDirList in $strategyDirList)
    									<th scope="row" class="textCenter">$!{CS_HTML.txt2html($strategyDirList.INITIATIVE_NM)}</th>
    								#end
                                </tr>
                            </thead>
						#end
						#if($!{CS_HTML.txt2html($signalList.size())}!=0)
							<tbody id="tbody">
								#if($!{CS_HTML.txt2html($strategyDirList.size())}!=0 && $!{CS_HTML.txt2html($signalList.size())}!=0)
                					#foreach($signalList in $signalList)
										<tr>
    										<td class="textCenter">$!{CS_HTML.txt2html($signalList.SIGNAL_NM)}</td>
											#if($!{CS_HTML.txt2html($strategyList.size())}!=0)
												#foreach($strategyDirList in $strategyDirList)
                                                <td class="wp25">
													#foreach($strategyList in $strategyList)
            											#if(($!{CS_HTML.txt2html($signalList.SIGNAL_ID)}==$!{CS_HTML.txt2html($strategyList.SIGNAL_ID)}) && $!{CS_HTML.txt2html($strategyDirList.INITIATIVE_ID)}==$!{CS_HTML.txt2html($strategyList.INITIATIVE_ID)})
    														<b>&nbsp;&nbsp;$!{CS_HTML.txt2html($strategyList.STRATEGY_NM)}</b><br/>
        													#if($!{CS_HTML.txt2html($metricList.size())}!=0)
    															<div style="display:none">
																	#foreach($metricList in $metricList)
                            											#if($!{CS_HTML.txt2html($strategyList.STRATEGY_ID)}==$!{CS_HTML.txt2html($metricList.STRATEGY_ID)})
    																		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                            <img src="$!{img_path}/common/ball/ball_$!{CS_HTML.txt2html($metricList.STATUS)}.gif" class="valign_middle"  alt="신호등"></img>	
                                                                            &nbsp;&nbsp;$!{CS_HTML.txt2html($metricList.METRIC_NM)}<br/>
            															#end
        															#end
    															</div >
    														#end
														#end
													#end
    											</td>
    											#end
											#end
                                        </tr>
                					#end
								#end
                            </tbody>
						#end
						</table>
					</div>
            		<div class="blockDetail">
            			<table>
							<tbody >
								<tr >
                                    <th scope="row" class="w200">검토의견</th>
                                    <td >
										<textarea  id="editor2" name="editor2"  rows="10" cols="10" title="검토의견">$!{CS_HTML.txt2html($summary.OPINION)}</textarea><!--<span id="indicator2">0</span>/35000byte-->
										<script type="text/javascript">
										//<![CDATA[
											// Replace the <textarea id="editor2"> with an CKEditor instance.
											
											CKEDITOR.replace( 'editor2',
												{
												
												//customConfig : '커스텀설정js파일위치',
												//extraPlugins : 'autogrow',
												// Remove the resize plugin, as it doesn't make sense to use it in conjunction with the AutoGrow plugin.
												language: 'ko'
												//autoGrow_maxHeight : 800,
												//skin : 'v2', // Kama,v2
												//extraPlugins : 'devtools',
												//removePlugins : 'resize',
												//toolbar : 'MyToolBar',
												//enterMode		: CKEDITOR.ENTER_BR,
												/*
												ENTER_P - <p> paragraphs are created
												ENTER_BR - <br> elements
												ENTER_DIV - <div> blocks are created
												*/
												//shiftEnterMode	: CKEDITOR.ENTER_P
												/*
												ENTER_P - <p> paragraphs are created
												ENTER_BR - <br> elements
												ENTER_DIV - <div> blocks are created
												*/
												
												//extraPlugins : 'uicolor',
												//uiColor: '#14B8C4'
												});
										//]]>
										</script>
									</td>
                                </tr>
                            </tbody>
						</table>
					</div>
					<div class="blockButton_all">
						<div class="blockButton_l"><!--<input id="btnExcelDown" type="image" src="$!{img_path}/btn_excel.gif" align="middle" alt="엑셀다운로드" />--></div>
						<div class="blockButton">
							<ul>
								<li><input type="submit" id="btnInsert" value="저장" /></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</form>
		
	</div>
	<div class="clear"></div>
</div>
