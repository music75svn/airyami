#*************************************************************************
* CLASS 명      : empPaySetModify
* 작 업 자      : 안요한
* 작 업 일      : 2013년 6월 14일
* 기    능      : 개인급여설정 조회
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     안요한      2013년 06월 14일             최 초 작 업
**************************************************************************#
#set($curr_url = $!{context_path} + "/prs/bonus/empPaySet/empPaySetInfoList_xml.vw")
<script type="text/javascript" language="javascript" >
//<![CDATA[

    var J = jQuery;

    J(document).ready(function(){

        /******************************************
         * 데이터 그리드 출력
         ******************************************/
        var str = J('#formFind').serialize();
        jQuery("#list").jqGrid({
            url          :"$!{context_path}/prs/bonus/empPaySet/empPaySetInfoList_xml.vw" + "?" + str,
            mtype        :"POST",
            datatype     :"json",
            jsonReader   : {
                            page   : "page",
                            total  : "total",
                            root   : "rows",
                            records: function(obj){return obj.length;},
                            repeatitems: false,
                            id     : "id"
                           },
            height       : $!{jqGrid_height},
            width        : $!{jqGrid_r_width},
            colNames     :[ '일련번호', '사번','사원번호','성명', '부서코드','부서명', '발령코드','발령사유','직급코드','직급', '직위코드','직위','근무시작일', '근무종료일', '근무월수(월)', '기본급(원)', 'cnt','index','비고'],
            colModel     :[
                            {name:'SEQ'      			,index:'SEQ'				,width:10   	,align:'center'		, formatter:linkSeq},
                            {name:'EMPNS'      			,index:'EMPNS'				,width:10   	,align:'center'		, formatter:linkEmpn},
                            {name:'EMPN'      			,index:'EMPN'				,width:60   	,align:'center'		},
                            {name:'KOR_NM'				,index:'KOR_NM'				,width:60   	,align:'center'		},
                            {name:'DEPT_CD'				,index:'DEPT_CD'			,width:80    	,align:'center'	  	},
                            {name:'DEPT_KOR_NM'     	,index:'DEPT_KOR_NM'		,width:120    	,align:'center' 	},
                            {name:'PCMT_TC'				,index:'PCMT_TC'			,width:60   	,align:'center'		},
                            {name:'PCMT_TC_NM'			,index:'PCMT_TC_NM'			,width:60   	,align:'center'		},
                            {name:'CAST_TC'				,index:'CAST_TC'			,width:60   	,align:'center'		},
                            {name:'CAST_TC_NM'			,index:'CAST_TC_NM'			,width:60   	,align:'center'		},
                            {name:'POS_TC'				,index:'POS_TC'				,width:100   	,align:'center'		},
                            {name:'POS_TC_NM'			,index:'POS_TC_NM'			,width:100   	,align:'center'		},
                            {name:'START_PCMT_DATE'		,index:'START_PCMT_DATE'	,width:100   	,align:'center'		},
                            {name:'END_PCMT_DATE'		,index:'END_PCMT_DATE'		,width:100   	,align:'center'		},
                            {name:'WORK_MON'			,index:'WORK_MON'			,width:60   	,align:'center'		,formatter:goWorkMon},
                            {name:'PAY'					,index:'PAY'				,width:80   	,align:'right'      ,formatter:goPay     ,cellattr: attr1Setting},
                            {name:'PAY_CNT'      	 	,index:'PAY_CNT'       		,width:10    	,align:'center'	  	,sortable:false},
							{name:'PAY_INDEX'      		,index:'PAY_INDEX'      	,width:10    	,align:'center'	  	,sortable:false},
                            {name:'CONTENT'				,index:'CONTENT'			,width:80   	,align:'center' 	,formatter:goContent}
                            ],
            rowNum       : $!{jqGrid_rownum},
            autowidth    : false,
            viewrecords  : true,
            loadonce     : false,
            multiselect  : false,
            cellEdit     : true,
            gridview     : true,
            cmTemplate: {sortable:false},
            loadComplete : function() {
            
            					//근무월수 
								J("input[name=workMons]").numeric({allow:"."});        //특정문자 허용(.)
								J("input[name=workMons]").css("ime-mode", "disabled"); //한글사용 비활성화
								//기본급
								J("input[name=pays]").numeric();        //특정문자 허용(.)
								J("input[name=pays]").css("ime-mode", "disabled"); //한글사용 비활성화
								
                           },
            caption:"개인급여 조회 "
        }).jqGrid('hideCol',"DEPT_CD").jqGrid('hideCol',"SEQ").jqGrid('hideCol',"POS_TC").jqGrid('hideCol',"PCMT_TC").jqGrid('hideCol',"EMPNS").jqGrid('hideCol',"CAST_TC").jqGrid('hideCol',"PAY_INDEX").jqGrid('hideCol',"PAY_CNT").setGridWidth($!{jqGrid_r_width});

        /******************************************
         * 조회
         ******************************************/
        J("#formFind").submit(function(event) {
            //submit 하기전 작업추가
        });

        /******************************************
         * 저장
         ******************************************/
        J("#btnInsert").click(function(e) {
            e.preventDefault();

            saveChk();
        });
        
        /******************************************
		 * 취소버튼 (돌아가기)
		 ******************************************/
		J("#btnBack").click(function() {
			J("#formFind").attr("action", "$!{context_path}/prs/bonus/empPaySet/empPaySetList.vw?type=template").submit();
		});

        /******************************************
         * 저장버튼 이중 클릭 방지
         ******************************************/
        J("form").submit(function(){
            J("#btnInsert").unbind();
        });

        /******************************************
         * fancy Box 팝업호출
         ******************************************/
        J("#anchor").fancybox();
		});
		
    /******************************************
     * 필수입력 체크
     ******************************************/
    function saveChk() {
    
    	var ids	= J("#list").jqGrid('getDataIDs');
		
		for (var i = 0; i < ids.length; i++) {
		
			if (J("input[name='workMons']").eq(i).val() == "" ) {
				J("input[name='workMons']").eq(i).focus()
				alert("근무월수를 입력해주세요");
				return false;
				
			}
		}
		
		J.showConfirmBox("저장하시겠습니까?", "saveDo"); //saveDo() 콜백함수 호출
		
    }
    
    /*****************************************
	 * 데이터 Rowspan 설정
	 ******************************************/
	function attr1Setting(rowId, val, rowObject, cm) {
		var result;
		var index = rowObject.PAY_INDEX;
		var rowSpan = rowObject.PAY_CNT;
		
		if(index == 1) {
			result = ' rowspan="' + rowSpan + '"';
		} else {
			result = ' style="display:none"';
		}
		
		return result;     
	}

    /******************************************
     * 저장
     ******************************************/
    function saveDo() {	
		
        J("#mode").val("ADD");
        J("#year").val(J("#findYear").val());
        J("#formList").attr("action", "$!{context_path}/prs/bonus/empPaySet/empPaySetProcess.vw?type=template").submit();
                
        return false;

    }

    /******************************************
     * jqGrid 일련번호
     ******************************************/
    function linkSeq(cellvalue, options, rowObject) {
    	return '<input type="text" name="seqs" value="' + cellvalue + '" class="wp60" readonly="readonly"/>';
    }
    
    /******************************************
     * jqGrid 사원번호
     ******************************************/
    function linkEmpn(cellvalue, options, rowObject) {
    	return '<input type="text" name="empns" value="' + cellvalue + '" class="wp60" readonly="readonly"/>';
    }
    
    /******************************************
     * jqGrid 부서코드
     ******************************************/
    function linkDeptCd(cellvalue, options, rowObject) {
    	return '<input type="text" name="deptCds" value="' + cellvalue + '" class="wp50"/>';
    }
    
    
    /******************************************
     * jqGrid 근무개월수
     ******************************************/
    function goWorkMon(cellvalue, options, rowObject) {
        var str = "";
        
    	str += '<input type="text" name="workMons" value="' + cellvalue + '" class="wp60" maxlength="6"/>';
        
        return str;
    	
     }
	 
    /******************************************
     * jqGrid 기본급
     ******************************************/
    function goPay(cellvalue, options, rowObject) {
        var str = "";
        
    	str += '<input type="text" name="pays"  value="' + cellvalue + '" class="inputbox textRight w70" maxlength="12"/>';
        
        return str;
    	
     }
     
    /******************************************
     * jqGrid 비고
     ******************************************/
    function goContent(cellvalue, options, rowObject) {
        var str = "";
        
    	str += '<input type="text" name="contents" value="' + cellvalue + '" class="wp80" maxlength="50"/>';
        
        return str;
    	
     }

    /******************************************
     * 조직선택 클릭이벤트
     ******************************************/
    function goAction(deptCd, deptNm) {
        setDeptInfo(deptCd, deptNm);
    }

    /*****************************************************
     * 조직선택 설정
     *****************************************************/
    function setDeptInfo(deptCd, deptNm) {

        J("#findDeptCd").val(deptCd);
        J("#findDeptNm").val(J(deptNm).text());
       
        J("#formFind").attr("action", "$!{context_path}/prs/bonus/empPaySet/empPaySetList.vw?type=template").submit();

    }
    
      /*****************************************************
     * 부서명선택 설정
     *****************************************************/
    function setDeptInfoPop(deptCd, deptNm) {
	
        var index = J("#index").val();
        J("input[name=deptCds]").eq(index-1).val(deptCd);
        J("input[name=deptNms]").eq(index-1).val(J(deptNm).text());
        J.fancybox.close();
        
    }
    
//]]>
</script>

<div id="Table">
    <div id="Table_blockContainer">
        <h1 class="none">개인급여 설정</h1>
        <div class="tableTop">
            #parse("/WEB-INF/vl/common/template/tabs.vm")

            <!-- search S -->
            <form id="formFind" name="formFind" method="post" action="$!{context_path}/prs/bonus/empPaySet/empPaySetList.vw?type=template">
                <input type="hidden"		id="findHighPgmId"  name="findHighPgmId"    value="$!{searchMap.txt2html("findHighPgmId")}" />
                <input type="hidden"		id="findSubPgmId"   name="findSubPgmId"     value="$!{searchMap.txt2html("findSubPgmId")}" />
                <input type="hidden"		id="findPgmId"      name="findPgmId"        value="$!{searchMap.txt2html("findPgmId")}" />
                <input type="hidden"		id="findDeptCd"   	name="findDeptCd"     	value="$!{searchMap.txt2html("findDeptCd")}" />
                <input type="hidden"		id="findDeptNm"   	name="findDeptNm"    	value="$!{searchMap.txt2html("findDeptNm")}" />
				<input type="hidden"		id="findEmpn"		name="findEmpn"			value="$!{searchMap.txt2html("empn")}" />
				<input type="hidden"		id="findKorNm"		name="findKorNm"		value="$!{searchMap.txt2html("korNm")}" />
				
                <div class="searchBox">
                    <div><div><div>
                    <table summary="개인급여 설정 검색 조건">
                        <caption class="none">개인급여 설정 검색 조건</caption>
                        <thead><tr><th></th></tr></thead>
                        <tbody>
                            <tr>
                                <td class="searchBox_tit w250">
                                    <span><label for="findYear">평가년도</label></span>
                                    <span class="searchBar">
                                        <select id="findYear" name="findYear" class="select w80">
                                            $!CS_CODE.getCodeOption("017", $!{searchMap.txt2html("findYear")})
                                        </select>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <input type="image" class="btnSearch" src="$!{img_path}/common/btn_search.gif" align="middle" alt="검색" />
                    </div></div></div>
                </div>
            </form>
            <!-- search E -->
            <div class="clear"></div>
        </div>

        <form id="formList" name="formList" method="post" action="$!{context_path}/prs/bonus/empPaySet/empPaySetProcess.vw?type=template">
            <input type="hidden" id="mode"			name="mode" />
            <input type="hidden" id="year"			name="year" />
            <input type="hidden" id="empn"  		name="empn" 	/>			
            <input type="hidden" id="seq"  			name="seq" 	/>			
            <input type="hidden" id="workMon"  		name="workMon" />		
            <input type="hidden" id="pay"  			name="pay" />		
            <input type="hidden" id="content"  		name="content" />		
            	

            $!{searchMap.makeHiddenFind()}
            <div id="splitterBox">
                <div>

                    <!-- 조직트리 Start -->
                    <div class="blockGridTreeTable">
                        #parse("/WEB-INF/vl/prs/insa/dept/deptTree.vm")
                    </div>

                    <!-- 데이터그리드 Start -->
                    <div class="blockGridListTable floatRight">
                        <table id="list" summary="개인급여 설정 조회결과">
                            <caption class="none">개인급여 설정 조회</caption>
                            <thead><tr><th></th></tr></thead>
                            <tbody><tr><td></td></tr></tbody>
                        </table>
                        <div id="pager"></div>
                    </div>
                    <!--// 데이터그리드 End -->
                    <div class="blockButton_all floatLeft">
                        <div class="blockButton">
                            <ul>
						#if($!{CS_HTML.txt2html($detail.CONFIRM_DT)} == "")
                               <li><input type="button" id="btnInsert"		value="저장" /></li>
                        #else 
	    						<li><span id="closeAlert" class="txt_red2">$!{searchMap.txt2html("findYear")}년도 성과급 확정을 $!{CS_HTML.txt2html($detail.CONFIRM_DT)}에 진행하셨습니다.&nbsp;&nbsp;</span></li>	    				
						#end
								<li><input type="button" id="btnBack" 		value="돌아가기" /></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <a id="anchor"></a>
    <div class="clear"></div>
</div>
