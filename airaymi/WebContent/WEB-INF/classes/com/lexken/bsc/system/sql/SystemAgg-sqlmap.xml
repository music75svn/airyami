<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="bsc.system.systemAgg">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: 데이터집계관리 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_PROC_MASTER
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT X.PROC_ID,
         	X.PROC_NM,
         	X.PROC_GBN,
	        Y.SEQ,
	        Y.YEAR,
	        Y.EXEC_YN,
	        Y.ERROR_ID,
	        TO_CHAR(Y.EXEC_DATE, 'YYYY-MM-DD HH24:MI:SS') EXEC_DATE,
         	(SELECT COUNT (PROC_ID) FROM BSC_PROC_MASTER WHERE PROC_GBN = X.PROC_GBN) CNT
	    FROM BSC_PROC_MASTER X LEFT OUTER JOIN
	            (SELECT A.SEQ,
	                    A.PROC_ID,
	                    A.YEAR,
	                    A.EXEC_YN,
	                    A.ERROR_ID,
	                    A.EXEC_DATE
	             FROM BSC_PROC_ADMIN A WHERE (A.YEAR = #findYear# AND A.MON = '12')
	                    AND A.SEQ = (SELECT MAX (B.SEQ) 
	                    			 FROM BSC_PROC_ADMIN B 
	                    			 WHERE A.PROC_ID = B.PROC_ID 
	                    			 	AND B.YEAR = #findYear#
	                    			 	AND B.MON = '12'
                    			 	 GROUP BY B.PROC_ID) ) Y
	         ON X.PROC_ID = Y.PROC_ID
		ORDER BY X.PROC_GBN, X.SORT_ORDER, X.PROC_ID
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 파라미터 맵
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<parameterMap id="paramMap" class="java.util.HashMap">
		<parameter property="year" 			jdbcType="VARCHAR"  javaType="java.lang.String" mode="IN"/>	
	</parameterMap>	

	<!--
	==================================================================   
	  # 설명	: 데이터집계관리 프로시저 호출
	  #	기능	: CALL PROCEDURE
	  #	TABLE	: 
	==================================================================
	-->	
	<procedure id="callSpBscTotalProc"  parameterMap="paramMap">
		{CALL  SP_BSC_TOTAL_PROC_KGS(?)} 
    </procedure>
    
    <!--
	==================================================================   
	  # 설명	: 데이터집계관리 프로시저 호출(간략)
	  #	기능	: CALL PROCEDURE
	  #	TABLE	: 
	==================================================================
	-->	
	<procedure id="callSpBscTotalProcShortly"  parameterMap="paramMap">
		{CALL  SP_BSC_TOTAL_PROC_KGS_SHORTLY(?)} 
    </procedure>	
    
    <!--
	==================================================================   
	  # 설명	: 확인요청 지표 목표 일괄 승인
	  #	기능	: CALL PROCEDURE
	  #	TABLE	: 
	==================================================================
	-->	
	<procedure id="callSpApproveTargetAll"  parameterMap="paramMap">
		{CALL  SP_APPROVE_TARGET_ALL(?)} 
    </procedure>	
    
    <!--
	==================================================================   
	  # 설명	: 확인요청 지표 실적 일괄 승인
	  #	기능	: CALL PROCEDURE
	  #	TABLE	: 
	==================================================================
	-->	
	<procedure id="callSpApproveActualAll"  parameterMap="paramMap">
		{CALL  SP_APPROVE_ACTUAL_ALL(?)} 
    </procedure>	
    
</sqlMap>



