<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="bsc.eval.imponEvalTerm">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: 비계량평가일정관리 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: 
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT 
		   T1.YEAR,
	       T1.MON,
	       T2.CODE_NM MON_NM,
	       T1.START_DT,
	       T1.END_DT,
	       T1.STATUS,
	       T3.CODE_NM STATUS_NM
	    FROM BSC_IMPON_IN_TERM T1 
	    LEFT OUTER JOIN BSC_CODE T2
	    	ON T2.YEAR='9999'
	    	AND T2.CODE_GRP_ID='134'
	    	AND T1.MON=T2.CODE_ID
	    LEFT OUTER JOIN BSC_CODE T3
	    	ON T3.YEAR='9999'
	    	AND T3.CODE_GRP_ID='137'
	    	AND T1.STATUS=T3.CODE_ID
		WHERE T1.YEAR = #findYear#	    	
    	
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 비계량평가일정관리 상세 보기
	  #	기능	: SELECT
	  #	TABLE	: 
	==================================================================
	-->
	<select id="getDetail" parameterClass="hashMap" resultClass="hashMap">
		SELECT 
		   T1.YEAR,
	       T1.MON,
	       T1.START_DT,
	       T1.END_DT,
	       T1.STATUS,
	       T2.CODE_NM STATUS_NM
	    FROM BSC_IMPON_IN_TERM T1 
	    LEFT OUTER JOIN BSC_CODE T2
	    	ON T2.YEAR='9999'
	    	AND T2.CODE_GRP_ID='137'
	    	AND T1.STATUS=T2.CODE_ID
	   	WHERE T1.YEAR = #year#
	   	AND T1.MON = #cycle#                      
           
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 비계량평가일정관리 등록
	  #	기능	: INSERT
	  #	TABLE	: BSC_IMPON_IN_TERM
	==================================================================
	-->	
	<insert id="insertData" parameterClass="hashMap">
		INSERT INTO BSC_IMPON_IN_TERM(
               YEAR
             , MON
             , START_DT
             , END_DT
             , STATUS
             ) VALUES (
               #year#
             , #cycle#
             , #startDt#
             , #endDt#
             , '01'
             )

	</insert>	
	
	<!--
	==================================================================   
	  # 설명	: 비계량평가일정관리 수정
	  #	기능	: UPDATE
	  #	TABLE	: BSC_IMPON_IN_TERM
	==================================================================
	-->	
	<update id="updateData" parameterClass="hashMap">
		UPDATE BSC_IMPON_IN_TERM
			SET START_DT= #startDt#, END_DT = #endDt#
			<dynamic prepend=",">
				<isNotEqual property="status" compareValue="00">
					STATUS = #status#
				</isNotEqual>
			</dynamic>			
			WHERE YEAR = #year#
			<dynamic prepend="AND">
				<isEqual property="status" compareValue="00">
					MON = #cycle#
				</isEqual>
				<isNotEqual property="status" compareValue="00">
					MON = #statusCycle#
				</isNotEqual>
			</dynamic>
		              
	</update>	

	<!--
	==================================================================   
	  # 설명	: 비계량평가일정관리 삭제
	  #	기능	: UPDATE
	  #	TABLE	: BSC_IMPON_IN_TERM
	==================================================================
	-->
		
	<update id="deleteData" parameterClass="hashMap">
		DELETE BSC_IMPON_IN_TERM
		WHERE YEAR = #year#
		AND MON = #cycle#              
	</update>

	<!--
	==================================================================   
	  # 설명	: 비계량평가일정관리 평가데이터 삭제
	  #	기능	: UPDATE
	  #	TABLE	: BSC_IMPON_IN_TERM
	==================================================================
	-->
		
	<update id="deleteEvalData" parameterClass="hashMap">
		DELETE BSC_IMPON_DETAIL
		WHERE YEAR = #year#
		AND MON = #statusCycle#              
	</update>

	<!--
	==================================================================   
	  # 설명	: 비계량평가일정관리 평가데이터(평자가 완료) 삭제
	  #	기능	: UPDATE
	  #	TABLE	: BSC_IMPON_STATUS
	==================================================================
	-->
		
	<update id="deleteEvalStatusData" parameterClass="hashMap">
		DELETE BSC_IMPON_STATUS
		WHERE YEAR = #year#
		AND MON = #statusCycle#              
	</update>

	<!--
	==================================================================   
	  # 설명	: 해당 평가구분 등록 여부 확인
	  #	기능	: SELECT
	  #	TABLE	: BSC_METRIC_IN_TERM
	==================================================================
	-->	
	<select id="getCount" parameterClass="hashMap" resultClass="java.lang.Integer">
		SELECT COUNT(*) CNT 
		  FROM BSC_IMPON_IN_TERM
		 WHERE YEAR = #year#
		 AND MON = #cycle#
	</select>	
	
</sqlMap>


