#*************************************************************************
* CLASS 명      : imponEvalEvalModify
* 작 업 자      : 김윤기 
* 작 업 일      : 2012년 7월 26일 
* 기    능      : 비계량평가실시    
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자    작     업     일        변 경 내 용                비고
* ----  --------  -----------------  -------------------------  --------
*  1    김윤기      2012년 7월 26일             최 초 작 업 
**************************************************************************# 

<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;

	J(document).ready(function(){
    
		/******************************************
		 * 취소버튼 (돌아가기)
		 ******************************************/
		J("#btnBack").click(function() {
			J("#form1").attr("action", "$!{context_path}/bsc/eval/imponEvalEval/imponEvalEvalList.vw?type=template").submit();
		});
        
		/******************************************
		 * 저장버튼 이벤트
		 ******************************************/
		J("#btnInsert").click(function(e) {
			if(evalable()){
    			e.preventDefault();
    			saveChk();
			}
		});

		/******************************************
		 * 저장버튼 이중 클릭 방지
		 ******************************************/
		J("form").submit(function(){
			J("#btnInsert").unbind();
		});
		
		
		/******************************************
		 * 평가의견 byte 체크
		 ******************************************/
		var index = J("#index").val(); 
		for(var i=1; i<=index; i++){
    		J("#suggests_"+i).checkbyte({
    			indicator:J("#indicator_"+i),
    			limit:3500
    		});
    		J("#suggests_"+i).trigger("keyup");
		}
		
		/******************************************
		 * 하단 평가완료 문구 디스플레이 체크
		 ******************************************/
		if(J("#endYn").val()=='Y'){
			J("#endAlert").show();
		}else{
			J("#endAlert").hide();
		}
		
		/******************************************
		 * $!{ACTIVITY_NM} 버튼 클릭 이벤트
		 ******************************************/
		J("#btnActivity").click(function(e) {
			popupActivity();
		});		
	});

	/******************************************
	 * 평가 진행상태 체크
	 ******************************************/
	function evalable(){
		var status = true;
		var term = true;
		var able = true;
		
		if(J("#status").val() != "02") status = false;
		if(J("#inTerm").val() != "Y") term = false;
		
		if((!term && !status) || !term){
    		J.showMsgBox("평가 기간이 아닙니다.", null, null);
			
		}else if(!status){
    		J.showMsgBox("평가가 시작되지 않았습니다.", null, null);
			
		}
		
		if(!status || !term){
			able=false;
		}
		
		return able;
	}
	
	/******************************************
	 * 필수입력 체크
	 ******************************************/
	function saveChk() {
		
		if(J("#endYn").val()=="Y"){
			J.showMsgBox("평가가 이미 완료되었습니다.", null, null);
			return;
		}
		
		var index = J("#index").val(); 
		var checked=true;
		for(var i=1; i<=index; i++){
			if(!J(":input[name=grades_"+ i +"]:checked").val()){
				checked=false;
			}
		}
		
		if(!checked){
			J.showMsgBox("등급을 선택해주십시오", null, null);
			return;
		}
		
		
		
         
		J.showConfirmBox("저장하시겠습니까?", "saveDo"); //saveDo() 콜백함수 호출
	}
    
	/******************************************
	 * 저장
	 ******************************************/
	function saveDo() {
		J("#form1").attr("action", "$!{context_path}/bsc/eval/imponEvalEval/imponEvalEvalProcess.vw?type=template").submit();
	}
	
	function popupActivity(){
		window.open("", "List", "width=1200, height=450, top=50, left=100 scrollbars=yes, resizble=no");
      	J("#form1").attr("action","$!{context_path}/bsc/base/activity/activityDetailView.vw");
      	J("#form1").attr("target","List");
		J("#form1").submit();
		J("#form1").attr("target","_self");
	}
	

//]]>
</script>    
 
<form id="form1" name="form1" method="post" action="$!{context_path}/bsc/eval/imponEvalEval/imponEvalEvalProcess.vw?type=template">
    <input type="hidden" id="mode"			name="mode"			value="$!{searchMap.txt2html("mode")}" />
	<input type="hidden" id="status"		name="status" 		value="$!{searchMap.txt2html("status")}"/>
	<input type="hidden" id="inTerm"		name="inTerm" 		value="$!{searchMap.txt2html("inTerm")}"/>
	<input type="hidden" id="year"		 	name="year" 		value="$!{searchMap.txt2html("year")}"/>
	<input type="hidden" id="cycle"		 	name="cycle"  		value="$!{searchMap.txt2html("cycle")}"/>
    <input type="hidden" id="evalEmpId"		name="evalEmpId"	value="$!{searchMap.txt2html("evalEmpId")}" />
	<input type="hidden" id="metricGrpId"	name="metricGrpId" 	value="$!{searchMap.txt2html("metricGrpId")}"/>
	<input type="hidden" id="metricId"		name="metricId" 	value="$!{searchMap.txt2html("metricId")}"/>
    <input type="hidden" id="evalEmpNm"		name="endYn"	value="$!{searchMap.txt2html("endYn")}" />
    <input type="hidden" id="itemCd"		name="itemCd"		value="" />
	
    $!{searchMap.makeHiddenFind()}
	
    <div id="Table">
    	<div id="Table_blockContainer">
    		<div class="tableTop">
    			#parse("/WEB-INF/vl/common/template/tabs.vm")
        		<!-- search S -->
    			<form>
    				<div class="searchBox">
        				<div><div><div>
        				<table summary="비계량평가 조건">
    						<caption class="none">비계량평가 검색 조건</caption> 
    						<thead><tr><th></th></tr></thead>
            				<tbody>
                				<tr>
    								<td class="searchBox_tit w200">
                						<span><label for="findYear">$!{YEARMON}</label></span>
                						<span class="searchBar">
											$!{searchMap.txt2html("yearNm")}
                						</span>
                						<span class="searchBar">
											$!{searchMap.txt2html("cycleNm")}
                						</span>
                					</td>
                					<td class="searchBox_tit w150">
    									<span><label for="findEvalEmpId">평가자</label></span>
                						<span class="searchBar">
											$!{searchMap.txt2html("evalEmpNm")}
										</span>
                                    </td>            					
                					<td class="searchBox_tit w600">
                    					<span><label for="metricGrpId">평가대상 비계량 $!{METRIC_NM}</label></span>
                						<span class="searchBar">
											$!{searchMap.txt2html("metricGrpNm")}
                						</span>
                                    </td>            					
                				</tr>
            				</tbody>
        				</table>
                        </div></div></div>
        	        </div>
        		</form>
        		<!-- search E -->
				<div class="clear"></div>
    		</div>
			
			<!--blockListTable Start-->
			<div class="blockListTable">					
				<table summary="" >
					<caption></caption>
					<colgroup >
						<col width="150px"/>
						<col width="60px"/>
						<col width="800px"/>
						<col width="*"/>
                    </colgroup>					
					<thead>
						<tr>
							<th scope="col">평가항목</th>
							<th scope="col">가중치</th>
							<th scope="col">평가기준</th>
							<th scope="col">등급</th>
						</tr>
					</thead>
				</table>
			</div>
			
			<div class="tableContent" style="height:$!{jqGrid_height}px;overflow:auto;overflow-x:hidden">					
				<table summary="" >
					<caption></caption>
					<colgroup >
						<col width="150px"/>
						<col width="60px"/>
						<col width="800px"/>
						<col width="*"/>
                    </colgroup>
					<tbody>
						#set($idx = 0)
						#set($itmCd = '')
						#foreach($gradeList in $gradeList)
                            <tr>
								#if($!{gradeList.ITEM_CD} != $itmCd)
									<td rowspan="$!{CS_HTML.txt2html($gradeList.CNT)}">$!{CS_HTML.txt2html($gradeList.ITEM_NM)}</td>
									<td rowspan="$!{CS_HTML.txt2html($gradeList.CNT)}">$!{CS_HTML.txt2html($gradeList.ITEM_WEIGHT)}</td>
								#end
								
								#if($!{CS_STATIC.nullToBlank($gradeList.GRADE)} != "")
    								<td class="textLeft">
										$!{CS_HTML.txt2html($gradeList.CONTENT)}
									</td>
								#else
    								<td colspan="2">
										<textarea id="suggests_$idx" name="suggests_$idx" class="tabletext" title="평가의견" cols="" rows="3" style="margin-right:10px;">$!{CS_HTML.txt2html($gradeList.CONTENT)}</textarea>
										<div class="floatRight" style="margin-right:15px;"><span id="indicator_$idx">0</span>/3500byte</div>
									</td>
								#end
								
								#if($!{CS_STATIC.nullToBlank($gradeList.GRADE)} != "")
								<td>
									#if($!{gradeList.ITEM_CD} != $itmCd)
    									 #set($idx = $idx+1)
										 <input type="hidden" name="itemCds_$idx" value="$!{CS_HTML.txt2html($gradeList.ITEM_CD)}"/>
									#end
									<input type="radio" name="grades_$idx" value="$!{CS_HTML.txt2html($gradeList.GRADE)}_$!{CS_HTML.txt2html($gradeList.GRADE_SCORE)}" $!{CS_HTML.getChecked($gradeList.GRADE, $!gradeList.FLAG)} />
									&nbsp;
									$!{CS_HTML.txt2html($gradeList.GRADE)}
								</td>
								#end
								
							</tr>	
							#set($itmCd = $!{CS_HTML.txt2html($gradeList.ITEM_CD)})
						#end
					</tbody>
				</table>
			</div>
			<input type="hidden"  id="index" name="index" value="$!{idx}"/>
			<span id="endAlert" class="txt_red2 none">※평가가 완료 되었습니다.</span>
			<!--//blockListTable End-->
    		<div class="blockButton">
				<ul>
    				<li><input type="button" id="btnActivity"   value="$!{ACTIVITY_NM}" /></li>
					<li><input type="button" id="btnBack"   	value="돌아가기" /></li>
    				<li><input type="button" id="btnInsert" 	value="저장"     /></li>
    			</ul>
    		</div>	
    	</div>
    	<div class="clear"></div>
    </div>
</form>
