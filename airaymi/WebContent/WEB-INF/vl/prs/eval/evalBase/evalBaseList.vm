#*************************************************************************
* CLASS 명      : evalBaseList
* 작 업 자      : 박경태
* 작 업 일      : 2012년 11월 27일 
* 기    능      : 평가요소
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     박경태      2012년 11월 27일             최 초 작 업
**************************************************************************# 
#set($curr_url = $!{context_path} + "/prs/eval/evalBase/evalBaseList.vw")
<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;
	
	J(document).ready(function(){
    
		/******************************************
		 * 조회
		 ******************************************/
		J("#formFind").submit(function(event) {
			//submit 하기전 작업추가
		});
        
		/******************************************
		 * 신규 등록
		 ******************************************/
		J("#btnInsert").click(function() {
			saveChk();
			return false;
			
		});
        
		/******************************************
		 * 엑셀다운로드 버튼 클릭 이벤트
		 ******************************************/
		J("#btnExcelDown").click(function() {
			excelDownload();
			return false;
		});
		
		/******************************************
		 * 년도별 평가단 change 이벤트
		 ******************************************/
		$('#findYear').change(function(){
			chgEvalGrp();
		});
		
		/******************************************
		 * 비고 byte 체크
		 ******************************************/
		J("#content").checkbyte({
			indicator:J("#contentIndicator"),
			limit:2000
		});
		J("#content").trigger("keyup");
		
		if('$!{CS_HTML.txt2html($confirmYn)}' == 'Y'){
			J("#content").attr('readonly','readonly');
			J("#addFile").hide();
		}
		
		if('$!{CS_HTML.txt2html($closeYn)}' == 'Y'){
			J("#content").attr('readonly','readonly');
			J("#addFile").hide();
		}
	});
	
	/******************************************
	 * 필수입력 체크
	 ******************************************/
	function saveChk() {
		var fileChk = true;
		
		if('$!{CS_HTML.txt2html($confirmYn)}' == 'Y'){
			J.showMsgBox("평가가 확정되어 평가요소를 수정할수 없습니다.", null, null);
			return;
		}
		
		if('$!{CS_HTML.txt2html($closeYn)}' == 'Y'){
			J.showMsgBox("평가가 마감되어 평가요소를 수정할수 없습니다.", null, null);
			return;
		}
	
		if(!J.checkLength("content", "설명", 1, 2000)) {
			return;
		}
		
		//첨부파일 확장자 체크
		J(":file", "#formList").each(function(index, item) {
			var fileFullName = J("input[name=" + item.name + "]").val();
			
			var src = getFileExtension(fileFullName);
			
			if (!((src.toLowerCase() == "xls") || (src.toLowerCase() == "xlsx") || (src.toLowerCase() == "ppt") || (src.toLowerCase() == "pptx")||
				  (src.toLowerCase() == "doc") || (src.toLowerCase() == "docx") || (src.toLowerCase() == "hwp") || (src.toLowerCase() == "pdf") ||
				  (src.toLowerCase() == "zip") || (src.toLowerCase() == "txt")  || (src.toLowerCase() == "gif") || (src.toLowerCase() == "jpg") ||
			      (src.toLowerCase() == "png") || (src.toLowerCase() == "png")
			    )) {
			
				fileChk = false;
    		}
		});
		
		if(fileChk == false) {
			J.showMsgBox("허용되지 않는 파일형식입니다<br/>허용되는 파일형식 : <br/>xls, xlsx, ppt, pptx, doc, docx, hwp <br/> pdf, zip, txt, gif, jpg, png, jpeg", null, null);
    		return;
		}
		
		document.charset='utf-8';
		
		J.showConfirmBox("저장하시겠습니까?", "saveDo"); //saveDo() 콜백함수 호출
	}
    
	/******************************************
	 * 저장
	 ******************************************/
	function saveDo() {
		J("#year").val(J("#findYear").val());
		J("#evalDegreeId").val(J("#findEvalDegreeId").val());
		J("#mode").val("ADD");
		J("#formList").attr("action", "$!{context_path}/prs/eval/evalBase/evalBaseProcess.vw?type=template").submit();
	}
	
	/******************************************
	 * 년도별 평가구분 조회
	 ******************************************/
	function chgEvalGrp(){
		J.ajax({
        	url      : "$!{context_path}/prs/eval/evalGroup/getDegreeList_ajax.vw",﻿
        	cache    : false,
        	type     : "POST",
			data     : J("#formFind").serialize(),
        	dataType : "html",
        	contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success  : function (data) {
				var xmlDoc = J.parseXML(data);
        		J("#findEvalDegreeId").empty();
				J(xmlDoc).find("data").each(function() {
					J('<option/>').attr('value', J(this).find("value").text()).text(J(this).find("text").text()).appendTo('#findEvalDegreeId');
				})
			}
    	});
	}

	
	/******************************************
	 * 엑셀다운로드
	 ******************************************/
	function excelDownload(){
		J("#yearNm").val(J("#findYear > option:selected").text());
		J("#formList").attr("action", "$!{context_path}/prs/eval/evalBase/evalBaseListExcel.vw?type=excel").submit();
		return false;
	}
	
	/******************************************
	 * 파일추가
	 ******************************************/
	var fileIndex = 0;
	
	function fileAttachAdd() {
		J("#fileAttach").append("<li id=\"fileRow" + fileIndex + "\"><input type=\"file\" name=\"file" + fileIndex + "\" class=\"input\" size=\"70\" /> <input type=\"button\" value=\"삭제\" onclick=\"deleteRow(" + fileIndex + ")\" class=\"input\" size=\"70\"></li>");
		fileIndex++;
	}
	
	function deleteRow(fileIndex)	{
    	J("#fileRow" + fileIndex).remove();
    }

//]]>
</script>

<div id="Table">
	<div id="Table_blockContainer">
		<h1 class="none">평가요소</h1>
		<div class="tableTop">
			#parse("/WEB-INF/vl/common/template/tabs.vm")
			
    		<!-- search S -->
			<form id="formFind" name="formFind" method="post" action="$!{context_path}/prs/eval/evalBase/evalBaseList.vw?type=template">
				<input type="hidden"    id="findHighPgmId"  name="findHighPgmId"    value="$!{searchMap.txt2html("findHighPgmId")}" />
				<input type="hidden"    id="findSubPgmId"   name="findSubPgmId"     value="$!{searchMap.txt2html("findSubPgmId")}" />
				<input type="hidden"    id="findPgmId"      name="findPgmId"        value="$!{searchMap.txt2html("findPgmId")}" />
				
				<div class="searchBox">
    				<div><div><div>
    				<table summary="평가요소검색 조건">
						<caption class="none">평가요소 검색 조건</caption> 
						<thead><tr><th></th></tr></thead>
        				<tbody>
            				<tr>
								<td class="searchBox_tit w250">
            						<span><label for="findYear">$!{YEAR}</label></span>
            						<span class="searchBar">
            							<select id="findYear" name="findYear" class="select w80">
            								$!CS_CODE.getCodeOption("017", $!{searchMap.txt2html("findYear")})
            							</select>
            						</span>
            					</td>
								<td class="searchBox_tit w250">
                					<span><label for="findEvalDegreeId">평가구분</label></span>
									<span class="searchBar">
										<select id="findEvalDegreeId" name="findEvalDegreeId" class="select w120">
            								#foreach($evalDegreeList in $evalDegreeList)
												<option value="$!{CS_HTML.txt2html($evalDegreeList.EVAL_DEGREE_ID)}" $searchMap.getSelected("findEvalDegreeId", "$!{CS_HTML.txt2html($evalDegreeList.EVAL_DEGREE_ID)}")>$!{CS_HTML.txt2html($evalDegreeList.EVAL_DEGREE_NM)}</option>
											#end
            							</select> 
									</span>
                                </td>
            				</tr>
        				</tbody>
    				</table>
                    <input type="image" class="btnSearch" src="$!{img_path}/common/btn_search.gif" align="middle" alt="검색" /> 
                    </div></div></div>
    	        </div>
    		</form>
    		<!-- search E -->
			<div class="clear"></div>
		</div>
		
		<form id="formList" name="formList" method="post" enctype="multipart/form-data" action="$!{context_path}/prs/eval/evalBase/evalBaseProcess.vw?type=template">
			<input type="hidden" id="mode"       	name="mode" />
			<input type="hidden" id="year"       	name="year" />
			<input type="hidden" id="yearNm"     	name="yearNm" />
			<input type="hidden" id="evalDegreeId"  name="evalDegreeId" />
			$!{searchMap.makeHiddenFind()}
			<div id="splitterBox">
				<div class="blockDetail">
        			<table summary="평가요소 등록">
    					<caption class="none">평가요소 등록</caption>
        				<colgroup>
        					<col width="15%" />
        					<col width="85%" />
        				</colgroup>
        				<tbody>
    						<tr>
    							<th scope="row"><span class="txt_red">(*)</span> <label for="content">설명</label></th>
    							<td>
    								<textarea id="content" name="content" class="tabletext" title="설명" cols="" rows="5" >$!{CS_HTML.txt2html($detail.CONTENT)}</textarea>
    								<span id="contentIndicator">0</span>/2000byte
								</td>
    						</tr>
    						<tr>
    							<th scope="row"><label for="attachFileNm">첨부파일</label></th>
    							<td>
									#foreach($fileList in $fileList)
                						$!{CS_HTML.makeFileIconFileName($fileList.get("ATTACH_FILE_SUFFIX"), $fileList.get("ATTACH_FILE_NM"), $fileList.get("ATTACH_FILE_PATH"))} 
                						&nbsp;&nbsp;
                						#if($!{CS_HTML.txt2html($closeYn)} != 'Y')
                						<input type="checkbox" name="delAttachFiles" id="delAttachFile$!{fileList.get("SEQ")}" value="$!{fileList.get("SEQ")}" />&nbsp;
                    					<label for="delAttachFile$!{fileList.get("SEQ")}">첨부파일 삭제</label> 
										#end
										<br/>
									#end
                					<br/>
									#if($!{CS_HTML.txt2html($closeYn)} != 'Y')
									<a id="addFile" href="javascript:fileAttachAdd();"><img src="$!{searchMap.txt2html("context")}/images/common/btn_file.gif" class="valign_middle" alt="파일추가" /></a>&nbsp;(첨부파일 용량제한은 100M입니다)<br/>
									#end
									<div>
                						<ul id="fileAttach">
                						</ul>
                					</div>
								</td>
    						</tr>
    					</tbody>
        			</table>
        		</div>
        		<div class="blockButton"> 
        			<ul>
        				<li><input type="submit" id="btnInsert" value="저장" /></li>
        			</ul>
        		</div>	
			</div>
		</form>
		
	</div>
	<div class="clear"></div>
</div>
