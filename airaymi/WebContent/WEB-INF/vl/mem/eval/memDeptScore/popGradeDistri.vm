#*************************************************************************
* CLASS 명      : popTransHis
* 작 업 자      : 하윤식
* 작 업 일      : 2012년 6월 26일
* 기    능      : 조직별KPI관리
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     하윤식      2012년 6월 26일             최 초 작 업
**************************************************************************#
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko">

#set($main_url = $!{searchMap.txt2html("mainUrl")})
#set($curr_url = $!{context_path} + "/mem/eval/memDeptScore/popGradeDistri.vw")

<head>
	#parse("/WEB-INF/vl/common/template/head.vm")

<script type="text/javascript" language="javascript">
//<![CDATA[

	var J = jQuery;
	var grdRowId = 0;

	J(document).ready(function(){

		/******************************************
		 * 데이터 그리드 출력
		 ******************************************/
	 	var str = J('#formPopGrade').serialize();

		jQuery("#poplist").jqGrid({
			url          :"$!{context_path}/mem/eval/memDeptScore/popGradeDistri_xml.vw" + "?" + str,
			mtype        :"POST",
			datatype     :"json",
			jsonReader   : {
    						page   : "page",
    						total  : "total",
    						root   : "rows",
    						records: function(obj){return obj.length;},
    						repeatitems: false,
    						id     : "id"
    				       },
			height       : '200',
			width        : '500',
			colModel     :[
                            {name:'YEAR'       	 	,index:'YEAR'          ,width:60   ,align:'center' ,hidden:true  ,label:'년도'},
                            {name:'GRADE'        	,index:'GRADE'         ,width:60   ,align:'center' ,hidden:false ,label:'등급' ,formatter:linkGrade},                            
                            {name:'SCORE'           ,index:'SCORE'         ,width:50   ,align:'center' ,hidden:false  ,label:'점수' ,formatter:linkScore}
							],
			rowNum       : $!{jqGrid_rownum},
			autowidth    : false,
			viewrecords  : true,
			loadonce     : true,
			gridview     : true,
			multiselect  : true,
			cellEdit     : true,
			caption:"등급표환산점수"
		});
		
		J("#btnClose").click(function(){
		
			self.close();
		
		});
		
		J("#btnGradeSave").click(function(){
		
			var saveChk = true;
		
			var scores = "";
			var scoreChk = "";
			var score = "";
			var grades = "";
			var gradeChk = "";
			var grade = "";
		
			J("input[name=scoreArray]").each(function(index,value){
				
				var score = J(this).val();
				
				if("" == score){
					score = "none";
				}
				
				scores += J(this).val()+"|";
			});
			
			J("input[name=gradeArray]").each(function(index,value){
				
				var grade = J(this).val();
				
				if("" == grade){
					grade = "none";
				}
				
				grades += J(this).val()+"|";
			});	
			
			scoreChk = scores;
			gradeChk = grades;
			
			if("" == scoreChk.replace("|","").replace("none","")+gradeChk.replace("|","").replace("none","")){
				saveChk = false;
			}
			
			if(saveChk){		
				opener.saveGradeScore(scores,grades);		
				self.close();	
			}else{
				alert("등급 및 점수를 입력하십시요.");
				return false;
			}	
		});

	});
	
	/******************************************
	 * jqGrid 가중치
	 ******************************************/
	function linkGrade(cellvalue, options, rowObject) {
		return '<input type="text" name="gradeArray" value="' + cellvalue + '" class="wp70" maxlength="6" />';
	}
	
	/******************************************
	 * jqGrid 가중치
	 ******************************************/
	function linkScore(cellvalue, options, rowObject) {
		return '<input type="text" name="scoreArray" value="' + cellvalue + '" class="wp70" maxlength="6" />';
	}
	
	function addRow() {
		grdRowId++;
		J("#poplist").jqGrid("addRow", {
				rowID:grdRowId,
				initdata : {
				            YEAR:"",
							GRADE:"",
							SCORE:""
							},
				position : "last",
				useDefValues : false,
				useFormmatter : false,
				addRowParams : {extraparam:{}}
		});
		
		J("#poplist").resetSelection();
	}
	
	function delRow() {
		var rowids = J("#poplist").jqGrid('getGridParam' , 'selarrrow');
		for (var i = rowids.length -1; i >=0 ; i--) {
			var rowid = rowids[i];
			J("#poplist").delRowData(rowid);
		}
	}
	
//]]>
</script>
</head>
<body>
<div id="Table" style="width:500px;">

	<div>
		<div id="Table_blockContainer" style="width:500px;">
			<div>
				<div style="height:25px;text-align:right">
					<a href="javascript:addRow();"><img class="btnSearch" src="$!{img_path}/btn_add2.gif" align="middle" alt="행추가" /></a>
					<a href="javascript:delRow();"><img class="btnSearch" src="$!{img_path}/btn_del2.gif" align="middle" alt="행삭제" /></a>
				</div>
			</div>
		</div>
	</div>

	<div id="Table_blockContainer" style="width:500px;">
		<h1 class="none">등급환산점수관리</h1>

		<form id="formPopGrade" name="formPopGrade" method="post" action="$!{context_path}/mem/base/memMetric/memMetricProcess.vw?type=template">
			<input type="hidden" id="year"		name="year" 		value="$!{searchMap.txt2html("year")}" />

		<div id="splitterBox">
			<div>
				<div id="mainListData">
					<!-- 데이터그리드 Start -->
					<div class="">
						<table id="poplist" summary="조직별$!{METRIC_NM}관리 조회결과">
							<caption class="none">조직별$!{METRIC_NM}관리 조회</caption>
							<thead><tr><th></th></tr></thead>
							<tbody><tr><td></td></tr></tbody>
						</table>
						<div id="pager"></div>
					</div>
					
					<!--// 데이터그리드 End -->
					<div class="blockButton_all">
						<div id="blockButton" class="blockButton">
							<ul>
								<li id="bGradeSave" ><input type="button" id="btnGradeSave"  value="저장" /></li>
								<li id="bClose" ><input type="button" id="btnClose"  value="닫기" /></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		</form>
	</div>
</div>
</body>
</html>