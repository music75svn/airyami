#*************************************************************************
* CLASS 명      : ahpItemMappingModify
* 작 업 자      : 하윤식 
* 작 업 일      : 2012년 11월 28일 
* 기    능      : AHP 평가대상그룹매핑    
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자    작     업     일        변 경 내 용                비고
* ----  --------  -----------------  -------------------------  --------
*  1    하윤식      2012년 11월 28일             최 초 작 업 
**************************************************************************# 

<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;

	J(document).ready(function(){
    
		/******************************************
		 * 취소버튼 (돌아가기)
		 ******************************************/
		J("#btnBack").click(function() {
			J("#evalUserGrpId").val("");
			J("#form1").attr("action", "$!{context_path}/bsc/ahp/ahpItemMapping/ahpItemMappingList.vw?type=template").submit();
		});
        
		/******************************************
		 * 저장버튼 이벤트
		 ******************************************/
		J("#btnInsert").click(function(e) {
			e.preventDefault();
			saveChk();
		});

		/******************************************
		 * 저장버튼 이중 클릭 방지
		 ******************************************/
		J("form").submit(function(){
			J("#btnInsert").unbind();
		});
		
	});

	/******************************************
	 * 필수입력 체크
	 ******************************************/
	function saveChk() {
		setMetricInfo();
		J.showConfirmBox("저장하시겠습니까?", "saveDo"); //saveDo() 콜백함수 호출
	}
    
	/******************************************
	 * 저장
	 ******************************************/
	function saveDo() {
		J("#form1").attr("action", "$!{context_path}/bsc/ahp/ahpItemMapping/ahpItemMappingProcess.vw?type=template").submit();
	}

	/******************************************
	 * 세부지표 setting
	 ******************************************/
	function setMetricInfo() {
		var itemGrpIds = "";
		
		if(J("#targetData option").size()>0){
    		J("select option", "#target").each(function () {
    			var str = J(this).text();
    			var itemGrpId = J(this).val();
    			
    			itemGrpIds += itemGrpId + '|';
    		});
			J("#itemGrpIds").val(itemGrpIds);
		}
	}
	
	/******************************************
	 * KPI 선택하기
	 ******************************************/
	function addItem() {
		J("select option:selected", "#source").each(function () {
			
			var metricId = J(this).val();
			var metricNm = J(this).html();
			var isExist = false;
			
			//이미 등록되었는지 체크 추가
			J("select option", "#target").each(function () {
				if(metricId == J(this).val()) {
					J.showMsgBox("선택하신 data는 이미 선택되었습니다.", null, null); 
					isExist = true;
				}
			});
			
			if(isExist == false) {
				J("#targetData").append("<option value='" + metricId +"'>" + metricNm + "</option>");
				J(this).remove();
			}
			
		});
	}
	
	/******************************************
	 * KPI 삭제하기
	 ******************************************/
	function delItem() {
		J("select option:selected", "#target").each(function () {
			J("#sourceData").append("<option value='" + J(this).val() +"'>" + J(this).text() + "</option>");
			J(this).remove();
		});
	}
//]]>
</script>    

<div id="Table">
	<div id="Table_blockContainer">
		<div class="tableTop">
			#parse("/WEB-INF/vl/common/template/tabs.vm")
			<div class="clear"></div>
		</div>
		<div class="tableTop">
            <!-- 검색 테이블 Start -->
            <div class="searchBox">
            <div><div><div>   
                <table summary="검색조건">        
                    <caption class="none">검색조건</caption>
                    <thead><tr><th></th><th></th></tr></thead>
                    <tbody>
                        <tr>
							<td class="searchBox_tit w200">$!{YEAR} : <span class="searchBar">$!{searchMap.txt2html("year")}년</span></td>
							<td class="searchBox_tit w250">평가단 : <span class="searchBar">$!{evalUserGrpNm}</span></td>
						</tr>
                    </tbody>
                </table>
            </div></div></div>
            </div>
            <!--// 검색 테이블 End -->
            <div class="clear"></div>
        </div>
		
		<div class="blockDetail2">
			<table summary="메뉴권한 등록">
				<caption class="none">메뉴권한 등록</caption>
				<tbody>
					<tr>
						<td style="width:45%; height:40px;">
							<span>평가대상 그룹 전체리스트</span> 
						</td>	
						<td style="width:10%;">
							&nbsp;
						</td>	
						<td>
							<span>선택된 평가대상 그룹 리스트</span> 
						</td>
					</tr>	
					<tr>
						<td style="width:45%;" valign="top">
							#*
							<div id="source" style="border:1px solid #d2d2d2; height:370px; overflow-x:hidden; background:#eee;">
                                <ol class="selectable">
									#foreach($list in $totList)
										<li class="ui-widget-content"><input type="hidden" name="itemGrpIds" value="$!{CS_HTML.txt2html($list.ITEM_GRP_ID)}"/>$!{CS_HTML.txt2html($list.ITEM_GRP_NM)}</li>
									#end
                                </ol>
                            </div>
							*#
							<div id="source">
                                <select multiple="multiple" id="sourceData" name="sourceData" style="height:387px;width:100%;background:#fff url($!{img_path}/common/div_back.gif) repeat-x 0 100%; " ondblclick="javascript:addItem();">
									#foreach($list in $totList)
										<option value="$!{CS_HTML.txt2html($list.ITEM_GRP_ID)}"/>$!{CS_HTML.txt2html($list.ITEM_GRP_NM)}</option>
                                    #end
								</select>
                            </div>
						</td>
						#*
						<td style="width:10%;" valign="top" class="valign_middle">
							<input type="image" id="allToLeft" src="$!{img_path}/common/btn_arrow1up.gif" alt="왼으로 전체 이동" /><br/><br/>
							<input type="image" id="allToRight" src="$!{img_path}/common/btn_arrow2up.gif" alt="오른쪽으로 전체 이동" />
						</td>
						*#
						<td class="textCenter" style="width:10%;">
                    		<img src="$!{searchMap.txt2html("context")}/images/common/btn_arrow2.gif" onmouseover="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow2up.gif'" onmouseout="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow2.gif'" onClick="addItem();"><br /><br />
                    		<img src="$!{searchMap.txt2html("context")}/images/common/btn_arrow1.gif" onmouseover="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow1up.gif'" onmouseout="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow1.gif'" onClick="delItem();">
        				</td>
						<td valign="top">
							<form id="form1" name="form1" method="post" action="$!{context_path}/bsc/ahp/ahpItemMapping/ahpItemMappingProcess.vw?type=template">
                            <input type="hidden" 	id="mode"			name="mode"	    		value="$!{searchMap.txt2html("mode")}" />
							<input type="hidden" 	id="year"			name="year"	      		value="$!{searchMap.txt2html("year")}" />
							<input type="hidden" 	id="evalUserGrpId"	name="evalUserGrpId"    value="$!{searchMap.txt2html("evalUserGrpId")}" />
							<input type="hidden" 	id="itemGrpIds"		name="itemGrpIds"   	value="$!{searchMap.txt2html("itemGrpIds")}" />
							$!{searchMap.makeHiddenFind()}
							
							#*
							<div id="target" style="border:1px solid #d2d2d2; height:370px; overflow-x:hidden; background:#eee;">
                               <ol class="selectable">
                                	#foreach($list in $selList)
										<li class="ui-widget-content"><input type="hidden" name="itemGrpIds" value="$!{CS_HTML.txt2html($list.ITEM_GRP_ID)}"/>$!{CS_HTML.txt2html($list.ITEM_GRP_NM)}</li>
                                    #end
                                </ol>
							</div>
							*#
							<div id="target">
                               <select multiple="multiple" id="targetData" name="targetData" style="height:387px;width:100%;background:#fff url($!{img_path}/common/div_back.gif) repeat-x 0 100%;" ondblclick="javascript:delItem();">
									#foreach($list in $selList)
										<option value="$!{CS_HTML.txt2html($list.ITEM_GRP_ID)}"/>$!{CS_HTML.txt2html($list.ITEM_GRP_NM)}</option>
                                    #end
								</select>
							</div>
							</form>
						</td>
					</tr>	
				</tbody>
			</table>
		</div>
		
		<div class="blockButton_all">			
			<div class="blockButton_l"></div>
    		<div class="blockButton"> 
    			<ul>
    				<li><input type="button" id="btnBack"   value="돌아가기" /></li>
    				<li><input type="submit" id="btnInsert" value="저장" /></li>
    			</ul>
    		</div>
        </div>
	</div>
	<div class="clear"></div>
</div>
