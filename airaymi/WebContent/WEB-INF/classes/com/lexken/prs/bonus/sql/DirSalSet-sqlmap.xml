<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="prs.bonus.dirSalSet">

	<!--
	==================================================================
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: PRS_EVAL_GRP
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />

	<!--
	==================================================================
	  # 설명	: 파견직설정 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BON_DIS_SET
	==================================================================
	-->
	<select id="getConfirm" parameterClass="hashMap" resultClass="hashMap">
		SELECT TO_CHAR(S.CONFIRM_DT,'YYYY.MM.DD HH24:MI:SS') CONFIRM_DT
          FROM BON_SET S
		 WHERE S.YEAR = #findYear#
	</select>

	<!--
	==================================================================
	  # 설명	: 임원연봉설정 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_INSA_PCMT
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
          SELECT * FROM
			  ( SELECT   A.YEAR
				       , A.EMPN
				       , A.KOR_NM
				       , A.DEPT_CD
				       , C.DEPT_KOR_NM
				       , G.CAST_TC
				       , D.CODE_NM AS CAST_TC_NM
				       , G.POS_TC
				       , E.CODE_NM AS POS_TC_NM
				       , (  SELECT MIN (ORG_PCMT_DATE) ORG_PCMT_DATE
				              FROM BSC_INSA_PCMT BB
				          GROUP BY BB.EMPN, BB.YEAR
				            HAVING BB.EMPN = A.EMPN
				            AND BB.YEAR = A.YEAR)
				            ORG_PCMT_DATE
				       , (  SELECT MIN (START_PCMT_DATE) START_PCMT_DATE
				              FROM BSC_INSA_PCMT BB
				          GROUP BY BB.EMPN, BB.YEAR
				            HAVING BB.EMPN = A.EMPN
				            AND BB.YEAR = A.YEAR)
				            START_PCMT_DATE
				       , G.END_PCMT_DATE
				       , CASE
				            WHEN G.PCMT_TC IN ('81', '82', '83', '84', '85', '86', '8I', '8H')
				            THEN
				               G.END_PCMT_DATE
				            ELSE
				               ''
				         END
				            ORG_END_DATE
				       , G.PCMT_TC
				       , CASE
				            WHEN G.PCMT_TC IN ('81', '82', '83', '84', '85', '86', '8I', '8H')
				            THEN
				               (SELECT CODE_NM
				                  FROM BSC_CODE
				                 WHERE CODE_GRP_ID = '182'
				                   AND CODE_ID = '02')
				            ELSE
				               (SELECT CODE_NM
				                  FROM BSC_CODE
				                 WHERE CODE_GRP_ID = '182'
				                   AND CODE_ID = '01')
				         END
				            PCMT_TC_NM
				       , (  SELECT ROUND (
				                      SUM (
				                         MONTHS_BETWEEN (TO_DATE (END_PCMT_DATE) + 1
				                                       , START_PCMT_DATE))
				                    , 2)
				              FROM BSC_INSA_PCMT CC
				          GROUP BY CC.EMPN, CC.YEAR
				            HAVING CC.EMPN = A.EMPN
				            AND CC.YEAR = A.YEAR)
				            WORK_MON
				       , F.RATE
				       , TO_CHAR (NVL (F.SALARY, '')) SALARY
				       , F.CONTENT
				       , DECODE(A.POS_TC,'02','01', A.POS_TC) POS_TC_ORDER
				    FROM BSC_INSA_PCMT A
				         LEFT OUTER JOIN BSC_INSA_DEPT C
				            ON A.YEAR = C.YEAR
				           AND A.DEPT_CD = C.DEPT_CD
				         LEFT OUTER JOIN BSC_CODE D
				            ON D.CODE_GRP_ID = '170'
				           AND A.YEAR = D.YEAR
				           AND A.CAST_TC = D.CODE_ID
				         LEFT OUTER JOIN BSC_CODE E
				            ON E.CODE_GRP_ID = '171'
				           AND A.YEAR = E.YEAR
				           AND A.POS_TC = E.CODE_ID
				         LEFT OUTER JOIN BON_DIR_SAL_SET F
				            ON A.YEAR = F.YEAR
				           AND A.EMPN = F.EMPN
				         INNER JOIN (SELECT A.*
				                       FROM    BSC_INSA_PCMT A
				                            INNER JOIN
				                               (  SELECT MAX (END_PCMT_DATE) END_PCMT_DATE, EMPN
				                                    FROM BSC_INSA_PCMT
				                                GROUP BY EMPN,YEAR 
				                                HAVING YEAR = #findYear#) B
				                            ON A.END_PCMT_DATE = B.END_PCMT_DATE
				                           AND A.EMPN = B.EMPN
				                      WHERE CAST_TC = '00'
				                         OR  POS_TC IN ('06', '08')) G
				            ON A.YEAR = G.YEAR
				           AND A.EMPN = G.EMPN
				           AND A.SER = G.SER
				           AND A.ORG_PCMT_DATE = G.ORG_PCMT_DATE
				   WHERE A.YEAR = #findYear#
				     AND A.CAST_TC = '00'
				     ) AA
				ORDER BY POS_TC_ORDER, AA.DEPT_CD DESC
	</select>



	<!--
    ==================================================================
      # 설명  : 임원연봉 입력
      # 기능  : INSERT
      # TABLE : BON_DIR_SAL_SET
    ==================================================================
    -->
	<insert id="insertData" parameterClass="hashMap">
		INSERT INTO BON_DIR_SAL_SET (YEAR
								 , EMPN
								 , DEPT_CD
								 , CAST_TC
								 , POS_TC
								 , WORK_MON
								 , SALARY
								 , RATE
								 , CONTENT
								 , CREATE_DT
                     			  )
			 VALUES (              #findYear#
								 , #empn#
								, #deptCd#
								, #castTc#
								, #posTc#
								, #workMon#
								, #salary#
								, #rate#
								, #content#
								, SYSDATE
            		)
	</insert>
	<!--
    ==================================================================
      # 설명  : 임원연봉 수정
      # 기능  : UPDATE
      # TABLE : BON_DIR_SAL_SET
    ==================================================================
    -->
	<update id="updateData" parameterClass="hashMap">
		UPDATE BON_DIR_SAL_SET
		SET
			  WORK_MON = #workMon#
			, SALARY   = #salary#
			, RATE     = #rate#
			, CONTENT  = #content#
	        , MODIFY_DT   = SYSDATE
		WHERE YEAR = #findYear#
		AND EMPN = #empn#
	</update>

	<!--
    ==================================================================
      # 설명    : 임원연봉 삭제
      # 기능    : DELETE
      # TABLE   : BON_DIR_SAL_SET
    ==================================================================
    -->
    <delete id="deleteData" parameterClass="hashMap">
        DELETE FROM BON_DIR_SAL_SET
         WHERE YEAR				= #findYear#

    </delete>

</sqlMap>


