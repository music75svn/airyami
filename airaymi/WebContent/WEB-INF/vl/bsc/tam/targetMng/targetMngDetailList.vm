#*************************************************************************
* CLASS 명      : targetMngDetailList
* 작 업 자      : 정철수
* 작 업 일      : 2012년 11월 16일
* 기    능      : 지표목표입력
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     정철수     2012년 11월 16일              최 초 작 업
**************************************************************************#
#set($curr_url = $!{context_path} + "/bsc/tam/targetMng/targetMngDetailList.vm.vw")
<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;

	J(document).ready(function(){

    	J("#targetStatusId").val("$!{CS_HTML.txt2html($detail.TARGET_STATUS_ID)}");
		J("#cycleId").val("$!{CS_HTML.txt2html($detail.CYCLE_ID)}");

		/******************************************
    	 * 실적입력 화면에서 disabled
    	 ******************************************/
		#if($!{CS_HTML.txt2html($detail.TARGET_STATUS_ID)} == "03" || $!{CS_HTML.txt2html($detail.TARGET_STATUS_ID)} == "04")  //승인요청, 승인완료일 경우
			setInputDisable();
       	#else
			setInputDisable();
			setInputAble();
		#end

		/******************************************
    	 * 마감여부에 따른 disabled
    	 ******************************************/
		#if($!{yearCloseYn} == 'Y' || $!{targetInputTermYn} == 'N')
			setInputDisable();
		#end

		showReturnView(); //반려조회 버튼 설정

		/******************************************
    	 * 숫자만 입력받기
    	 ******************************************/
    	/*
		J(":input[name=colValues]").numeric({allow:".-"}); 			//숫자만 입력받기
		J(":input[name=colValues]").css("ime-mode", "disabled"); 	//한글사용 비활성화

		J(":input[name=targetInput]").numeric({allow:".-"}); 		//숫자만 입력받기
		J(":input[name=targetInput]").css("ime-mode", "disabled"); 	//한글사용 비활성화
		*/

		/******************************************
		 * 화면로딩시  목표배분 기본 설정(입력 userInput 일때) 지정
		 ******************************************/
		J("#targetInput", "#blockDetailTB").attr("disabled", true);
		J("#targetInput", "#blockDetailTB").addClass("readonly");


		/******************************************
		 * 목표설정근거 byte 체크
		 ******************************************/
		J("#content").checkbyte({
			indicator:J("#indicator"),
			limit:1000
		});
		J("#content").trigger("keyup");

		#if($!{searchMap.txt2html("findActualType")} != "input")
			J("#content").attr("readonly", true);
		#end

		/******************************************
		 * 목표배분 에 change 이벤트 설정
		 ******************************************/
		J("#targetDivision").change( function(){
			var targetInputType = J(this).val();

			if( targetInputType == 'userInput' ){
				// 입력 일때
				J("#targetInput", "#blockDetailTB").attr("disabled", true);
				J("#targetInput", "#blockDetailTB").addClass("readonly");
				J("#targetInput").val('');
				J("input[name=colValues]", "#blockDetailTB").val('');
				#foreach( $list in $inputYnList )
        			#if( $!{CS_HTML.txt2html($list.INPUT_YN)} == "Y" )
        				J("input[name=colValues]", "#blockDetailTB").eq( $!{CS_HTML.txt2html($list.MON)} ).attr("disabled", false);
        				J("input[name=colValues]", "#blockDetailTB").eq( $!{CS_HTML.txt2html($list.MON)} ).removeClass("readonly");
        			#end
        		#end

			}else if( targetInputType == 'division' ){
				// 동일값 일때
				J("#targetInput", "#blockDetailTB").attr("disabled", false);
				J("#targetInput", "#blockDetailTB").removeClass("readonly");
				J("#targetInput").val('');
				J("input[name=colValues]", "#blockDetailTB").val('');
			}else if( targetInputType == 'accDivision' ){
				// 누적배분 일때
				J("#targetInput", "#blockDetailTB").attr("disabled", false);
				J("#targetInput", "#blockDetailTB").removeClass("readonly");
				J("#targetInput").val('');
				J("input[name=colValues]", "#blockDetailTB").val('');
			}
		});



		/******************************************
		 * 목표배분 에 keyup 이벤트 설정
		 ******************************************/
		J("#targetInput").keyup( function(){
			if(((event.keyCode >= 48) && (event.keyCode <= 57)) || ((event.keyCode >= 96) && (event.keyCode <= 105)) || (event.keyCode == 8)|| (event.keyCode == 46)){

				var targetInputType = J("#targetDivision").val();
				var inputVal = J(this).val();


    			if( targetInputType == 'division' ){
    				// 동일값 일 때
    				#foreach( $inputYn in $inputYnList )
            			#if( $!{CS_HTML.txt2html($inputYn.INPUT_YN)} == "Y" )
    						var inputCnt = '$!{CS_HTML.txt2html($inputYn.INPUT_MON_CNT)}' ;
            				J("input[name=colValues]", "#blockDetailTB").eq( $!{CS_HTML.txt2html($inputYn.MON)} ).val(inputVal);
            			#end
            		#end

    			}else if( targetInputType == 'accDivision' ){
    				// 누적배분 일때
    				var seqVal = 1;
    				#foreach( $inputYn in $inputYnList )
            			#if( $!{CS_HTML.txt2html($inputYn.INPUT_YN)} == "Y" )
    						var inputCnt = '$!{CS_HTML.txt2html($inputYn.INPUT_MON_CNT)}' ;
    						var tmpVal = Math.round(  inputVal * seqVal / inputCnt * 1000 ) / 1000 ;
            				J("input[name=colValues]", "#blockDetailTB").eq( $!{CS_HTML.txt2html($inputYn.MON)} ).val(tmpVal);
    						seqVal = seqVal + 1;
            			#end
            		#end
    			}

			}
		});


		/******************************************
		 * 목표값 계산기 버튼 클릭 이벤트
		 ******************************************/
		J("#btnTargetCalculator").click(function() {
			J("#year").val(J("#findYear").val());
			window.open("", "targetMng", "width=900,height=900,top=50,left=100,scrollbars=yes,resizble=no");
			J("#formList").attr("action","$!{searchMap.txt2html("context")}/bsc/tam/targetMng/targetCalculator.vw");
          	J("#formList").attr("target","targetMng");
    		J("#formList").submit();

		});




	});

	function setInputDisable(){
		J("input[type=text]", "#blockDetailTB").attr("disabled", true);
		J("input[type=text]", "#blockDetailTB").addClass("readonly");

		J("#content", "#blockDetailTB").attr("disabled", true);
		J("#content", "#blockDetailTB").addClass("readonly");

		J("#targetInput", "#blockDetailTB").attr("disabled", true);
		J("#targetInput", "#blockDetailTB").addClass("readonly");

		J("#targetDivision", "#blockDetailTB").attr("disabled", true);
		J("#targetDivision", "#blockDetailTB").addClass("readonly");
	}

	function setInputAble(){
		#foreach( $inputYn in $inputYnList )
			#if( $!{CS_HTML.txt2html($inputYn.INPUT_YN)} == "Y" )
				J("input[name=colValues]", "#blockDetailTB").eq( $!{CS_HTML.txt2html($inputYn.MON)} ).attr("disabled", false);
				J("input[name=colValues]", "#blockDetailTB").eq( $!{CS_HTML.txt2html($inputYn.MON)} ).removeClass("readonly");
			#end
		#end

		J("#content", "#blockDetailTB").attr("disabled", false);
		J("#content", "#blockDetailTB").removeClass("readonly");

		J("#targetDivision", "#blockDetailTB").attr("disabled", false);
		J("#targetDivision", "#blockDetailTB").removeClass("readonly");
	}


	/******************************************
	 * 파일추가
	 ******************************************/
	var fileIndex = 0;

	function fileAttachAdd() {
		J("#fileAttach").append("<li id=\"fileRow" + fileIndex + "\"><input type=\"file\" name=\"file" + fileIndex + "\" class=\"input\" size=\"70\" /> <input type=\"button\" value=\"삭제\" onclick=\"deleteRow(" + fileIndex + ")\" class=\"input\" size=\"70\"></li>");
		fileIndex++;
	}

	function deleteRow(fileIndex)	{
    	J("#fileRow" + fileIndex).remove();
    }

//]]>
</script>

<div id="blockDetailTB" class="blockListTable">
	<table summary="목표입력">
    	<caption class="none">목표입력</caption>
    	<thead>
    		<tr>
    		    <th scope="col" width="4%" class="textCenter">구분</th>
    			<th scope="col" width="8%" class="textCenter">1월</th>
				<th scope="col" width="8%" class="textCenter">2월</th>
				<th scope="col" width="8%" class="textCenter">3월</th>
				<th scope="col" width="8%" class="textCenter">4월</th>
				<th scope="col" width="8%" class="textCenter">5월</th>
				<th scope="col" width="8%" class="textCenter">6월</th>
				<th scope="col" width="8%" class="textCenter">7월</th>
				<th scope="col" width="8%" class="textCenter">8월</th>
				<th scope="col" width="8%" class="textCenter">9월</th>
				<th scope="col" width="8%" class="textCenter">10월</th>
				<th scope="col" width="8%" class="textCenter">11월</th>
				<th scope="col" width="8%" class="textCenter">12월</th>
    		</tr>
    	</thead>
    	<tbody>
    		#foreach($list in $list)
    			<tr class="row1">
    				<td class="textCenter">목표</td>
                	<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="01" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON01)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON01)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="02" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON02)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON02)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="03" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON03)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON03)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="04" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON04)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON04)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="05" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON05)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON05)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="06" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON06)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON06)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="07" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON07)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON07)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="08" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON08)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON08)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="09" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON09)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON09)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="10" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON10)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON10)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="11" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON11)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON11)}
						#end
					</td>
					<td class="textCenter">
						#if($!{searchMap.txt2html("findActualType")} == "input")
							<input type="hidden" name="mons" class="inputbox" value="12" />
							<input type="text" name="colValues" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($list.MON12)}" maxlength="15" />
						#else
							$!{CS_HTML.txt2html($list.MON12)}
						#end
					</td>
    			</tr>
			#end
		</tbody>
    </table>
	<br/>
	<table summary="목표입력">
    	<caption class="none">목표입력</caption>
		<tbody>
			#if($!{searchMap.txt2html("findActualType")} == "input")
			<tr style = "display:none">
				<th width="25%">목표배분</th>
				<td width="75%" class="textLeft">
					<input type="text" id="targetInput" name="targetInput" style="width:200px;" class="inputbox" value="" maxlength="15" />

					<select id="targetDivision" name="targetDivision" class="select w80" >
						<option value="userInput">입력</option>
						<option value="division">동일값</option>
						<option value="accDivision">누적배분</option>
                    </select>
					<div class="blockButton w100" ><input type="button" id="btnTargetCalculator" value="목표계산기"/></div>
				</td>
			</tr>
			#end
			<tr >
				<th width="25%">첨부파일</th>
				<td width="75%" class="textLeft">
					#foreach($fileList in $fileList)
						$!{CS_HTML.makeFileIconFileName($fileList.get("ATTACH_FILE_SUFFIX"), $fileList.get("ATTACH_FILE_NM"), $fileList.get("ATTACH_FILE_PATH"))}
						&nbsp;&nbsp;

						#if($!{searchMap.txt2html("findActualType")} == "input")
    						#if($!{CS_HTML.txt2html($detail.TARGET_STATUS_ID)} == "01" || $!{CS_HTML.txt2html($detail.TARGET_STATUS_ID)} == "02")
    							<input type="checkbox" name="delAttachFiles" id="delAttachFile$!{fileList.get("SEQ")}" value="$!{fileList.get("SEQ")}" />&nbsp;
    							<label for="delAttachFile$!{fileList.get("SEQ")}">첨부파일 삭제</label> <br/>
    						#end
						#end

					#end
					<br/>

					#if($!{searchMap.txt2html("findActualType")} == "input")
    					#if($!{CS_HTML.txt2html($detail.TARGET_STATUS_ID)} == "01" || $!{CS_HTML.txt2html($detail.TARGET_STATUS_ID)} == "02" || $!{CS_HTML.txt2html($detail.TARGET_STATUS_ID)} == "05")
    						<a href="javascript:fileAttachAdd();"><img src="$!{searchMap.txt2html("context")}/images/common/btn_file.gif" class="valign_middle" alt="파일추가" /></a>&nbsp;(첨부파일 용량제한은 100M입니다)<br/>
    					#end
					#end

					<div>
						<ul id="fileAttach">
						</ul>
					</div>
				</td>
			</tr>
			<tr>
				<th >목표설정근거</th>
				<td  class="textLeft">
					<textarea id="content" name="content" class="tabletext" title="목표설정근거" cols="" rows="5">$!{CS_HTML.txt2html($detail.CONTENT)}</textarea>
					<span id="indicator">0</span>/1000byte
				</td>
			</tr>
		</tbody>
	 </table>
</div>
<div class="clear"></div>
