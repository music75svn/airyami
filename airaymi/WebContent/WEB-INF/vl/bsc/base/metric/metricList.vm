#*************************************************************************
* CLASS 명      : metricList
* 작 업 자      : 하윤식
* 작 업 일      : 2012년 6월 26일
* 기    능      : 조직별KPI관리
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     하윤식      2012년 6월 26일             최 초 작 업
**************************************************************************#
#set($curr_url = $!{context_path} + "/bsc/base/metric/metricList.vw")
<script type="text/javascript" language="javascript">
//<![CDATA[

	var J = jQuery;

	J(document).ready(function(){

		/******************************************
		 * 데이터 그리드 출력
		 ******************************************/
	 	var str = J('#formFind').serialize();

		jQuery("#list").jqGrid({
			url          :"$!{context_path}/bsc/base/metric/metricList_xml.vw" + "?" + str,
			mtype        :"POST",
			datatype     :"json",
			jsonReader   : {
    						page   : "page",
    						total  : "total",
    						root   : "rows",
    						records: function(obj){return obj.length;},
    						repeatitems: false,
    						id     : "id"
    				       },
			height       : $!{jqGrid_height}+7,
			width        : $!{jqGrid_r_width},
			colNames     :[ '평가유형','$!{PERSPECTIVE_NM}', '$!{STRATEGY_NM}', 'CSF_ID', 'CSF', '$!{METRIC_NM} ID', '$!{METRIC_NM}', '연계유형', '주기', '단위', '$!{WEIGHT}', '$!{WEIGHT}', '상위지표ID'],
			colModel     :[
							{name:'TYPE_NM'       		 ,index:'TYPE_NM'       	   ,width:60   ,align:'center'    },
							{name:'PERSPECTIVE_NM'       ,index:'PERSPECTIVE_NM'       ,width:60   ,align:'center'    },
                            {name:'STRATEGY_NM'          ,index:'STRATEGY_NM'          ,width:140   ,align:'left'   },
                            {name:'CSF_ID'          	 ,index:'CSF_ID'          	   ,width:130   ,align:'left'   },
                            {name:'CSF_NM'          	 ,index:'CSF_NM'          	   ,width:130   ,align:'left'   },
                            {name:'METRIC_ID'            ,index:'METRIC_ID'            ,width:50    ,align:'left'   },
							{name:'METRIC_NM'            ,index:'METRIC_NM'            ,width:210   ,align:'left'    ,formatter:linkUpdate },
							{name:'METRIC_PROPERTY_NM'   ,index:'METRIC_PROPERTY_NM'   ,width:50    ,align:'center' },
							{name:'EVAL_CYCLE_NM'        ,index:'EVAL_CYCLE_NM'        ,width:45    ,align:'center' },
							{name:'UNIT_NM'              ,index:'UNIT_NM'              ,width:60    ,align:'center' },
							{name:'WEIGHT'               ,index:'WEIGHT'               ,width:50    ,align:'center' },
							{name:'WEIGHT2'              ,index:'WEIGHT2'              ,width:80    ,align:'center'  ,formatter:linkWeight},
							{name:'UP_METRIC_ID'         ,index:'UP_METRIC_ID'         ,width:60    ,align:'center' }
							],
			rowNum       : $!{jqGrid_rownum},
			autowidth    : false,
			viewrecords  : true,
			loadonce     : true,
			gridview     : true,
			multiselect  : true,
			cellEdit     : true,
			loadComplete : function() {
								getWeightSum();  //가중치 합계가져오기
								getScDeptInfo(); //조직별 담당자 및 KPI 승인상태 가져오기
                           },
			caption:"조직별$!{METRIC_NM}관리"
		}).jqGrid('hideCol',"CSF_ID").jqGrid('hideCol',"METRIC_ID").jqGrid('hideCol',"UP_METRIC_ID").jqGrid('hideCol',"WEIGHT2").setGridWidth($!{jqGrid_r_width});

		/******************************************
		 * 조회
		 ******************************************/
		J("#formFind").submit(function(event) {
			var findYear = J("#findYear").val();
			var oldYear = J("#oldYear").val();

			if(findYear == oldYear) {
    			goGridSearch();
    			return false;
			}
		});

		/******************************************
		 * 신규 등록
		 ******************************************/
		J("#btnInsert").click(function() {
			J("#metricId").val("");
			J("#mode").val("ADD");
			J("#year").val(J("#findYear").val());
			J("#scDeptId").val(J("#findScDeptId").val());
			J("#scDeptNm").val(J("#findScDeptNm").val());
			J("#formList").attr("action", "$!{context_path}/bsc/base/metric/metricModify.vw?type=template").submit();
		});

		/******************************************
		 * 일괄수정
		 ******************************************/
		J("#btnModify").click(function() {
			J("#metricId").val("");
			J("#year").val(J("#findYear").val());
			J("#scDeptId").val(J("#findScDeptId").val());
			J("#scDeptNm").val(J("#findScDeptNm").val());
			J("#formList").attr("action", "$!{context_path}/bsc/base/metric/metricBatchList.vw?type=template").submit();
		});

		/******************************************
		 * 삭제 버튼 클릭 이벤트
		 ******************************************/
		J("#btnDelete").click(function() {
			goDelete();
			return false;
		});

		/******************************************
		 * 승인요청 버튼 클릭 이벤트
		 ******************************************/
		J("#btnRequest").click(function() {
			var weightSum = J("#weightSum").text();

			if("100" != weightSum) {
				J.showMsgBox("가중치 합계가 100이 되어야 승인요청을 할 수 있습니다.", null, null);
				return;
			}

			J("#status").val("03");
			J.showConfirmBox("승인요청하시겠습니까?", "statusDo"); //statusDo() 콜백함수 호출
			return false;
		});

		/******************************************
		 * 승인 버튼 클릭 이벤트
		 ******************************************/
		J("#btnApprove").click(function() {
			J("#status").val("04");
			J.showConfirmBox("승인하시겠습니까?", "statusDo"); //statusDo() 콜백함수 호출
			return false;
		});

		/******************************************
		 * 승인취소 버튼 클릭 이벤트
		 ******************************************/
		J("#btnCancle").click(function() {
			J("#status").val("02");
			J.showConfirmBox("승인취소 하시겠습니까?", "statusDo"); //statusDo() 콜백함수 호출
			return false;
		});

		/******************************************
		 * 반려 버튼 클릭 이벤트

		J("#btnReturn").click(function() {
			J("#status").val("05");
			J.showConfirmBox("반려하시겠습니까?", "returnPop"); //returnPop() 콜백함수 호출
			return false;
		});
		******************************************/

		/******************************************
		 * 반려조회 버튼 클릭 이벤트

		J("#btnReturnView").click(function() {
			returnCauseViewPop();
			return false;
		});
		******************************************/

		/******************************************
		 * 지표복사 버튼 클릭 이벤트
		 ******************************************/
		J("#btnKpiCopy").click(function() {
			goMetricCopy();
			return false;
		});

		/******************************************
		 * 지표이동 버튼 클릭 이벤트
		 ******************************************/
		J("#btnKpiMove").click(function() {
			goMetricMove();
			return false;
		});

		/******************************************
		 * fancy Box 팝업호출
		 ******************************************/
		J("#anchor").fancybox();

		/******************************************
		 * 엑셀다운로드 버튼 클릭 이벤트
		 ******************************************/
		J("#btnExcelDown").click(function() {
			excelDownload();
			return false;
		});

	});

	/******************************************
	 * 반려팝업호출

	function returnPop() {
		J("#year").val(J("#findYear").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#scDeptNm").val(J("#findScDeptNm").val());
		J("#mode").val("STATUS");
		J("#anchor").attr("href","$!{context_path}/bsc/module/commModule/popReturnInput.vw?findYear=$!{searchMap.txt2html("year")}");
		J("#anchor").click();
	}
	******************************************/

	/******************************************
	 * 반려조회 팝업호출

	function returnCauseViewPop() {
		var year = J("#findYear").val();
		var scDeptId = J("#findScDeptId").val();
		J("#anchor").attr("href","$!{context_path}/bsc/module/commModule/popReturnView.vw?year=" + year + "&amp;scDeptId=" + scDeptId);
		J("#anchor").click();
	}
	******************************************/

	/******************************************
	 * 승인상태 처리
	 ******************************************/
	function statusDo() {
		J("#year").val(J("#findYear").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#scDeptNm").val(J("#findScDeptNm").val());
		J("#mode").val("STATUS");
		J("#formList").attr("action", "$!{context_path}/bsc/base/metric/metricProcess.vw?type=template").submit();
		return false;
	}

	/******************************************
	 * 지표가중치 합계 가져오기
	 ******************************************/
	function getWeightSum() {
		var findYear = J("#findYear").val();
		var findScDeptId = J("#findScDeptId").val();
		var findUseYn = J("#findUseYn").val();

		J.ajax({
			url        : "$!{context_path}/bsc/base/metric/metricWeightSum_ajax.vw",
        	type       : "POST",
			data       : "findYear=" + findYear + "&amp;findScDeptId=" + findScDeptId + "&amp;findUseYn=" + findUseYn,
        	dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success    : function (xml) {
				if(J(xml).find("items").find("item").length > 0) {
					J(xml).find("items").find("item").each(function() {
                        var weightSum = J(this).find("weightSum").text();
						J("#weightSum").text(weightSum);

						if(weightSum != "100") {
							J("#weightAlert").show();
						} else {
							J("#weightAlert").hide();
						}
                    });
				}
        	},
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}

	/******************************************
	 * 조직별 담당자 및 KPI 승인상태 가져오기
	 ******************************************/
	function getScDeptInfo() {
		var findYear = J("#findYear").val();
		var findScDeptId = J("#findScDeptId").val();

		J.ajax({
			url        : "$!{context_path}/bsc/base/metric/scDeptInfo_ajax.vw",
        	type       : "POST",
			data       : "findYear=" + findYear + "&amp;findScDeptId=" + findScDeptId,
        	dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success    : function (xml) {
				var approveStatusId = "";
				var approveStatusNm = "";
				var bscUserId = "";
				var managerUserId = "";

				if(J(xml).find("items").find("item").length > 0) {
					J(xml).find("items").find("item").each(function() {
						approveStatusId = J(this).find("approveStatusId").text();
						approveStatusNm = J(this).find("approveStatusNm").text();
						bscUserId = J(this).find("bscUserId").text();
						managerUserId = J(this).find("managerUserId").text();

						J("#approveStatus").text(approveStatusNm);
						J("#bscUserId").val(bscUserId);
						J("#managerUserId").val(managerUserId);
                    });
				}

				//버튼설정
				buttonEnableSet(approveStatusId);
        	},
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}


	/******************************************
	 * 버튼 설정
	 ******************************************/
	function buttonEnableSet(approveStatusId) {

		#if(!$CS_LOGIN.chkAuthGrp("01") && !$CS_LOGIN.chkAuthGrp("60"))
			#if($!{kpiClosingYn} == 'Y')
				J("#blockButton > ul > li").hide(); //모든 버튼 숨김
				return;
			#end
		#end

		var bscUserId = J("#bscUserId").val();
		var managerUserId = J("#managerUserId").val();
		var bscUserAdmin = false;     //부서담당자 권한(지표입력자)
		var managerUserAdmin = false; //부서장(지표승인자)

		//부서담당자 권한체크
		if("$!{CS_LOGIN.getUser_id()}" == bscUserId) {
			bscUserAdmin = true;
		}

		//부서장 권한체크
		if("$!{CS_LOGIN.getUser_id()}" == managerUserId) {
			managerUserAdmin = true;
		}

		J("#bReturnView").hide(); //반려조회
		J("#bKpiMove").hide();    //지표이동
		J("#bKpiCopy").hide();    //지표복사
		J("#bReturn").hide();     //반려
		J("#bRequest").hide();    //승인요청
		J("#bApprove").hide();    //승인
		J("#bCancle").hide();     //승인취소
		J("#bModify").hide();     //일괄수정
		J("#bInsert").hide();     //신규
		J("#bDelete").hide();     //삭제

		if(approveStatusId.length == 0 || approveStatusId == "02") { //지표입력중

			if(bscUserAdmin) { //부서담당자
    			J("#bKpiMove").show();    //지표이동
    			J("#bKpiCopy").show();    //지표복사
				J("#bRequest").show();    //승인요청
    			J("#bModify").show();     //일괄수정
    			J("#bInsert").show();     //신규
    			J("#bDelete").show();     //삭제
			}

			if($!{CS_LOGIN.chkAuthGrp("01")} || $!{CS_LOGIN.chkAuthGrp("60")}) { //전체관리자
    			J("#bKpiMove").show();    //지표이동
    			J("#bKpiCopy").show();    //지표복사
				J("#bRequest").show();    //승인요청
    			J("#bModify").show();     //일괄수정
    			J("#bInsert").show();     //신규
    			J("#bDelete").show();     //삭제
			}

		} else if(approveStatusId == "03") { //지표승인요청시

			if(managerUserAdmin) { //부서장
				J("#bReturn").show();     //반려
				J("#bApprove").show();    //승인
			}

			if($!{CS_LOGIN.chkAuthGrp("01")} || $!{CS_LOGIN.chkAuthGrp("60")}) { //전체관리자
				J("#bReturn").show();     //반려
				J("#bApprove").show();    //승인
			}

		} else if(approveStatusId == "04") { //지표승인완료시
			if(managerUserAdmin) { //부서장
				J("#bReturn").show();     //반려
			}

			if($!{CS_LOGIN.chkAuthGrp("01")} || $!{CS_LOGIN.chkAuthGrp("60")}) { //전체관리자
				J("#bReturnView").show(); //반려조회
    			J("#bKpiMove").show();    //지표이동
    			J("#bKpiCopy").show();    //지표복사
				J("#bReturn").show();     //반려
				//J("#bCancle").show();     //승인취소
    			J("#bModify").show();     //일괄수정
    			J("#bInsert").show();     //신규
    			J("#bDelete").show();     //삭제
			}

		} else if(approveStatusId == "05") { //지표반려시
			if(bscUserAdmin) { //부서담당자
				J("#bReturnView").show(); //반려조회
    			J("#bKpiMove").show();    //지표이동
    			J("#bKpiCopy").show();    //지표복사
				J("#bRequest").show();    //승인요청
    			J("#bModify").show();     //일괄수정
    			J("#bInsert").show();     //신규
    			J("#bDelete").show();     //삭제
			}

			if($!{CS_LOGIN.chkAuthGrp("01")} || $!{CS_LOGIN.chkAuthGrp("60")}) { //전체관리자
    			J("#bKpiMove").show();    //지표이동
    			J("#bKpiCopy").show();    //지표복사
				J("#bRequest").show();    //승인요청
    			J("#bModify").show();     //일괄수정
    			J("#bInsert").show();     //신규
    			J("#bDelete").show();     //삭제
			}
		}
	}

	/******************************************
	 * jqGrid 가중치
	 ******************************************/
	function linkWeight(cellvalue, options, rowObject) {
		return '<input type="text" name="weights" value="' + cellvalue + '" class="wp70" maxlength="6" />';
	}

	/******************************************
	 * jqGrid 수정페이지 링크
	 ******************************************/
	function linkUpdate(cellvalue, options, rowObject) {
		var str = cellvalue;

		if(rowObject.UP_METRIC_ID != "") {
			str = "<img src=\'$!{img_path}/tree.gif\' align='absmiddle'>" + str
		}

		return '<a href=javascript:goModify(' + options.rowId + ')>' + str + '<//a>';
	}

	/******************************************
	 * 그리드 ajax 조회
	 ******************************************/
	function goGridSearch() {
		J("#list").setGridParam({url:"$!{context_path}/bsc/base/metric/metricList_xml.vw?"+J("#formFind").serialize(), datatype:"json"});
		J("#list").trigger("reloadGrid");
	}

	/******************************************
	 * 수정
	 ******************************************/
	function goModify(rowId) {
		var ret = J("#list").jqGrid('getRowData',rowId);
		J("#metricId").val(ret.METRIC_ID);
		J("#year").val(J("#findYear").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#scDeptNm").val(J("#findScDeptNm").val());
		//J("#findSearchCodeId").val(J("#findScDeptId").val());
		J("#mode").val("MOD");
		J("#formList").attr("action", "$!{context_path}/bsc/base/metric/metricModify.vw?type=template").submit();
	}

	/******************************************
	 * 삭제
	 ******************************************/
	function goDelete() {
		if(!J.gridSelectChk("list")){
			J.showMsgBox("삭제할 데이터를 선택하십시요", null, null);
		} else {
			J.showConfirmBox("삭제하시겠습니까?", "deleteDo"); //deleteDo() 콜백함수 호출
		}
	}

	/******************************************
	 * 삭제처리
	 ******************************************/
	function deleteDo() {
		var id = J("#list").getGridParam('selarrrow');
		var ids = J("#list").jqGrid('getDataIDs');
		var rowdata = "";
		var metricIds = "";

		for (var i = 0; i < ids.length; i++) {
			J.each(id, function (index, value) {
				if (value == ids[i]) {
					rowdata = J("#list").getRowData(ids[i]);
					metricIds += rowdata.METRIC_ID + '|';
				}
			});
		}

		J("#year").val(J("#findYear").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#scDeptNm").val(J("#findScDeptNm").val());
		J("#metricIds").val(metricIds);
		J("#mode").val("DEL");
		J("#formList").attr("action", "$!{context_path}/bsc/base/metric/metricProcess.vw?type=template").submit();
		return false;
	}

	/******************************************
	 * 조직트리 선택
	 ******************************************/
	function goAction(code, name) {
		var scDeptNm = J(name).text();
		J("#findScDeptId").val(code);
		J("#findScDeptNm").val(scDeptNm);
		goGridSearch();
	}

	/******************************************
	 * 지표복사체크
	 ******************************************/
	function goMetricCopy() {
		if(!J.gridSelectChk("list")){
			J.showMsgBox("복사할 $!{METRIC_NM}를 선택하십시요", null, null);
		} else {
			metricCopyPop();
		}
	}

	/******************************************
	 * 지표복사
	 ******************************************/
	function metricCopyPop() {
		var id = J("#list").getGridParam('selarrrow');
		var ids = J("#list").jqGrid('getDataIDs');
		var rowdata = "";
		var metricIds = "";

		for (var i = 0; i < ids.length; i++) {
			J.each(id, function (index, value) {
				if (value == ids[i]) {
					rowdata = J("#list").getRowData(ids[i]);
					metricIds += rowdata.METRIC_ID + '|';
				}
			});
		}

		J("#year").val(J("#findYear").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#scDeptNm").val(J("#findScDeptNm").val());
		J("#metricIds").val(metricIds);

		var scDeptId = J("#findScDeptId").val();
		J("#anchor").attr("href","$!{context_path}/bsc/module/commModule/popScDeptList.vw?findYear=$!{searchMap.txt2html("findYear")}&amp;scDeptId=" + scDeptId);
		J("#anchor").click();
		return false;
	}

	/******************************************
	 * 지표복사 처리
	 ******************************************/
	function metricCopyDo() {
		J("#year").val(J("#findYear").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#scDeptNm").val(J("#findScDeptNm").val());
		J("#mode").val("COPY");
		J("#formList").attr("action", "$!{context_path}/bsc/base/metric/metricProcess.vw?type=template").submit();
		return false;
	}

	/******************************************
	 * 지표이동체크
	 ******************************************/
	function goMetricMove() {
		if(!J.gridSelectChk("list")){
			J.showMsgBox("이동할 $!{METRIC_NM}를 선택하십시요", null, null);
		} else {
			metricMovePop();
		}
	}

	/******************************************
	 * 지표이동
	 ******************************************/
	function metricMovePop() {
		var id = J("#list").getGridParam('selarrrow');
		var ids = J("#list").jqGrid('getDataIDs');
		var rowdata = "";
		var metricIds = "";

		for (var i = 0; i < ids.length; i++) {
			J.each(id, function (index, value) {
				if (value == ids[i]) {
					rowdata = J("#list").getRowData(ids[i]);
					metricIds += rowdata.METRIC_ID + '|';
				}
			});
		}

		J("#year").val(J("#findYear").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#scDeptNm").val(J("#findScDeptNm").val());
		J("#metricIds").val(metricIds);

		var year = J("#findYear").val();
		var findSearchCodeId = J("#findScDeptId").val();
		J("#anchor").attr("href","$!{context_path}/bsc/module/commModule/popScDeptTree.vw?findYear=" + year + "&amp;findSearchCodeId=" + findSearchCodeId);
		J("#anchor").click();
		return false;
	}

	/*****************************************************
	 * 지표이동 조직선택 설정
	 *****************************************************/
	function setDeptInfoPop(scDeptId, scDeptNm) {
		J.fancybox.close();

		J("#targetScDeptId").val(scDeptId);
		J("#year").val(J("#findYear").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#scDeptNm").val(J("#findScDeptNm").val());
		J("#mode").val("MOVE");
		J("#formList").attr("action", "$!{context_path}/bsc/base/metric/metricProcess.vw?type=template").submit();
		return false;
	}

	/******************************************
	 * 엑셀다운로드
	 ******************************************/
	function excelDownload(){
		J("#year").val(J("#findYear").val());
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#useYn").val(J("#findUseYn").val());
		J("#yearNm").val(J("#findYear > option:selected").text());
		J("#useYnNm").val(J("#findUseYn > option:selected").text());
		J("#formList").attr("action", "$!{context_path}/bsc/base/metric/metricListExcel.vw?type=excel").submit();
		return false;
	}
//]]>
</script>

<div id="Table">
	<div id="Table_blockContainer">
		<h1 class="none">조직별$!{METRIC_NM}관리</h1>
		<div class="tableTop">
			#parse("/WEB-INF/vl/common/template/tabs.vm")

    		<!-- search S -->
			<form id="formFind" name="formFind" method="post" action="$!{context_path}/bsc/base/metric/metricList.vw?type=template">
				<input type="hidden" 	id="oldYear"		name="oldYear"			value="$!{searchMap.txt2html("findYear")}" />
				<input type="hidden"	id="findHighPgmId"	name="findHighPgmId"	value="$!{searchMap.txt2html("findHighPgmId")}" />
				<input type="hidden" 	id="findSubPgmId"	name="findSubPgmId"		value="$!{searchMap.txt2html("findSubPgmId")}" />
				<input type="hidden"	id="findPgmId"		name="findPgmId"		value="$!{searchMap.txt2html("findPgmId")}" />

				<div class="searchBox">
    				<div><div><div>
    				<table summary="조직별$!{METRIC_NM} 관리검색 조건">
						<caption class="none">조직별$!{METRIC_NM}관리 검색 조건</caption>
						<thead><tr><th></th></tr></thead>
        				<tbody>
            				<tr>
								<td class="searchBox_tit w180">
            						<span><label for="findYear">$!{YEAR}</label></span>
            						<span class="searchBar">
            							<select id="findYear" name="findYear" class="select w80">
            								$!CS_CODE.getCodeOption("017", $!{searchMap.txt2html("findYear")})
            							</select>
            						</span>
            					</td>
								<td class="searchBox_tit w250">
            						<span><label for="findScDeptNm">$!{SC_DEPT_NM}</label></span>
            						<span class="searchBar">
										<input type="hidden" id="findScDeptId" name="findScDeptId" value="$!{searchMap.txt2html("scDeptId")}"/>
										<input type="text" id="findScDeptNm" name="findScDeptNm" value="$!{searchMap.txt2html("scDeptNm")}" class="disable" readonly="readonly"/>
            						</span>
            					</td>
            					<td class="searchBox_tit w200">
                                    <span><label for="findUseYn">사용여부</label></span>
            						<span class="searchBar">
            							<select id="findUseYn" name="findUseYn" class="select w70">
            								$!CS_CODE.getCodeOption("011", $!{searchMap.txt2html("findUseYn")})
            							</select>
            						</span>
            					</td>
								<td class="searchBox_tit w140">
									<span>$!{WEIGHT}합계 : </span>
            						<span id="weightSum" class="searchBar"></span>
            					</td>
								<!--
								<td class="searchBox_tit w140">
									<span>$!{METRIC_NM}승인상태 : </span>
            						<span id="approveStatus" class="searchBar"></span>
            					</td>
								-->
            				</tr>
        				</tbody>
    				</table>
                    <input type="image" class="btnSearch" src="$!{img_path}/common/btn_search.gif" align="middle" alt="검색" />
                    </div></div></div>
    	        </div>
    		</form>
    		<!-- search E -->
			<div class="clear"></div>
		</div>

		<form id="formList" name="formList" method="post" action="$!{context_path}/bsc/base/metric/metricProcess.vw?type=template">
			<input type="hidden" id="mode"       	    name="mode" />
			<input type="hidden" id="year"		 	    name="year" />
			<input type="hidden" id="metricIds"  	    name="metricIds" />
			<input type="hidden" id="metricId"   	    name="metricId" />
			<input type="hidden" id="scDeptId"   	    name="scDeptId" />
			<input type="hidden" id="scDeptNm"   	    name="scDeptNm" />
			<input type="hidden" id="status"    	    name="status" />
			<input type="hidden" id="returnCause"	    name="returnCause" />
			<input type="hidden" id="targetScDeptIds"	name="targetScDeptIds" />
			<input type="hidden" id="targetScDeptId"	name="targetScDeptId" />
			<input type="hidden" id="bscUserId"			name="bscUserId" />
			<input type="hidden" id="managerUserId"		name="managerUserId" />
			<input type="hidden" id="yearNm"        	name="yearNm" />
			<input type="hidden" id="useYn"        		name="useYn" />
			<input type="hidden" id="useYnNm"      	 	name="useYnNm" />
			$!{searchMap.makeHiddenFind()}
		</form>

		<div id="splitterBox">
			<div>
				<!-- 조직트리 Start -->
				<div class="blockGridTreeTable">
					#parse("/WEB-INF/vl/bsc/module/commModule/commonTree.vm")
				</div>

				<div id="mainListData">
					<!-- 데이터그리드 Start -->
					<div class="blockGridListTable floatRight">
						<table id="list" summary="조직별$!{METRIC_NM}관리 조회결과">
							<caption class="none">조직별$!{METRIC_NM}관리 조회</caption>
							<thead><tr><th></th></tr></thead>
							<tbody><tr><td></td></tr></tbody>
						</table>
						<div id="pager"></div>
					</div>
					<!--// 데이터그리드 End -->
					<div class="blockButton_all floatLeft">
						<div class="blockButton" style="float:left; text-align:left; width:145px;">
							<input id="btnExcelDown" type="button" align="middle" value="엑셀변환" alt="엑셀다운로드" /><br/>
								<!-- 성과평가부에서 입력을 하기 때문에 지표등록기간체크 없음
								#if($!{kpiClosingYn} == 'Y')
									<span id="closeAlert" class="txt_blue">※$!{METRIC_NM}입력이 마감되었습니다.</span><br/>
								#end
								#if($!{kpiInputTermYn} == 'N')
									<span id="closeAlert" class="txt_blue">※$!{METRIC_NM}입력 기한이 아닙니다.</span><br/>
								#end
								-->
								<span id="weightAlert" class="txt_red2 none">※$!{WEIGHT} 합계가 100이 되어야 합니다. 재조정 해주세요.</span><br/>
						</div>
						<div id="blockButton" class="blockButton">
							<ul>
								##<li id="bReturnView" style="display:none"><input type="button" id="btnReturnView" value="반려조회" /></li>
								<li id="bKpiMove" style="display:none"><input type="button" id="btnKpiMove" value="$!{METRIC_NM}이동" /></li>
								<li id="bKpiCopy" style="display:none"><input type="button" id="btnKpiCopy" value="$!{METRIC_NM}복사" /></li>
								<!--<li id="bRequest" style="display:none"><input type="button" id="btnRequest" value="승인요청" /></li>-->
								##<li id="bReturn"  style="display:none"><input type="button" id="btnReturn"  value="반려" /></li>
								<li id="bApprove" style="display:none"><input type="button" id="btnApprove" value="승인" /></li>
								<!-- <li id="bCancle"  style="display:none"><input type="button" id="btnCancle"  value="승인취소" /></li> -->
								<li id="bModify"  style="display:none"><input type="button" id="btnModify"  value="일괄수정" /></li>
								<li id="bInsert"  style="display:none"><input type="button" id="btnInsert"  value="신규" /></li>
								<li id="bDelete"  style="display:none"><input type="submit" id="btnDelete"  value="삭제" /></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<a id="anchor"></a>
	<div class="clear"></div>
</div>
