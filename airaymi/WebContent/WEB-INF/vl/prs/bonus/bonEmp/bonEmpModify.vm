#*************************************************************************
* CLASS 명      : BonEmpModify
* 작 업 자      : 지원길
* 작 업 일      : 2013년 6월 18일
* 기    능      : 직원성과급 조회
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     지원길      2013년 06월 18일             최 초 작 업
**************************************************************************#
#set($curr_url = $!{context_path} + "/prs/bonus/bonEmp/bonEmpInfoList_xml.vw")
<script type="text/javascript" language="javascript" >
//<![CDATA[

    var J = jQuery;

    J(document).ready(function(){

        /******************************************
         * 데이터 그리드 출력
         ******************************************/
        var str = J('#formFind').serialize();
        jQuery("#list").jqGrid({
            url          :"$!{context_path}/prs/bonus/bonEmp/bonEmpInfoList_xml.vw" + "?" + str,
            mtype        :"POST",
            datatype     :"json",
            jsonReader   : {
                            page   : "page",
                            total  : "total",
                            root   : "rows",
                            records: function(obj){return obj.length;},
                            repeatitems: false,
                            id     : "id"
                           },
            height       : $!{jqGrid_height},
            width        : $!{jqGrid_r_width},
            colNames     :[ '일련번호', '평가년도', '사번', '성명', '직급코드','직급', '직위코드','직위', '부서코드','부서명', '근무시작일', '근무종료일', '기본급', '근무<br/>월수<br/>(월)', '자체<br/>지급률<br/>(%)', '정평<br/>지급률<br/>(%)', '차등<br/>지급률<br/>(%)', '자체성과급<br/>(원)', '정평성과급<br/>(원)', 'CNT','INDEX','총지급액<br/>(원)'],
            colModel     :[
                            {name:'SEQ'      			,index:'SEQ'				,width:10   	,align:'center'		},
                            {name:'YEAR'      			,index:'YEAR'				,width:10   	,align:'center'		},
                            {name:'EMPN'      			,index:'EMPN'				,width:50   	,align:'center'		},
                            {name:'KOR_NM'				,index:'KOR_NM'				,width:50   	,align:'center'		},
                            {name:'CAST_TC'				,index:'CAST_TC'			,width:50   	,align:'center'		},
                            {name:'CAST_TC_NM'			,index:'CAST_TC_NM'			,width:40   	,align:'center'		},
                            {name:'POS_TC'				,index:'POS_TC'				,width:10   	,align:'center'		},
                            {name:'POS_TC_NM'			,index:'POS_TC_NM'			,width:80   	,align:'center'		},
                            {name:'DEPT_CD'				,index:'DEPT_CD'			,width:10    	,align:'center'	  	},
                            {name:'DEPT_KOR_NM'     	,index:'DEPT_KOR_NM'		,width:100    	,align:'left' 		},
                            {name:'START_PCMT_DATE'		,index:'START_PCMT_DATE'	,width:80   	,align:'center' 	},
                            {name:'END_PCMT_DATE'		,index:'END_PCMT_DATE'		,width:80   	,align:'center' 	},
                            {name:'PAY'					,index:'PAY'				,width:80   	,align:'center' , cellattr: attr1Setting},
                            {name:'WORK_MON'			,index:'WORK_MON'			,width:40   	,align:'center'		},
                            {name:'INSIDE_REAL_RATE'	,index:'INSIDE_REAL_RATE'	,width:50   	,align:'center'		},
                            {name:'GOV_EMP_REAL_RATE'	,index:'GOV_EMP_REAL_RATE'	,width:50   	,align:'center'		},
                            {name:'ORG_GRA_RATE'		,index:'ORG_GRA_RATE'		,width:50   	,align:'center'		},
                            {name:'INSIDE_PAY'			,index:'INSIDE_PAY'			,width:80   	,align:'right'		},
                            {name:'GOV_PAY'				,index:'GOV_PAY'			,width:80   	,align:'right' 	},
                            {name:'TOT_CNT'				,index:'TOT_CNT'			,width:10   	,align:'center'		,sortable:false},
                            {name:'TOT_INDEX'			,index:'TOT_INDEX'			,width:10   	,align:'right' 	,sortable:false},
                            {name:'TOT_PAY'				,index:'TOT_PAY'			,width:80   	,align:'right' 	, cellattr: attr1Setting}


                            ],
            rowNum       : $!{jqGrid_rownum},
            autowidth    : false,
            viewrecords  : true,
            loadonce     : false,
            multiselect  : false,
            cellEdit     : true,
            gridview     : true,
            cmTemplate: {sortable:false},
            caption:"개인급여 조회 "
        }).jqGrid('hideCol',"SEQ").jqGrid('hideCol',"YEAR").jqGrid('hideCol',"POS_TC").jqGrid('hideCol',"CAST_TC").jqGrid('hideCol',"DEPT_CD").jqGrid('hideCol',"TOT_CNT").jqGrid('hideCol',"TOT_INDEX").setGridWidth($!{jqGrid_r_width});

        /******************************************
         * 조회
         ******************************************/
        J("#formFind").submit(function(event) {
            //submit 하기전 작업추가
        });

        /******************************************
         * 저장
         ******************************************/
        J("#btnInsert").click(function(e) {
            e.preventDefault();

            saveChk();
        });

        /******************************************
		 * 취소버튼 (돌아가기)
		 ******************************************/
		J("#btnBack").click(function() {
			J("#formFind").attr("action", "$!{context_path}/prs/bonus/bonEmp/bonEmpList.vw?type=template").submit();
		});

		/******************************************
         * 직원성과급 엑셀다운로드 버튼 클릭 이벤트
         ******************************************/
        J("#btnInsaDown").click(function() {
            insaExcelDownload();
            return false;
        });

        /******************************************
         * fancy Box 팝업호출
         ******************************************/
        J("#anchor").fancybox();
		});

    /******************************************
     * 조직선택 클릭이벤트
     ******************************************/
    function goAction(deptCd, deptNm) {
        setDeptInfo(deptCd, deptNm);
    }

    /*****************************************************
     * 조직선택 설정
     *****************************************************/
    function setDeptInfo(deptCd, deptNm) {

        J("#findDeptCd").val(deptCd);
        J("#findDeptNm").val(J(deptNm).text());

        J("#formFind").attr("action", "$!{context_path}/prs/bonus/bonEmp/bonEmpList.vw?type=template").submit();

    }

      /*****************************************************
     * 부서명선택 설정
     *****************************************************/
    function setDeptInfoPop(deptCd, deptNm) {

        var index = J("#index").val();
        J("input[name=deptCds]").eq(index-1).val(deptCd);
        J("input[name=deptNms]").eq(index-1).val(J(deptNm).text());
        J.fancybox.close();

    }

    /******************************************
     * 직원성과급 엑셀다운로드
     ******************************************/
    function insaExcelDownload(){
        J("#yearNm").val(J("#findYear > option:selected").text());
        J("#formList").attr("action", "$!{context_path}/prs/bonus/bonEmp/bonEmpExcel.vw?type=excel").submit();
        return false;
    }

    /*****************************************
	 * 데이터 Rowspan 설정
	 ******************************************/
	function attr1Setting(rowId, val, rowObject, cm) {
		var result;
		var index = rowObject.TOT_INDEX;
		var rowSpan = rowObject.TOT_CNT;

		if(index == 1) {
			result = ' rowspan="' + rowSpan + '"';
		} else {
			result = ' style="display:none"';
		}

		return result;
	}

//]]>
</script>

<div id="Table">
    <div id="Table_blockContainer">
        <h1 class="none">직원성과급 설정</h1>
        <div class="tableTop">
            #parse("/WEB-INF/vl/common/template/tabs.vm")

            <!-- search S -->
            <form id="formFind" name="formFind" method="post" action="$!{context_path}/prs/bonus/bonEmp/bonEmpList.vw?type=template">
                <input type="hidden"		id="findHighPgmId"  name="findHighPgmId"    value="$!{searchMap.txt2html("findHighPgmId")}" />
                <input type="hidden"		id="findSubPgmId"   name="findSubPgmId"     value="$!{searchMap.txt2html("findSubPgmId")}" />
                <input type="hidden"		id="findPgmId"      name="findPgmId"        value="$!{searchMap.txt2html("findPgmId")}" />
                <input type="hidden"		id="findDeptCd"   	name="findDeptCd"     	value="$!{searchMap.txt2html("findDeptCd")}" />
                <input type="hidden"		id="findDeptNm"   	name="findDeptNm"    	value="$!{searchMap.txt2html("findDeptNm")}" />
				<input type="hidden"		id="findEmpn"		name="findEmpn"			value="$!{searchMap.txt2html("empn")}" />
				<input type="hidden"		id="findKorNm"		name="findKorNm"		value="$!{searchMap.txt2html("korNm")}" />

                <div class="searchBox">
                    <div><div><div>
                    <table summary="직원성과급 설정 검색 조건">
                        <caption class="none">직원성과급 설정 검색 조건</caption>
                        <thead><tr><th></th></tr></thead>
                        <tbody>
                            <tr>
                                <td class="searchBox_tit w250">
                                    <span><label for="findYear">평가년도</label></span>
                                    <span class="searchBar">
                                        <select id="findYear" name="findYear" class="select w80">
                                            $!CS_CODE.getCodeOption("017", $!{searchMap.txt2html("findYear")})
                                        </select>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <input type="image" class="btnSearch" src="$!{img_path}/common/btn_search.gif" align="middle" alt="검색" />
                    </div></div></div>
                </div>
            </form>
            <!-- search E -->
            <div class="clear"></div>
        </div>

        <form id="formList" name="formList" method="post" action="$!{context_path}/prs/bonus/bonEmp/bonEmpProcess.vw?type=template">
            <input type="hidden" id="mode"			name="mode" />
            <input type="hidden" id="year"			name="year" />
            <input type="hidden" id="empn"  		name="empn" />
            <input type="hidden" id="seq"  			name="seq" 	/>


            $!{searchMap.makeHiddenFind()}
            <div id="splitterBox">
                <div>

                    <!-- 조직트리 Start -->
                    <div class="blockGridTreeTable">
                        #parse("/WEB-INF/vl/prs/insa/dept/deptTree.vm")
                    </div>

                    <!-- 데이터그리드 Start -->
                    <div class="blockGridListTable floatRight">
                        <table id="list" summary="직원성과급 설정 조회결과">
                            <caption class="none">직원성과급 설정 조회</caption>
                            <thead><tr><th></th></tr></thead>
                            <tbody><tr><td></td></tr></tbody>
                        </table>
                        <div id="pager"></div>
                    </div>
                    <!--// 데이터그리드 End -->
                    <div class="blockButton_all floatLeft">
                        <div class="blockButton">
                            <ul>
                                <li><input type="button" id="btnBack" 		value="돌아가기" /></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <a id="anchor"></a>
    <div class="clear"></div>
</div>
