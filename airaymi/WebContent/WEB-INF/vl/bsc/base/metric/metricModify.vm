#*************************************************************************
* CLASS 명      : metricModify
* 작 업 자      : 하윤식
* 작 업 일      : 2012년 6월 26일
* 기    능      : 조직별KPI관리
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자    작     업     일        변 경 내 용          비고
* ----  --------  -----------------  -------------------------  --------
*  1    하윤식      2012년 6월 26일           최 초 작 업
**************************************************************************#

<script type="text/javascript" language="javascript">
//<![CDATA[

	var J = jQuery;

	J(document).ready(function(){

		/******************************************
		 * 취소버튼 (돌아가기)
		 ******************************************/
		J("#btnBack").click(function() {
			J("#form1").attr("action", "$!{context_path}/bsc/base/metric/metricList.vw?type=template").submit();
		});

		/******************************************
		 * 저장버튼 이벤트
		 ******************************************/
		J("#btnInsert").click(function(e) {
			e.preventDefault();
			saveChk();
		});

		/******************************************
		 * 저장버튼 이중 클릭 방지
		 ******************************************/
		J("form").submit(function(){
			J("#btnInsert").unbind();
		});

		/******************************************
		 * 실적산식 검증버튼 이벤트
		 ******************************************/
		J("#btnActCalType").click(function(e) {
			checkModifyCalType();
		});

		/******************************************
		 * 비고 byte 체크
		 ******************************************/
		J("#kpiPurpose").checkbyte({
			indicator:J("#kpiPurposeIndicator"),
			limit:3000
		});
		J("#kpiPurpose").trigger("keyup");

		/******************************************
		 * 득점산식 구간대 변경이벤트
		 ******************************************/
		J("#scoreCalTypeGubun").bind('change', function() {
			dispSection();
		});

		/******************************************
		 * 평가유형(정량/정성) selectBox 변경이벤트
		 ******************************************/
		J("#typeId").bind('change', function() {
			onChgTypeid();
		});

		/******************************************
		 * fancy Box 팝업호출
		 ******************************************/
		J("#insertUserSearch").fancybox();  //KPI 담당자
		J("#approveUserSearch").fancybox(); //실적 승인자
		J("#upMetricSearch").fancybox();    //상위KPI 조회
		J("#targetInsert").fancybox();      //목표입력
		J("#anchor").fancybox();            //실적연계 항목 팝업

		/******************************************
		 * 목표/실적 공유여부 변경시 이벤트
		 ******************************************/
		J(":input:radio[name=tamShareYn]").click(function(){
			setTamShareYn();
        });

		$("#stretchGoal").numeric(); //숫자만 입력받기
		$("#stretchGoal").css("ime-mode", "disabled"); //한글사용 비활성화

		/******************************************
		 * 조회
		 ******************************************/
		J("#formFind").submit(function(event) {

		});

		/******************************************
		 * 조정계수 숫자만 입력받기
		 ******************************************/
		J("#adjustRate").numeric({allow:"."});
		J("#adjustRate").css("ime-mode", "disabled"); //한글사용 비활성화

		/******************************************
		 * 화면 초기셋팅
		 ******************************************/
		init();
	});

	/******************************************
	 * 필수입력 체크
	 ******************************************/
	function saveChk() {
	 	/*
		if (J("input[name=metricPropertyId]:checked").val() == undefined) {
			J.showMsgBox("연계유형을 선택해 주십시요", null, "metricPropertyId");
			return;
		}
		*/

		if(!J.checkLength("metricNm", "$!{METRIC_NM}명", 1, 150)) {
			return;
		}

        if( !LengthCheck(J("#description").val(), "설명", 0, 300 ) ) {
            J("#description").focus();
            return;
        }

		/*
		if(J("#strategyId").val() == "") {
			J.showMsgBox("$!{STRATEGY_NM}를 선택해 주십시요", null, "strategyId");
			return;
		}


		if (J("input[name=bscMetricGbn]:checked").val() == undefined) {
			J.showMsgBox("$!{METRIC_NM} 유형을 선택해 주십시요", null, "bscMetricGbn");
			return;
		}
		*/

        if(J("#tgtInsertGubun").val() == "") {
            J.showMsgBox("목표입력구분을 선택해 주십시요", null, "tgtInsertGubun");
            return;
        }

        if(J("#tgtInsertGubun").val() == "01" || J("#tgtInsertGubun").val() == "01" ){
            if( J("#itemCd").val() == "" ){
                J.showMsgBox("목표입력구분이 시스템 또는 엑셀일 경우에는 연계항목을 입력해야 합니다.", null, "itemNm");
                return;
            }
        }

		if(J("#evalCycle").val() == "") {
			J.showMsgBox("주기를 선택해 주십시요", null, "evalCycle");
			return;
		}

		if(J("#timeRollup").val() == "") {
			J.showMsgBox("기간합산을 선택해 주십시요", null, "timeRollup");
			return;
		}

		if(J("#typeId").val() == "01"){ //정량지표일 경우
    		if(J("#unit").val() == "") {
    			J.showMsgBox("단위를 선택해 주십시요", null, "unit");
    			return;
    		}
		}

        if(J("#typeId").val() == "01"){ //정량지표일 경우
            if(J("input[name=actMon]:checked").length==0){
                J.showMsgBox("측정주기를 선택해 주십시요", null, null);
                return;
            }
        }

        if( !LengthCheck(J("#kpiPurpose").val(), "지표정의", 0, 3000 ) ) {
            J("#kpiPurpose").focus();
            return;
        }

		if(J("#typeId").val() == "01"){ //정량지표일 경우
    		if(!J.checkLength("actCalType", "실적산식", 1, 500)) {
    			return;
    		}

			//실적산식 입력 체크
    		if(!actCalTypeColSaveChk()) return;

			if((J("#scoreCalTypeGubun").val() == "01" || J("#scoreCalTypeGubun").val() == "03") && J("#scoreCalTypeId").val() == "") {
    			J.showMsgBox("득점산식을 선택해 주십시요", null, "scoreCalTypeId");
    			return;
    		}

            //구간 입력 체크
            if(!scoreCalTypeSaveChk()) return;

            //구간대처리
            if(!calEvalSection()) return;

		}

		J.showConfirmBox("저장하시겠습니까?", "saveDo"); //saveDo() 콜백함수 호출
	}


    /******************************************
     * 등록구간 입력 체크
     ******************************************/
    function scoreCalTypeSaveChk() {
        var saveChk = true;

        if( J("#scoreCalTypeGubun").val() == "02" || J("#scoreCalTypeGubun").val() == "03" || J("#scoreCalTypeGubun").val() == "04" ) {

            J("input[name=conversionScores]", "#evalSectionArea").each(function(index, item) {
                if(J(item).val() == "") {
                    J.showMsgBox("환산점수를 입력해 주십시요", null, J('input[name=conversionScores]').eq(index));
                    saveChk = false;
                    return false;
                }
                if( isNaN(J(item).val())) {
                    J.showMsgBox("환산점수을 숫자만 입력 가능합니다.", null, J('input[name=conversionScores]').eq(index));
                    saveChk = false;
                    return false;
                }
            });

            J("input[name=viewValues]", "#evalSectionArea").each(function(index, item) {
                if(J(item).val() == "") {
                    J.showMsgBox("점수구간을 입력해 주십시요", null, J('input[name=viewValues]').eq(index));
                    saveChk = false;
                    return false;
                }
                if( isNaN(J(item).val())) {
                    J.showMsgBox("점수구간을 숫자만 입력 가능합니다.", null, J('input[name=viewValues]').eq(index));
                    saveChk = false;
                    return false;
                }
            });

        }

        return saveChk;
    }

	/******************************************
	 * 산식항목 입력 체크
	 ******************************************/
	function actCalTypeColSaveChk() {
		var saveChk = true;

		//단위 체크
		J("select[name=units]", "#actCalTypeArea").each(function(index, item) {
			if(J(item).val() == "") {
				J.showMsgBox("단위를 입력해 주십시요", null, J('select[name=units]').eq(index));
				saveChk = false;
				return false;
			}
		});

		//실적입력구분 체크
		J("select[name=insertGubuns]", "#actCalTypeArea").each(function(index, item) {
			if(J(item).val() == "") {
				J.showMsgBox("실적입력구분을 입력해 주십시요", null, J('select[name=insertGubuns]').eq(index));
				saveChk = false;
				return false;
			}
		});

		//산식항목명 체크
		J("input[name=calTypeColNms]", "#actCalTypeArea").each(function(index, item) {
			if(J(item).val() == "") {
				J.showMsgBox("산식항목명을 입력해 주십시요", null, J('input[name=calTypeColNms]').eq(index));
				saveChk = false;
				return false;
			}
		});

		return saveChk;
	}

	/******************************************
	 * 저장
	 ******************************************/
	function saveDo() {
		if(J("#typeId").val() == "02"){ //정성지표일 경우
    		J("#unit").attr("disabled", false);
    		J("#evalCycle").attr("disabled", false);
    		J("#timeRollup").attr("disabled", false);
		}

		var actMons= "";
		J("input[name=actMon]:checked").each(function() {
			actMons += $(this).val() + '|';
		});

		J("#actMons").val(actMons);
		J("#scDeptId").val(J("#findScDeptId").val());
		J("#strategyId").val(J("#strategyId").val());
		J("#csfId").val(J("#csfId").val());
		J("#metricId").val(J("#metricId").val());
		J("#form1 input").attr("disabled",false);
		J("#form1 select").attr("disabled",false);
		J("#form1 textarea").attr("disabled",false);

		J("#actCalTypeTemplate").remove();
		J("#form1").attr("action", "$!{context_path}/bsc/base/metric/metricProcess.vw?type=template").submit();
	}

	/******************************************
	 * 실적산식 변경시 실적항목 변경
	 ******************************************/
	function checkModifyCalType() {
		var actCalTypeNm = J("#actCalType").val();

		var str = actCalTypeNm.extChar().split("/").unique(); //산식 배열
		var strSize = str.length - 1; //산식항목 개수

		var obj = J("#actCalTypeTB tbody tr");
		var objSize = obj.length;

		//기존 산식항목 삭제
		if(objSize > 3) {
    		for(var i = objSize - 2; i > 1; i--) {
    			obj.eq(i).remove();
    		}
		}

		//신규 산식항목 설정
		for(var i = 0; i < strSize; i++) {
			J("#actCalTypeTemplate tr td:first span").text(str[i]);
			J("#actCalTypeTemplate input[name=calTypeCols]").val(str[i]);
			J("#actCalTypeTemplate tr").clone().insertBefore("#kpiActCalTypeNm");
		}
	}

	/******************************************
	 * 구간대 처리
	 ******************************************/
	function calEvalSection() {
		var value = J("#scoreCalTypeGubun").val();
		var cnt = J("input[name=viewValues]").length ;

    	var firstVal = "";
    	var lastVal = "";
    	var isDescending = true;

    	if (value == "02" || value == "03" || value == "04") {
    		var tmp_0 = 0;
    		var tmp_1 = 0;

    		if( "" != J("input[name=viewValues]").eq(0).val() && "" != J("input[name=viewValues]").eq(1).val()) {
    			tmp_0 = parseFloat(J("input[name=viewValues]").eq(0).val());
    			tmp_1 = parseFloat(J("input[name=viewValues]").eq(1).val());

    			if(tmp_0 > tmp_1 && value == "02" || value == "03" ) {
    				isDescending = true;
    			} else if( tmp_0 < tmp_1 && value == "04" ) {
    				isDescending = false;
    			} else {
                    alert("상/하향구간 점수가 잘못 되어있습니다.");
                    J("input[name=viewValues]").eq(0).focus()
    				return false;
    			}
    		} else {
    			return false;
    		}

    		for(var i = 2; i < cnt - 1; i++) {
                tmp_0 = parseFloat(J("input[name=viewValues]").eq(i-1).val());
                tmp_1 = parseFloat(J("input[name=viewValues]").eq(i).val());
                if(isDescending) {
                    if(tmp_0 > tmp_1) {
                    } else {
                        alert("상향구간 점수가 잘못 되어있습니다.");
                        J("input[name=viewValues]").eq(i).focus()
                        return false;
                    }
                } else {
                    if(tmp_0 < tmp_1) {
                    } else {
                        alert("하향구간 점수가 잘못 되어있습니다.");
                        J("input[name=viewValues]").eq(i).focus()
                        return false;
                    }
                }
            }
    	}

    	if(isDescending) {
    		firstVal = "9999999";
    		lastVal = "-9999999";
    	} else {
    		firstVal = "-9999999";
    		lastVal = "9999999";
    	}

    	if (value == "02" || value == "03") {
    		for(var i = 0; i < cnt; i++) {
    			if (i == 0) {
					J("input[name=fromValues]").eq(i).val( J("input[name=viewValues]").eq(i).val());
					J("input[name=toValues]").eq(i).val(firstVal);
    			} else if (i == cnt-1) {
					J("input[name=fromValues]").eq(i).val(lastVal);
					J("input[name=toValues]").eq(i).val( J("input[name=viewValues]").eq(i).val());
    			} else {
					J("input[name=fromValues]").eq(i).val( J("input[name=viewValues]").eq(i).val());
					J("input[name=toValues]").eq(i).val( J("input[name=viewValues]").eq(i-1).val());
    			}
    		}
    	} else if (value == "04") {
    		for(var i = 0; i < cnt; i++) {
    			if (i == 0) {
					J("input[name=fromValues]").eq(i).val(firstVal);
					J("input[name=toValues]").eq(i).val( J("input[name=viewValues]").eq(i).val());
    			} else if (i == cnt-1) {
					J("input[name=fromValues]").eq(i).val( J("input[name=viewValues]").eq(i-1).val());
					J("input[name=toValues]").eq(i).val(lastVal);
    			} else {
					J("input[name=fromValues]").eq(i).val( J("input[name=viewValues]").eq(i-1).val());
					J("input[name=toValues]").eq(i).val( J("input[name=viewValues]").eq(i).val());
    			}
    		}
    	}
    	return true;
	}

	/*****************************************************
	 * 득점산식 구분에 의한 평가구간을 활성 비활성 한다.
	 *****************************************************/
    function dispSection() {
    	var arg = J("#scoreCalTypeGubun").val();

    	if(arg == "02" || arg == "03" || arg == "04") {
			J("#evalSectionArea").show();
    	} else {
    		J("#evalSectionArea").hide();
    	}

    	if(arg == "02" || arg == "04") {
			J("#scoreCalTypeId option:eq(0)").attr("selected", "selected");
			J("#scoreCalTypeId").attr("disabled", true);
    	} else {
    		if(J("#typeId").val() == "01"){ //정량지표일 경우
				J("#scoreCalTypeId").removeProp("disabled");
				J("#scoreCalTypeId").val(J("#orgScoreCalTypeId").val());
    		}
    	}

    	if(arg == "02" || arg == "03") { //상향구간대, 득점산식+구간대
			J("span.optionStr").text("이상");
			J("span.optionStr:last").text("미만");
    	} else if(arg == "04") { //하향구간대
			J("span.optionStr").text("이하");
			J("span.optionStr:last").text("초과");
    	}
    }

	/*****************************************************
	 * 평가유형(정량/정성) 변경시 이벤트
	 *****************************************************/
    function onChgTypeid() {
		var typeId = J("#typeId").val();
		var arg = J("#scoreCalTypeGubun").val();

		if(typeId == "01") {  //정량일 경우
			J("#actCalTypeStr").show();
			J("#actCalTypeArea").show();
			J("#scoreCalTypeArea").show();

			if(arg == "02" || arg == "03" || arg == "04") {
				J("#evalSectionArea").show();
			}

			J("#unit").val(J("#orgUnit").val());
			J("#unit").attr("disabled", false);
			J("#unitValidation").show();
			J("#evalCycle").val(J("#orgEvalCycle").val());
			J("#evalCycle").attr("disabled", false);
			J("#timeRollup").val(J("#orgTimeRollup").val());
			J("#timeRollup").attr("disabled", false);
			J("#targetYContainer").show();

		} else if(typeId == "02") {  //정성일 경우
			J("#actCalTypeStr").hide();
			J("#actCalTypeArea").hide();
			J("#scoreCalTypeArea").hide();
			J("#evalSectionArea").hide();

			J("#unit").val("");
			J("#unit").attr("disabled", true);
			J("#unitValidation").hide();
			J("#evalCycle").val("Y");
			J("#evalCycle").attr("disabled", true);
			J("#timeRollup").val("L");
			J("#timeRollup").attr("disabled", true);
			J("#targetYContainer").hide();
		}
	}

	/*****************************************************
	 * 화면초기셋팅
	 *****************************************************/
	function init() {
		if(J("#mode").val()=="ADD"){
			metricGrpSearch();	  //신규버튼클릭시 지표POOL팝업
		}
		setTamShareDisable(); //목표/실적 공유여부 설정
		onChgTypeid(); 		  //평가유형(정량/정성)에 따른 설정
		dispSection();		  //득점산식 구분에 따른 설정
		//fnChange();    //주기 설정이 측정주기 세팅

		//목표/실적 공유여부 설정
		if(J("#upMetricId").val() == "") {
			J(":input:radio[name=tamShareYn]").attr("disabled", true);
		}

		//지표 승인상태가 승인요청, 승인일 경우 조회만 가능(전체관리자 예외)
		if(!$CS_LOGIN.chkAuthGrp("01") && !$CS_LOGIN.chkAuthGrp("60")) { //전체관리자 예외
    		if("$!{CS_HTML.txt2html($status.APPROVE_STATUS_ID)}" == "03"
			    || "$!{CS_HTML.txt2html($status.APPROVE_STATUS_ID)}" == "04"
				|| "$!{kpiClosingYn}" == "Y"
				//|| "$!{kpiInputTermYn}" == "N"
				|| "$!{CS_LOGIN.getUser_id()}" != "$!{CS_HTML.txt2html($status.BSC_USER_ID)}"
				) {
        		//input box
        		J("input[type=text]", "#mainContent").each(function(index, item) {
        			J(this).after(J(this).val());
        			J(this).remove();
        		});

        		//select box
        		J("select", "#mainContent").each(function(index, item) {
        			J(this).after(J("> option:selected", this).text());
        			J(this).remove();
        		});

        		//radio, textarea
        		J("input:radio, textarea").attr("disabled", true);

        		//image
        		J("input:image[src*=ic_search]").remove();
        		J("input:image[src*=ic_cancel]").remove();
        		J("img[src*=ic_search]").remove();
        		J("img[src*=ic_cancel]").remove();

				//저장버튼 hidden
				J("#btnInsert").hide();
    		}
		}
		setMetricGrpSetDisable();

	}

	/*****************************************************
	 * 조직선택 설정
	 *****************************************************/
	function setDeptInfo(scDeptId, scDeptNm) {

		scDeptNm = J(scDeptNm).text();
		J("#chargeScDeptId").val(scDeptId);
		J("#chargeScDeptNm").val(scDeptNm);
		J.fancybox.close();
	}

	/*****************************************************
	 * KPI 담당자 설정
	 *****************************************************/
	function setInsertUserInfo(arguments) {
		J("#insertUserId").val(arguments[0]);
		J("#insertUserNm").val(arguments[1]);
		J.fancybox.close();
	}

	/*****************************************************
	 * 실적승인자 설정
	 *****************************************************/
	function setApproveUserInfo(arguments) {
		J("#approveUserId").val(arguments[0]);
		J("#approveUserNm").val(arguments[1]);
		J.fancybox.close();
	}

	/*****************************************************
	 * 지표pool 선택 팝업
	 *****************************************************/
	function metricGrpSearch() {
		if(J(":input:radio[name=tamShareYn]:checked").val() == "Y" && "" != J("#upMetricId").val()) {
			J.showMsgBox("상위$!{METRIC_NM} 목표/실적 공유 설정시 상위$!{METRIC_NM}를 선택해야 합니다", null, null);
			return;
		} else {
			J("#anchor").attr("href","$!{context_path}/bsc/module/commModule/popMetricGrpSearch.vw?findYear=$!{searchMap.txt2html("year")}");
			J("#anchor").click();
		}
	}

	/*****************************************************
	 * 지표pool 선택 취소
	 *****************************************************/
	function metricGrpInit() {
		if(J(":input:radio[name=tamShareYn]:checked").val() == "Y" && "" != J("#upMetricId").val()) {
			return;
		} else {
			J("#metricGrpId").val("");
			J("#metricGrpNm").val("");
		}
	}

	/*****************************************************
	 * 지표pool 선택시 ajax 실행(기본정보 설정)
	 *****************************************************/
	function setKpiPoolSet(metricGrpId) {
		J.fancybox.close();

		var findYear = J("#year").val();
		var findMetricGrpId = metricGrpId;

		//지표POOL 기본정보 설정
		J.ajax({
			url        : "$!{context_path}/bsc/base/metric/metricGrpData_ajax.vw",
        	type       : "POST",
			data       : "findYear=" + findYear + "&amp;findMetricGrpId=" + findMetricGrpId,
        	dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success    : function (xml) {
				if(J(xml).find("items").find("item").length > 0) {
					J(xml).find("items").find("item").each(function() {
                        var metricGrpId       = J(this).find("metricGrpId").text();
                        var metricGrpNm       = J(this).find("metricGrpNm").text();
                        var typeId            = J(this).find("typeId").text();
                        var metricPropertyId  = J(this).find("metricPropertyId").text();
                        var kpiPurpose        = J(this).find("kpiPurpose").text();
                        var chargeScDeptId    = J(this).find("chargeScDeptId").text();
                        var evalCycle         = J(this).find("evalCycle").text();
                        var timeRollup        = J(this).find("timeRollup").text();
                        var unit              = J(this).find("unit").text();
                        var actCalType        = J(this).find("actCalType").text();
                        var scoreCalTypeGubun = J(this).find("scoreCalTypeGubun").text();
                        var scoreCalTypeId    = J(this).find("scoreCalTypeId").text();
                        var content           = J(this).find("content").text();
						var strategyId        = J(this).find("strategyId").text();
						var csfId             = J(this).find("csfId").text();
						var directionId       = J(this).find("directionId").text();
						var description       = J(this).find("description").text();

						J("#metricNm").val(metricGrpNm);
						J("#metricGrpId").val(metricGrpId);
						J("#metricGrpNm").val(metricGrpNm);
						J("#typeId").val(typeId);
						onChgTypeid(); //평가유형(정량/정성)에 따른 설정
						J("input[name='metricPropertyId'][value=" + metricPropertyId + "]").attr("checked", "checked");
						J("#kpiPurpose").val(kpiPurpose);
						J("#kpiPurpose").trigger("keyup");
						J("#evalCycle").val(evalCycle);
						J("#timeRollup").val(timeRollup);
						J("#unit").val(unit);
						J("#strategyId").val(strategyId);
						J("#csfId").val(csfId);
						J("#directionId").val(directionId);
						J("#actCalType").val(actCalType);
						J("#scoreCalTypeGubun").val(scoreCalTypeGubun);
						checkModifyCalType(); //실적산식 항목 설정
						dispSection(); //득점산식 구분에 따른 항목 설정
						J("#scoreCalTypeId").val(scoreCalTypeId);
						J("#description").val(description);
						J("#metricGrpIdDesc").text(metricGrpId);
                    });
				}

				J(xml).find("items").find("coldata").each(function() {
					J("input[name='actMon'][value=" + J(this).find("colMon").text() + "]").attr("checked", "checked");
				})

				//실적산식 항목 설정 호출
				setKpiPoolCalTypeColSet(findMetricGrpId);
        	},
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}

	/*****************************************************
	 * 지표pool 선택시 ajax 실행(산식항목 설정)
	 *****************************************************/
	function setKpiPoolCalTypeColSet(metricGrpId) {
		var findYear = J("#year").val();
		var findMetricGrpId = metricGrpId;

		//지표POOL 산식항목설정
		J.ajax({
			url        : "$!{context_path}/bsc/base/metric/metricGrpCalTypeCol_ajax.vw",
        	type       : "POST",
			data       : "findYear=" + findYear + "&amp;findMetricGrpId=" + findMetricGrpId,
        	dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success    : function (xml) {
				if(J(xml).find("items").find("item").length > 0) {
					J(xml).find("items").find("item").each(function(index) {
                        var metricGrpId  = J(this).find("metricGrpId").text();
                        var calTypeCol   = J(this).find("calTypeCol").text();
                        var calTypeColNm = J(this).find("calTypeColNm").text();
                        var insertGubun  = J(this).find("insertGubun").text();
                        var unit         = J(this).find("unit").text();
                        var itemCd       = J(this).find("itemCd").text();
						var itemNm       = J(this).find("itemNm").text();
						var sourceSystem = J(this).find("sourceSystem").text();

						J("#actCalTypeArea input[name=calTypeColNms]").eq(index).val(calTypeColNm);
						J("#actCalTypeArea select[name=insertGubuns]").eq(index).val(insertGubun);
						J("#actCalTypeArea select[name=units]").eq(index).val(unit);
						J("#actCalTypeArea input[name=itemCds]").eq(index).val(itemCd);
						J("#actCalTypeArea input[name=itemNms]").eq(index).val(itemNm);
						J("#actCalTypeArea input[name=sourceSystems]").eq(index).val(sourceSystem);
                    });
				}

				//구간대 설정 호출
				setKpiPoolEvalSectionSet(findMetricGrpId);
        	},
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}

	/*****************************************************
	 * 지표pool 선택시 ajax 실행(구간대 설정)
	 *****************************************************/
	function setKpiPoolEvalSectionSet(metricGrpId) {
		var findYear = J("#year").val();
		var findMetricGrpId = metricGrpId;

		//지표POOL 구간대항목 설정
		J.ajax({
			url        : "$!{context_path}/bsc/base/metric/metricGrpEvalSectionGrp_ajax.vw",
			type       : "POST",
			data       : "findYear=" + findYear + "&amp;findMetricGrpId=" + findMetricGrpId,
			dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
			success    : function (xml) {
				var lastVal = "";
				var itemLen = J(xml).find("items").find("item").length;
				if(itemLen > 0) {
					J(xml).find("items").find("item").each(function(index) {
                        var metricGrpId     = J(this).find("metricGrpId").text();
                        var evalSectionId   = J(this).find("evalSectionId").text();
                        var fromValue       = J(this).find("fromValue").text();
                        var toValue         = J(this).find("toValue").text();
                        var conversionScore = J(this).find("conversionScore").text();
						var viewVal         = J(this).find("viewVal").text();

						J("#evalSectionArea input[name=evalSectionIds]").eq(index).val(evalSectionId);
						J("#evalSectionArea input[name=fromValues]").eq(index).val(fromValue);
						J("#evalSectionArea input[name=toValues]").eq(index).val(toValue);
						J("#evalSectionArea input[name=conversionScores]").eq(index).val(conversionScore);

						if(index == itemLen - 1) {
							J("#evalSectionArea input[name=viewValues]").eq(index).val(lastVal);
						} else {
							J("#evalSectionArea input[name=viewValues]").eq(index).val(viewVal);
						}
						lastVal = viewVal;
                    });
				}

				//지표pool 설정후 disable 설정
				setMetricGrpSetDisable();
        	},
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}

	/*****************************************************
	 * 상위지표 선택시 설정
	 *****************************************************/
	function setKpiSet(metricId, metricNm) {
		J.fancybox.close();
		J("#upMetricId").val(metricId);
		J("#upMetricNm").val(metricNm);

		//목표/실적 공유여부
		J(":input:radio[name=tamShareYn]").attr("disabled", false);
	}

	/******************************************
	 * 상위KPI 설정 취소
	 ******************************************/
	function upMetricInit() {
		J("#upMetricId").val("");
		J("#upMetricNm").val("");

		J("#tamShareYn1").attr("checked", "checked");
		J(":input:radio[name=tamShareYn]").attr("disabled", true);
	}

	/*****************************************************
	 * 목표/실적 공유여부에 따른 설정
	 *****************************************************/
	function setTamShareYn() {
		//목표/실적 공유
		if(J(":input:radio[name=tamShareYn]:checked").val() == "Y" && "" != J("#upMetricId").val()) {
			setKpiSetAjax();
		} else if(J(":input:radio[name=tamShareYn]:checked").val() == "N") {
			setTamShareDisable();
		}
	}

	/*****************************************************
	 * 상위KPI 선택시 ajax 실행(기본정보 설정)
	 *****************************************************/
	function setKpiSetAjax() {
		var year = J("#year").val();
		var metricId = J("#upMetricId").val();

		//상위지표 기본정보 설정
		J.ajax({
			url        : "$!{context_path}/bsc/base/metric/upMetricData_ajax.vw",
        	type       : "POST",
			data       : "year=" + year + "&amp;metricId=" + metricId,
        	dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success    : function (xml) {
				if(J(xml).find("items").find("item").length > 0) {
					J(xml).find("items").find("item").each(function() {
                        //var metricNm		  = J(this).find("metricNm").text();   //지표명 연계 제외
                        var metricGrpId       = J(this).find("metricGrpId").text();
						var metricGrpNm       = J(this).find("metricGrpNm").text();
                        var typeId            = J(this).find("typeId").text();
						var strategyId        = J(this).find("strategyId").text();  //전략과제
						var csfId             = J(this).find("csfId").text();
						var directionId       = J(this).find("directionId").text();
						var kpiPurpose        = J(this).find("kpiPurpose").text();
						var bscMetricGbn      = J(this).find("bscMetricGbn").text();
                        var metricPropertyId  = J(this).find("metricPropertyId").text();
						var evalCycle         = J(this).find("evalCycle").text();
                        var timeRollup        = J(this).find("timeRollup").text();
						var tgtInsertGubun    = J(this).find("tgtInsertGubun").text();
						var deptRollup        = J(this).find("deptRollup").text();
						var unit              = J(this).find("unit").text();
						var insertUserId      = J(this).find("insertUserId").text();
                        var insertUserNm      = J(this).find("insertUserNm").text();
                        var approveUserId     = J(this).find("approveUserId").text();
                        var approveUserNm     = J(this).find("approveUserNm").text();
                        var actCalType        = J(this).find("actCalType").text();
                        var scoreCalTypeGubun = J(this).find("scoreCalTypeGubun").text();
                        var scoreCalTypeId    = J(this).find("scoreCalTypeId").text();
                        var content           = J(this).find("content").text();
						var mediumTargety     = J(this).find("mediumTargety").text();
						var actualY           = J(this).find("actualY").text();
						var stretchGoal       = J(this).find("stretchGoal").text();
						var description       = J(this).find("description").text();

						//J("#metricNm").val(metricNm);    //지표명 연계 제외
						J("#metricGrpId").val(metricGrpId);
						J("#metricGrpNm").val(metricGrpNm);
						J("#typeId").val(typeId);
						//onChgTypeid(); //평가유형(정량/정성)에 따른 설정
						J("#typeId").val(typeId);
						J("#strategyId").val(strategyId);
						J("#csfId").val(csfId);
						J("#directionId").val(directionId);
						J("#kpiPurpose").val(kpiPurpose);
						J("#kpiPurpose").trigger("keyup");
						J("input[name='bscMetricGbn'][value=" + bscMetricGbn + "]").attr("checked", "checked");
						J("input[name='metricPropertyId'][value=" + metricPropertyId + "]").attr("checked", "checked");
						J("#evalCycle").val(evalCycle);
						J("#timeRollup").val(timeRollup);
						J("#tgtInsertGubun").val(tgtInsertGubun);
						J("#deptRollup").val(deptRollup);
						J("#unit").val(unit);
						J("#insertUserId").val(insertUserId);
						J("#insertUserNm").val(insertUserNm);
						J("#approveUserId").val(approveUserId);
						J("#approveUserNm").val(approveUserNm);
						J("#actCalType").val(actCalType);
						checkModifyCalType(); //실적산식 항목 설정
						J("#scoreCalTypeGubun").val(scoreCalTypeGubun);
						//dispSection(); //득점산식 구분에 따른 항목 설정
						J("#scoreCalTypeId").val(scoreCalTypeId);
						J("#content").val(content);
						J("#mediumTargety").val(mediumTargety);
						J("#actualY").val(actualY);
						J("#stretchGoal").val(stretchGoal);
						J("#metricGrpIdDesc").text(metricGrpId);
						J("#description").val(description);

                    });
				}

				J(xml).find("items").find("coldata").each(function() {
					J("input[name='actMon'][value=" + J(this).find("colMon").text() + "]").attr("checked", "checked");
				})

				//실적산식 항목 설정 호출
				setKpiCalTypeColSet();
        	},
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}

	/*****************************************************
	 * 상위KPI 선택시 ajax 실행(산식항목 설정)
	 *****************************************************/
	function setKpiCalTypeColSet() {
		var year = J("#year").val();
		var metricId = J("#upMetricId").val();

		//상위KPI 산식항목설정
		J.ajax({
			url        : "$!{context_path}/bsc/base/metric/upMetricCalTypeCol_ajax.vw",
        	type       : "POST",
			data       : "year=" + year + "&amp;metricId=" + metricId,
        	dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success    : function (xml) {
				if(J(xml).find("items").find("item").length > 0) {
					J(xml).find("items").find("item").each(function(index) {
                        var metricId     = J(this).find("metricId").text();
                        var calTypeCol   = J(this).find("calTypeCol").text();
                        var calTypeColNm = J(this).find("calTypeColNm").text();
                        var insertGubun  = J(this).find("insertGubun").text();
                        var unit         = J(this).find("unit").text();
                        var itemCd       = J(this).find("itemCd").text();
						var itemNm       = J(this).find("itemNm").text();
						var sourceSystem = J(this).find("sourceSystem").text();

						J("#actCalTypeArea input[name=calTypeColNms]").eq(index).val(calTypeColNm);
						J("#actCalTypeArea select[name=insertGubuns]").eq(index).val(insertGubun);
						J("#actCalTypeArea select[name=units]").eq(index).val(unit);
						J("#actCalTypeArea input[name=itemCds]").eq(index).val(itemCd);
						J("#actCalTypeArea input[name=itemNms]").eq(index).val(itemNm);
						J("#actCalTypeArea input[name=sourceSystems]").eq(index).val(sourceSystem);
                    });
				}

				//구간대 설정 호출
				setKpiEvalSectionSet();
        	},
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}

	/*****************************************************
	 * 상위KPI 선택시 ajax 실행(구간대 설정)
	 *****************************************************/
	function setKpiEvalSectionSet() {
		var year = J("#year").val();
		var metricId = J("#upMetricId").val();

		//상위KPI 구간대항목 설정
		J.ajax({
			url        : "$!{context_path}/bsc/base/metric/upMetricEvalSection_ajax.vw",
        	type       : "POST",
			data       : "year=" + year + "&amp;metricId=" + metricId,
        	dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success    : function (xml) {
				var lastVal = "";
				var itemLen = J(xml).find("items").find("item").length;
				if(itemLen > 0) {
					J(xml).find("items").find("item").each(function(index) {
                        var metricId        = J(this).find("metricId").text();
                        var evalSectionId   = J(this).find("evalSectionId").text();
                        var fromValue       = J(this).find("fromValue").text();
                        var toValue         = J(this).find("toValue").text();
                        var conversionScore = J(this).find("conversionScore").text();
						var viewVal         = J(this).find("viewVal").text();

						J("#evalSectionArea input[name=evalSectionIds]").eq(index).val(evalSectionId);
						J("#evalSectionArea input[name=fromValues]").eq(index).val(fromValue);
						J("#evalSectionArea input[name=toValues]").eq(index).val(toValue);
						J("#evalSectionArea input[name=conversionScores]").eq(index).val(conversionScore);

						if(index == itemLen - 1) {
							J("#evalSectionArea input[name=viewValues]").eq(index).val(lastVal);
						} else {
							J("#evalSectionArea input[name=viewValues]").eq(index).val(viewVal);
						}
						lastVal = viewVal;
                    });
				}

				//목표 설정 호출
				setKpiTargetSet();
        	},
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}

	/*****************************************************
	 * 상위KPI 선택시 ajax 실행(목표 설정)
	 *****************************************************/
	function setKpiTargetSet() {
		var findYear = J("#year").val();
		var metricId = J("#upMetricId").val();

		J("#tgtPopInfo").children().remove();
		J("#tgtValueUpdateByTamShare").val("Y");

		//상위KPI 목표 설정
		J.ajax({
			url        : "$!{context_path}/bsc/base/metric/upMetricTarget_ajax.vw",
        	type       : "POST",
			data       : "findYear=" + findYear + "&amp;metricId=" + metricId,
        	dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success    : function (xml) {
				var lastVal = "";
				var itemLen = J(xml).find("items").find("item").length;
				if(itemLen > 0) {
					J(xml).find("items").find("item").each(function(index) {
                        var mon        = J(this).find("mon").text();
                        var tgtValue   = J(this).find("tgtValue").text();

						J("#tgtPopInfo").append("<input type=\"text\" name=\"tgtMons\" value=\"" + mon + "\" />");
						J("#tgtPopInfo").append("<input type=\"text\" name=\"tgtValues\" value=\"" + tgtValue + "\" />");
                    });
				}

				//목표/실적 공유 설정후 disable
				setTamShareDisable();
        	},
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}

 	/******************************************
	 * 조직트리 선택
	 ******************************************/
	function goAction(code, name) {
		var scDeptNm = J(name).text();
		J("#formFind input[name=scDeptId]").val(code);
		J("#formFind input[name=scDeptNm]").val(scDeptNm);
		J("#formFind").attr("action", "$!{context_path}/bsc/base/metric/metricList.vw?type=template").submit();
	}

	/******************************************
	 * 목표입력 팝업
	 ******************************************/
	function targetInsertPop() {
		var evalCycle = J("#evalCycle").val();
		var metricId = "$!{CS_HTML.txt2html($detail.METRIC_ID)}";

		if(J("#tgtValueUpdateByTamShare").val() == "Y" && J("#tgtValueUpdateByPop").val() == "N") {
			metricId = J("#upMetricId").val();
		}

		J("#anchor").attr("href","$!{context_path}/bsc/base/metric/popTargetInsert.vw?findYear=$!{searchMap.txt2html("year")}&amp;metricId=" + metricId + "&amp;evalCycle=" + evalCycle);
		J("#anchor").click();
	}

	/*****************************************************
	 * 연계항목 초기화
	 *****************************************************/
	function setInitItem(index) {
		J("#actCalTypeTB input[name=itemCds]").eq(index-2).val("");
		J("#actCalTypeTB input[name=itemNms]").eq(index-2).val("");
	}

	/******************************************
	 * 산식항목 연계항목 팝업
	 ******************************************/
	function systemItemPop(index) {
		var i = index - 2;
		var insertGubun = J("select[name=insertGubuns]", "#actCalTypeArea").eq(i).val();

		if(insertGubun == "01" || insertGubun == "07") {
			J("#anchor").attr("href","$!{context_path}/bsc/module/commModule/popSystemItemSearch.vw?findYear=$!{searchMap.txt2html("year")}&amp;findItemActualDivi=02&amp;callBack=setSystemItemSet&amp;index=" + i);
			J("#anchor").click();
		} else {
			J.showMsgBox("실적입력구분이 시스템이나 엑셀인 경우 선택가능합니다", null, null);
			return;
		}
	}

	/******************************************
	 * 산식항목 연계항목 설정
	 ******************************************/
	function setSystemItemSet(index, itemCd, itemNm) {
		J("#actCalTypeTB input[name=itemCds]").eq(index).val(itemCd);
		J("#actCalTypeTB input[name=itemNms]").eq(index).val(itemNm);
		J.fancybox.close();
	}

	/******************************************
	 * 목표 연계항목 팝업
	 ******************************************/
	function systemTargetItemPop() {
		var tgtInsertGubun = J("#tgtInsertGubun").val();

		if(tgtInsertGubun == "01" || tgtInsertGubun == "07") {
			J("#anchor").attr("href","$!{context_path}/bsc/module/commModule/popSystemItemSearch.vw?findYear=$!{searchMap.txt2html("year")}&amp;findItemActualDivi=01&amp;callBack=setTargetItemSet&amp;index=1");
			J("#anchor").click();
		} else {
			J.showMsgBox("목표입력구분이 시스템이나 엑셀인 경우 선택가능합니다", null, null);
			return;
		}
	}

	/******************************************
	 * 목표 연계항목 설정
	 ******************************************/
	function setTargetItemSet(index, itemCd, itemNm) {
		J("#itemCd").val(itemCd);
		J("#itemNm").val(itemNm);
		J.fancybox.close();
	}

	/*****************************************************
	 * 목표/실적 공유여부 설정이 "Y" 인경우 disabled
	 *****************************************************/
	function setTamShareDisable() {
		if(J(":input:radio[name=tamShareYn]:checked").val() == "Y" && "" != J("#upMetricId").val()) {
			J("#form1 input:not(#btnBack):not(#btnInsert):not(:image)").attr("disabled", true);
			J("#form1 select").attr("disabled", true);
			J("#form1 textarea").attr("disabled", true);

			J("#metricNm").attr("disabled", false);       //지표명
			J("#upMetricId").attr("disabled", false);     //상위지표코드
			J("#upMetricNm").attr("disabled", false);     //상위지표명
			J("#insertUserId").attr("disabled", false);   //KPI담당자
			J("#insertUserNm").attr("disabled", false);   //KPI담당자명
			J("#approveUserId").attr("disabled", false);  //실적승인자
			J("#approveUserNm").attr("disabled", false);  //실적승인자명
			J("#useYn").attr("disabled", false);          //사용여부
			J(":input:radio[name=tamShareYn]").attr("disabled", false);              //목표/실적 공유여부
			J("#actCalTypeArea select[name=insertGubuns]").attr("disabled", false);  //실적입력구분
			J("#actCalTypeArea select[name=itemNms]").attr("disabled", false);       //연계항목명
			J("input[name='actMon']").attr("disabled", true);						 //측정주기

		} else {
			J("#form1 input:not(#btnBack):not(#btnInsert):not(:image)").attr("disabled", false);
			J("#form1 select").attr("disabled", false);
			J("#form1 textarea").attr("disabled", false);
		}
	}

	/*****************************************************
	 * KPI Pool 설정후 disable 설정
	 *****************************************************/
	function setMetricGrpSetDisable() {
		if(J("#metricGrpId").val() != "") {
			//J("input[name='metricPropertyId']").attr("disabled", true);	//연계유형
			J("#typeId").attr("disabled", true);     					//평가유형
			J("#evalCycle").attr("disabled", true);  					//주기
			J("#timeRollup").attr("disabled", true); 					//실적집계방법
			J("#unit").attr("disabled", true);       					//단위
			J("#evalCycle").attr("disabled", true);  					//주기
			J("#strategyId").attr("disabled", false); 					//전략과제
			J("#csfId").attr("disabled", false);  	 					//CSF
			J("#directionId").attr("disabled", true);  	 				//전략과제
			J("input[name='actMon']").attr("disabled", true);			//측정주기

			/*실적산식 disable
			J("#actCalType").attr("disabled", true);  //실적산식
			J("#actCalTypeArea input[name=calTypeColNms]").attr("disabled", true); //산식항목명
			J("#actCalTypeArea select[name=units]").attr("disabled", true);         //단위

			//득점산식 disable
			J("#scoreCalTypeGubun").attr("disabled", true); //득점산식 구분
			J("#scoreCalTypeId").attr("disabled", true);    //득점산식

			//구간대 disable
			J("#evalSectionArea input").attr("disabled", true);  //구간대*/
		}
	}

	/*****************************************************
	 * 산식입력기 팝업
	 *****************************************************/
	function popCalTypeCol() {
		var actCalType = J("#actCalType").val();
		J("#anchor").attr("href","$!{context_path}/bsc/module/commModule/popCalTypeCol.vw?findYear=$!{searchMap.txt2html("year")}&amp;actCalType=" + actCalType);
		J("#anchor").click();
	}

	/*****************************************************
	 * 주기 설정이 측정주기 세팅
	 *****************************************************/
	function fnChange() {
		var evalCycle = J("#evalCycle").val();
        var map=J("input[name=actMon]");;

        if( evalCycle == "Y" ){

            J.each(map, function(key, value){
                J(value).removeAttr("checked");
            });

            J.each(map, function(key, value){
                if( key == "11" ) {
                    J(value).attr("checked","checked");
                }
            });
        } else if ( evalCycle == "M" ) {
             J.each(map, function(key, value){
                J(value).removeAttr("checked");
            });

            J.each(map, function(key, value){
                J(value).attr("checked","checked");
            });
        } else if ( evalCycle == "H" ) {
             J.each(map, function(key, value){
                J(value).removeAttr("checked");
            });

            J.each(map, function(key, value){
                if( key == "5" || key == "11" ) {
                    J(value).attr("checked","checked");
                }
            });
        } else if ( evalCycle == "Q" ) {
             J.each(map, function(key, value){
                J(value).removeAttr("checked");
            });

            J.each(map, function(key, value){
                if( key == "2" || key == "5" || key == "8" || key == "11" ) {
                    J(value).attr("checked","checked");
                }
            });
        }
	}

//]]>
</script>

<div id="Table">
	<div id="Table_blockContainer">

		<div class="tableTop">
			#parse("/WEB-INF/vl/common/template/tabs.vm")

			<!-- search S -->
			<form id="formFind" name="formFind" method="post" action="$!{context_path}/bsc/base/metric/metricList.vw?type=template">
				<input type="hidden" 	id="oldYear"		name="oldYear"			value="$!{searchMap.txt2html("findYear")}" />
				<input type="hidden"	id="findHighPgmId"	name="findHighPgmId"	value="$!{searchMap.txt2html("findHighPgmId")}" />
				<input type="hidden" 	id="findSubPgmId"	name="findSubPgmId"		value="$!{searchMap.txt2html("findSubPgmId")}" />
				<input type="hidden"	id="findPgmId"		name="findPgmId"		value="$!{searchMap.txt2html("findPgmId")}" />
				<input type="hidden"  	name="scDeptId"     value="$!{searchMap.txt2html("scDeptId")}" />
				<input type="hidden"  	name="scDeptNm"     value="$!{searchMap.txt2html("scDeptNm")}" />

				<div class="searchBox">
    				<div><div><div>
    				<table summary="조직별$!{METRIC_NM}관리검색 조건">
						<caption class="none">조직별$!{METRIC_NM}관리 검색 조건</caption>
						<thead><tr><th></th></tr></thead>
        				<tbody>
            				<tr>
								<td class="searchBox_tit w180">
                                    <span><label for="findYear">$!{YEAR}</label></span>
            						<span class="searchBar">
            							<select id="findYear" name="findYear" class="select w80">
            								$!CS_CODE.getCodeOption("017", $!{searchMap.txt2html("findYear")})
            							</select>
            						</span>
            					</td>
								<td class="searchBox_tit w250">
                                    <span><label for="findScDeptNm">$!{SC_DEPT_NM}</label></span>
            						<span class="searchBar">
										<input type="hidden" id="findScDeptId" name="findScDeptId" value="$!{searchMap.txt2html("scDeptId", $!{topCodeInfo.SC_DEPT_ID})}"/>
										<input type="text" id="findScDeptNm" name="findScDeptNm" value="$!{searchMap.txt2html("scDeptNm", $!{topCodeInfo.SC_DEPT_NM})}" class="disable" readonly="readonly"/>
            						</span>
            					</td>
            					<td class="searchBox_tit w200">
                                    <span><label for="findUseYn">사용여부</label></span>
            						<span class="searchBar">
            							<select id="findUseYn" name="findUseYn" class="select w70">
            								$!CS_CODE.getCodeOption("011", $!{searchMap.txt2html("findUseYn")})
            							</select>
            						</span>
            					</td>
								<td class="searchBox_tit w140">
									<span>$!{WEIGHT}합계 : </span>
            						<span id="weightSum" class="searchBar">$!{CS_HTML.txt2html($weightSum)}</span>
            					</td>
            				</tr>
        				</tbody>
    				</table>
                    <input type="image" class="btnSearch" src="$!{img_path}/common/btn_search.gif" align="middle" alt="검색" />
                    </div></div></div>
    	        </div>
    		</form>
    		<!-- search E -->
			<div class="clear"></div>
		</div>

		<div class="blockGridTreeTable">
			#parse("/WEB-INF/vl/bsc/module/commModule/commonTree.vm")
		</div>

		<div id="mainContent">
    		<form id="form1" name="form1" method="post" action="$!{context_path}/bsc/base/metric/metricProcess.vw?type=template">
                <input type="hidden" id="mode"				name="mode"					value="$!{searchMap.txt2html("mode")}" />
            	<input type="hidden" id="year"				name="year"					value="$!{searchMap.txt2html("year")}" />
            	<input type="hidden" id="scDeptId"   		name="scDeptId"             value="$!{searchMap.txt2html("scDeptId")}" />
            	<input type="hidden" id="scDeptNm"   		name="scDeptNm"             value="$!{searchMap.txt2html("scDeptNm")}" />
            	<input type="hidden" id="initiativeYn"		name="initiativeYn" 		value="Y" />
            	<input type="hidden" id="orgScoreCalTypeId"	name="orgScoreCalTypeId"	value="$!{CS_HTML.txt2html($detail.SCORE_CAL_TYPE_ID)}" />
            	<input type="hidden" id="orgUnit"           name="orgUnit"				value="$!{CS_HTML.txt2html($detail.UNIT)}" />
            	<input type="hidden" id="orgEvalCycle"		name="orgEvalCycle"			value="$!{CS_HTML.txt2html($detail.EVAL_CYCLE)}" />
            	<input type="hidden" id="orgTimeRollup"		name="orgTimeRollup"		value="$!{CS_HTML.txt2html($detail.TIME_ROLLUP)}" />
                <input type="hidden" id="actMons"			name="actMons"				/>
				$!{searchMap.makeHiddenFind()}

            	#if($!{searchMap.txt2html("mode")} == "MOD")
            		<input type="hidden" id="metricId" name="metricId" class="inputbox w100" value="$!{CS_HTML.txt2html($detail.METRIC_ID)}" />
            	#else
            		<input type="hidden" id="metricId" name="metricId" class="inputbox w100"/>
    			#end

        		<div class="blockDetailForTree blockDetail">
        			<table summary="조직별$!{METRIC_NM}관리 등록">
    					<caption class="none">조직별$!{METRIC_NM}관리 등록</caption>
        				<colgroup>
        					<col width="15%" />
        					<col width="35%" />
    						<col width="15%" />
    						<col width="35%" />
        				</colgroup>
        				<tbody>
        					<tr class="none2">
								<th scope="row"><label for="metricGrpNm">$!{METRIC_GRP_NM}</label></th>
        						<td>
									<input type="hidden" id="metricGrpId" name="metricGrpId" class="inputbox wp80" value='$!{CS_HTML.txt2html($detail.METRIC_GRP_ID)}' readonly="readonly" />
    								<input type="text" id="metricGrpNm" name="metricGrpNm" class="inputbox w230" value='$!{CS_HTML.txt2html($detail.METRIC_GRP_NM)}' maxlength="50" readonly="readonly"/>
    								<input type="image" onclick="javascript:metricGrpSearch();return false;" class="valign_middle" src="$!{img_path}/common/board/ic_search.gif" alt="지표풀선택"/>
    								<input type="image" onclick="javascript:metricGrpInit();return false;" class="valign_middle" src="$!{img_path}/common/board/ic_cancel.gif" alt="지표풀 선택취소"/>
        						</td>
								<th scope="row">$!{METRIC_GRP_NM}코드</th>
        						<td><span id="metricGrpIdDesc">$!{CS_HTML.txt2html($detail.METRIC_GRP_ID)}</span></td>
							</tr>
							<tr>
    							<th scope="row"><span class="txt_red">(*)</span> <label for="metricNm">$!{METRIC_NM}</label></th>
        						<td><input type="text" id="metricNm" name="metricNm" class="inputbox wp95" value='$!{CS_HTML.txt2html($detail.METRIC_NM)}' maxlength="50" /></td>
								<th scope="row"><label for="useYn">사용여부</label></th>
        						<td>
        							<input type="radio" name="useYn" id="useYn1" value="Y" #if(!$detail.USE_YN || $detail.USE_YN == "Y") checked="checked" #end />&nbsp;<label for="useYn1">사용</label>&nbsp;&nbsp;&nbsp;
    								<input type="radio" name="useYn" id="useYn2" value="N" #if($detail.USE_YN == "N") checked="checked" #end/>&nbsp;<label for="useYn2">미사용</label>
        						</td>
        					</tr>
							<tr class="none2">
								<th scope="row"><label for="typeId">평가유형</label></th>
        						<td>
    								<select id="typeId" name="typeId" class="select w150">
        								$!CS_CODE.getCodeOption("007", $!{CS_HTML.txt2html($detail.TYPE_ID, '01')}, $!{searchMap.txt2html("year")})
        							</select>
    							</td>
    							<th scope="row"><label for="upMetricId">상위$!{METRIC_NM}</label></th>
        						<td>
    								<input type="hidden" id="upMetricId" name="upMetricId" class="inputbox wp80" value='$!{CS_HTML.txt2html($detail.UP_METRIC_ID)}' maxlength="50" />
    								<input type="text" id="upMetricNm" name="upMetricNm" class="inputbox w230" value='$!{CS_HTML.txt2html($detail.UP_METRIC_NM)}' maxlength="50" readonly="readonly" title="상위$!{METRIC_NM}"/>
    								<a id="upMetricSearch" href="$!{context_path}/bsc/module/commModule/popMetricSearch.vw?findYear=$!{searchMap.txt2html("year")}"><img src="$!{img_path}/common/board/ic_search.gif" class="valign_middle" alt="상위$!{METRIC_NM}선택" /></a>
    								<a href="javascript:upMetricInit();"><img src="$!{img_path}/common/board/ic_cancel.gif" class="valign_middle" alt="상위$!{METRIC_NM} 취소" /></a>
    							</td>
							</tr>
							<tr>
        						<th scope="row"><label for="perspectiveId">BSC 관점</label></th>
        						<td>
            						<span class="searchBar">
            							<select id="perspectiveId" name="perspectiveId" class="select w150" >
											#foreach($list in $perspectiveList)
												<option value="$!{CS_HTML.txt2html($list.PERSPECTIVE_ID)}" $!{CS_HTML.getSelected($!{CS_HTML.txt2html($list.PERSPECTIVE_ID)}, $!{CS_HTML.txt2html($detail.PERSPECTIVE_ID)})}>$!{CS_HTML.txt2html($list.PERSPECTIVE_NM)}</option>
											#end
										</select>
            						</span>
            					</td>
        						<th scope="row"><label for="degreeYn">난이도 평가대상여부</label></th>
        						<td>
            						<span class="searchBar">
	    								<input type="radio" name="degreeYn" id="degreeYn1" value="Y" $!{CS_HTML.getChecked($!{CS_HTML.txt2html($detail.DEGREE_YN, 'N')}, 'Y')} />&nbsp;<label for="degreeYn1">대상</label>&nbsp;&nbsp;&nbsp;
										<input type="radio" name="degreeYn" id="degreeYn2" value="N" $!{CS_HTML.getChecked($!{CS_HTML.txt2html($detail.DEGREE_YN, 'N')}, 'N')}/>&nbsp;<label for="degreeYn2">비대상</label>
            						</span>
            					</td>
            				</tr>	
    						<tr>
        						<th scope="row"><label for="strategyId">전략과제</label></th>
        						<td  colspan="1">
            						<span class="searchBar">
            							<select id="strategyId" name="strategyId" class="select w300">
											<option value="" >미지정</option>
		    								#foreach($list in $strategyIdList)
												<option value="$!{CS_HTML.txt2html($list.STRATEGY_ID)}" $!{CS_HTML.getSelected($!{CS_HTML.txt2html($list.STRATEGY_ID)}, $!{CS_HTML.txt2html($detail.STRATEGY_ID)})}>$!{CS_HTML.txt2html($list.STRATEGY_NM)}</option>
											#end
            							</select>
            						</span>
            					</td>
            					<th scope="row"><label for="csfId">CSF</label></th>
        						<td  colspan="1">
            						<span class="searchBar">
            							<select id="csfId" name="csfId" class="select w300">
											<option value="" >미지정</option>
		    								#foreach($list in $csfList)
												<option value="$!{CS_HTML.txt2html($list.CSF_ID)}" $!{CS_HTML.getSelected($!{CS_HTML.txt2html($list.CSF_ID)}, $!{CS_HTML.txt2html($detail.CSF_ID)})}>$!{CS_HTML.txt2html($list.CSF_NM)}</option>
											#end
            							</select>
            						</span>
            					</td>
        					</tr>
							<tr>
								<th scope="row"><span class="txt_red">(*)</span> <label for="tgtInsertGubun">목표입력구분 </label></th>
        						<td>
    								<select id="tgtInsertGubun" name="tgtInsertGubun" class="select w100">
    									<option value="">미지정</option>
        								$!CS_CODE.getCodeOption("130", $!{CS_HTML.txt2html($detail.TGT_INSERT_GUBUN, '02')}, $!{searchMap.txt2html("year")})
        							</select>
    								<span>
        								<input type="hidden" id="itemCd" name="itemCd" class="inputbox w60" value="$!{CS_HTML.txt2html($detail.ITEM_CD)}" />
        								<input type="text" id="itemNm" name="itemNm" class="inputbox w125" readonly="readonly" value="$!{CS_HTML.txt2html($detail.ITEM_NM)}" maxlength="30" title="연계항목"/>
        								<input type="image" onclick="javascript:systemTargetItemPop();return false;" class="valign_middle" src="$!{img_path}/common/board/ic_search.gif" alt="목표연계항목"/>
        								<input type="image" onclick="javascript:J.setInit('itemCd','itemNm');return false;" class="valign_middle" src="$!{img_path}/common/board/ic_cancel.gif" alt="목표연계항목취소"/>
    								</span>
    							</td>
    							<th scope="row"><label for="tamShareYn0">목표/실적 공유여부</label></th>
        						<td>
        							$!CS_CODE.getCodeRadio("tamShareYn", "122", $!{CS_HTML.txt2html($detail.TAM_SHARE_YN, 'N')}, $!{searchMap.txt2html("year")})
        						</td>
    							<!--
								<th scope="row"><label for="directionId">$!{DIRECTION_NM}</label></th>
        						<td>
    								<select id="directionId" name="directionId" class="select w180">
    									<option value="">==선택==</option>
        								#foreach($list in $directionList)
    										<option value="$!{CS_HTML.txt2html($list.DIRECTION_ID)}" $!{CS_HTML.getSelected($!{CS_HTML.txt2html($list.DIRECTION_ID)}, $!{CS_HTML.txt2html($detail.DIRECTION_ID)})}>$!{CS_HTML.txt2html($list.DIRECTION_NM)}</option>
    									#end
        							</select>
    							</td>
        					</tr>
    						<tr>
        						<th scope="row"><label for="strategyId">$!{STRATEGY_NM}</label></th>
        						<td>
    								<select id="strategyId" name="strategyId" class="select w260">
    									<option value="">미지정</option>
    									#foreach($list in $strategyList)
    										<option value="$!{CS_HTML.txt2html($list.STRATEGY_ID)}" $!{CS_HTML.getSelected($!{CS_HTML.txt2html($list.STRATEGY_ID)}, $!{CS_HTML.txt2html($detail.STRATEGY_ID)})}>$!{CS_HTML.txt2html($list.STRATEGY_NM)}</option>
    									#end
        							</select>
    							</td>
								<th scope="row"><label for="csfId">CSF</label></th>
        						<td>
    								<select id="csfId" name="csfId" class="select w180">
    									<option value="">==선택==</option>
        								#foreach($list in $csfList)
    										<option value="$!{CS_HTML.txt2html($list.CSF_ID)}" $!{CS_HTML.getSelected($!{CS_HTML.txt2html($list.CSF_ID)}, $!{CS_HTML.txt2html($detail.CSF_ID)})}>$!{CS_HTML.txt2html($list.CSF_NM)}</option>
    									#end
        							</select>
    							</td>
        					</tr>
        					-->
    						<tr>
        						<th scope="row"><span class="txt_red">(*)</span> <label for="evalCycle">주기</label></th>
        						<td>
    								<select id="evalCycle" name="evalCycle" class="select w150">
        								$!CS_CODE.getCodeOption("008", $!{CS_HTML.txt2html($detail.EVAL_CYCLE, 'Q')}, $!{searchMap.txt2html("year")})
        							</select>
    							</td>
        						<th scope="row"><span class="txt_red">(*)</span> <label for="timeRollup">실적집계방법</label></th>
        						<td>
        							<select id="timeRollup" name="timeRollup" class="select w150">
        								$!CS_CODE.getCodeOption("009", $!{CS_HTML.txt2html($detail.TIME_ROLLUP, 'L')}, $!{searchMap.txt2html("year")})
        							</select>
        						</td>
        					</tr>
    						<tr>
								<th scope="row"><span id="unitValidation" class="txt_red">(*)</span> <label for="unit">단위</label></th>
        						<td>
    								<select id="unit" name="unit" class="select w150">
    									<option value="">미지정</option>
        								$!CS_CODE.getCodeOption("013", $!{CS_HTML.txt2html($detail.UNIT)}, $!{searchMap.txt2html("year")})
        							</select>
    							</td>
        						<th scope="row"><label for="deptRollup">조직합산</label></th>
        						<td>
        							<select id="deptRollup" name="deptRollup" class="select w150">
    									<option value="">미지정</option>
        								$!CS_CODE.getCodeOption("022", $!{CS_HTML.txt2html($detail.DEPT_ROLLUP)}, $!{searchMap.txt2html("year")})
        							</select>
        						</td>
        					</tr>
        					<tr>
								<th scope="row"><label for="unit">하부부서 점수 미부여</label></th>
        						<td colspan="3">
    								<input type="checkbox"  id="downScoreYn" name="downScoreYn" value="Y" #if($detail.DOWN_SCORE_YN == "Y") checked="checked" #end title="하부부서 50% 미부여"/>
    							</td>
        					</tr>
        					<!--
        					<tr style="display:none;">
	    						<th scope="row"><span id="degreeIndexCdValidation" class="txt_red">(*) </span><label for="degreeIndexCd">지표속성</label></th>
	    						<td>
									$!CS_CODE.getCodeRadio("degreeIndexCd", "173", $!{CS_HTML.txt2html($detail.DEGREE_INDEX_CD, '30')}, $!{searchMap.txt2html("year")})
								</td>
								<th scope="row"><span id="degreeChallengeCdValidation" class="txt_red">(*) </span><label for="degreeChallengeCd">도전성</label></th>
	    						<td>
									$!CS_CODE.getCodeRadio("degreeChallengeCd", "174", $!{CS_HTML.txt2html($detail.DEGREE_CHALLENGE_CD, '30')}, $!{searchMap.txt2html("year")})
								</td>
	    					<tr style="display:none;">
	    					<tr>
	    						<th scope="row"><span id="degreeControl1CdValidation" class="txt_red">(*) </span><label for="degreeControl1Cd">통제성착안1</label></th>
	    						<td>
									$!CS_CODE.getCodeRadio("degreeControl1Cd", "175", $!{CS_HTML.txt2html($detail.DEGREE_CONTROL1_CD, '20')}, $!{searchMap.txt2html("year")})
								</td>
								<th scope="row"><span id="degreeControl2CdValidation" class="txt_red">(*) </span><label for="degreeControl2Cd">통제성착안2</label></th>
	    						<td>
									$!CS_CODE.getCodeRadio("degreeControl2Cd", "176", $!{CS_HTML.txt2html($detail.DEGREE_CONTROL2_CD, '20')}, $!{searchMap.txt2html("year")})
								</td>
	    					</tr>
	    					-->
    						<tr>
								<th style="display:none" scope="row"><label for="adjustRate">조정계수</label></th>
        						<td style="display:none"><input type="text" id="adjustRate" name="adjustRate" class="inputbox w140" value='$!{CS_HTML.txt2html($detail.ADJUST_RATE)}' maxlength="10" /></td>
        						<th scope="row"><span class="txt_red">(*)</span> <label for="metricPropertyId0">연계유형</label></th>
        						<td colspan="3">
    								$!CS_CODE.getCodeRadio("metricPropertyId", "010", $!{CS_HTML.txt2html($detail.METRIC_PROPERTY_ID, '02')}, $!{searchMap.txt2html("year")})
        						</td>
        					</tr>
							<tr>
        						<th scope="row"><label for="actMon">측정주기</label></th>
        						<td colspan="3">
    								$!CS_CODE.getCodeCheckBox("actMon", "024", $!{regMonDesc}, $!{searchMap.txt2html("year")})
    							</td>
    						</tr>
    						<tr>
    							<th scope="row"><label for="description">설명</label></th>
								<td colspan="3"><input type="text" id="description" name="description" class="inputbox wp90" value='$!{CS_HTML.txt2html($detail.DESCRIPTION)}' maxlength="100" /></td>
						    </tr>
    						<tr>
        						<th scope="row"><label for="kpiPurpose">$!{METRIC_NM}정의</label></th>
        						<td colspan="3">
        							<textarea id="kpiPurpose" name="kpiPurpose" class="tabletext" title="KPI 목적" cols="10" rows="3">$!{CS_HTML.txt2html($detail.KPI_PURPOSE)}</textarea>
    								<span id="kpiPurposeIndicator">0</span>/3000byte
        						</td>
        					</tr>
        				</tbody>
        			</table>
        		</div>

    			<!-- KPI 담당자 지정 -->
    			<div class="blockDetailForTree blockDetail2">
        			<table summary="실적담당자 지정">
        				<caption class="none">실적담당자 지정</caption>
        				<colgroup>
        					<col width="15%" />
        					<col width="35%" />
    						<col width="15%" />
    						<col width="35%" />
        				</colgroup>
        				<tbody>
        					<tr>
        						<th scope="row" colspan="4" style="text-align:left; padding-left:85px">실적담당자 지정</th>
        					</tr>
        					<tr>
        						<th scope="row"><label for="insertUserNm"> 실적입력자</label></th>
        						<td style="text-align:left; padding-left:20px">
    								<input type="hidden" id="insertUserId" name="insertUserId" class="inputbox w100" value="$!{CS_HTML.txt2html($detail.INSERT_USER_ID)}" />
    								<input type="text" id="insertUserNm" name="insertUserNm" class="inputbox w100" value='$!{CS_HTML.txt2html($detail.INSERT_USER_NM)}' maxlength="20" readonly="readonly"/>
    								<a id="insertUserSearch" href="$!{context_path}/bsc/module/commModule/popSearchUser.vw?findYear=$!{searchMap.txt2html("year")}&amp;callBack=setInsertUserInfo"><img src="$!{img_path}/common/board/ic_search.gif" class="valign_middle" alt="사용자선택" /></a>
    								<a href="javascript:J.setInit('insertUserId','insertUserNm');"><img src="$!{img_path}/common/board/ic_cancel.gif" class="valign_middle" alt="사용자선택 취소" /></a>
    							</td>
        						<th scope="row"><label for="approveUserNm"> 실적확인자</label></th>
        						<td style="text-align:left; padding-left:20px">
    								<input type="hidden" id="approveUserId" name="approveUserId" class="inputbox w100" value="$!{CS_HTML.txt2html($detail.APPROVE_USER_ID)}" />
    								<input type="text" id="approveUserNm" name="approveUserNm" class="inputbox w100" value='$!{CS_HTML.txt2html($detail.APPROVE_USER_NM)}' maxlength="20" readonly="readonly"/>
    								<a id="approveUserSearch" href="$!{context_path}/bsc/module/commModule/popSearchUser.vw?findYear=$!{searchMap.txt2html("year")}&amp;callBack=setApproveUserInfo"><img src="$!{img_path}/common/board/ic_search.gif" class="valign_middle" alt="사용자선택" /></a>
    								<a href="javascript:J.setInit('approveUserId','approveUserNm');"><img src="$!{img_path}/common/board/ic_cancel.gif" class="valign_middle" alt="사용자선택 취소" /></a>
    							</td>
        					</tr>
        				</tbody>
        			</table>
        		</div>

    			<!-- 목표 및 실적
    			<div class="blockDetailForTree blockDetail2">
        			<table summary="목표 및 실적">
        				<caption class="none">목표 및 실적</caption>
        				<colgroup>
        					<col width="27%" />
        					<col width="73%" />
        				</colgroup>
        				<tbody>
        					<tr>
        						<th scope="row" colspan="2" style="text-align:left; padding-left:85px"> 목표 및 실적</th>
        					</tr>
        					<tr>
        						<th scope="row"><label for="mediumTargety">중단기목표</label></th>
        						<td style="text-align:left; padding-left:20px">
    								<input type="text" id="mediumTargety" name="mediumTargety" class="inputbox w170" value='$!{CS_HTML.txt2html($detail.MEDIUM_TARGETY)}' maxlength="20" />
    							</td>
        					</tr>
    						<tr>
        						<th scope="row"><label for="actualY">현수준실적</label></th>
        						<td style="text-align:left; padding-left:20px">
    								<input type="text" id="actualY" name="actualY" class="inputbox w170" value='$!{CS_HTML.txt2html($detail.ACTUAL_Y)}' maxlength="20" />
    							</td>
        					</tr>
    						<tr>
        						<th scope="row"><label for="stretchGoal">Stretch Goal</label></th>
        						<td style="text-align:left; padding-left:20px">
    								<input type="text" id="stretchGoal" name="stretchGoal" class="inputbox w170" value='$!{CS_HTML.txt2html($detail.STRETCH_GOAL)}' maxlength="20" />
    							</td>
        					</tr>
    						<tr id="targetYContainer">
        						<th scope="row">년 목표</th>
        						<td style="text-align:left; padding-left:20px">
									<span id="targetY" style="padding-right:50px">$!{targetY}</span>
    								<a href="javascript:targetInsertPop();"><img src="$!{img_path}/common/bt_04.gif" class="valign_middle" alt="목표입력" /></a>
    							</td>
        					</tr>
        				</tbody>
        			</table>
        		</div>-->

    			<!-- 실적산식 -->
    			<span id="actCalTypeStr" class="blockDetailForTree none">※ $!{METRIC_NM}산식을 변경하시면, 산식항목을 새로 입력하셔야 합니다.</span>
    			<div id="actCalTypeArea" class="blockDetailForTree blockDetail2 none">
        			<table id="actCalTypeTB" summary="산식항목 등록">
        				<caption class="none">산식항목 등록</caption>
        				<colgroup>
        					<col width="15%" />
        					<col width="25%" />
    						<col width="10%" />
    						<col width="10%" />
    						<col width="22%" />
    						<col width="18%" />
        				</colgroup>
        				<tbody>
        					<tr>
        						<th scope="row"><label for="actCalType">$!{METRIC_NM} 산식</label></th>
        						<td colspan="5">
    								<input type="text" id="actCalType" name="actCalType" class="inputbox wp80" value='$!{CS_HTML.txt2html($detail.ACT_CAL_TYPE)}' maxlength="300" readonly="readonly"/>
									<!-- <img id="btnActCalType" src="$!{img_path}/common/bt_05.gif" class="valign_middle" alt="산식입력" /> -->
									<input type="image" onclick="javascript:popCalTypeCol();return false;" class="valign_middle" src="$!{img_path}/common/bt_05.gif" alt="산식입력"/>
    							</td>
        					</tr>
        					<tr id="actCalTypeList">
        						<th scope="row">산식항목</th>
        						<th scope="row">산식항목명</th>
    							<th scope="row">실적입력구분</th>
    							<th scope="row">단위</th>
    							<th scope="row">연계항목</th>
    							<th scope="row">원천데이터</th>
        					</tr>

                            #foreach($list in $calTypeColList)
        						<tr>
            						<td>
    									<span>$!{CS_HTML.txt2html($list.CAL_TYPE_COL)}</span>
    									<input type="hidden" name="calTypeCols" class="inputbox wp90" value="$!{CS_HTML.txt2html($list.CAL_TYPE_COL)}"/>
    								</td>
            						<td>
    									<input type="text" name="calTypeColNms" class="inputbox wp90" value="$!{CS_HTML.txt2html($list.CAL_TYPE_COL_NM)}" maxlength="80" title="산식항목"/>
    								</td>
        							<td>
    									<select name="insertGubuns" class="select w90" title="입력구분">
                                            <option value="">미지정</option>
    										$!CS_CODE.getCodeOption("014", $list.INSERT_GUBUN, $!{searchMap.txt2html("year")})
    									</select>
    								</td>
        							<td>
    									<select name="units" class="select w90" title="단위">
                                            <option value="">미지정</option>
    										$!CS_CODE.getCodeOption("013", $list.UNIT, $!{searchMap.txt2html("year")})
    									</select>
    								</td>
        							<td>
    									<input type="hidden" name="itemCds" class="inputbox wp60" value="$!{CS_HTML.txt2html($list.ITEM_CD)}" />
    									<input type="text" name="itemNms" class="inputbox wp60" value="$!{CS_HTML.txt2html($list.ITEM_NM)}" readonly="readonly" maxlength="30"  title="연계항목"/>
    									<input type="image" onclick="javascript:systemItemPop(this.parentNode.parentNode.rowIndex);return false;" class="valign_middle" src="$!{img_path}/common/board/ic_search.gif" alt="연계항목선택"/>
    									<input type="image" onclick="javascript:setInitItem(this.parentNode.parentNode.rowIndex);return false;" class="valign_middle" src="$!{img_path}/common/board/ic_cancel.gif" alt="연계항목취소"/>
    								</td>
        							<td>
    									<input type="text" name="sourceSystems" class="inputbox wp90" value="$!{CS_HTML.txt2html($list.SOURCE_SYSTEM)}" maxlength="30" title="연계시스템"/>
    								</td>
            					</tr>
                            #end

    						<tr id="kpiActCalTypeNm">
        						<th scope="row">$!{METRIC_NM} 산식명</th>
    							<td class="textLeft" colspan="5"><span>$!{calTypeColDesc}</span></td>
        					</tr>
        				</tbody>
        			</table>
        		</div>

    			<!-- 득적산식 -->
    			<div id="scoreCalTypeArea" class="blockDetailForTree blockDetail2 none">
        			<table summary="득점산식 등록">
        				<caption class="none">득점산식 등록</caption>
        				<colgroup>
        					<col width="15%" />
        					<col width="85%" />
        				</colgroup>
        				<tbody>
        					<tr>
        						<th scope="row" colspan="2" style="text-align:left; padding-left:85px">득점산식</th>
        					</tr>
        					<tr>
        						<th scope="row"><span class="txt_red">(*)</span> <label for="scoreCalTypeGubun">득점산식구분</label></th>
        						<td style="text-align:left; padding-left:20px">
    								<select id="scoreCalTypeGubun" name="scoreCalTypeGubun" class="select w200">
        								$!CS_CODE.getCodeOption("012", $!{CS_HTML.txt2html($detail.SCORE_CAL_TYPE_GUBUN, '01')}, $!{searchMap.txt2html("year")})
        							</select>
    							</td>
        					</tr>
    						<tr>
        						<th scope="row"><span class="txt_red">(*)</span> <label for="scoreCalTypeId">득점산식</label></th>
        						<td style="text-align:left; padding-left:20px">
    								<select id="scoreCalTypeId" name="scoreCalTypeId" class="select wp98">
    									<option value="">미지정</option>
        								#foreach($list in $scoreCalTypeList)
    										<option value="$!{CS_HTML.txt2html($list.CAL_TYPE_ID)}" $!{CS_HTML.getSelected($!{CS_HTML.txt2html($list.CAL_TYPE_ID)}, $!{CS_HTML.txt2html($detail.SCORE_CAL_TYPE_ID)})}>[$!{CS_HTML.txt2html($list.CAL_TYPE_ID)}]$!{CS_HTML.txt2html($list.CAL_TYPE_NM)}</option>
    									#end
        							</select>
    							</td>
        					</tr>
        				</tbody>
        			</table>
        		</div>

    			<!-- 평가등급 구간대 -->
    			<div id="evalSectionArea" class="blockDetailForTree blockDetail2 none">
        			<table summary="평가등급구간대 등록">
        				<caption class="none">평가등급구간대 등록</caption>
        				<colgroup>
        					<col width="15%" />
        					<col width="15%" />

    						#foreach($list in $evalSectionList)
    							<col width="14%" />
    						#end

        				</colgroup>
        				<tbody>
        					<tr>
        						<th scope="row" rowspan="3"><span class="txt_red">(*)</span> 평가등급구간대</th>
        						<th scope="row">구간분류</th>

    							#foreach($list in $evalSectionList)
        							<th scope="row">$!{CS_HTML.txt2html($list.EVAL_SECTION_NM)}</th>
    							#end

        					</tr>
    						<tr>
    							<th scope="row">점수구간</th>

    							#set($curValue = "")
    							#set($lastValue = "")
    							#set($idx = 1)
    							#set($evalSectionListSize = $!{CS_HTML.txt2html($evalSectionList.size())})
    							#foreach($list in $evalSectionList)
    								#if($idx == $evalSectionListSize)
    									#set($curValue = $!{lastValue})
    								#else
    									#set($curValue = $!{CS_HTML.txt2html($list.VIEW_VAL)})
    								#end
        							<td>
    									<input type="hidden" name="evalSectionIds" class="inputbox w50" value="$!{CS_HTML.txt2html($list.EVAL_SECTION_ID)}" />
        								<input type="text" name="viewValues" class="inputbox w50" value="$!{curValue}" maxlength="15" title="환산점수"/>
    									<input type="hidden" name="fromValues" class="inputbox w50" value="$!{CS_HTML.txt2html($list.FROM_VALUE)}" />
    									<input type="hidden" name="toValues" class="inputbox w50" value="$!{CS_HTML.txt2html($list.TO_VALUE)}" />
    									<span class="optionStr">이상</span>
        							</td>
    								#set($idx = $idx + 1)
    								#set($lastValue = $curValue)
    							#end

        					</tr>
    						<tr>
        						<th scope="row">환산점수</th>
    							#foreach($list in $evalSectionList)
    								<td>
        								<input type="text" name="conversionScores" class="inputbox w80" value="$!{CS_HTML.txt2html($list.CONVERSION_SCORE)}" maxlength="3" title="환산점수"/>
        							</td>
    							#end
        					</tr>
        				</tbody>
        			</table>
        		</div>

				<div class="blockButton_all floatLeft">
    				<div class="blockButton_l" style="margin-left:250px;">
    					<!-- 성과평가부에서 입력을 하기 때문에 지표등록기간 체크 없음
    					#if($!{kpiClosingYn} == 'Y')
    						<span id="closeAlert" class="txt_blue">※$!{METRIC_NM}입력이 마감되었습니다.</span><br/>
    					#end
    					#if($!{kpiInputTermYn} == 'N')
    						<span id="closeAlert" class="txt_blue">※$!{METRIC_NM}입력 기한이 아닙니다.</span><br/>
    					#end
    					-->
    					<span id="weightAlert" class="txt_red2 none">※$!{WEIGHT} 합계가 100이 되어야 합니다. 재조정 해주세요.</span><br/>
    				</div>
            		<div class="blockButton">
            			<ul>
            				<li><input type="button" id="btnBack"   value="돌아가기"/></li>
            				<li><input type="button" id="btnInsert" value="저장"/></li>
            			</ul>
            		</div>
				</div>

    			<input type="hidden" id="tgtValueUpdateByPop" name="tgtValueUpdateByPop" value="N" />
    			<input type="hidden" id="tgtValueUpdateByTamShare" name="tgtValueUpdateByTamShare" value="N" />
            	<div id="tgtPopInfo" class="none">
            		#foreach($list in $targetList)
            			<input type="text" name="tgtMons" value="$!{CS_HTML.txt2html($list.MON)}" title="해당월"/>
            			<input type="text" name="tgtValues" value="$!{CS_HTML.txt2html($list.TGT_VALUE)}" title="목표값"/>
                    #end
            	</div>
    		</form>
		</div>
	</div>
	<a id="anchor"></a>
	<div class="clear"></div>
</div>

<table id="actCalTypeTemplate" class="none">
	<tr>
        <td>
			<span></span>
			<input type="hidden" name="calTypeCols" class="inputbox wp90" value=""/>
		</td>
        <td>
			<input type="text" name="calTypeColNms" class="inputbox wp90" value="" maxlength="80" title="산식항목"/>
        </td>
        <td>
            <select name="insertGubuns" class="select w90" title="입력구분">
                <option value="">미지정</option>
            	$!CS_CODE.getCodeOption("014", "02", $!{searchMap.txt2html("year")})
            </select>
        </td>
        <td>
            <select name="units" class="select w90" title="단위">
                <option value="">미지정</option>
            	$!CS_CODE.getCodeOption("013", "", $!{searchMap.txt2html("year")})
            </select>
        </td>
        <td>
			<input type="hidden" name="itemCds" class="inputbox wp60" value="" />
			<input type="text" name="itemNms" class="inputbox wp60" value="" readonly="readonly" maxlength="30" title="연계항목"/>
			<input type="image" onclick="javascript:systemItemPop(this.parentNode.parentNode.rowIndex);return false;" class="valign_middle" src="$!{img_path}/common/board/ic_search.gif" alt="연계항목선택"/>
    		<input type="image" onclick="javascript:setInitItem(this.parentNode.parentNode.rowIndex);return false;" class="valign_middle" src="$!{img_path}/common/board/ic_cancel.gif" alt="연계항목취소"/>
        </td>
        <td>
			<input type="text" name="sourceSystems" class="inputbox wp90" value="" maxlength="30" title="연계시스템"/>
        </td>
	</tr>
</table>

