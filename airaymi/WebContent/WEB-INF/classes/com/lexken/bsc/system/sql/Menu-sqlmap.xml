<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="bsc.system.menu">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: 메뉴관리 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT PGM_ID
		     , PGM_NM
		     , UP_PGM_ID
		     , LEVEL_ID
		     , URL
		     , (SELECT COUNT(1) FROM BSC_PGMLIST B WHERE A.PGM_ID = B.UP_PGM_ID AND ROWNUM =1) CNT
		  FROM BSC_PGMLIST A
		 START WITH LEVEL_ID = '00'                                        
		CONNECT BY PRIOR PGM_ID = UP_PGM_ID   
		ORDER SIBLINGS BY SORT_ORDER, PGM_ID
	</select>
	
	
	<!--
	==================================================================   
	  # 설명	: 메뉴관리 상세 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->
	<select id="getDetail" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.PGM_ID
			 , A.PGM_NM
			 , A.UP_PGM_ID
			 , A.LEVEL_ID
			 , A.URL
			 , A.SORT_ORDER
			 , A.CONTENT
			 , CASE WHEN B.LEVEL_ID = '01' THEN B.PGM_ID
                    WHEN C.LEVEL_ID = '01' THEN C.PGM_ID
                    END TOP_PGM_ID
             , CASE WHEN B.LEVEL_ID = '02' THEN B.PGM_ID 
                    END SUB_PGM_ID
             , A.PARAM
		 FROM BSC_PGMLIST A
		 		LEFT OUTER JOIN BSC_PGMLIST B ON A.UP_PGM_ID = B.PGM_ID
				LEFT OUTER JOIN BSC_PGMLIST C ON B.UP_PGM_ID = C.PGM_ID
		WHERE A.PGM_ID = #pgmId#
	</select>
	
	
	<!--
	==================================================================   
	  # 설명	: 메뉴관리 등록
	  #	기능	: INSERT
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->	
	<insert id="insertData" parameterClass="hashMap">
		<selectKey resultClass="java.lang.String" keyProperty="SEQ" >
			SELECT F_PGM_SERI('BSC_PGMLIST','','','','','') SEQ FROM DUAL
		</selectKey> 
		INSERT INTO BSC_PGMLIST (
					PGM_ID
                  , PGM_NM
                  , UP_PGM_ID
                  , LEVEL_ID
                  , URL
                  , SORT_ORDER
                  , CONTENT
                  , PARAM
                  ) VALUES ( 
                    #SEQ#
                  , #pgmNm#
                  , #upPgmId#
                  , #levelId#
                  , #url#
                  , #sortOrder#
                  , #content#
                  , #param#
              )
	</insert>	

	
	<!--
	==================================================================   
	  # 설명	: 메뉴관리 수정
	  #	기능	: UPDATE
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->	
	<update id="updateData" parameterClass="hashMap">
		UPDATE BSC_PGMLIST
		   SET PGM_NM     = #pgmNmU#
		     , LEVEL_ID   = #levelIdU#
		     , URL        = #urlU#
		     , CONTENT    = #contentU#
		     , PARAM      = #param#
		 WHERE PGM_ID     = #pgmIdU#
	</update>	
	

	<!--
	==================================================================   
	  # 설명	: 메뉴관리 삭제
	  #	기능	: UPDATE
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->	
	<delete id="deleteData" parameterClass="hashMap">
		DELETE FROM BSC_PGMLIST
		WHERE  PGM_ID     = #pgmId#
	</delete>
	
	
	<!--
	==================================================================   
	  # 설명	: 메뉴관리 권한목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->
	<select id="getAdminList" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.CODE_ID AS ADMIN_GUBUN
			 , A.CODE_NM AS ADMIN_GUBUN_NM
             , B.PGM_ID
	      FROM BSC_CODE A
			   LEFT OUTER JOIN BSC_MENU_RIGHT B ON A.CODE_ID = B.ADMIN_GUBUN AND B.PGM_ID = #pgmId#
         WHERE A.CODE_GRP_ID = '018'
           AND A.DELETE_DT IS NULL
         ORDER BY A.SORT_ORDER ASC
	</select>
	
	
	<!--
	==================================================================   
	  # 설명	: 권한관리 삭제
	  #	기능	: DELETE
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->	
	<delete id="deleteAdminData" parameterClass="hashMap">
		DELETE FROM BSC_MENU_RIGHT
		WHERE  PGM_ID     = #pgmId#
	</delete>
	
	
	<!--
	==================================================================   
	  # 설명	: 권한관리 등록
	  #	기능	: INSERT
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->	
	<insert id="insertAdminData" parameterClass="hashMap">
		INSERT INTO BSC_MENU_RIGHT (
					ADMIN_GUBUN
                  , PGM_ID
                  ) VALUES ( 
                    #adminGubun#
                  , #pgmId#
              )
	</insert>	
	
	
	<!--
	==================================================================   
	  # 설명	: 동일레벨 메뉴목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->
	<select id="getMenuSortList" parameterClass="hashMap" resultClass="hashMap">
		SELECT PGM_ID
			 , PGM_NM
			 , UP_PGM_ID
			 , LEVEL_ID
			 , URL
			 , SORT_ORDER
			 , CONTENT
		 FROM BSC_PGMLIST
		WHERE UP_PGM_ID IN (SELECT UP_PGM_ID FROM BSC_PGMLIST WHERE PGM_ID = #pgmId#)
        ORDER BY SORT_ORDER, PGM_ID
	</select>
	
	
	<!--
	==================================================================   
	  # 설명	: 메뉴 정렬순서 수정
	  #	기능	: UPDATE
	  #	TABLE	: BSC_PGMLIST
	==================================================================
	-->	
	<update id="updateSortOrderData" parameterClass="hashMap">
		UPDATE BSC_PGMLIST
		   SET SORT_ORDER = #sortOrder# 
		WHERE  PGM_ID     = #pgmIdKey#
	</update>	
	

</sqlMap>


