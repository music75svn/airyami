<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="cbe.eval.evalResult">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: CBE_EVAL_MASTER
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: 종합평가결과 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: CBE_EVAL_MASTER
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.YEAR,
	            A.EVAL_DEGREE_ID,
	            A.EVAL_MEMB_USER_ID, 
	            A.EVAL_METHOD_GBN,
	            F_CODE_NM('155', A.EVAL_METHOD_GBN, '9999') AS EVAL_METHOD_GBN_NM,
	            D.WEIGHT_GRP_NM,
	            D.SORT_ORDER,
	            E.RIVAL_GRP_NM,
	            A.NAME,
	            C.SC_DEPT_NM,
	            A.JIKGUB_NM,
	            B.FRS_DEPT_CONVERT_SCORE,
	            B.SEC_DEPT_CONVERT_SCORE,
	            B.TEAM_CONVERT_SCORE,
	            B.PRS_CONVERT_SCORE,
	            B.CONBI_EVAL_SCORE,
	            B.CONBI_EVAL_FIX_GRADE
		  FROM CBE_EVAL_MASTER A
		  LEFT OUTER JOIN CBE_EVAL_RESULT B ON A.YEAR=B.YEAR AND A.EVAL_DEGREE_ID=B.EVAL_DEGREE_ID AND A.EVAL_MEMB_USER_ID=B.EVAL_MEMB_USER_ID
		  LEFT OUTER JOIN BSC_SC_DEPT C ON A.YEAR=C.YEAR AND A.SC_DEPT_ID=C.SC_DEPT_ID
		  LEFT OUTER JOIN CBE_WEIGHT_GRP D ON A.YEAR=D.YEAR AND A.EVAL_DEGREE_ID=D.EVAL_DEGREE_ID AND A.WEIGHT_GRP_ID=D.WEIGHT_GRP_ID
		  LEFT OUTER JOIN CBE_RIVAL_GRP E ON A.YEAR=E.YEAR AND A.EVAL_DEGREE_ID=E.EVAL_DEGREE_ID AND A.RIVAL_GRP_ID=E.RIVAL_GRP_ID
		WHERE A.YEAR=#findYear#
		    AND A.EVAL_DEGREE_ID=#findEvalDegreeId#  
		    <isNotEmpty property="findEvalMembUserId">
	         AND A.EVAL_MEMB_USER_ID = #findEvalMembUserId# 
	       </isNotEmpty>
	       <isNotEmpty property="findEvalMembUserNm">
	         AND A.NAME LIKE '%'||#findEvalMembUserNm#||'%'
	       </isNotEmpty>
		ORDER BY D.SORT_ORDER, B.CONBI_EVAL_SCORE
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 종합평가결과 상세 보기
	  #	기능	: SELECT
	  #	TABLE	: CBE_EVAL_MASTER
	==================================================================
	-->
	<select id="getDetail" parameterClass="hashMap" resultClass="hashMap">
		SELECT YEAR                  
			 , EVAL_DEGREE_ID        
			 , EVAL_MEMB_USER_ID     
			 , NAME                  
			 , SC_DEPT_ID            
			 , JIKGUB_ID             
			 , JIKGUB_NM             
			 , POS_ID                
			 , POS_NM                
			 , WEIGHT_GRP_ID         
			 , RIVAL_GRP_ID          
			 , ITEM_FRS_DEPT_ID      
			 , ITEM_SEC_DEPT_ID      
			 , ITEM_TEAM_ID          
			 , WORK_TERM             
			 , EVAL_METHOD_GBN       
			 , EXCE_EVAL_REASON      
		  FROM CBE_EVAL_MASTER 
		 WHERE 1 = 1 
		   AND YEAR = #year#
		   AND EVAL_DEGREE_ID = #evalDegreeId#
		   AND EVAL_MEMB_USER_ID = #evalMembUserId#	      
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 종합평가결과 등록
	  #	기능	: INSERT
	  #	TABLE	: CBE_EVAL_MASTER
	==================================================================
	-->	
	<insert id="insertData" parameterClass="hashMap">
		<selectKey resultClass="java.lang.String" keyProperty="SEQ" >
			SELECT F_PGM_SERI('CBE_EVAL_MASTER','','','','','') SEQ FROM DUAL
		</selectKey>
		INSERT INTO CBE_EVAL_MASTER ( 
			   YEAR
			 , EVAL_DEGREE_ID
			 , EVAL_MEMB_USER_ID
			 , NAME
			 , SC_DEPT_ID
			 , JIKGUB_ID
			 , JIKGUB_NM
			 , POS_ID
			 , POS_NM
			 , WEIGHT_GRP_ID
			 , RIVAL_GRP_ID
			 , ITEM_FRS_DEPT_ID
			 , ITEM_SEC_DEPT_ID
			 , ITEM_TEAM_ID
			 , WORK_TERM
			 , EVAL_METHOD_GBN
			 , EXCE_EVAL_REASON
			 , CREATE_DT
			 ) VALUES ( 
			   #year#
			 , #SEQ#
			 , #evalMembUserId#
			 , #name#
			 , #scDeptId#
			 , #jikgubId#
			 , #jikgubNm#
			 , #posId#
			 , #posNm#
			 , #weightGrpId#
			 , #rivalGrpId#
			 , #itemFrsDeptId#
			 , #itemSecDeptId#
			 , #itemTeamId#
			 , #workTerm#
			 , #evalMethodGbn#
			 , #exceEvalReason#
			 , SYSDATE
			 )
	</insert>	
	
	<!--
	==================================================================   
	  # 설명	: 종합평가결과 수정
	  #	기능	: UPDATE
	  #	TABLE	: CBE_EVAL_MASTER
	==================================================================
	-->	
	<update id="updateData" parameterClass="hashMap">
		UPDATE CBE_EVAL_MASTER 
		   SET NAME                   = #name# 
			 , SC_DEPT_ID             = #scDeptId# 
			 , JIKGUB_ID              = #jikgubId# 
			 , JIKGUB_NM              = #jikgubNm# 
			 , POS_ID                 = #posId# 
			 , POS_NM                 = #posNm# 
			 , WEIGHT_GRP_ID          = #weightGrpId# 
			 , RIVAL_GRP_ID           = #rivalGrpId# 
			 , ITEM_FRS_DEPT_ID       = #itemFrsDeptId# 
			 , ITEM_SEC_DEPT_ID       = #itemSecDeptId# 
			 , ITEM_TEAM_ID           = #itemTeamId# 
			 , WORK_TERM              = #workTerm# 
			 , EVAL_METHOD_GBN        = #evalMethodGbn# 
			 , EXCE_EVAL_REASON       = #exceEvalReason# 
			 , MODIFY_DT              = SYSDATE 
		 WHERE 1 = 1 
		   AND YEAR = #year#
		   AND EVAL_DEGREE_ID = #evalDegreeId#
		   AND EVAL_MEMB_USER_ID = #evalMembUserId#		
	</update>	
	

	<!--
	==================================================================   
	  # 설명	: 종합평가결과 삭제
	  #	기능	: UPDATE
	  #	TABLE	: CBE_EVAL_MASTER
	==================================================================
	-->	
	<update id="deleteData" parameterClass="hashMap">
		DELETE FROM CBE_EVAL_MASTER 
		 WHERE 1 = 1 
		   AND YEAR = #year#
		   AND EVAL_DEGREE_ID = #evalDegreeId#
		   AND EVAL_MEMB_USER_ID = #evalMembUserId#
	</update>
	
	<!--
	==================================================================   
	  # 설명	: 평가결과 보기
	  #	기능	: SELECT
	  #	TABLE	: CBE_EVAL_MASTER
	==================================================================
	-->
	<select id="getResultList" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.YEAR,
	            A.EVAL_DEGREE_ID,
	            A.EVAL_METHOD_GBN,
	            F_CODE_NM('155', A.EVAL_METHOD_GBN, '9999') AS EVAL_METHOD_GBN_NM,
	            D.WEIGHT_GRP_NM,
	            E.RIVAL_GRP_NM,
	            A.NAME,
	            C.SC_DEPT_NM,
	            (SELECT SC_DEPT_NM
	                FROM BSC_SC_DEPT
	              WHERE YEAR=A.YEAR
	                  AND SC_DEPT_ID=A.ITEM_FRS_DEPT_ID) ITEM_FRS_DEPT_NM,
	             D.FRS_DEPT_WEIGHT,     
	             (SELECT SC_DEPT_NM
	                FROM BSC_SC_DEPT
	              WHERE YEAR=A.YEAR
	                  AND SC_DEPT_ID=A.ITEM_SEC_DEPT_ID) ITEM_SEC_DEPT_NM,
	             D.SEC_DEPT_WEIGHT,     
	             (SELECT SC_DEPT_NM
	                FROM BSC_SC_DEPT
	              WHERE YEAR=A.YEAR
	                  AND SC_DEPT_ID=A.ITEM_TEAM_ID) ITEM_TEAM_NM,     
	            D.TEAM_WEIGHT,
	            D.PRS_WEIGHT,      
	            B.FRS_DEPT_SCORE,
	            B.FRS_DEPT_CONVERT_SCORE,
	            B.FRS_DEPT_WT_REFL_CONVERT_SCORE,
	            B.SEC_DEPT_SCORE,
	            B.SEC_DEPT_CONVERT_SCORE,
	            B.SEC_DEPT_WT_REFL_CONVERT_SCORE,
	            B.TEAM_SCORE,
	            B.TEAM_CONVERT_SCORE,
	            B.TEAM_WT_REFL_CONVERT_SCORE,
	            B.PRS_GRADE_ITEM_ID,
	            B.PRS_GRADE AS PRS_GRADE_ITEM_NM,
	            B.PRS_CONVERT_SCORE,
	            B.PRS_WT_REFL_CONVERT_SCORE,
	            B.CONBI_EVAL_SCORE,
	            B.CONBI_EVAL_FIX_GRADE
	  FROM CBE_EVAL_MASTER A
	  LEFT OUTER JOIN CBE_EVAL_RESULT B ON A.YEAR=B.YEAR AND A.EVAL_DEGREE_ID=B.EVAL_DEGREE_ID AND A.EVAL_MEMB_USER_ID=B.EVAL_MEMB_USER_ID
	  LEFT OUTER JOIN BSC_SC_DEPT C ON A.YEAR=C.YEAR AND A.SC_DEPT_ID=C.SC_DEPT_ID
	  LEFT OUTER JOIN CBE_WEIGHT_GRP D ON A.YEAR=D.YEAR AND A.EVAL_DEGREE_ID=D.EVAL_DEGREE_ID AND A.WEIGHT_GRP_ID=D.WEIGHT_GRP_ID
	  LEFT OUTER JOIN CBE_RIVAL_GRP E ON A.YEAR=E.YEAR AND A.EVAL_DEGREE_ID=E.EVAL_DEGREE_ID AND A.RIVAL_GRP_ID=E.RIVAL_GRP_ID
	WHERE A.YEAR=#year#
	     AND A.EVAL_DEGREE_ID=#evalDegreeId#
	     AND A.EVAL_MEMB_USER_ID=#evalMembUserId#  
	</select>
</sqlMap>


