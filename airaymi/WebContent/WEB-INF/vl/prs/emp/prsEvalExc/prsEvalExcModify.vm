#*************************************************************************
* CLASS 명      : prsEvalExcModify
* 작 업 자      : 신인수
* 작 업 일      : 2013년 6월 22일
* 기    능      : 직원개인평가(평가대상제외자)
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자    작     업     일        변 경 내 용                비고
* ----  --------  -----------------  -------------------------  --------
*  1    신인수      2013년 6월 22일             최 초 작 업
**************************************************************************#

<script type="text/javascript"
language="javascript" >
//<![CDATA[

    var J = jQuery;

    J(document).ready(function(){

        /******************************************
         * 취소버튼 (돌아가기)
         ******************************************/
        J("#btnBack").click(function() {
            J("#form2").attr("action", "$!{context_path}/prs/emp/prsEvalExc/prsEvalExcList.vw?type=template").submit();
        });

        /******************************************
         * 저장버튼 이벤트
         ******************************************/
        J("#btnInsert").click(function(e) {
            e.preventDefault();
            saveChk();
        });

        /******************************************
         * 저장버튼 이중 클릭 방지
         ******************************************/
        J("form").submit(function(){
            J("#btnInsert").unbind();
        });

		/******************************************
		 * 검색조건 텍스트 설정
		 ******************************************/
		J("#findEmpn").numeric();
		J("#findEmpn").css("ime-mode", "disabled");
		J("#findDeptKorNm").css("ime-mode", "active");
		J("#findKorNm").css("ime-mode", "active");

		/******************************************
    	 * 성명 검색 엔터키 이벤트
    	 ******************************************/
		J("#findUserNm").keyup(function(e)  {
        	if(e.keyCode == 13) {
        		tree_goAction('','');
        	}
        });
		
		J("#userDataSelect").dblclick(function() {
        addItem();
        });
		

    });

    /******************************************
     * 필수입력 체크
     ******************************************/
    function saveChk() {
        J.showConfirmBox("저장하시겠습니까?", "saveDo"); //saveDo() 콜백함수 호출
    }

	/******************************************
	 * 저장
	 ******************************************/
	function saveDo() {
		setMetricInfo();
		J("#form1").attr("action", "$!{context_path}/prs/emp/prsEvalExc/prsEvalExcProcess.vw?type=template").submit();
	}

	/******************************************
	 * 평가대상 선택하기
	 ******************************************/
	function addItem() {
		J("#userDataSelect option:selected").each(function () {
			var optValus = J(this).val();
			var optText = J(this).html();
			var isExist = false;
			
			/*J("select option", "#target").each(function () {
				if(optValus == J(this).val()) {
					J.showMsgBox("선택하신 data는 이미 선택되었습니다.", null, null);
					isExist = true;
				}
			});*/
			if(isExist == false) {
    			J("#targetData").append("<option value='" + optValus +"'>" + optText + "</option>");
    			J(this).remove();
			}
		});
	}

	/******************************************
	 * 평가대상 삭제하기
	 ******************************************/
	function delItem() {
		J("select option:selected", "#target").each(function () {
			J("#sourceData").append("<option value='" + J(this).val() +"'>" + J(this).text() + "</option>");
			J(this).remove();
		});
	}

	/******************************************
	 * 평가제외대상세팅
	 ******************************************/
	function setMetricInfo() {
		var empns = "";

		if(J("#targetData option").size()>0){
    		J("select option", "#target").each(function () {
    			var str = J(this).text();
    			var empn = J(this).val();

    			empns += empn + '|';
    		});
			J("#empns").val(empns);
		}
	}

	/******************************************
	 * 조직선택 클릭이벤트
	 ******************************************/
	function tree_goAction(deptId, deptNm) {

		var findUserNm = J("#findUserNm").val();
		J("#findSelectDept").val(deptId);
		if("" != deptId){
			findUserNm = "";
			J("#findUserNm").val("");
		}

		J.ajax({
			url        : "$!{context_path}/prs/emp/prsEvalExc/prsEvalUserInfo_ajax.vw",
			type       : "POST",
			data       : "deptId=" + deptId + "&amp;userNm=" + findUserNm,
        	dataType   : "xml",
			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success    : function (xml) {
				J("#userDataSelect").empty();
				if(J(xml).find("items").find("item").length > 0) {
					$(xml).find("items").find("item").each(function() {  
                    	var userId   = $(this).find("userId").text();
                    	var userNm   = $(this).find("userNm").text();
						var deptId   = $(this).find("deptId").text();
						var deptNm   = $(this).find("deptNm").text();
						var jikgubCd = $(this).find("jikgubCd").text();
						var jikgubNm = $(this).find("jikgubNm").text();
						var posCd    = $(this).find("posCd").text();
						var posNm    = $(this).find("posNm").text();
						if(findUserNm == "") {
						    J("#userDataSelect").append("<option value=\""+userId+"\">"+userId+" "+userNm+" "+jikgubNm+" "+posNm+" "+"</option>");
						} else {
						    J("#userDataSelect").append("<option value=\""+userId+"\">"+userId+" "+userNm+" "+jikgubNm+" "+deptNm+" "+"</option>");
						}
                    });
				}
        	},  
			error : function(xhr, status, error) {
				alert(error);
			}
    	});
	}

//]]>
</script>
    <div id="Table">
        <div id="Table_blockContainer">
            <div class="tableTop">
                #parse("/WEB-INF/vl/common/template/tabs.vm")
                <div class="clear"></div>
            </div>
            <div class="tableTop">
                <!-- 검색 테이블 Start -->
                <div class="searchBox">
                <div><div><div>
                    <table summary="검색조건">
                        <caption class="none">검색조건</caption>
                        <thead><tr><th></th><th></th></tr></thead>
                        <tbody>
                            <tr>
                                <td class="searchBox_tit w250">$!{YEAR} <span class="searchBar">$!{searchMap.txt2html("findYear")}년</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div></div></div>
                </div>
                <!--// 검색 테이블 End -->
                <div class="clear"></div>
            </div>
            <div class="blockDetail">
                <table summary="직원개인평가(평가대상제외자) 등록">
                    <caption class="none">직원개인평가(평가대상제외자) 등록</caption>
                    <tbody>
						<tr>
							<form id="formFind" name="formFind" method="post" action="$!{context_path}/prs/emp/prsEvalExc/prsEvalExcModify.vw?type=template">
								<input type="hidden"	id="findHighPgmId"	    name="findHighPgmId"		value="$!{searchMap.txt2html("findHighPgmId")}" />
                            	<input type="hidden" 	id="findSubPgmId"	    name="findSubPgmId"			value="$!{searchMap.txt2html("findSubPgmId")}" />
                            	<input type="hidden"    id="findPgmId"		    name="findPgmId"			value="$!{searchMap.txt2html("findPgmId")}" />
								<input type="hidden" 	id="mode"		    	name="mode"		      		value="$!{searchMap.txt2html("mode")}" />
								<input type="hidden" 	id="findYear"			name="findYear"		  		value="$!{searchMap.txt2html("findYear")}" />
								<input type="hidden" 	id="exceptCd"			name="exceptCd"		  		value="$!{searchMap.txt2html("exceptCd")}" />
								<input type="hidden" 	id="findSelectDept" 	name="findSelectDept"   	value="$!{searchMap.txt2html("findSelectDept")}" />
							<td style="width:45%; height:40px;">
								<span>직원조회</span>
							</td>
							</form>
							<td style="width:10%;">
								&nbsp;
							</td>
							<td>
								<span>평가제외자</span>
							</td>
						</tr>
						<tr>
							<td style="width:45%;" valign="top">
								<div style="width:515px;height:350px;">
                                	<div id="popSearchUserArea">
                                		<h1 class="none">실조직트리</h1>
                                		<div class="blockGridTreeTable">
												#parse("/WEB-INF/vl/prs/emp/prsEvalExc/deptTree.vm")
                                		</div>
                                		<div style="margin: 5px 0px 8px 25px;float:left;"><span class="strong">성명 : </span><input type="text" id="findUserNm" name="findUserNm" class="w180"/></div>
                                		<div id="userData" class="" style="float:left;margin-left:20px;height:353px;width:240px;">
                                			<select id="userDataSelect" multiple="multiple" style="height:345px;width:100%;">
                                			</select>
                                		</div>

                                	</div>
                                </div>
    						</td>
    						<td class="textCenter" style="width:10%;">
                        		<img src="$!{searchMap.txt2html("context")}/images/common/btn_arrow2.gif" onmouseover="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow2up.gif'" onmouseout="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow2.gif'" onClick="addItem();"><br /><br />
                        		<img src="$!{searchMap.txt2html("context")}/images/common/btn_arrow1.gif" onmouseover="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow1up.gif'" onmouseout="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow1.gif'" onClick="delItem();">
            				</td>
							<td valign="top">
								<form id="form1" name="form1" method="post" action="$!{context_path}/prs/emp/prsEvalExc/prsEvalExcProcess.vw?type=template">
                                <input type="hidden" 	id="mode"		    name="mode"		      value="ADD" />
                            	<input type="hidden"	id="year"           name="year"           value="$!{searchMap.txt2html("year")}" />
								<input type="hidden" 	id="exceptCd"		name="exceptCd"		  value="$!{searchMap.txt2html("exceptCd")}" />
								<input type="hidden"	id="empns"          name="empns"          />
								$!{searchMap.makeHiddenFind()}

    								<div id="target">
                                       <select multiple="multiple" id="targetData" name="targetData" style="height:387px;width:100%;background:#fff url($!{img_path}/common/div_back.gif) repeat-x 0 100%;" ondblclick="javascript:delItem();">
    										#foreach($prsExcList in $prsExcList)
        										<option value="$!{CS_HTML.txt2html($prsExcList.EMPN)}"/>$!{CS_HTML.txt2html($prsExcList.EMPN)}  $!{CS_HTML.txt2html($prsExcList.KOR_NM)} $!{CS_HTML.txt2html($prsExcList.CAST_TC_NM)} $!{CS_HTML.txt2html($prsExcList.POS_TC_NM)} $!{CS_HTML.txt2html($prsExcList.DEPT_KOR_NM)}</option>
                                            #end
    									</select>
    								</div>
								</form>
							</td>
						</tr>
    				</tbody>
                </table>
            </div>
            <div class="blockButton">
                <ul>
                    <li><input type="button" id="btnBack"   value="돌아가기" /></li>
                    <li><input type="button" id="btnInsert" value="저장" /></li>
                </ul>
            </div>
        </div>
        <div class="clear"></div>
    </div>
	<form id="form2" name="form2" method="post" action="$!{context_path}/prs/emp/prsEvalExc/prsEvalExcList.vw?type=template">
		<input type="hidden"	id="findHighPgmId"	    name="findHighPgmId"		value="$!{searchMap.txt2html("findHighPgmId")}" />
    	<input type="hidden" 	id="findSubPgmId"	    name="findSubPgmId"			value="$!{searchMap.txt2html("findSubPgmId")}" />
    	<input type="hidden"    id="findPgmId"		    name="findPgmId"			value="$!{searchMap.txt2html("findPgmId")}" />
        <input type="hidden" 	id="mode"		        name="mode"		            value="$!{searchMap.txt2html("mode")}" />
        <input type="hidden"	id="findYear"           name="findYear"             value="$!{searchMap.txt2html("findYear")}" />
	</form>
