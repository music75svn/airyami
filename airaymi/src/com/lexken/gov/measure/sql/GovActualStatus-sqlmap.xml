<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="gov.measure.govActualStatus">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: 경평 계량지표 실적입력현황 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: 
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT * 
		FROM (
				SELECT A.YEAR
				     , A.INSERT_USER_ID
				     , UI.USER_NM AS INSERT_USER_NM
				     , D.DEPT_ID
				     , D.DEPT_NM
				     , UI.EMAIL
				     , NVL(COUNT(1), 0) TOT_CNT
				     , NVL(SUM(CASE WHEN B.ACTUAL IS NULL THEN 1 END), 0) AS CNT_01
				     , NVL(SUM(CASE WHEN B.ACTUAL IS NOT NULL THEN 1 END), 0) AS CNT_02   
				  FROM GOV_METRIC A
	   LEFT OUTER JOIN GOV_ACTUAL B 
	   			    ON A.YEAR = B.YEAR 
	   			   AND A.GOV_METRIC_ID = B.GOV_METRIC_ID 
	   			   AND B.MON = #findMon#
	   LEFT OUTER JOIN BSC_USERINFO UI 
	   				ON A.INSERT_USER_ID = UI.USER_ID       
	   LEFT OUTER JOIN V_DEPTINFO D 
	   			    ON UI.DEPT_ID = D.DEPT_ID
				 WHERE A.YEAR = #findYear#
				   AND A.GBN_ID = '01'
				   AND A.DELETE_DT IS NULL 
			  GROUP BY A.YEAR
			  		 , A.INSERT_USER_ID
			  		 , UI.USER_NM
			  		 , D.DEPT_ID
			  		 , D.DEPT_NM
			  		 , UI.EMAIL
			)
		WHERE 1=1
		
		<dynamic>
		   	<isEqual prepend="AND" property="findStatus" compareValue="Y">
            	TOT_CNT = CNT_02 
		    </isEqual>
		    <isEqual prepend="AND" property="findStatus" compareValue="N">
            	TOT_CNT != CNT_02 
		    </isEqual>  
	    </dynamic>
	    
		ORDER BY INSERT_USER_NM
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 경평 계량지표 실적입력현황 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: 
	==================================================================
	-->
	<select id="getSubCalList" parameterClass="hashMap" resultClass="hashMap">
			SELECT A.YEAR
			     , A.INSERT_USER_ID
			     , C.USER_NM AS INSERT_USER_NM
			     , D.DEPT_ID
			     , D.DEPT_NM
			     , C.EMAIL
			     , NVL(COUNT(1), 0) TOT_CNT
			     , NVL(SUM(CASE WHEN B.ACTUAL IS NULL THEN 1 END), 0) AS CNT_01
			     , NVL(SUM(CASE WHEN B.ACTUAL IS NOT NULL THEN 1 END), 0) AS CNT_02 
			  FROM GOV_SUB_CAL A 
   LEFT OUTER JOIN GOV_SUB_CAL_ACTUAL B 
 			    ON A.YEAR = B.YEAR 
 			   AND A.SUB_CAL_ID = B.SUB_CAL_ID 
 			   AND B.MON = #findMon#
   LEFT OUTER JOIN V_ROLE_USER C 
 			    ON A.INSERT_USER_ID = C.USER_ID
   LEFT OUTER JOIN V_DEPTINFO D 
   			    ON C.DEPT_ID = D.DEPT_ID
			 WHERE A.YEAR = #findYear#
		  GROUP BY A.YEAR, A.INSERT_USER_ID
			     , C.USER_NM
			     , D.DEPT_ID
			     , D.DEPT_NM
			     , C.EMAIL
		  ORDER BY C.USER_NM       
	</select>	
	
	<!--
	==================================================================   
	  # 설명	: 경평 계량지표 실적입력현황 상세 보기
	  #	기능	: SELECT
	  #	TABLE	: 
	==================================================================
	-->
	<select id="getDetail" parameterClass="hashMap" resultClass="hashMap">

	</select>
	
	<!--
	==================================================================   
	  # 설명	: 경평 계량지표 실적입력현황 등록
	  #	기능	: INSERT
	  #	TABLE	: 
	==================================================================
	-->	
	<insert id="insertData" parameterClass="hashMap">

	</insert>	
	
	<!--
	==================================================================   
	  # 설명	: 경평 계량지표 실적입력현황 수정
	  #	기능	: UPDATE
	  #	TABLE	: 
	==================================================================
	-->	
	<update id="updateData" parameterClass="hashMap">
		
	</update>	
	

	<!--
	==================================================================   
	  # 설명	: 경평 계량지표 실적입력현황 삭제
	  #	기능	: UPDATE
	  #	TABLE	: 
	==================================================================
	-->	
	<update id="deleteData" parameterClass="hashMap">

	</update>
	
	
</sqlMap>


