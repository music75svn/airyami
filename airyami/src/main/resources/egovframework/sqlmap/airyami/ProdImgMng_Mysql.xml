<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="prodImg">

<typeAlias alias="ValueMap" type="egovframework.airyami.cmm.util.ValueMap"/>

	<select id="prodImg.selectFileList" parameterClass="Map" resultClass="ValueMap">
	SELECT PROD_NO
		  ,LANG_CD
		  ,FILE_DTL_SEQ
		  ,IMG_TYPE_CD
		  ,FILE_PATH
		  ,URL_PATH
		  ,SAVE_FILE_NAME
		  ,ORG_FILE_NAME
		  ,FILE_EXT
		  ,FILE_SIZE
	  FROM TB_PRODUCT_IMAGE
	 WHERE PROD_NO = #PROD_NO#
	   /* AND LANG_CD = LANG_CD */
	 ORDER BY FILE_DTL_SEQ
	</select>


	<select id="prodImg.selectNewDetailId" parameterClass="java.math.BigDecimal" resultClass="java.math.BigDecimal">
	SELECT IFNULL(MAX(FILE_DTL_SEQ) + 1, 1) FILE_DTL_SEQ
	  FROM TB_PRODUCT_IMAGE 
	 WHERE PROD_NO = #PROD_NO#
	   AND LANG_CD = #LANG_CD#
	</select>
	
	<update id="prodImg.deleteFile" parameterClass="Map" >
	DELETE FROM TB_PRODUCT_IMAGE
	 WHERE PROD_NO = #PROD_NO# 
	   AND LANG_CD = #LANG_CD#
	   AND FILE_DTL_SEQ = #FILE_DTL_SEQ#
	</update>
	
	<insert id="prodImg.insertFile" parameterClass="map">
	INSERT INTO TB_PRODUCT_IMAGE(
	    PROD_NO
	   ,LANG_CD
	   ,FILE_DTL_SEQ
	   ,IMG_TYPE_CD
	   ,FILE_PATH
	   <isNotEmpty property="URL_PATH">,URL_PATH</isNotEmpty>
	   ,SAVE_FILE_NAME
	   ,ORG_FILE_NAME
	   ,FILE_EXT
	   ,FILE_SIZE
	   ,INSERT_USER_ID
	   ,INSERT_DT
	   )
	VALUES
	  (
	    #PROD_NO#
	   ,#LANG_CD#
	   ,#FILE_DTL_SEQ#
	   ,#IMG_TYPE_CD#
	   ,#FILE_PATH#
	   <isNotEmpty property="URL_PATH">,#URL_PATH#</isNotEmpty>
	   ,#SAVE_FILE_NAME#
	   ,#ORG_FILE_NAME#
	   ,#FILE_EXT#
	   ,#FILE_SIZE#
	   ,#LOGIN_ID#
	   ,DATE_FORMAT(now(), '%Y%m%d%H%i%s')
	  )
	
	</insert>
	
	<insert id="prodImg.insertFileDownLoadLog" parameterClass="map">
	INSERT INTO TB_PRODUCT_IMAGE_down_log
	SELECT NULL
	      ,PROD_NO
		  ,FILE_DTL_SEQ
		  <isNotEmpty property="LOGIN_ID">	, #LOGIN_ID# 	</isNotEmpty>
	      <isEmpty property="LOGIN_ID"> 	, 'GUEST'		</isEmpty>
	      ,DATE_FORMAT(now(), '%Y%m%d')
	      ,DATE_FORMAT(now(), '%H%i%s')
	      <isNotEmpty property="LOGIN_ID">	, #LOGIN_ID# 	</isNotEmpty>
	      <isEmpty property="LOGIN_ID"> 	, 'GUEST'		</isEmpty>
	      ,DATE_FORMAT(now(), '%Y%m%d')
	      ,DATE_FORMAT(now(), '%H%i%s')
	  FROM TB_PRODUCT_IMAGE
	 WHERE PROD_NO = #PROD_NO#
	 <isNotEmpty property="FILE_DTL_SEQ">
	   AND FILE_DTL_SEQ= #FILE_DTL_SEQ# 
	 </isNotEmpty>
	</insert>
	
	
	
	
</sqlMap>