#*************************************************************************
* CLASS 명   : popMetricMappingModify.vm
* 작 업 자      : 현걸욱
* 작 업 일      : 2012.11.01
* 기    능      : 부서별지표검색
* ---------------------------- 변 경 이 력 --------------------------------
* 번호   작 업 자     작   업   일        변 경 내 용             비고
* ----  --------  -----------------  -------------------------  --------
*  1     하 윤 식      2012.11.01          최 초 작 업 
**************************************************************************# 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko">

#set($main_url = $!{searchMap.txt2html("mainUrl")})
#set($curr_url = $!{context_path} + "/bsc/system/reOpinion/popOpinionModify.vw")

<head>
	#parse("/WEB-INF/vl/common/template/head.vm")
<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;
	
	J(document).ready(function(){
    	
		/******************************************
		 * 입력완료 버튼 이벤트
		 ******************************************/
		J("#btnInsert").click(function(e) {
			e.preventDefault();
			saveChk();
		});
		
		try {
			$("input", ".blockButton" ).button(); //버튼 ui 적용
		} catch(err) { }
		
		J("#contents").checkbyte({
			indicator:J("#contentsInd"),
			limit:3000
		});
		J("#contents").trigger("keyup");
		
	});
	
	/******************************************
	 * 연계지표매핑
	 ******************************************/
	function saveChk() {
        
        if(!J.checkLength("title", "제목", 1, 200)) {
            return;
        } 
	
		if(J("#typeId").val() == "") {
			J.showMsgBox("요청구분을 선택해 주십시요", null, "typeId");
			return;
		}
		
		if(J("#replyStatus").val() == "") {
			J.showMsgBox("답변상태를 선택해 주십시요", null, "replyStatus");
			return;
		}
		
        if(!J.checkLength("contents", "내용", 0, 3000)) {
            return;
        } 
	
		var fileChk = true;
		
		//첨부파일 확장자 체크
		J(":file", "#formMod").each(function(index, item) {
			var fileFullName = J("input[name=" + item.name + "]").val();
			var src = getFileExtension(fileFullName);
			
			if (!((src.toLowerCase() == "xls") || (src.toLowerCase() == "xlsx") || (src.toLowerCase() == "ppt") || (src.toLowerCase() == "pptx")||
				  (src.toLowerCase() == "doc") || (src.toLowerCase() == "docx") || (src.toLowerCase() == "hwp") || (src.toLowerCase() == "pdf") ||
				  (src.toLowerCase() == "zip") || (src.toLowerCase() == "txt")  || (src.toLowerCase() == "gif") || (src.toLowerCase() == "jpg") ||
			      (src.toLowerCase() == "png") || (src.toLowerCase() == "png")
			    )) {
			
				fileChk = false;
    		}
		});
		
		if(fileChk == false) {
			J.showMsgBox("허용되지 않는 파일형식입니다<br/>허용되는 파일형식 : <br/>xls, xlsx, ppt, pptx, doc, docx, hwp <br/> pdf, zip, txt, gif, jpg, png, jpeg", null, null);
    		return;
		}
		
		if(confirm("저장하시겠습니까?")){
		
			saveInsDo();
		
		}else{
			return;
		}

	}
	
	/******************************************
	 * 저장
	 ******************************************/
	function saveInsDo() {
		J("#formMod").attr("action", "$!{context_path}/bsc/system/reOpinion/reOpinionProcess.vw?type=template").submit();
		opener.parentRefresh();
		self.close();
	}
	
	/******************************************
	 * 파일추가
	 ******************************************/
	var fileIndex = 0;
	
	function fileAttachAdd() {
		J("#fileAttach").append("<li id=\"fileRow" + fileIndex + "\"><input type=\"file\" id=\"file\" name=\"file" + fileIndex + "\" class=\"input\" size=\"60\" /> <input type=\"button\" value=\"삭제\" onclick=\"deleteRow(" + fileIndex + ")\" class=\"input\" size=\"70\"></li>");
		fileIndex++;
	}
	
	function deleteRow(fileIndex)	{
    	J("#fileRow" + fileIndex).remove();
    }
	
//]]>
</script>    
</head>
<body>
<form id="formMod" name="formMod" method="post" enctype="multipart/form-data" action="$!{context_path}/bsc/system/reOpinion/reOpinionProcess.vw?type=template">
    <input type="hidden" 	id="mode"		    name="mode"		      value="$!{searchMap.txt2html("mode")}" />
	<input type="hidden"	id="year"           name="year"           value="$!{searchMap.txt2html("year")}" />
	<input type="hidden"	id="cbId"       	name="cbId"       	  value="$!{searchMap.txt2html("cbId")}" />
	<input type="hidden"	id="cbGbn"       	name="cbGbn"       	  value="01" />
	<input type="hidden"	id="scDeptId"       name="scDeptId"       value="$!{CS_LOGIN.getSc_dept_id()}" />
	<input type="hidden"	id="sabun"       	name="sabun"       	  value="$!{CS_LOGIN.getSabun()}" />
	<input type="hidden"	id="userNm"       	name="userNm"         value="$!{CS_LOGIN.getUser_nm()}" />
    $!{searchMap.makeHiddenFind()}
<div style="width:650px;height:400px;">
	<div id="Table_blockContainer_w600">
		<div class="tableTop">
            <!-- 검색 테이블 Start -->
            <div class="searchBox">
            <div><div><div>   
                <table summary="검색조건">        
                    <caption class="none">검색조건</caption>
                    <thead><tr><th></th><th></th></tr></thead>
                    <tbody>
                        <tr>
							<td class="searchBox_tit w120">평가년도 <span class="searchBar">$!{searchMap.txt2html("year")}년</span></td>
						</tr>
                    </tbody>
                </table>
            </div></div></div>
            </div>
            <!--// 검색 테이블 End -->
            <div class="clear"></div>
        </div>
		<div class="blockDetail h300" style="height:300px;overflow:auto;">
			<table summary="이의신청 등록">
				<caption class="none">이의신청 등록</caption>
				<colgroup>
					<col width="15%" />
					<col width="85%" />
				</colgroup>
				<tbody>
					<tr>
						<th scope="row"><label for="typeId">등록자</label></th>
						<td>
							$!{CS_LOGIN.getUser_nm()} ($!{CS_LOGIN.getSc_dept_nm()})
						</td>
					</tr>
					<tr>
						<th scope="row"><span class="txt_red">(*)</span><label for="title">제목</label></th>
						<td>
							<input type="text" id="title" name="title" class="inputbox wp95" value='$!{CS_HTML.txt2html($detail.TITLE)}' maxlength="100" />
						</td>
					</tr>
					<tr>
						<th scope="row"><span class="txt_red">(*)</span><label for="typeId">요청구분</label></th>
						<td>
							<select id="typeId" name="typeId" class="select w140">
								<option value="">===선택===</option>
								$!CS_CODE.getCodeOption("160", $!{CS_HTML.txt2html($detail.TYPE_ID)})
							</select>
						</td>
					</tr>
					<tr>
						<th scope="row"><span class="txt_red">(*)</span><label for="replyStatus">답변상태</label></th>
						<td>
							<select id="replyStatus" name="replyStatus" class="select w140">
								<option value="">===선택===</option>
								$!CS_CODE.getCodeOption("161", $!{CS_HTML.txt2html($detail.REPLY_STATUS)})
							</select>
						</td>
					</tr>
					<tr>
						<th scope="row"><span class="txt_red">(*)</span><label for="prvYn">공개구분</label></th>
						<td>
							<input type="radio" id="prvYn1" name="prvYn" value="Y" #if($!{CS_HTML.txt2html($detail.PRV_YN)} == 'Y') checked #end>비공개</option>
							<input type="radio" id="prvYn2" name="prvYn" value="N" #if($!{CS_HTML.txt2html($detail.PRV_YN)} == 'Y') #else checked #end>공개</option>
						</td>
					</tr>
					<tr>
						<th scope="row"><label for="contents">내용</label></th>
						<td>
							<textarea id="contents" name="contents" class="tabletext" title="KPI 목적" cols="10" rows="5">$!{CS_HTML.txt2html($detail.CONTENTS)}</textarea>
							<span id="contentsInd">0</span>/3000byte
						</td>
					</tr>
					<tr>
						<th scope="row"><label for="">첨부파일</label></th>
						<td>
							#foreach($fileList in $fileList)
								$!{CS_HTML.makeFileIconFileName($fileList.get("ATTACH_FILE_SUFFIX"), $fileList.get("ATTACH_FILE_NM"), $fileList.get("ATTACH_FILE_PATH"))} 
								&nbsp;&nbsp;<input type="checkbox" name="delAttachFiles" id="delAttachFile$!{fileList.get("SEQ")}" value="$!{fileList.get("SEQ")}" />&nbsp;<label for="delAttachFile$!{fileList.get("SEQ")}">첨부파일 삭제</label> <br/>
							#end
							<a href="javascript:fileAttachAdd();"><img src="$!{searchMap.txt2html("context")}/images/common/btn_file.gif" class="valign_middle" alt="파일추가" /></a>&nbsp;(첨부파일 용량제한은 100M입니다)<br/>
							<div>
								<ul id="fileAttach">
								</ul>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="blockButton"> 
			<ul>
				<li><input type="button" id="btnInsert" value="입력완료" /></li>
			</ul>
		</div>	
	</div>
	<div class="clear"></div>
</div>
</form>
<div id="dialog" title="확인"><p>&nbsp;</p></div>    <!-- 다이어로그 -->
</body>
</html>
