<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="bsc.popup.technicalEdc">

	<!--
	==================================================================
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	:
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />

	<!--
	==================================================================
	  # 설명	: 시스템 연계항목 정보를 가져옴
	  #	기능	: SELECT
	  #	TABLE	:
	==================================================================
	-->
	<select id="getItem" remapResults="true" parameterClass="hashMap" resultClass="hashMap">
          SELECT A.ITEM_CD, B.CAL_TYPE_COL_NM
            FROM BSC_SYSTEM_ITEM A
               , BSC_CAL_TYPE_COL B
           WHERE A.YEAR = #findYear#
             AND A.YEAR = B.YEAR
             AND A.ITEM_CD = B.ITEM_CD
             AND B.METRIC_ID = #findMetricId#
             AND B.INSERT_GUBUN = '01'
           ORDER BY B.CAL_TYPE_COL_NM
	</select>

	<!--
	==================================================================
	  # 설명	: 시스템 연계 부서 목록 보기
	  #	기능	: SELECT
	  #	TABLE	:
	==================================================================
	-->
	<select id="getScDeptMapping" parameterClass="hashMap" resultClass="java.lang.String">
		SELECT DEPT_ID
		  FROM ( SELECT DEPT_ID
				   FROM BSC_SC_DEPT_MAPPING
				  WHERE YEAR = #findYear#
				    AND SC_DEPT_ID = #findScDeptCd# ORDER BY DEPT_ID )
		 WHERE ROWNUM = 1
	</select>

	<!--
	==================================================================
	  # 설명	: 시스템 연계 부서 목록 보기
	  #	기능	: SELECT
	  #	TABLE	:
	==================================================================
	-->
	<select id="getDeptInfo" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.DEPT_ID, B.DEPT_NM
		  FROM BSC_SC_DEPT_MAPPING A
	LEFT OUTER JOIN BSC_DEPTINFO B
			ON A.DEPT_ID = B.DEPT_ID
		 WHERE (YEAR, SC_DEPT_ID) IN
		          (SELECT YEAR, SC_DEPT_ID
		             FROM BSC_METRIC
		            WHERE (METRIC_GRP_ID, YEAR) IN
		                     (SELECT METRIC_GRP_ID, YEAR
		                        FROM BSC_METRIC
		                       WHERE YEAR = #findYear# AND METRIC_ID = #findMetricId#)
		            AND DELETE_DT IS NULL)

	</select>

	<!--
	==================================================================
	  # 설명	: 2014년도 교육원 전문교육(신규) 수입목표 달성(650백만원) 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: SAORA01.GBD0802D
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		 SELECT SUM(CUM_REQ_QTY) AS CUM_REQ_QTY          <!-- 누계-신규 - 신청수량 -->
              , SUM(CUM_REQ_AMT) AS CUM_REQ_AMT         <!-- 누계-신규 - 신청금액 -->
              , SUM(CUM_INSP_QTY) AS CUM_INSP_QTY    <!-- 누계-신규 - 검사수량 -->
              , SUM(CUM_PASS_QTY) AS CUM_PASS_QTY    <!-- 누계-신규 - 합격수량 -->
              , SUM(CUM_UNPASS_QTY) AS CUM_UNPASS_QTY     <!-- 누계-신규 - 불합격수량  -->
              , SUM(CUM_UNINSP_QTY) AS CUM_UNINSP_QTY  <!-- 누계-신규 - 검사불능수량 -->
              , SUM(CUM_DIF_QTY) AS CUM_DIF_QTY     <!-- 누계-신규 - 잔량 -->
		   FROM (SELECT (SELECT X.COMM_C
                FROM MAORA01.MDA0000M X
               WHERE B.UP_SER = X.SER
             )                                      AS RPT_TC, 
             (SELECT X.COMM_C_NM
                FROM MAORA01.MDA0000M X
               WHERE B.UP_SER = X.SER
             )                                      AS RPT_TC_NM,  
             A.ROLE_TC,
             C.ROLE_TC_NM,
             A.INSP_KIND_TC,
             C.INSP_KIND_TC_NM,
             A.LAW_TC,
             C.LAW_TC_NM,
             A.STIC_LAG_TC,
             C.STIC_LAG_TC_NM,
             A.STIC_MID_TC,
             C.STIC_MID_TC_NM,
             A.STIC_SML_TC,
             C.STIC_SML_TC_NM,
             SUM(A.REQ_QTY)                         AS REQ_QTY,             
             SUM(A.REQ_AMT)                         AS REQ_AMT,              
             SUM(A.INSP_QTY)                        AS INSP_QTY,             
             SUM(A.PASS_QTY)                        AS PASS_QTY,             
             SUM(A.UNPASS_QTY)                      AS UNPASS_QTY,          
             SUM(A.UNINSP_QTY)                      AS UNINSP_QTY,         
             SUM(A.RE_REQ_QTY)                      AS RE_REQ_QTY,          
             SUM(A.RE_REQ_AMT)                      AS RE_REQ_AMT,           
             SUM(A.RE_INSP_QTY)                     AS RE_INSP_QTY,          
             SUM(A.RE_PASS_QTY)                     AS RE_PASS_QTY,          
             SUM(A.RE_UNPASS_QTY)                   AS RE_UNPASS_QTY,       
             SUM(A.RE_UNINSP_QTY)                   AS RE_UNINSP_QTY,        
             SUM(A.CUM_REQ_QTY)                     AS CUM_REQ_QTY,          
             SUM(A.CUM_REQ_AMT)                     AS CUM_REQ_AMT,          
             SUM(A.CUM_INSP_QTY)                    AS CUM_INSP_QTY,       
             SUM(A.CUM_PASS_QTY)                    AS CUM_PASS_QTY,       
             SUM(A.CUM_UNPASS_QTY)                  AS CUM_UNPASS_QTY,      
             SUM(A.CUM_UNINSP_QTY)                  AS CUM_UNINSP_QTY,     
             SUM(A.CUM_DIF_QTY)                     AS CUM_DIF_QTY,         
             SUM(A.CUM_RE_REQ_QTY)                  AS CUM_RE_REQ_QTY,      
             SUM(A.CUM_RE_REQ_AMT)                  AS CUM_RE_REQ_AMT,      
             SUM(A.CUM_RE_INSP_QTY)                 AS CUM_RE_INSP_QTY,      
             SUM(A.CUM_RE_PASS_QTY)                 AS CUM_RE_PASS_QTY,     
             SUM(A.CUM_RE_UNPASS_QTY)               AS CUM_RE_UNPASS_QTY,   
             SUM(A.CUM_RE_UNINSP_QTY)               AS CUM_RE_UNINSP_QTY,   
             SUM(A.CUM_DIF_RE_QTY)                  AS CUM_DIF_RE_QTY,      
             SUM(A.CUM_DIF_QTY+A.CUM_DIF_RE_QTY)    AS CUM_DIF_SUM_DIF     
        FROM (
              SELECT ROLE_TC,
                     INSP_KIND_TC,
                     LAW_TC,
                     STIC_LAG_TC,
                     STIC_MID_TC,
                     STIC_SML_TC,
                     0                                            AS REQ_QTY,
                     0                                            AS REQ_AMT,
                     0                                            AS INSP_QTY,
                     0                                            AS PASS_QTY,
                     0                                            AS UNPASS_QTY,
                     0                                            AS UNINSP_QTY,
                     0                                            AS RE_REQ_QTY,
                     0                                            AS RE_REQ_AMT,
                     0                                            AS RE_INSP_QTY,
                     0                                            AS RE_PASS_QTY,
                     0                                            AS RE_UNPASS_QTY,
                     0                                            AS RE_UNINSP_QTY,
                     SUM(NVL(REQ_QTY,0))                          AS CUM_REQ_QTY,
                     SUM(NVL(REQ_AMT,0))                          AS CUM_REQ_AMT,
                     SUM(NVL(INSP_QTY,0))                         AS CUM_INSP_QTY,
                     SUM(NVL(PASS_QTY,0))                         AS CUM_PASS_QTY,
                     SUM(NVL(UNPASS_QTY,0))                       AS CUM_UNPASS_QTY,
                     SUM(NVL(UNINSP_QTY,0))                       AS CUM_UNINSP_QTY,
                     SUM(NVL(RE_REQ_QTY,0))                       AS CUM_RE_REQ_QTY,
                     SUM(NVL(RE_REQ_AMT,0))                       AS CUM_RE_REQ_AMT,
                     SUM(NVL(RE_INSP_QTY,0))                      AS CUM_RE_INSP_QTY,
                     SUM(NVL(RE_PASS_QTY,0))                      AS CUM_RE_PASS_QTY,
                     SUM(NVL(RE_UNPASS_QTY,0))                    AS CUM_RE_UNPASS_QTY,
                     SUM(NVL(RE_UNINSP_QTY,0))                    AS CUM_RE_UNINSP_QTY,
                     SUM(NVL(REQ_QTY,0)-NVL(INSP_QTY,0))          AS CUM_DIF_QTY,
                     SUM(NVL(RE_REQ_QTY,0)-NVL(RE_INSP_QTY,0))    AS CUM_DIF_RE_QTY
                FROM SAORA01.GHF0221D
               WHERE BR_CD <![CDATA[<>]]> '0000'
                 AND SUMM_YY     = #findYear#       
                 AND SUMM_MM <![CDATA[<=]]> #findMon#         
                 AND ROLE_TC <![CDATA[<>]]> '93'
                 AND BR_CD LIKE '%' 
                 AND ROLE_TC = '31' 
                 AND INSP_KIND_TC = '07' 
               GROUP BY
                     ROLE_TC,
                     INSP_KIND_TC,
                     LAW_TC,
                     STIC_LAG_TC,
                     STIC_MID_TC,
                     STIC_SML_TC
           ) A,
           MAORA01.MDA0000M B,
           SAORA01.GIB0100M_MV_01 C
       WHERE B.SYS_TC = 'TAA'
         AND B.KIND_TC = '1050'
         AND B.LEVL = 2
         AND A.ROLE_TC = B.COMM_C
         AND A.ROLE_TC      = C.ROLE_TC
         AND A.INSP_KIND_TC = C.INSP_KIND_TC
         AND A.LAW_TC       = C.LAW_TC
         AND A.STIC_LAG_TC  = C.STIC_LAG_TC
         AND A.STIC_MID_TC  = C.STIC_MID_TC
         AND A.STIC_SML_TC  = C.STIC_SML_TC
       GROUP BY
             B.UP_SER,
             A.ROLE_TC,
             C.ROLE_TC_NM,
             A.INSP_KIND_TC,
             C.INSP_KIND_TC_NM,
             A.LAW_TC,
             C.LAW_TC_NM,
             A.STIC_LAG_TC,
             C.STIC_LAG_TC_NM,
             A.STIC_MID_TC,
             C.STIC_MID_TC_NM,
             A.STIC_SML_TC,
             C.STIC_SML_TC_NM
) WHERE ROLE_TC = '31'
        AND INSP_KIND_TC = '07'
        AND STIC_LAG_TC <![CDATA[<>]]> '45'

	</select>

</sqlMap>


