<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="mem.base.memEvalUserRate">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: MEM_EVAL_USER_RATE
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 
	<!--
	==================================================================   
	  # 설명	: 평가자비율설정 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: MEM_ECM_EVAL_GRADE_CONVERT_TAB
	==================================================================
	-->
	<select id="getEvalGiveMethodList" parameterClass="hashMap" resultClass="hashMap">
		SELECT
		       EVAL_METHOD_ID
		     , EVAL_METHOD_NM 
		  FROM MEM_ECM_EVAL_GRADE_CONVERT_TAB
		 WHERE YEAR = #findYear#
		   AND DELETE_DT IS NULL  
<isNotEmpty property="evalMethodGbnId">
           AND EVAL_METHOD_GBN_ID = #evalMethodGbnId#
</isNotEmpty>
		 ORDER BY EVAL_METHOD_NM
	</select>

	<!--
	==================================================================   
	  # 설명	: 평가자비율설정 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: MEM_EVAL_USER_RATE
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT
		       #findYear# AS YEAR
			 , A.CODE_ID AS EVAL_USER_GUBUN_ID
		     , A.CODE_NM AS EVAL_USER_GUBUN_NM
		     , B.EVAL_YN_ID
		     , B.EVAL_RATE
		     , B.EVAL_METHOD_ID
		     , B.EVAL_GIVE_METHOD_ID
		     , B.SORT_ORDER
		  FROM BSC_CODE A
		     , MEM_EVAL_USER_RATE B
		 WHERE A.CODE_ID = B.EVAL_USER_GUBUN_ID(+)
		   AND A.CODE_GRP_ID = '237'
		   AND A.DELETE_DT IS NULL
		   AND B.YEAR(+) = #findYear#
		   AND A.YEAR IN (SELECT CASE YEAR_YN WHEN 'Y' THEN #findYear# ELSE '9999' END FROM BSC_CODE_GRP WHERE CODE_GRP_ID = '237' AND DELETE_DT IS NULL)    
		 ORDER BY A.SORT_ORDER
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 평가자비율설정 정렬순서 일괄 저장
	  #	기능	: UPDATE
	  #	TABLE	: MEM_EVAL_USER_RATE
	==================================================================
	-->	
	<insert id="allSaveData" parameterClass="hashMap">
	 	 MERGE INTO MEM_EVAL_USER_RATE A
		       USING (SELECT #findYear# YEAR, #evalUserGubunId# EVAL_USER_GUBUN_ID FROM DUAL) B
		          ON (A.YEAR = B.YEAR AND A.EVAL_USER_GUBUN_ID = B.EVAL_USER_GUBUN_ID)
		  WHEN MATCHED THEN
		       UPDATE SET 
		              EVAL_YN_ID = #evalYn#
		            , EVAL_RATE = #evalRate#
		            , EVAL_METHOD_ID = #evalMethod#
		            , EVAL_GIVE_METHOD_ID = #evalGiveMethod#
		            , SORT_ORDER = #sortOrder#
		            , MODIFY_DT = SYSDATE
		  WHEN NOT MATCHED THEN
		       INSERT (
		              YEAR
		            , EVAL_USER_GUBUN_ID
		            , EVAL_YN_ID
		            , EVAL_RATE
		            , EVAL_METHOD_ID
		            , EVAL_GIVE_METHOD_ID
		            , SORT_ORDER
		            , CREATE_DT
		       ) VALUES (
		              #findYear#
		            , #evalUserGubunId#
		            , #evalYn#
		            , #evalRate#
		            , #evalMethod#
		            , #evalGiveMethod#
		            , #sortOrder#
		            , SYSDATE
		       )		             
	</insert>	
	

</sqlMap>


