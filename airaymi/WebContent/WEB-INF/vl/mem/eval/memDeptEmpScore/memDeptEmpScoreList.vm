#*************************************************************************
* CLASS 명     : orgDeptPrsScoreList
* 작 업 자      : 박선혜
* 작 업 일      : 2013.06.22
* 기    능      : 조직관리역량평가결과 조회
* ---------------------------- 변 경 이 력 --------------------------------
* 번호   작 업 자     작   업   일        변 경 내 용             비고
* ----  --------  -----------------  -------------------------  --------
*  1     지 원 길      2013.06.22          최 초 작 업
**************************************************************************#
#set($curr_url = $!{context_path} + "/mem/eval/memDeptEmpScore/memDeptEmpScoreList.vw")
<script type="text/javascript" language="javascript" >
//<![CDATA[
	var J = jQuery;

	J(document).ready(function(){

		/******************************************
		 * 데이터 그리드 출력
		 ******************************************/
		var str = J('#formFind').serialize();

		jQuery("#list").jqGrid({
			url          :"$!{context_path}/mem/eval/memDeptEmpScore/memDeptEmpScoreList_xml.vw" + "?" + str,
			mtype        :"POST",
			datatype     :"json",
			jsonReader   : {
    						page   : "page",
    						total  : "total",
    						root   : "rows",
    						records: "records",
    						repeatitems: false,
    						id     : "id"
    				       },
			height       : $!{jqGrid_height},
			width        : $!{jqGrid_width},
			colModel     :[
							{name:'YEAR'             ,index:'YEAR'             ,width:80   ,align:'center'  ,sortable:true ,hidden:true ,label:'년도'},
							{name:'EMP_NO'           ,index:'EMP_NO'           ,width:80   ,align:'center'  ,sortable:true ,hidden:false ,label:'사번' ,cellattr: attrSetting },
							{name:'EMP_NM'           ,index:'EMP_NM'           ,width:90   ,align:'center'  ,sortable:true ,hidden:false ,label:'이름' ,cellattr: attrSetting },
							{name:'SER'              ,index:'SER'              ,width:100  ,align:'center'  ,sortable:true ,hidden:true ,label:'순번' ,cellattr: attrSetting },
							{name:'CAST_TC'          ,index:'CAST_TC'          ,width:100  ,align:'center'  ,sortable:true ,hidden:true ,label:'직급코드' ,cellattr: attrSetting },
							{name:'CAST_TC_NM'       ,index:'CAST_TC_NM'       ,width:80   ,align:'center'  ,sortable:true ,hidden:false ,label:'직급' ,cellattr: attrSetting },
							{name:'POS_TC'           ,index:'POS_TC'           ,width:100  ,align:'center'  ,sortable:true ,hidden:true ,label:'직위코드' ,cellattr: attrSetting },
							{name:'POS_TC_NM'        ,index:'POS_TC_NM'        ,width:80   ,align:'center'  ,sortable:true ,hidden:false ,label:'직위' ,cellattr: attrSetting },
							{name:'DEPT_CD'          ,index:'DEPT_CD'          ,width:80   ,align:'center'  ,sortable:true ,hidden:true ,label:'조직코드'},
							{name:'DEPT_NM'          ,index:'DEPT_NM'          ,width:150  ,align:'left'    ,sortable:true ,hidden:false ,label:'조직'},
							{name:'PCMT_TC'          ,index:'PCMT_TC'          ,width:80   ,align:'center'  ,sortable:true ,hidden:true ,label:'발령구분코드'},
							{name:'PCMT_TC_NM'       ,index:'PCMT_TC_NM'       ,width:150  ,align:'left'    ,sortable:true ,hidden:false ,label:'발령구분'},
							{name:'START_PCMT_DATE'  ,index:'START_PCMT_DATE'  ,width:90   ,align:'center'  ,sortable:true ,hidden:false ,label:'근무시작일' ,formatter:linkStartDt},
							{name:'END_PCMT_DATE'    ,index:'END_PCMT_DATE'    ,width:90   ,align:'center'  ,sortable:true ,hidden:false ,label:'근무종료일' ,formatter:linkEndDt},
							/*
							{name:'WORK_MON'         ,index:'WORK_MON'         ,width:80   ,align:'center'  ,sortable:true ,hidden:false ,label:'근무월'  ,formatter:linkWorkMon},
							{name:'DEPT_SCORE'       ,index:'DEPT_SCORE'       ,width:90   ,align:'center'  ,sortable:true ,hidden:false ,label:'조직점수'  ,formatter:linkDeptScore},
							{name:'DEPT_FINAL_SCORE' ,index:'DEPT_FINAL_SCORE' ,width:90   ,align:'center'  ,sortable:true ,hidden:false ,label:'최종점수'  ,cellattr: attrSetting ,formatter:linkDeptFinalScore},
							*/
							{name:'WORK_MON'         ,index:'WORK_MON'         ,width:80   ,align:'center'  ,sortable:true ,hidden:false ,label:'근무월' },
							{name:'DEPT_SCORE'       ,index:'DEPT_SCORE'       ,width:90   ,align:'center'  ,sortable:true ,hidden:false ,label:'조직점수' },
							{name:'DEPT_FINAL_SCORE' ,index:'DEPT_FINAL_SCORE' ,width:90   ,align:'center'  ,sortable:true ,hidden:false ,label:'최종점수'  ,cellattr: attrSetting },
							{name:'CNT'          	 ,index:'CNT'          	   ,width:80   ,align:'center'  ,sortable:true ,hidden:true ,label:'개수'},
							{name:'CNT_INDEX'        ,index:'CNT_INDEX'        ,width:150  ,align:'left'    ,sortable:true ,hidden:true ,label:'개수인덱스'}
							],
			rowNum       : 15,
			pager		 : jQuery('#pager'),
			autowidth    : false,
			viewrecords  : true,
			loadonce     : false,
			multiselect  : false,
			cmTemplate	 : {sortable:false},
			cellEdit     : true,
			gridview     : true,
			caption:"조직관리역량평가"
		});

		/******************************************
         * 조직관리역량평가결과 엑셀다운로드 버튼 클릭 이벤트
         ******************************************/
        J("#btnExcelDown").click(function() {
            deptScoreExcelDownload();
            return false;
        });
        
        J("#btnSaveAll").click(function() {
            saveAllChk();
            return false;
        });
        
        J("#btnBatch").click(function() {
            batchChk();
            return false;
        });

		/******************************************
		 * 조직선택 팝업호출
		 ******************************************/
		J("#icSearch").fancybox();

   	});
   	
   	function saveAllChk(){
   	
   		J.showConfirmBox("일괄수정 하시겠습니까?", "allSaveDo"); //allSaveDo() 콜백함수 호출
   	
   	}
   	
   	function allSaveDo(){
   	
   		J("#year").val(J("#findYear").val());
		J("#mode").val("ALLSAVE");
		J("#formList").attr("action", "$!{context_path}/mem/eval/memDeptEmpScore/memDeptEmpScoreProcess.vw?type=template").submit();
		return false;
   	
   	}
   	
   	function batchChk(){
   	
   		J.showConfirmBox("모든 평가대상자의 월할계산 조직점수가 초기화 됩니다. 진행하시겠습니까?", "batchDo"); //allSaveDo() 콜백함수 호출
   	
   	}
   	
   	function batchDo(){
   	
   		J("#year").val(J("#findYear").val());
		J("#mode").val("BATCH");
		J("#formList").attr("action", "$!{context_path}/mem/eval/memDeptEmpScore/memDeptEmpScoreProcess.vw?type=template").submit();
		return false;
   	
   	}
   	
   	/******************************************
	 * jqGrid 수정페이지 링크
	 ******************************************/
	function linkUpdate(cellvalue, options, rowObject) {
		var str = cellvalue;

		return '<a href=javascript:goModify(' + options.rowId + ')>' + str + '<//a>';
	}
	
	function goModify(rowId ){
	
		var ret = J("#list").jqGrid('getRowData',rowId);
	
	}
   	
   	/******************************************
     * jqGrid 적용기준일
     ******************************************/
    function linkStartDt(cellvalue, options, rowObject) {
		var str = '';
		str += '<input type="text" name="startPcmtDateArray" value="' + cellvalue + '" class="inputbox w80" readonly="readonly" onmouseover="javascript:startCal();"/>'+
    		   '<input type="hidden" name="deptEmpNoArray" value="' + rowObject.EMP_NO + '" />'+
		       '<input type="hidden" name="deptSerArray" value="' + rowObject.SER + '" />';
    	return str;
    }
    
    /******************************************
     * jqGrid 적용기준일
     ******************************************/
    function linkEndDt(cellvalue, options, rowObject) {
		var str = '';
		str += '<input type="text" name="endPcmtDateArray" value="' + cellvalue + '" class="inputbox w80" readonly="readonly" onmouseover="javascript:endCal();"/>';
    	return str;
    }
    
    function startCal(){
    	J("input[name=startPcmtDateArray]").each(function(index,value){
        
    		J("input[name=startPcmtDateArray]").eq(index).datepicker({
				dateFormat: 'yy.mm.dd'
			});
    	
    	});
    }
    
    function endCal(){
    	J("input[name=endPcmtDateArray]").each(function(index,value){
    		J("input[name=endPcmtDateArray]").eq(index).datepicker({
				dateFormat: 'yy.mm.dd'
			});
    	});
    }
   	
   	/******************************************
     * jqGrid 평가대상여부
     ******************************************/
    function linkWorkMon(cellvalue, options, rowObject) {
    	var str = "";
    	
    	str += '<select id="workMonArray" name="workMonArray" class="select w70">';
	    #foreach($workMonList in $workMonList)
	    	if (cellvalue == "$!{CS_HTML.txt2html($workMonList.code_id)}") {
	    		str += '	<option value="$!{CS_HTML.txt2html($workMonList.code_id)}" selected>$!{CS_HTML.txt2html($workMonList.code_nm)}</option>';
	    	}else{
	    		str += '	<option value="$!{CS_HTML.txt2html($workMonList.code_id)}">$!{CS_HTML.txt2html($workMonList.code_nm)}</option>';
	    	}
	    #end
        str += '</select>';
    	
    	return str;
    }
    
    /******************************************
	 * jqGrid 가중치
	 ******************************************/
	function linkDeptScore(cellvalue, options, rowObject) {
		return '<input type="text" name="deptScoreArray" value="' + cellvalue + '" class="wp70" maxlength="6" />'+
		       '<input type="hidden" name="deptEmpNoArray" value="' + rowObject.EMP_NO + '" />'+
		       '<input type="hidden" name="deptSerArray" value="' + rowObject.SER + '" />';
	}
	
	/******************************************
	 * jqGrid 가중치
	 ******************************************/
	function linkDeptFinalScore(cellvalue, options, rowObject) {
		return '<input type="text" name="deptFinalScoreArray" value="' + cellvalue + '" class="wp70" maxlength="6" />'+
		       '<input type="hidden" name="deptFinalEmpNoArray" value="' + rowObject.EMP_NO + '" />';
	}

   	/*****************************************
	 * jqGrid Common Rowspan
	 ******************************************/
	function attrSetting(rowId, val, rowObject, cm) {
		var result;
		var index = rowObject.CNT_INDEX;
		var rowSpan = rowObject.CNT;

		if(index == 1) {
			result = ' rowspan="' + rowSpan + '"';
		} else {
			result = 'style="display:none"';
		}
		return result;
	}

	/******************************************
	 * 조회
	 ******************************************/
	J("#formFind").submit(function(event) {
		//submit 하기전 작업추가

	});

	/******************************************
     * 조직관리역량평가결과 엑셀다운로드
     ******************************************/
    function deptScoreExcelDownload(){
        J("#yearNm").val(J("#findYear > option:selected").text());
        J("#castTcNm").val(J("#findCastTc > option:selected").text());
        J("#posTcNm").val(J("#findPosTc > option:selected").text());
		J("#empNm").val(J("#findEmpNm").val());
        J("#formList").attr("action", "$!{context_path}/mem/eval/memDeptEmpScore/memDeptEmpScoreListExcel.vw?type=excel").submit();
        return false;
    }

	/******************************************
	 * 조직검색
	 ******************************************/
	function setDeptInfoPop(deptId, deptNm) {
		J("#findDeptCd").val(deptId);
		J("#findDeptNm").val(deptNm);
		J.fancybox.close();
	}

//]]>
</script>

<div id="Table">
	<div id="Table_blockContainer">
		<h1 class="none">조직관리역량평가 결과</h1>
		<div class="tableTop">
			#parse("/WEB-INF/vl/common/template/tabs.vm")

    		<!-- search S -->
			<form id="formFind" name="formFind" method="post" action="$!{context_path}/mem/eval/memDeptEmpScore/memDeptEmpScoreList.vw?type=template">
				<input type="hidden"	id="findHighPgmId"	name="findHighPgmId"	value="$!{searchMap.txt2html("findHighPgmId")}" />
				<input type="hidden" 	id="findSubPgmId"	name="findSubPgmId"		value="$!{searchMap.txt2html("findSubPgmId")}" />
				<input type="hidden"	id="findPgmId"		name="findPgmId"		value="$!{searchMap.txt2html("findPgmId")}" />

				<div class="searchBox">
    				<div><div><div>
    				<table summary="조직관리역량평가 검색 조건">
						<caption class="none">조직관리역량평가 검색 조건</caption>
						<thead><tr><th></th></tr></thead>
        				<tbody>
            				<tr>
								<td class="searchBox_tit w150">
            						<span><label for="findYear">기준년도</label></span>
            						<span class="searchBar">
            							<select id="findYear" name="findYear" class="select w80">
            								$!CS_CODE.getCodeOption("017", $!{searchMap.txt2html("findYear")})
            							</select>
            						</span>
            					</td>
								<!--
								<td class="searchBox_tit w250">
            						<span><label for="findDeptNm">부서</label></span>
            						<span class="searchBar">
        								<input type="hidden" id="findDeptCd" name="findDeptCd" value="$!{searchMap.txt2html("findDeptCd")}" />
        								<input type="text" id="findDeptNm" name="findDeptNm" class="inputbox w170" value="$!{searchMap.txt2html("findDeptNm")}" readonly="readonly" maxlength="20" />
        								<a id="icSearch" href="$!{context_path}/prs/org/orgDeptPrsEvalItemAct/popDeptCdTree.vw?findYear=$!{searchMap.txt2html("findYear")}&amp;findSearchCodeId=$!{searchMap.txt2html("findScDeptId")}"><img src="$!{img_path}/common/board/ic_search.gif" class="valign_middle" alt="부서검색"/></a>
            						</span>
            					</td>
            					-->
            					<td class="searchBox_tit w150">
            						<span><label for="findCastTc">직급</label></span>
            						<span class="searchBar">
            							<select id="findCastTc" name="findCastTc" class="select w100">
            								<option value="">전체</option>
            								$!CS_CODE.getCodeOption("170", $!{searchMap.txt2html("findCastTc")}, $!{searchMap.txt2html("findYear")})
            							</select>
            						</span>
            					</td>
            					<td class="searchBox_tit w150">
            						<span><label for="findPosTc">직위</label></span>
            						<span class="searchBar">
            							<select id="findPosTc" name="findPosTc" class="select w100">
            								<option value="">전체</option>
            								$!CS_CODE.getCodeOption("171", $!{searchMap.txt2html("findPosTc")}, $!{searchMap.txt2html("findYear")})
            							</select>
            						</span>
            					</td>
            					<td class="searchBox_tit w200">
            						<span><label for="findEmpNm">이름</label></span>
            						<span class="searchBar">
            							<input type="text" name="findEmpNm" id="findEmpNm" value="$!{searchMap.txt2html("findEmpNm")}" title="이름"/>
            						</span>
            					</td>
            				</tr>
        				</tbody>
    				</table>
                    <input type="image" class="btnSearch" src="$!{img_path}/common/btn_search.gif" align="middle" alt="검색" />
                    </div></div></div>
    	        </div>
    		</form>
    		<!-- search E -->

			<div class="clear"></div>
		</div>

		<form id="formList" name="formList" method="post" action="$!{context_path}/mem/eval/memDeptEmpScore/memDeptEmpScoreProcess.vw?type=template">
			<input type="hidden" id="mode"          name="mode" />
			<input type="hidden" id="year"       	name="year" />
			<input type="hidden" id="yearNm"		name="yearNm" />
			<input type="hidden" id="empNo"       	name="empNo" />
			<input type="hidden" id="empNm"			name="empNm" />
			<input type="hidden" id="castTc"		name="castTc" />
			<input type="hidden" id="castTcNm"		name="castTcNm" />
			<input type="hidden" id="posTc"			name="posTc" />
			<input type="hidden" id="posTcNm"		name="posTcNm" />

			$!{searchMap.makeHiddenFind()}

			<div id="splitterBox">
				<div>
					<!-- 데이터그리드 Start -->
					<div class="blockGridListTable">
						<table id="list" summary="연계항목 조회">
							<caption class="none">연계항목 조회</caption>
							<thead><tr><th></th></tr></thead>
							<tbody><tr><td></td></tr></tbody>
						</table>
						<div id="pager"></div>
					</div>
					
					<div class="blockButton_all floatLeft">
						<div class="blockButton" style="float:left; text-align:left; width:145px;">
						</div>
						<div id="blockButton" class="blockButton">
							<ul>
								<input id="btnExcelDown" type="button" align="middle" value="엑셀다운로드" alt="엑셀다운로드" />
								<input id="btnBatch" type="button" align="middle" value="조직점수생성" alt="조직점수생성" />
						    	<input id="btnSaveAll" type="button" align="middle" value="일괄저장" alt="일괄저장" />
							</ul>
						</div>
					</div>
					
					
					
				</div>
			</div>
		</form>

	</div>
	<div class="clear"></div>
</div>

