#*************************************************************************
* CLASS 명      : matrixKpiModify
* 작 업 자      : 박경태 
* 작 업 일      : 2012년 10월 23일 
* 기    능      : 평가단별지표    
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자    작     업     일        변 경 내 용                비고
* ----  --------  -----------------  -------------------------  --------
*  1    박경태      2012년 10월 23일             최 초 작 업 
**************************************************************************# 

<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;

	J(document).ready(function(){
    
		/******************************************
		 * 취소버튼 (돌아가기)
		 ******************************************/
		J("#btnBack").click(function() {
			J("#form1").attr("action", "$!{context_path}/bsc/matrix/matrixKpi/matrixKpiList.vw?type=template").submit();
		});
        
		/******************************************
		 * 저장버튼 이벤트
		 ******************************************/
		J("#btnInsert").click(function(e) {
			e.preventDefault();
			saveChk();
		});

		/******************************************
		 * 저장버튼 이중 클릭 방지
		 ******************************************/
		J("form").submit(function(){
			J("#btnInsert").unbind();
		});
		
	});
	
	/******************************************
	 * 필수입력 체크
	 ******************************************/
	function saveChk() {
		J.showConfirmBox("저장하시겠습니까?", "saveDo"); //saveDo() 콜백함수 호출
	}
    
	/******************************************
	 * 저장
	 ******************************************/
	function saveDo() {
		setMetricInfo();
		J("#form1").attr("action", "$!{context_path}/bsc/matrix/matrixKpi/matrixKpiProcess.vw?type=template").submit();
	}
	
	/******************************************
	 * 세부지표 setting
	 ******************************************/
	function setMetricInfo() {
		var metricIds = "";
		
		if(J("#targetData option").size()>0){
    		J("select option", "#target").each(function () {
    			var str = J(this).text();
    			var metricId = J(this).val();
    			
    			metricIds += metricId + '|';
    		});
			J("#metricIds").val(metricIds);
		}
	}
	
	/******************************************
	 * KPI 선택하기
	 ******************************************/
	function addItem() {
		J("select option:selected", "#source").each(function () {
			
			var metricId = J(this).val();
			var metricNm = J(this).html();
			var isExist = false;
			
			//이미 등록되었는지 체크 추가
			J("select option", "#target").each(function () {
				if(metricId == J(this).val()) {
					J.showMsgBox("선택하신 data는 이미 선택되었습니다.", null, null); 
					isExist = true;
				}
			});
			
			if(isExist == false) {
				J("#targetData").append("<option value='" + metricId +"'>" + metricNm + "</option>");
				J(this).remove();
			}
			
		});
	}
	
	/******************************************
	 * KPI 삭제하기
	 ******************************************/
	function delItem() {
		J("select option:selected", "#target").each(function () {
			J("#sourceData").append("<option value='" + J(this).val() +"'>" + J(this).text() + "</option>");
			J(this).remove();
		});
	}
	

//]]>
</script>    
	
    <div id="Table">
    	<div id="Table_blockContainer">
    		<div class="tableTop">
    			#parse("/WEB-INF/vl/common/template/tabs.vm")
    			<div class="clear"></div>
    		</div>
			
			<div class="tableTop">
				
				<form id="formFind" name="formFind" method="post" action="$!{context_path}/bsc/matrix/matrixKpi/matrixKpiModify.vw?type=template">
				<input type="hidden"	id="findHighPgmId"	    name="findHighPgmId"		value="$!{searchMap.txt2html("findHighPgmId")}" />
				<input type="hidden" 	id="findSubPgmId"	    name="findSubPgmId"			value="$!{searchMap.txt2html("findSubPgmId")}" />
				<input type="hidden"    id="findPgmId"		    name="findPgmId"			value="$!{searchMap.txt2html("findPgmId")}" />	
				<input type="hidden"	id="findYear"           name="findYear"           	value="$!{searchMap.txt2html("findYear")}" />
                <input type="hidden"	id="findEvalUserGrpId"  name="findEvalUserGrpId"  	value="$!{searchMap.txt2html("findEvalUserGrpId")}" />
				
                <!-- 검색 테이블 Start -->
                <div class="searchBox">
                <div><div><div>   
                    <table summary="검색조건">        
                        <caption class="none">검색조건</caption>
                        <thead><tr><th></th><th></th></tr></thead>
                        <tbody>
                            <tr>
								<td class="searchBox_tit w200">
            						<span>$!{YEAR}</span>
            						<span class="searchBar">
										$!{searchMap.txt2html("year")}년
            						</span>
            					</td>
								<td class="searchBox_tit w200">
                					<span>평가단</span>
									<span class="searchBar">
										$!{CS_HTML.txt2html($evalUserGrpDetail.EVAL_USER_GRP_NM)} 
									</span>
                                </td>
								<td class="searchBox_tit w200">
									<span><label for="poolGubun">POOL구분</label></span>
            						<span class="searchBar">
            							<select id="poolGubun" name="poolGubun" class="select w120">
											<option value="">전체</option>
            								$!CS_CODE.getCodeOption("142", $!{searchMap.txt2html("poolGubun")})
            							</select>
            						</span>
            					</td>
							</tr>
                        </tbody>
                    </table>
					<input type="image" class="btnSearch" src="$!{img_path}/common/btn_search.gif" align="middle" alt="검색" /> 
                </div></div></div>
                </div>
                <!--// 검색 테이블 End -->
                <div class="clear"></div>
				
                </form>
            </div>
			
			<div class="blockDetail2">
    			<table summary="평가단별지표 등록">
					<caption class="none">평가단별지표 등록</caption>
    				<tbody>
						<tr>
							<td style="width:45%; height:40px;">
								<span>평가대상지표 POOL</span> 
							</td>	
							<td style="width:10%;">
								&nbsp;
							</td>	
							<td>
								<span>선택된 평가대상지표 POOL</span> 
							</td>
						</tr>	
						<tr>
							<td style="width:45%;" valign="top">
    							<div id="source">
                                    <select multiple="multiple" id="sourceData" name="sourceData" style="height:387px;width:100%;background:#fff url($!{img_path}/common/div_back.gif) repeat-x 0 100%;" ondblclick="javascript:addItem();">
										#foreach($totPoolList in $totPoolList)
    										<option value="$!{CS_HTML.txt2html($totPoolList.METRIC_GRP_ID)}"/>$!{CS_HTML.txt2html($totPoolList.METRIC_GRP_NM)}</option>
                                        #end
									</select>
                                </div>
    						</td>
    						<td class="textCenter" style="width:10%;">
                        		<img src="$!{searchMap.txt2html("context")}/images/common/btn_arrow2.gif" onmouseover="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow2up.gif'" onmouseout="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow2.gif'" onClick="addItem();"><br /><br />
                        		<img src="$!{searchMap.txt2html("context")}/images/common/btn_arrow1.gif" onmouseover="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow1up.gif'" onmouseout="this.src='$!{searchMap.txt2html("context")}/images/common/btn_arrow1.gif'" onClick="delItem();">
            				</td>
							<td valign="top">
								<form id="form1" name="form1" method="post" action="$!{context_path}/bsc/matrix/matrixKpi/matrixKpiProcess.vw?type=template">
                                <input type="hidden" 	id="mode"		    name="mode"		      value="$!{searchMap.txt2html("mode")}" />
                            	<input type="hidden"	id="year"           name="year"           value="$!{searchMap.txt2html("year")}" />
                            	<input type="hidden"	id="evalUserGrpId"  name="evalUserGrpId"  value="$!{searchMap.txt2html("evalUserGrpId")}" />
                            	<input type="hidden"	id="metricGrpId"    name="metricGrpId"    value="$!{searchMap.txt2html("metricGrpId")}" />
								<input type="hidden"	id="metricIds"    	name="metricIds"/>
								
								$!{searchMap.makeHiddenFind()}
								
								<div id="target">
                                   <select multiple="multiple" id="targetData" name="targetData" style="height:387px;width:100%;background:#fff url($!{img_path}/common/div_back.gif) repeat-x 0 100%;" ondblclick="javascript:delItem();">
										#foreach($subPoolList in $subPoolList)
    										<option value="$!{CS_HTML.txt2html($subPoolList.METRIC_GRP_ID)}"/>$!{CS_HTML.txt2html($subPoolList.METRIC_GRP_NM)}</option>
                                        #end
									</select>
								</div>
								</form>
							</td>
						</tr>	
    				</tbody>
    			</table>
			</div>
			
    		<div class="blockButton"> 
    			<ul>
    				<li><input type="button" id="btnBack"   value="돌아가기" /></li>
    				<li><input type="submit" id="btnInsert" value="저장" /></li>
    			</ul>
    		</div>	
    	</div>
    	<div class="clear"></div>
    </div>

