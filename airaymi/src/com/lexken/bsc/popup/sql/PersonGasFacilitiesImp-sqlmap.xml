<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="bsc.popup.personGasFacilitiesImp">

	<!--
	==================================================================
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	:
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />


	<!--
	==================================================================
	  # 설명	: 시스템항목관리 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_SYSTEM_ITEM
	==================================================================
	-->
	<select id="getCountList" parameterClass="hashMap" resultClass="hashMap">
		SELECT SUBSTR (D.AUDT_DATE, 1, 4) YEAR
             , SUBSTR (D.AUDT_DATE, 5, 2) MON
             , D.BR_CD AS DEPT_ID
             , COUNT(D.BR_CD) CNT    
             , E.DEPT_NM
          FROM SAORA01.GBM0501D D
    LEFT OUTER JOIN BSC_DEPTINFO E
            ON D.BR_CD = E.DEPT_ID     
        WHERE D.SPLY_DOCU = '001' 
          AND NVL(D.GUBUN, '000') != '001'
          AND SUBSTR(D.AUDT_DATE, 1, 4) = #findYear#
          AND SUBSTR(D.AUDT_DATE, 5, 2) = #findMon#
          <isEqual property="findDeptId" compareValue="2600">
	      AND D.BR_CD IN (SELECT BR_CD FROM SAORA01.GBM0501D WHERE SUBSTR(D.AUDT_DATE, 1, 4) = #findYear# AND SUBSTR(D.AUDT_DATE, 5, 2) = #findMon#)
	      </isEqual>
	      GROUP BY SUBSTR(D.AUDT_DATE, 1, 4), SUBSTR (D.AUDT_DATE, 5, 2), D.BR_CD, E.DEPT_NM    
	</select>
	
	<!--
	==================================================================
	  # 설명	: 시스템항목관리 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_SYSTEM_ITEM
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT SUBSTR (D.AUDT_DATE, 1, 4) YEAR
	         , SUBSTR (D.AUDT_DATE, 5, 2) MON
	         , D.BR_CD DEPT_CD	<!-- 지사코드 -->
	         , E.DEPT_NM
	         , D.AUDT_DATE 		<!-- 검사일자 -->
	         , D.AUDT_EMP    	<!-- 검사자(사번) -->
	         , (SELECT NAME_HAN          
	              FROM V_ROLE_USER
	             WHERE SABUN = D.AUDT_EMP) AUDT_EMP_NM	<!-- 검사자 명 -->
	         , D.RCPT_NM         <!-- 수급자 명 -->
	         , (SELECT COMM_C_NM FROM maora01.mda0000m WHERE SYS_TC = 'GIE' AND KIND_TC = '0020' AND UP_SER = '86961' AND COMM_C = D.QTY) QTY          <!-- 용기수량(1:1개,2:2개) -->  
	         , (SELECT COMM_C_NM FROM maora01.mda0000m WHERE SYS_TC = 'GIE' AND KIND_TC = '0020' AND UP_SER = '86962' AND COMM_C = D.FRM_TP) FRM_TP    <!-- 용기수량(1:1개,2:2개) -->
	         , (SELECT COMM_C_NM FROM maora01.mda0000m WHERE SYS_TC = 'GIE' AND KIND_TC = '0020' AND UP_SER = '86963' AND COMM_C = D.HOME_TP) HOME_TP  <!-- 주거형태 -->
	         , (SELECT COMM_C_NM FROM maora01.mda0000m WHERE SYS_TC = 'GIE' AND KIND_TC = '0020' AND UP_SER = '87019' AND COMM_C = D.RSLT_TC) RSLT_TC  <!-- 결과 -->       
	         , D.RMK             <!-- 비고 --> 
	      FROM SAORA01.GBM0501D D
	LEFT OUTER JOIN BSC_DEPTINFO E
			ON D.BR_CD = E.DEPT_ID     
	    WHERE D.SPLY_DOCU = '001' 
	      AND NVL(D.GUBUN, '000') != '001'
	      AND SUBSTR(D.AUDT_DATE, 1, 4) = #findYear#
	      AND SUBSTR(D.AUDT_DATE, 5, 2) = #findMon#
	      <isEqual property="findDeptId" compareValue="2600">
	      AND D.BR_CD IN (SELECT BR_CD FROM SAORA01.GBM0501D WHERE SUBSTR(D.AUDT_DATE, 1, 4) = #findYear# AND SUBSTR(D.AUDT_DATE, 5, 2) = #findMon#)
	      </isEqual>    
	</select>
	
	<!--
	==================================================================
	  # 설명	: 시스템 연계항목 정보를 가져옴
	  #	기능	: SELECT
	  #	TABLE	:
	==================================================================
	-->
	<select id="getItem" remapResults="true" parameterClass="hashMap" resultClass="hashMap">
          SELECT A.ITEM_CD, B.CAL_TYPE_COL_NM
            FROM BSC_SYSTEM_ITEM A
               , BSC_CAL_TYPE_COL B
           WHERE A.YEAR = #findYear#
             AND A.YEAR = B.YEAR
             AND A.ITEM_CD = B.ITEM_CD
             AND B.METRIC_ID = #findMetricId#
			 AND B.INSERT_GUBUN = '01'
           ORDER BY B.CAL_TYPE_COL_NM
	</select>
	
	<!--
	==================================================================
	  # 설명	: 부서조회
	  #	기능	: SELECT
	  #	TABLE	: BSC_DEPTINFO
	==================================================================
	-->
	<select id="getDeptList" parameterClass="hashMap" resultClass="hashMap">
		
	SELECT A.DEPT_ID, B.DEPT_NM
		  FROM BSC_SC_DEPT_MAPPING A
	LEFT OUTER JOIN BSC_DEPTINFO B
			ON A.DEPT_ID = B.DEPT_ID
		 WHERE (YEAR, SC_DEPT_ID) IN
		          (SELECT YEAR, SC_DEPT_ID
		             FROM BSC_METRIC
		            WHERE (METRIC_GRP_ID, YEAR) IN
		                     (SELECT METRIC_GRP_ID, YEAR
		                        FROM BSC_METRIC
		                       WHERE YEAR = #findYear# AND METRIC_ID = #findMetricId#)
				AND DELETE_DT IS NULL)
<![CDATA[		   AND OULEVEL < 2 ]]>
  
	</select>
	
	<!--
	==================================================================
	  # 설명	: 시스템 연계 부서 목록 보기
	  #	기능	: SELECT
	  #	TABLE	:
	==================================================================
	-->
	<select id="getScDeptMapping" parameterClass="hashMap" resultClass="java.lang.String">
		SELECT DEPT_ID
		  FROM ( SELECT DEPT_ID 
				   FROM BSC_SC_DEPT_MAPPING
				  WHERE YEAR = #findYear# 
				    AND SC_DEPT_ID = #findScDeptCd# ORDER BY DEPT_ID 
				    )
		 WHERE ROWNUM = 1
	</select>
	

</sqlMap>


