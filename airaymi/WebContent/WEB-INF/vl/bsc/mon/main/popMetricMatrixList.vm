#*************************************************************************
* CLASS 명      : popMetricMatrixList.vm
* 작 업 자      : 하윤식
* 작 업 일      : 2012.06.30
* 기    능      : 지표연계 팝업
* ---------------------------- 변 경 이 력 --------------------------------
* 번호   작 업 자     작   업   일        변 경 내 용             비고
* ----  --------  -----------------  -------------------------  --------
*  1     하 윤 식      2012.06.30          최 초 작 업 
**************************************************************************# 

<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;
	
	J(document).ready(function(){
	
		/******************************************
		 * 데이터 그리드 출력
		 ******************************************/
		var str = J('#formFindPop').serialize();
		
		jQuery("#popMetricMatrixList").jqGrid({
			url          :"$!{searchMap.txt2html("context")}/bsc/mon/main/popMetricMatrixList_xml.vw" + "?" + str,
			mtype        :"POST",
			datatype     :"json",
			jsonReader   : {   
    						page   : "page",
    						total  : "total",
    						root   : "rows", 
    						records: function(obj){return obj.length;},
    						repeatitems: false, 
    						id     : "id"
    				       },
			height       : 250,
			colNames     :['METRIC_ID_LEV1', '전사 $!{searchMap.txt2html("METRIC_NM")}', 'METRIC_ID_LEV2'
    			             , '1레벨$!{searchMap.txt2html("METRIC_NM")}', 'METRIC_ID_LEV3', '2레벨 $!{searchMap.txt2html("METRIC_NM")}', 'METRIC_ID_LEV4'
    						 , '3레벨 $!{searchMap.txt2html("METRIC_NM")}', 'LEV1_CNT', 'LEV1_INDEX', 'LEV2_CNT', 'LEV2_INDEX', 'LEV3_CNT', 'LEV3_INDEX', 'LEV4_CNT', 'LEV4_INDEX'
    						 ,'SIGNAL1','SIGNAL2','SIGNAL3','SIGNAL4'],
			colModel     :[
							{name:'METRIC_ID_LEV1'       ,index:'METRIC_ID_LEV1'       ,width:150   ,align:'left' }, 
                            {name:'METRIC_NM_LEV1'       ,index:'METRIC_NM_LEV1'       ,width:150   ,align:'left' ,cellattr:attrSetting1 ,formatter:setNormalFont1}, 
                            {name:'METRIC_ID_LEV2'       ,index:'METRIC_ID_LEV2'       ,width:150   ,align:'left' }, 
                            {name:'METRIC_NM_LEV2'       ,index:'METRIC_NM_LEV2'       ,width:150   ,align:'left' ,cellattr:attrSetting2 ,formatter:setNormalFont2}, 
                            {name:'METRIC_ID_LEV3'       ,index:'METRIC_ID_LEV3'       ,width:150   ,align:'left' }, 
                            {name:'METRIC_NM_LEV3'       ,index:'METRIC_NM_LEV3'       ,width:150   ,align:'left' ,cellattr:attrSetting3 ,formatter:setNormalFont3}, 
                            {name:'METRIC_ID_LEV4'       ,index:'METRIC_ID_LEV4'       ,width:150   ,align:'left' }, 
                            {name:'METRIC_NM_LEV4'       ,index:'METRIC_NM_LEV4'       ,width:150   ,align:'left' ,cellattr:attrSetting4 ,formatter:setNormalFont4}, 
                            {name:'LEV1_CNT'             ,index:'LEV1_CNT'             ,width:150   ,align:'left' }, 
                            {name:'LEV1_INDEX'           ,index:'LEV1_INDEX'           ,width:150   ,align:'left' }, 
                            {name:'LEV2_CNT'             ,index:'LEV2_CNT'             ,width:150   ,align:'left' }, 
                            {name:'LEV2_INDEX'           ,index:'LEV2_INDEX'           ,width:150   ,align:'left' }, 
                            {name:'LEV3_CNT'             ,index:'LEV3_CNT'             ,width:150   ,align:'left' }, 
                            {name:'LEV3_INDEX'           ,index:'LEV3_INDEX'           ,width:150   ,align:'left' }, 
                            {name:'LEV4_CNT'             ,index:'LEV4_CNT'             ,width:150   ,align:'left' }, 
                            {name:'LEV4_INDEX'           ,index:'LEV4_INDEX'           ,width:150   ,align:'left' },
							{name:'STATUS_LEV1'          ,index:'STATUS_LEV1'          ,width:150   ,align:'left' },
							{name:'STATUS_LEV2'          ,index:'STATUS_LEV2'          ,width:150   ,align:'left' },
							{name:'STATUS_LEV3'          ,index:'STATUS_LEV3'          ,width:150   ,align:'left' },
							{name:'STATUS_LEV4'          ,index:'STATUS_LEV4'          ,width:150   ,align:'left' }
						   ],
			rowNum       : 100000,
			autowidth    : false,
			viewrecords  : true,
			loadonce     : false,
			cellEdit     : true,
			caption:"조회"
		}).jqGrid('hideCol',"METRIC_ID_LEV1").jqGrid('hideCol',"METRIC_ID_LEV2").jqGrid('hideCol',"METRIC_ID_LEV3").jqGrid('hideCol',"METRIC_ID_LEV4")
		  .jqGrid('hideCol',"LEV1_CNT").jqGrid('hideCol',"LEV1_INDEX")
		  .jqGrid('hideCol',"LEV2_CNT").jqGrid('hideCol',"LEV2_INDEX")
		  .jqGrid('hideCol',"LEV3_CNT").jqGrid('hideCol',"LEV3_INDEX")
		  .jqGrid('hideCol',"LEV4_CNT").jqGrid('hideCol',"LEV4_INDEX")
		  .jqGrid('hideCol',"STATUS_LEV1").jqGrid('hideCol',"STATUS_LEV2")
		  .jqGrid('hideCol',"STATUS_LEV3").jqGrid('hideCol',"STATUS_LEV4")
		  .setGridWidth(1160);
	
		/******************************************
		 * 데이터 그리드 출력
		 ******************************************/
		jQuery("#popDeptScoreList").jqGrid({
			url          :"$!{searchMap.txt2html("context")}/bsc/mon/main/deptScoreMatrixList_xml.vw" + "?" + str,
			mtype        :"POST",
			datatype     :"json",
			jsonReader   : {   
    						page   : "page",
    						total  : "total",
    						root   : "rows", 
    						records: function(obj){return obj.length;},
    						repeatitems: false, 
    						id     : "id"
    				       },
			height       : 150,
			colNames     :['$!{searchMap.txt2html("SC_DEPT_NM")}', '$!{searchMap.txt2html("METRIC_NM")}코드', '$!{searchMap.txt2html("METRIC_NM")}', '담당자', '주기', '$!{searchMap.txt2html("WEIGHT")}', '단위', '목표', '실적', '점수', '상태', '상위$!{METRIC_NM}'],
			colModel     :[
							{name:'SC_DEPT_NM'     ,index:'SC_DEPT_NM'      ,width:150    ,align:'center' },
							{name:'METRIC_ID'      ,index:'METRIC_ID'       ,width:100    ,align:'center' },
							{name:'METRIC_NM'      ,index:'METRIC_NM'  	  	,width:400    ,align:'left'   ,formatter:linkUpdateMetricPop},
							{name:'INSERT_USER_NM' ,index:'INSERT_USER_NM'  ,width:120    ,align:'center' },
							{name:'EVAL_CYCLE_NM'  ,index:'EVAL_CYCLE_NM'   ,width:120    ,align:'center' },
							{name:'WEIGHT'         ,index:'WEIGHT'          ,width:120    ,align:'center' },
							{name:'UNIT_NM'        ,index:'UNIT_NM'         ,width:100    ,align:'center' },
							{name:'TARGET'         ,index:'TARGET'          ,width:100    ,align:'right'  },
							{name:'ACTUAL'         ,index:'ACTUAL'          ,width:100    ,align:'right'  ,formatter:linkUpdateActual},
							{name:'SCORE'          ,index:'SCORE'           ,width:70     ,align:'right'  },
							{name:'STATUS'         ,index:'STATUS'          ,width:70     ,align:'center' ,formatter:linkUpdateSignalPop},
							{name:'UP_METRIC_ID'   ,index:'UP_METRIC_ID'    ,width:100    ,align:'center' }
						   ],
			rowNum       : 100000,
			autowidth    : false,
			viewrecords  : true,
			loadonce     : false,
			cellEdit     : true,
			caption:"조회"
		}).jqGrid('hideCol',"METRIC_ID").jqGrid('hideCol',"UP_METRIC_ID").setGridWidth(1160);
		
	});
	
	/******************************************
	 * 신호등 전사
	 ******************************************/
	function setNormalFont1(cellvalue, options, rowObject) {
		if(cellvalue == '') {
			return "";
		} else {
			return "<div class='normal'><a href=javascript:goPopMetricMatrixActualDetail('" + rowObject.METRIC_ID_LEV1 + "')>" + "<img name=\'sig\'  src=\'$!{searchMap.txt2html("context")}/images/common/ball/ball_" + rowObject.STATUS_LEV1 + ".gif\' >" + "</a> " + cellvalue + "</div>";
		}
	}
	
	function setNormalFont2(cellvalue, options, rowObject) {
		if(cellvalue == '') {
			return "";
		} else {
			return "<div class='normal'><a href=javascript:goPopMetricMatrixActualDetail('" + rowObject.METRIC_ID_LEV2 + "')>" + "<img name=\'sig\'  src=\'$!{searchMap.txt2html("context")}/images/common/ball/ball_" + rowObject.STATUS_LEV2 + ".gif\' >" + "</a> " + cellvalue + "</div>";
		}
	}
	
	function setNormalFont3(cellvalue, options, rowObject) {
		if(cellvalue == '') {
			return "";
		} else {
			return "<div class='normal'><a href=javascript:goPopMetricMatrixActualDetail('" + rowObject.METRIC_ID_LEV3 + "')>" + "<img name=\'sig\'  src=\'$!{searchMap.txt2html("context")}/images/common/ball/ball_" + rowObject.STATUS_LEV3 + ".gif\' >" + "</a> " + cellvalue + "</div>";
		}
	}
	
	function setNormalFont4(cellvalue, options, rowObject) {
		if(cellvalue == '') {
			return "";
		} else {
			return "<div class='normal'><a href=javascript:goPopMetricMatrixActualDetail('" + rowObject.METRIC_ID_LEV4 + "')>" + "<img name=\'sig\'  src=\'$!{searchMap.txt2html("context")}/images/common/ball/ball_" + rowObject.STATUS_LEV4 + ".gif\' >" + "</a> " + cellvalue + "</div>";
		}
	}
	
	/******************************************
	 * 실적상세 신호등
	 ******************************************/
	function linkUpdateSignalPop(cellvalue, options, rowObject) { 
		return "<a href=javascript:goPopMetricMatrixActualDetail('" + rowObject.METRIC_ID + "')>" + "<img name=\'sig\'  src=\'$!{searchMap.txt2html("context")}/images/common/ball/ball_" + cellvalue + ".gif\' >" + "</a>";
	}
	
	/******************************************
	 * 지표정의서
	 ******************************************/
	function linkUpdateMetricPop(cellvalue, options, rowObject) { 
		var str = cellvalue;
		
		if(rowObject.UP_METRIC_ID != "") {
			str = "<img src=\'$!{searchMap.txt2html("context")}/images/tree.gif\' align='absmiddle'>" + str
		}
		return str;
	}
	
	/*****************************************************
	 * 실적상세 팝업
	 *****************************************************/ 
    function goPopMetricMatrixActualDetail(metricId){
		var year = J("#findYear").val();
		var mon = J("#findMon").val();
		var analCycle = J(":input:radio[name=findAnalCycle]:checked").val();
		var metricId = metricId;
		
		var param = "&amp;year=" + year + "&amp;findMon=" + mon + "&amp;metricId=" + metricId + "&amp;analCycle="+analCycle;
		
		var url = "$!{context_path}/bsc/mon/metricActualDetail/popMetricActualDetailList.vw?type=popup" + param;
		openWinByName(url,'popMetricDetail','1250','650','yes');
    }

	$("#formFindPop").submit(function() { 
		J("#kpiPoolList").setGridParam({url:"$!{searchMap.txt2html("context")}/bsc/module/commModule/metricGrpList_xml.vw?"+J("#formFindPop").serialize()}); 
		J("#kpiPoolList").trigger("reloadGrid");
		return false;
	});
	
	/*****************************************
	 * 데이터 Rowspan 설정
	 ******************************************/
	function attrSetting1(rowId, val, rowObject, cm) {
		var result;
		var index = rowObject.LEV1_INDEX;
		var rowSpan = rowObject.LEV1_CNT;
		
		if(index == 1) {
			result = ' rowspan="' + rowSpan + '"';
		} else {
			result = ' style="display:none"';
		}
		return result;     
	}
	
	function attrSetting2(rowId, val, rowObject, cm) {
		var result;
		var index = rowObject.LEV2_INDEX;
		var rowSpan = rowObject.LEV2_CNT;
		
		if(index == 1) {
			result = ' rowspan="' + rowSpan + '"';
		} else {
			result = ' style="display:none"';
		}
		return result;     
	}
	
	function attrSetting3(rowId, val, rowObject, cm) {
		var result;
		var index = rowObject.LEV3_INDEX;
		var rowSpan = rowObject.LEV3_CNT;
		
		if(index == 1) {
			result = ' rowspan="' + rowSpan + '"';
		} else {
			result = ' style="display:none"';
		}
		return result;     
	}
	
	function attrSetting4(rowId, val, rowObject, cm) {
		var result;
		var index = rowObject.LEV4_INDEX;
		var rowSpan = rowObject.LEV4_CNT;
		
		if(index == 1) {
			result = ' rowspan="' + rowSpan + '"';
		} else {
			result = ' style="display:none"';
		}
		return result;     
	}

//]]>
</script>

<form id="formFindPop" name="formFindPop" method="post" action="$!{searchMap.txt2html("context")}/bsc/mon/main/popMetricMatrixList.vw">
	<input type="hidden"  name="findYear"      value="$!{searchMap.txt2html("findYear")}" />
	<input type="hidden"  name="findMon"       value="$!{searchMap.txt2html("findMon")}" />
	<input type="hidden"  name="findAnalCycle" value="$!{searchMap.txt2html("findAnalCycle")}" />
	<input type="hidden"  name="metricId"      value="$!{searchMap.txt2html("metricId")}" />
	
    <div style="width:1200px;height:500px;">
    	<div id="popMetricArea">
    		<h1 class="none">조회</h1>
    		<div style="margin-left:30px;margin-bottom:10px;"></div>
    		<div id="popUserData1" style="margin-left:15px;height:340px;width:450px;">
    			<!-- 데이터그리드 Start -->
    			<div class="blockGridListTable">
    				<table id="popMetricMatrixList" summary="조회">
    					<caption class="none">조회</caption>
    					<thead><tr><th></th></tr></thead>
    					<tbody><tr><td></td></tr></tbody>
    				</table>
    				<div id="popPager"></div>                    
    			</div>
				<div class="blockGridListTable" style="margin-top:15px;">
    				<table id="popDeptScoreList" summary="조회">
    					<caption class="none">조회</caption>
    					<thead><tr><th></th></tr></thead>
    					<tbody><tr><td></td></tr></tbody>
    				</table>
    				<div id="popPager2"></div>                    
    			</div>
    			<!--// 데이터그리드 End -->	
    		</div>
    	</div>
    </div>
</form>
