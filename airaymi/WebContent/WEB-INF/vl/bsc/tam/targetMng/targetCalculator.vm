#*************************************************************************
* CLASS 명      : targetCalculator
* 작 업 자      : 정철수
* 작 업 일      : 2012년 11월 21일  
* 기    능      : 지표목표값 계산기 
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     정철수     2012년 11월 21일              최 초 작 업
**************************************************************************# 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko">
<head >
	#parse("/WEB-INF/vl/common/template/head.vm")
<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;
	
	J(document).ready(function(){
		
	
		J(":input").numeric({allow:"."}); 		//숫자만 입력받기
		J(":input").css("ime-mode", "disabled"); 	//한글사용 비활성화
	
		/******************************************
		 * 저장버튼 이벤트
		 ******************************************/
		J("#btnInsert").click(function(e) {
			e.preventDefault();
			saveChk();
		});
		
		/******************************************
		 * 저장버튼 이중 클릭 방지
		 ******************************************/
		J("formPop").submit(function(){
			J("#btnInsert").unbind();
		});
	
		/******************************************
		 * 계산하기 버튼 
		 ******************************************/
		J("#btnCalcul").click(function() {
			calc();
		});
		
		/******************************************
		 * 닫기버튼 (창닫기)
		 ******************************************/
		J("#btnClose").click(function() {
			self.close();
		});
	});
	
	
	/******************************************
	 * 필수입력 체크
	 ******************************************/
	function saveChk() {
		J("#mode").val("CALCUL_ADD");
		J.showConfirmBox("저장하시겠습니까?", "saveDo"); //saveDo() 콜백함수 호출
	}
	
	/******************************************
	 * 저장
	 ******************************************/
	function saveDo() {
		J("#formPop").attr("action", "$!{context_path}/bsc/tam/targetMng/targetCalculMngProcess.vw?type=pop").submit(); 
	}
	
	
	function calc(){
 	
    	var result = new Array();	//산출값 배열
    	var f_result = new Array();	//산출값 순위 배열
    
    	var float_correct = 100000;	//소숫점 계산시 오차 보정을 위한 상수
    
    	//향상도(목표부여) 목표치
    	if( J("#resOf1Bef").val() == "" || J("#bestTarget").val() =="" ){
    		result[0] = -1;
    	}else{
    		result[0] = J("#resOf1Bef").val() * J("#bestTarget").val() / 100;
    	}
    	
    	//3개년 가중평균 목표치
    	if( J("#resOf3Bef").val() == "" || J("#resOf2Bef").val() == ""|| J("#resOf1Bef").val() == "" || J("#weightOf1Bef").val() == "" || J("#weightOf2Bef").val() == ""|| J("#weightOf3Bef").val() == "" ){
    		result[1] = -1;
    	}else{
			
			if( ( parseFloat( J("#weightOf1Bef").val() ) + parseFloat( J("#weightOf2Bef").val() ) + parseFloat( J("#weightOf3Bef").val() ) ) == 100 ){
				result[1] =(( J("#resOf1Bef").val() * J("#weightOf1Bef").val() / 100 * float_correct) + ( J("#resOf2Bef").val() * J("#weightOf2Bef").val() / 100 * float_correct) + ( J("#resOf3Bef").val() * J("#weightOf3Bef").val() / 100 * float_correct))/float_correct;				
			}else {
				result[1] = -2;
			}
    	}
    	 
    	//B분포 목표치
    	if( J("#resOf1Bef").val() == "" || J("#resOf2Bef").val() == "" || J("#resOf3Bef").val() == "" || J("#resOf4Bef").val() == "" || J("#resOf5Bef").val() == ""){
    		result[2] = -1;
    	}else{
    		result[2] = ((Math.max(J("#resOf1Bef").val(),J("#resOf2Bef").val(),J("#resOf3Bef").val(),J("#resOf4Bef").val(),J("#resOf5Bef").val()) * float_correct) + (Math.min( J("#resOf1Bef").val(),J("#resOf2Bef").val(),J("#resOf3Bef").val(),J("#resOf4Bef").val(),J("#resOf5Bef").val()) * float_correct) + ( J("#resOf1Bef").val() * 4)* float_correct )/ (6 * float_correct);
    	}
    		
    	//전년도 수준 목표치
    	if( J("#resOf1Bef").val() == ""){
    		result[3] = -1;
    	}else{
    		result[3] = J("#resOf1Bef").val();
    	}
    	
    	//자율목표치
    	if( J("#freeTarget").val() == ""){
    		result[4] = -1;
    	}else{
    		result[4] = J("#freeTarget").val();
    	}
    
    	for(var i=0; i<result.length; i++){
    		if(result[i] == -1){
				J("[name=result_value]").eq(i).text("해당없음");
    		}else if( result[i] == -2 ){
				J("[name=result_value]").eq(i).text("가중치 합 오류");
			}else{
				var tmpVal = ( Math.round(result[i] * 100) / 100 ) ; //소숫점2 자리 반올림
				J("[name=result_value]").eq(i).text( tmpVal ).attr("font-color","blue");
    		} 
    	}
    }	
	

//]]>
</script>
</head>
<body>

	
<form id="formPop" name="formPop" method="post" action="$!{context_path}/bsc/tam/targetMng/targetCalculator.vw?type=pop">
<input type="hidden"	id="findHighPgmId"			name="findHighPgmId"		value="$!{searchMap.txt2html("findHighPgmId")}" />
<input type="hidden" 	id="findSubPgmId"			name="findSubPgmId"			value="$!{searchMap.txt2html("findSubPgmId")}" />
<input type="hidden"    id="findPgmId"				name="findPgmId"			value="$!{searchMap.txt2html("findPgmId")}" />
<input type="hidden"    id="findSubjectId"          name="findSubjectId"        value="$!{searchMap.txt2html("findSubjectId")}" />
<input type="hidden"    id="year"          			name="year"        			value="$!{searchMap.txt2html("year")}" />
<input type="hidden"    id="metricId"          		name="metricId"       		value="$!{searchMap.txt2html("metricId")}" />
<input type="hidden"    id="mode"          			name="mode"       			/>
		
			
<div>
	<div class="pop_blockContainer">
		
		<div class="clear h10"></div>
		<div>
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
		<tr>
			<td>
				<table width="100%" border="0" cellpadding="0" cellspacing="0" class="popup_tit_c">
				<tr>
					<td class="popup_tit_l"></td>
					<td class="popup_tit_r">목표값 계산기</td>
				</tr>
				</table>
			</td>
		</tr>
		</table>	
		</div>
		<div class="clear h10"></div>
		
		<div class="blockDetail">
			<table summary="목표값 계산기">
				<caption class="none">목표값 계산기</caption>
				<colgroup>
					<col width="20%" />
					<col width="80%" />
				</colgroup>
				<tbody>
					<tr>
						<th scope="row" class="textCenter">구분</th>
						<th class="textCenter">입력값</th>
					</tr>
					<tr>
						<th scope="row" class="textLeft">최근 5개년 실적</th>
						<td>
							<table summary="최근 5개년 실적">
                				<caption class="none">최근 5개년 실적</caption>
                				<colgroup>
                					<col width="15%" />
                					<col width="15%" />
									<col width="15%" />
									<col width="15%" />
									<col width="15%" />
									<col width="15%" />
                				</colgroup>
                				<tbody>
                					<tr>
                						<th scope="row" class="textCenter">년도</th>
										<th scope="row" class="textCenter">$!{CS_HTML.txt2html($year05)} 년</th>
										<th scope="row" class="textCenter">$!{CS_HTML.txt2html($year04)} 년</th>
										<th scope="row" class="textCenter">$!{CS_HTML.txt2html($year03)} 년</th>
										<th scope="row" class="textCenter">$!{CS_HTML.txt2html($year02)} 년</th>
										<th scope="row" class="textCenter">$!{CS_HTML.txt2html($year01)} 년</th>
                					</tr>
                					<tr>
                						<th class="textCenter">실적</th>
										<td>
											<input type="text" id="resOf5Bef" name="resOf5Bef" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.RES_OF_5_BEF)}" />
										</td>
										<td>
											<input type="text" id="resOf4Bef" name="resOf4Bef" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.RES_OF_4_BEF)}" />
										</td>
										<td>
											<input type="text" id="resOf3Bef" name="resOf3Bef" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.RES_OF_3_BEF)}" />
										</td>
										<td>
											<input type="text" id="resOf2Bef" name="resOf2Bef" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.RES_OF_2_BEF)}" />
										</td>
										<td>
											<input type="text" id="resOf1Bef" name="resOf1Bef" style="width:90%;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.RES_OF_1_BEF)}" />
										</td>
										
                					</tr>
                					
                				</tbody>
                			</table>
						
						</td>
					</tr>
					
					<tr>
						<th scope="row" class="textLeft">최고,최저 목표 기준</th>
						<td>&nbsp;&nbsp;
							최고목표 : <input type="text" id="bestTarget" name="bestTarget" style="width:100px;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.BEST_TARGET)}" maxlength="5" /> %
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							최저목표 : <input type="text" id="lowestTarget" name="lowestTarget" style="width:100px;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.LOWEST_TARGET)}" maxlength="5" /> %
						</td>
					</tr>
					
					<tr>
						<th scope="row" class="textLeft">3개년 가중평균 가중치</th>
						<td>
							<table summary="가중평균 가중치">
                				<caption class="none">가중평균 가중치</caption>
                				<colgroup>
                					<col width="25%" />
                					<col width="25%" />
									<col width="25%" />
									<col width="25%" />
                				</colgroup>
                				<tbody>
                					<tr>
                						<th scope="row" class="textCenter">년도</th>
										<th scope="row" class="textCenter">$!{CS_HTML.txt2html($year03)} 년</th>
										<th scope="row" class="textCenter">$!{CS_HTML.txt2html($year02)} 년</th>
										<th scope="row" class="textCenter">$!{CS_HTML.txt2html($year01)} 년</th>
                					</tr>
                					<tr>
                						<th scope="row" class="textCenter">가중치</th>
										<td class="textCenter">
											<input type="text" id="weightOf3Bef" name="weightOf3Bef" style="width:100px;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.WEIGHT_OF_3_BEF)}" maxlength="5" /> %
										</td>
										<td class="textCenter">
											<input type="text" id="weightOf2Bef" name="weightOf2Bef" style="width:100px;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.WEIGHT_OF_2_BEF)}" maxlength="5" /> %
										</td>
										<td class="textCenter">
											<input type="text" id="weightOf1Bef" name="weightOf1Bef" style="width:100px;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.WEIGHT_OF_1_BEF)}" maxlength="5" /> %
										</td>
                					</tr>
                					
                				</tbody>
                			</table>
							
						</td>
					</tr>
					
					<tr>
						<th scope="row" class="textLeft">자율설정 목표치</th>
						<td>
							<input type="text" id="freeTarget" name="freeTarget" style="width:150px;" class="inputbox" value="$!{CS_HTML.txt2html($calculDetail.FREE_TARGET)}" maxlength="15" />
						</td>
					</tr>
					
				</tbody>
			</table>
		</div>

		<div class="blockButton_all">			
			<div class="blockButton_l">
			</div>
    		<div class="blockButton"> 
    			<ul>
					<li><input type="button" id="btnInsert" value="저장"/></li>
    				<li><input type="button" id="btnCalcul" value="계산하기"/></li>
    			</ul>
    		</div>
		</div>
		
		
		
		<div class="clear h10"></div>
		
		<div class="blockDetail">
			<table summary="목표값 계산 결과">
				<caption class="none">목표값 계산 결과</caption>
				<colgroup>
					<col width="20%" />
					<col width="60%" /> 
					<col width="20%" />
				</colgroup>
				<tbody>
					<tr>
						<th scope="row" class="textCenter">목표치</th>
						<th scope="row" class="textCenter">산출산식</th>
						<th scope="row" class="textCenter">산출값</th>
					</tr>
					<tr>
						<th scope="row" class="textLeft">향상도(목표부여) 목표치</th>
						<th scope="row" class="textCenter">전년도 실적치 기준 최고목표, 최저 목표</th>
                        <td class="textRight"><span name="result_value"></span></td>
					</tr>
					
					<tr>
						<th scope="row" class="textLeft">3개년 가중평균 목표치</th>
						<th scope="row" class="textCenter">최근 3개년 가중평균</th>
						<td class="textRight"><span name="result_value"></span></td>
					</tr>
					
					<tr>
						<th scope="row" class="textLeft">β분포 목표치</th>
						<th scope="row" class="textCenter">( 최고실적 + 최저실적 + ( 전년도실적 * 4 ) ) / 6</th>
						<td class="textRight"><span name="result_value"></span></td>
					</tr>
					
					<tr>
						<th scope="row" class="textLeft">전년도 수준 목표치</th>
						<th scope="row" class="textCenter">전년도와 동일(유사)한 목표치</th>
						<td class="textRight"><span name="result_value"></span></td>
					</tr>
					
					<tr>
						<th scope="row" class="textLeft">자율목표치</th>
						<th scope="row" class="textCenter">자율적으로 설정한 목표치</th>
						<td class="textRight"><span name="result_value"></span></td>
					</tr>
					
					
				</tbody>
			</table>
		</div>
		
		
		<div class="blockButton_all">			
			<div class="blockButton_l">
			</div>
    		<div class="blockButton"> 
    			<ul>
    				<li><input type="button" id="btnClose" value="닫기"/></li>
    			</ul>
    		</div>
		</div>
		
			
	</div>
	<div class="clear"></div>
</div>
	

<div id="dialog" title="확인"><p>&nbsp;</p></div>    <!-- 다이어로그 -->
<div class="clear"></div>
</form>
</body>
</html>