#*************************************************************************
* CLASS 명      : planHistoryList
* 작 업 자      : 김효은
* 작 업 일      : 2013년 12월 8일 
* 기    능      : 성과계획서(팝업)
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     김효은      2013년 12월 10일             최 초 작 업
**************************************************************************# 
<script type="text/javascript" language="javascript" >
//<![CDATA[

    var J = jQuery;
    
    J(document).ready(function(){
    
        /******************************************
         * 데이터 그리드 출력
         ******************************************/
        var str = J('#formFindList').serialize();
        
        jQuery("#historylist").jqGrid({
            url          :"$!{searchMap.txt2html("context")}/prs/mng/planHistory/planHistoryList_xml.vw" + "?" + str,
            mtype        :"POST",
            datatype     :"json",
            jsonReader   : {   
                            page   : "page",
                            total  : "total",
                            root   : "rows", 
                            records: function(obj){return obj.length;},
                            repeatitems: false, 
                            id     : "id"
                           },
            height       : 300,
            colNames     :['기준년도', '사원번호', '평가대상자 순번','SEQ', '이름',  '부서명',  '직급', '직위', '개인업적 평가 여부', '직무수행기간','성과계획관리여부', '확인자ID', '확인자', '최종확인일' ],
            colModel     :[
                            {name:'YEAR'                 ,index:'YEAR'                 ,width:150   ,align:'center' }, 
                            {name:'EVAL_MEMB_EMPN'       ,index:'EVAL_MEMB_EMPN'       ,width:100   ,align:'center' }, 
                            {name:'EVAL_MEMB_EMPN_SEQ'   ,index:'EVAL_MEMB_EMPN_SEQ'   ,width:150   ,align:'center' }, 
                            {name:'SEQ'  				 ,index:'SEQ'  				   ,width:150   ,align:'center' }, 
                            {name:'KOR_NM'               ,index:'KOR_NM'               ,width:100   ,align:'center'  ,formatter:linkUpdate}, 
                            {name:'DEPT_FULL_NM'         ,index:'DEPT_FULL_NM'         ,width:200   ,align:'left'   }, 
                            {name:'CAST_TC_NM'           ,index:'CAST_TC_NM'           ,width:150   ,align:'center' }, 
                            {name:'POS_TC_NM'            ,index:'POS_TC_NM'            ,width:150   ,align:'left'   }, 
                            {name:'PRS_YN'               ,index:'PRS_YN'               ,width:150   ,align:'center' }, 
                            {name:'WORKDATE'             ,index:'WORKDATE'             ,width:250   ,align:'center' }, 
                            {name:'PLAN_YN'              ,index:'PLAN_YN'              ,width:150   ,align:'center' }, 
                            {name:'APPROVE_USER_ID'      ,index:'APPROVE_USER_ID'      ,width:150   ,align:'center' }, 
                            {name:'APPROVE_USER_NM'      ,index:'APPROVE_USER_NM'      ,width:100   ,align:'center' },
                            {name:'FINAL_APPROVE_DT'     ,index:'FINAL_APPROVE_DT'     ,width:100   ,align:'center' } 
                            ],
            rowNum       : 100000,
            autowidth    : false, 
            viewrecords  : true,
            loadonce     : false,
			cmTemplate	 : {sortable:false},
            multiselect  : true,
            cellEdit     : true,
            caption:"성과계획서(팝업)"
        }).jqGrid('hideCol',"SEQ").jqGrid('hideCol',"YEAR").jqGrid('hideCol',"EVAL_MEMB_EMPN_SEQ").jqGrid('hideCol',"PRS_YN").jqGrid('hideCol',"PLAN_YN").jqGrid('hideCol',"APPROVE_USER_ID").setGridWidth(1100);
		
	});
			
	 /******************************************
     * 돌아가기
     ******************************************/
    function goBack() {
        J("#evalMembEmpn").val(J("#findEmpn").val());
        J("#evalMembEmpnSeq").val(J("#findEmpnSeq").val());
        J("#year").val(J("#findYear").val());
		
		J.ajax({
        	url      : "$!{searchMap.txt2html("context")}/prs/mng/planHistory/planHistoryList.vw",
        	cache    : false,
        	type     : "POST",
			data     : "findYear=" + J("#year").val() + "&amp;evalMembEmpn=" + J("#evalMembEmpn").val()+ "&amp;evalMembEmpnSeq=" + J("#evalMembEmpnSeq").val() ,
        	dataType : "html",
        	contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success  : function (data) {
        		J("#modifyData").empty();  //body부분 div를 empty 시켜줌(empty를 시키지 않을 경우 메모리릭 발생)   
        		J("#modifyData").append(data);
        	}
    	});
		
	}
	
    /******************************************
     * jqGrid 수정페이지 링크
     ******************************************/
    function linkUpdate(cellvalue, options, rowObject) { 
        return '<a href=javascript:goModify(' + options.rowId + ')>' + cellvalue + '<//a>';
    }
    
    /******************************************
     * 수정
     ******************************************/
    function goModify(rowId) {
        var ret = J("#historylist").jqGrid('getRowData',rowId);
        J("#evalMembEmpnSeq").val(ret.EVAL_MEMB_EMPN_SEQ);
        J("#evalMembEmpn").val(ret.EVAL_MEMB_EMPN);
        J("#seq").val(ret.SEQ);
        J("#year").val(J("#findYear").val());
		
		J.ajax({
        	url      : "$!{searchMap.txt2html("context")}/prs/mng/planHistory/planHistoryDetailList.vw",
        	cache    : false,
        	type     : "POST",
			data     : "findYear=" + J("#year").val() + "&amp;evalMembEmpn=" + J("#evalMembEmpn").val()+ "&amp;evalMembEmpnSeq=" + J("#evalMembEmpnSeq").val()+ "&amp;seq=" + J("#seq").val() ,
        	dataType : "html",
        	contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success  : function (data) {
        		J("#modifyData").empty();  //body부분 div를 empty 시켜줌(empty를 시키지 않을 경우 메모리릭 발생)   
        		J("#modifyData").append(data);
        	}
    	});
	}

//]]>
</script>


	<form id="formFindList" name="formFindList" method="post" action="">
    <input type="hidden"    id="findYear"     		 name="findYear"          value="$!{searchMap.txt2html("findYear")}" />
    <input type="hidden"    id="findEmpn"     		 name="findEmpn"          value="$!{searchMap.txt2html("evalMembEmpn")}" />
    <input type="hidden"    id="findEmpnSeq"   		 name="findEmpnSeq"    	  value="$!{searchMap.txt2html("evalMembEmpnSeq")}" />
	</form>
<div id="modifyData">
    <form id="formFindPop" name="formFindPop" method="post" action="">
        <input type="hidden" id="year"       name="year" />
        <input type="hidden" id="seq"        name="seq" />
		<div class="searchBox">
        <div><div><div>
        <table summary="성과계획서(팝업)검색 조건">
            <caption class="none">성과계획서(팝업) 검색 조건</caption> 
            <thead><tr><th></th></tr></thead>
            <tbody>
                <tr>
                    <td class="searchBox_tit w250">
                        <span><label for="findYear">평가년도:</label></span>
                        <span class="searchBar">$!{searchMap.txt2html("findYear")}년 </span>
                    </td>
                </tr>
            </tbody>
        </table>
        </div></div></div>
        </div>
	<div style="width:1105px;height:400px;">
        <!-- 데이터그리드 Start -->
        <div class="blockGridListTable">
            <table id="historylist" summary="성과계획서(팝업) 조회결과">&nbsp;
                <caption class="none">성과계획서(팝업) 조회</caption>
                <thead><tr><th></th></tr></thead>
                <tbody><tr><td></td></tr></tbody>
            </table>
            <div id="pager"></div>
        </div>
        <!--// 데이터그리드 End -->
        </div>
    </form>
</div>
