#*************************************************************************
* CLASS 명      : popMemEvalEmpList
* 작 업 자      : 유연주
* 작 업 일      : 2017년 04월12일 
* 기    능      : 평가진행사항 모니터링 직원목록 조회  
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자    작     업     일        변 경 내 용                비고
* ----  --------  -----------------  -------------------------  --------
*  1    유연주     2017년 04월12일             최 초 작 업 
**************************************************************************# 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko">

#set($main_url = $!{searchMap.txt2html("mainUrl")})
#set($curr_url = $!{context_path} + "/mem/monitor/memEvalProcMonitor/popMemEvalEmpList.vw")

<head>
	#parse("/WEB-INF/vl/common/template/head.vm")
<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;
	var grdRowId = 0;
	
	J(document).ready(function(){
		/******************************************
		 * 데이터 그리드 출력
		 ******************************************/
		var str = J('#form1').serialize();

		jQuery("#list").jqGrid({
			url          :"$!{context_path}/mem/monitor/memEvalProcMonitor/popMemEvalEmpList_xml.vw" + "?" + str,
			mtype        :"POST",
			datatype     :"json",
			jsonReader   : {
    						page   : "page",
    						total  : "total",
    						root   : "rows",
    						records: function(obj){return obj.length;},
    						repeatitems: false,
    						id     : "id"
    				       },
			height       : 250,
			colNames     :['사원번호', '평가자', '부서명', '직급', '직위', '평가대상자', '평가완료', '평가미완료', '이메일'],
			colModel     :[
                            {name:'EMP_NO'               ,index:'EMP_NO'               ,width:100   ,align:'center' },
                            {name:'EMP_NM'               ,index:'EMP_NM'               ,width:100   ,align:'center' },
                            {name:'DEPT_NM'              ,index:'DEPT_NM'              ,width:150   ,align:'left' },
							{name:'CAST_NM'              ,index:'CAST_NM'              ,width:100   ,align:'center' },
							{name:'POS_NM'               ,index:'POS_NM'               ,width:100   ,align:'center' },
							{name:'TARGET_COUNT'         ,index:'TARGET_COUNT'         ,width:100   ,align:'center' },
							{name:'COM_COUNT'            ,index:'COM_COUNT'            ,width:100   ,align:'center' },
							{name:'NOT_COUNT'            ,index:'NOT_COUNT'            ,width:100   ,align:'center' },
							{name:'EMAIL'                ,index:'EMAIL'                ,width:0     ,align:'center' }
							],
			rowNum       : $!{jqGrid_rownum},
			autowidth    : false,
			viewrecords  : true,
			loadonce     : true,
			multiselect  : true,
			cellEdit     : true,
			gridview     : true,
			##cmTemplate   : {sortable:false},
			loadComplete : function() {
                           },
			caption:"직원목록상세"
		}).jqGrid('hideCol',"EMAIL").setGridWidth(760);
		
		/******************************************
		 * 닫기버튼 이벤트
		 ******************************************/
		J("#btnClose").click(function(e) {
			self.close();
		});
		
		/******************************************
		 * 메일 버튼 클릭 이벤트
		 ******************************************/
		J("#btnMail").click(function() {
			mailWrite();
			return false;
		});
	});
	
	/******************************************
	 * 메일발송 팝업
	 ******************************************/
	function mailWrite(){
		var list = "";
		var id = "";
		var ids = "";
		var rowdata = "";
		var toMail = "";
		var toName = "";
		var toNameList = "";

		list = "list";
		id = J("#list").getGridParam('selarrrow');
		ids = J("#list").jqGrid('getDataIDs');

		for (var i = 0; i < ids.length; i++) {
			J.each(id, function (index, value) {
				if (value == ids[i]) {
					rowdata = J("#"+ list).getRowData(ids[i]);
					if(rowdata.EMAIL != '' && rowdata.EMAIL != null) {
    					toMail += rowdata.EMAIL + "|";

						toName += rowdata.EMP_NM + "|";
						toNameList += rowdata.EMP_NM + "<" + rowdata.EMAIL + ">;";
    				}
				}
			});
		}

		if(!J.gridSelectChk(list)){
			J.showMsgBox("메일을 전송할 대상자를 선택하십시요", null, null);
		} else {
			openWinByName('','pop','900','430','no');

			J("#toMail").val(toMail);
    		J("#toName").val(toName);
			J("#toNameList").val(toNameList);
    		J("#mailForm").attr("target", "pop");
    		J("#mailForm").attr("action", "$!{context_path}/bsc/module/commModule/popSendMail.vw?type=popup").submit();
    	}
	}
//]]>
</script>    
 
<form id="form1" name="form1" method="post" action="$!{context_path}/mem/monitor/memEvalProcMonitor/memActInProcess.vw?type=template">
    <input type="hidden" 	id="mode"		    name="mode"		      value="$!{searchMap.txt2html("mode")}" />
	<input type="hidden" 	id="gubun"       	name="gubun" 		  value="$!{searchMap.txt2html("gubun")}" />
	<input type="hidden" 	id="findYear"       name="findYear" 	  value="$!{searchMap.txt2html("findYear")}" />
	
    <div style="width:780px;height:300px;">
    	<div id="popMetricGrpArea" style="margin-left:15px;">
    		<h1 class="none">ActionPlan리스트</h1>
			<div class="tableTop">
                <!-- 검색 테이블 Start -->
                </br>
                <div class="searchBox">
                <div><div><div>   
                    <table summary="검색조건">        
                        <caption class="none">검색조건</caption>
                        <thead><tr><th></th><th></th></tr></thead>
                        <tbody>
                            <tr>
								<td class="searchBox_tit w250">진행사항 <span class="searchBar">
							#if($!{searchMap.txt2html("gubun")} == 'E1_COM')
								1차평가 > 평가완료
							#elseif($!{searchMap.txt2html("gubun")} == 'E1_ING')
								1차평가 > 평가중
							#elseif($!{searchMap.txt2html("gubun")} == 'E1_NOT')
								1차평가 > 미평가
							#elseif($!{searchMap.txt2html("gubun")} == 'E2_COM')
								2차평가 > 평가완료
							#elseif($!{searchMap.txt2html("gubun")} == 'E2_ING')
								2차평가 > 평가중
							#elseif($!{searchMap.txt2html("gubun")} == 'E2_NOT')
								2차평가 > 미평가
							#elseif($!{searchMap.txt2html("gubun")} == 'E3_COM')
								동료평가 > 평가완료
							#elseif($!{searchMap.txt2html("gubun")} == 'E3_ING')
								동료평가 > 평가중
							#elseif($!{searchMap.txt2html("gubun")} == 'E3_NOT')
								동료평가 > 미평가
							#end
								</span></td>
							</tr>
                        </tbody>
                    </table>
                </div></div></div>
                </div>
                <!--// 검색 테이블 End -->
                <div class="clear"></div>
            </div>
			<div id="userData">
    			<!-- 데이터그리드 Start -->
					<div class="blockGridListTable">
						<table id="list" summary="직원목록 조회결과">
							<caption class="none">직원목록 조회</caption>
							<thead><tr><th></th></tr></thead>
							<tbody><tr><td></td></tr></tbody>
						</table>
						<div id="pager"></div>
					</div>
    			<!--// 데이터그리드 End -->
			</div><br>
			<div class="blockButton"> 
    			<ul>
    				<li><input type="button" id="btnMail"   value="메일발송" /></li>
    				<li><input type="button" id="btnClose"   value="닫기" /></li>
    			</ul>
    		</div>	
    	</div>
    	<div class="clear"></div>
    </div>
<div id="dialog" title="확인" style="display:none;"><p>&nbsp;</p></div>    <!-- 다이어로그 -->
</form>
<form id="mailForm" name="mailForm" method="post" action="$!{context_path}/bsc/module/commModule/popSendMail.vw">
    <input type="hidden" id="toMail" 		name="toMail" />
	<input type="hidden" id="toName" 	    name="toName" />
    <input type="hidden" id="toNameList"    name="toNameList" />
    <input type="hidden" id="mailSendGbn"	name="mailSendGbn" /> <!-- 메일발송 디폴트문구(공통코드:140) -->
</form>
