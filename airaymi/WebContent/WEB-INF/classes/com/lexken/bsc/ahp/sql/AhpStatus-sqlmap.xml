<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="bsc.ahp.ahpStatus">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: AHP 평가현황 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: 
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.YEAR
	         , A.EVAL_USER_GRP_ID
	         , B.EVAL_USER_GRP_NM
	         , A.EVAL_USER_ID 
	         , F.USER_NM
	         , F.EMAIL
	         , F.DEPT_ID
	         , F.DEPT_NM
	         , C.ITEM_GRP_ID
	         , D.ITEM_GRP_NM
	         , NVL(E.EVAL_SUBMIT_YN, 'N') AS EVAL_SUBMIT_YN
	         , F_CODE_NM('143', NVL(E.EVAL_SUBMIT_YN, 'N'), A.YEAR) AS EVAL_SUBMIT_YN_NM
	         , (SELECT COUNT(1) FROM BSC_AHP_ITEM_TAB WHERE YEAR = A.YEAR AND ITEM_GRP_ID = C.ITEM_GRP_ID) AS TOT_CNT
             , (SELECT COUNT(1) FROM BSC_AHP_EVAL  
                WHERE YEAR = A.YEAR AND EVAL_USER_GRP_ID = A.EVAL_USER_GRP_ID AND ITEM_GRP_ID = C.ITEM_GRP_ID AND EVAL_USER_ID = A.EVAL_USER_ID AND EVAL_SCORE_ID IS NOT NULL) AS EVAL_CNT
		FROM BSC_AHP_EVAL_USER A
		          LEFT OUTER JOIN BSC_AHP_EVAL_USER_GRP B ON A.YEAR = B.YEAR AND A.EVAL_USER_GRP_ID = B.EVAL_USER_GRP_ID
		          LEFT OUTER JOIN BSC_AHP_EVAL_MAPPING C ON B.YEAR = C.YEAR AND B.EVAL_USER_GRP_ID = C.EVAL_USER_GRP_ID
		          LEFT OUTER JOIN BSC_AHP_ITEM_GRP D ON C.YEAR = D.YEAR AND C.ITEM_GRP_ID = D.ITEM_GRP_ID
		          LEFT OUTER JOIN BSC_AHP_EVAL_STATUS E ON D.YEAR = E.YEAR AND A.EVAL_USER_GRP_ID = E.EVAL_USER_GRP_ID AND D.ITEM_GRP_ID = E.ITEM_GRP_ID AND A.EVAL_USER_ID = E.EVAL_USER_ID
		          LEFT OUTER JOIN V_ROLE_USER F ON A.EVAL_USER_ID = F.USER_ID
		WHERE A.YEAR = #findYear#
		  AND A.EVAL_USER_GRP_ID = #findEvalUserGrpId#
		  
		  <isNotEmpty prepend="AND" property="findEvalSubmitYn">
			NVL(E.EVAL_SUBMIT_YN, 'N') = #findEvalSubmitYn#
		  </isNotEmpty>
	    
		ORDER BY F.USER_NM, B.SORT_ORDER, D.SORT_ORDER
	</select>

	<!--
	==================================================================   
	  # 설명	: AHP 평가단 목록조회
	  #	기능	: SELECT
	  #	TABLE	: BSC_AHP_EVAL_USER_GRP
	==================================================================
	-->
	<select id="getEvalUserGrpList" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.EVAL_USER_GRP_ID
		     , A.EVAL_USER_GRP_NM
		  FROM BSC_AHP_EVAL_USER_GRP A
		 WHERE A.YEAR = #findYear#
		 ORDER BY SORT_ORDER 
	</select>
	 
	 
	
</sqlMap>


