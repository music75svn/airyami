<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="cbe.eval.evalDeptConvertScore">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: 조직환산점수 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: 
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT CST.YEAR, CST.EVAL_DEGREE_ID, CST.SC_DEPT_ID, CST.SC_DEPT_NM
		     , CST.UP_SC_DEPT_ID, CST.UP_SC_DEPT_NM
		     , CST.SC_DEPT_GRP_ID
		     , F_CODE_NM('003', CST.SC_DEPT_GRP_ID, CST.YEAR) AS SC_DEPT_GRP_NM
		     , SD.SC_DEPT_S_NM
		     , CST.LEVEL_ID, CST.SCORE, CST.CONVERT_SCORE, CST.MON
		     , CST.SC_DEPT_TOT_CNT, CST.SC_DEPT_RANK
		     , CASE WHEN CST.SC_DEPT_RANK IS NULL OR CST.SC_DEPT_TOT_CNT IS NULL THEN NULL
		     		ELSE CST.SC_DEPT_RANK || ' / ' || CST.SC_DEPT_TOT_CNT
		       END AS DEPT_RANK
		     , CST.UP_SC_DEPT_RANK
		     , CST.FIX_CONVERT_SCORE
		  FROM CBE_RANK_CONVERT_SCORE_TAB CST
		       LEFT OUTER JOIN 
		       BSC_SC_DEPT SD
		       ON CST.YEAR = SD.YEAR
		      AND CST.SC_DEPT_ID = SD.SC_DEPT_ID
		       LEFT OUTER JOIN 
		       BSC_SC_DEPT USD
		       ON SD.YEAR = USD.YEAR
		      AND SD.UP_SC_DEPT_ID = USD.SC_DEPT_ID
		 WHERE 1=1
		   AND CST.YEAR = #findYear#
		   AND CST.EVAL_DEGREE_ID = #findEvalDegreeId#
		 ORDER BY USD.SORT_ORDER NULLS FIRST, USD.SC_DEPT_ID, CST.SC_DEPT_GRP_ID, SD.LEVEL_ID, CST.SC_DEPT_RANK NULLS LAST, SD.SORT_ORDER
	</select>
	
	
	
	<!--
	==================================================================   
	  # 설명	: 평가환산방법 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: CBE_EVAL_CONVERT_METHOD
	==================================================================
	-->
	<select id="getInsaEvalDegreeList" parameterClass="hashMap" resultClass="hashMap">
		SELECT EVU_STD_ID, EVU_STD_NM
		  FROM INSA_BSC_ESTI_RESULT   
		 GROUP BY EVU_STD_ID, EVU_STD_NM
		 ORDER BY EVU_STD_ID
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 조직환산점수 상세 보기
	  #	기능	: SELECT
	  #	TABLE	: CBE_EVAL_INIT_INFO
	==================================================================
	-->
	<select id="getInitInfoDetail" parameterClass="hashMap" resultClass="hashMap">
		SELECT YEAR, EVAL_DEGREE_ID, EVU_STD_ID, WORK_TERM
		  FROM CBE_EVAL_INIT_INFO
		 WHERE 1=1
		   AND YEAR =  #findYear#
		   AND EVAL_DEGREE_ID = #findEvalDegreeId#
	</select>
	
	
	<!--
	==================================================================   
	  # 설명	: 조직환산점수 등록
	  #	기능	: INSERT
	  #	TABLE	: CBE_EVAL_INIT_INFO
	==================================================================
	-->	
	<insert id="insertEvalInitData" parameterClass="hashMap">
		INSERT INTO CBE_EVAL_INIT_INFO ( 
			YEAR, EVAL_DEGREE_ID, EVU_STD_ID, WORK_TERM, CREATE_DT
			) VALUES ( 
			#year#, #evalDegreeId#, #insaEvalDegreeId#, #workTerm#, SYSDATE
			)
	</insert>	
	
	<!--
	==================================================================   
	  # 설명	: 조직환산점수 삭제
	  #	기능	: UPDATE
	  #	TABLE	: 
	==================================================================
	-->	
	<update id="deleteEvalInitData" parameterClass="hashMap">
		DELETE FROM  CBE_EVAL_INIT_INFO
		 WHERE 1 = 1 
		   AND YEAR = #year#
		   AND EVAL_DEGREE_ID = #evalDegreeId#

	</update>
	
	<!--
	==================================================================   
	  # 설명	: 조직환산점수 수정
	  #	기능	: UPDATE
	  #	TABLE	: CBE_RANK_CONVERT_SCORE_TAB
	==================================================================
	-->	
	<update id="updateData" parameterClass="hashMap">
		UPDATE CBE_RANK_CONVERT_SCORE_TAB
		   SET FIX_CONVERT_SCORE = #cbeFixScore#
		 WHERE 1 = 1 
		   AND YEAR = #year#
		   AND EVAL_DEGREE_ID = #evalDegreeId#
		   AND SC_DEPT_ID = #scDeptId#
	</update>	
	
	
	
	
	<!--
	==================================================================   
	  # 설명	: 파라미터 맵
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<parameterMap id="paramMap" class="java.util.HashMap">
		<parameter property="year" 			jdbcType="VARCHAR"  javaType="java.lang.String" mode="IN"/>
		<parameter property="evalDegreeId" 			jdbcType="VARCHAR"  javaType="java.lang.String" mode="IN"/>	
	</parameterMap>	
	
	<!--
	==================================================================   
	  # 설명	: 데이터집계관리 프로시저 호출
	  #	기능	: CALL PROCEDURE
	  #	TABLE	: 
	==================================================================
	-->	
	<procedure id="callSpSetConvertTab"  parameterMap="paramMap">
		{CALL  SP_CBE_SET_CONVERT_TAB(?, ?)} 
    </procedure>
    
    
    <!--
	==================================================================   
	  # 설명	: 인사정보 초기화 실행
	  #	기능	: PROCEDURES
	  #	TABLE	: 
	==================================================================
	-->		
	<procedure id="execData" parameterMap="paramMap">  
		{CALL SP_CBE_INFO_INIT(?, ?)}
	</procedure>
	
	
</sqlMap>


