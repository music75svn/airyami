<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="prs.emp.talkEmp">

    <!--
    ==================================================================   
      # 설명    : typeAlias 선언
      #    기능    : SETTING
      #    TABLE    : 
    ==================================================================
    -->
    <typeAlias alias="hashMap"             type="java.util.HashMap" />
     

    <!--
    ==================================================================   
      # 설명    : 직원개인성과 중간면담 목록 보기
      #    기능    : SELECT
      #    TABLE    : 
    ==================================================================
    -->
    <select id="getList" parameterClass="hashMap" resultClass="hashMap">
        SELECT A.YEAR
			 , A.EMPN
			 , A.KOR_NM
			 , A.DEPT_CD
			 , D.DEPT_KOR_NM
             , F_DEPT_FULL_NM(A.YEAR, A.DEPT_CD, 'BSC_INSA_DEPT') DEPT_FULL_NM
			 , A.CAST_TC
			 , B.CODE_NM AS CAST_TC_NM
			 , A.POS_TC
			 , C.CODE_NM AS POS_TC_NM
			 , A.EVAL_YN
			 , B1.START_PCMT_DATE
             , B1.END_PCMT_DATE 
             , V.ASSESSOR_EMPN AS MANAGER_USER_ID
			 , I.KOR_NM AS  MANAGER_USER_NM
          FROM CON_EMP_MEMBER A
          LEFT OUTER JOIN BSC_CODE B
                       ON A.YEAR = B.YEAR
                      AND B.CODE_GRP_ID = '170'
                      AND B.CODE_ID = A.CAST_TC
          LEFT OUTER JOIN BSC_CODE C
                       ON A.YEAR = C.YEAR
                      AND C.CODE_GRP_ID = '171'
                      AND C.CODE_ID = A.POS_TC
		  LEFT OUTER JOIN BSC_INSA_DEPT D
            		   ON A.YEAR = D.YEAR
           AND A.DEPT_CD = D.DEPT_CD
		  LEFT OUTER JOIN CON_EMP_EVAL_ASSESSOR V ON A.YEAR = V.YEAR AND A.DEPT_CD = V.DEPT_CD
		  LEFT OUTER JOIN BSC_INSA I ON V.YEAR = I.YEAR 
		  							<!-- AND V.DEPT_CD  = I.DEPT_CD  -->
		  							AND V.ASSESSOR_EMPN = I.EMPN
          LEFT OUTER JOIN (SELECT YEAR, EMPN, DEPT_CD, MIN(START_PCMT_DATE) AS START_PCMT_DATE, 
					          MAX(END_PCMT_DATE) AS END_PCMT_DATE 
					         FROM BSC_INSA_PCMT GROUP BY YEAR, EMPN, DEPT_CD 
					       ) B1 ON A.YEAR = B1.YEAR AND A.EMPN = B1.EMPN  AND A.DEPT_CD = B1.DEPT_CD 
         WHERE A.YEAR=#findYear#
           AND A.DEPT_CD IN (SELECT DEPT_CD
							   FROM BSC_INSA_DEPT
							  WHERE YEAR = #findYear#
						 START WITH DEPT_CD = '0000'
				   CONNECT BY PRIOR YEAR = YEAR
								AND PRIOR DEPT_CD = UP_DEPT_CD)
			<isNotEmpty prepend="AND" property="findYear">
	            A.YEAR = #findYear#
		   	</isNotEmpty>
		   	<isNotEmpty prepend="AND" property="findKorNm">
		   		UPPER(A.KOR_NM) LIKE  '%' || TRIM(UPPER(#findKorNm#)) ||'%'   
		   	</isNotEmpty>
          ORDER BY A.DEPT_CD, A.EMPN
    </select>
    
    <!--
    ==================================================================   
      # 설명    : 직원개인성과 중간면담 상세 보기
      #    기능    : SELECT
      #    TABLE    : 
    ==================================================================
    -->
    <select id="getDetail" parameterClass="hashMap" resultClass="hashMap">
        SELECT           FROM  
        WHERE 1 = 1           
    </select>
    
    <!--
    ==================================================================   
      # 설명    : 직원개인성과 중간면담 등록
      #    기능    : INSERT
      #    TABLE    : 
    ==================================================================
    -->    
    <insert id="insertData" parameterClass="hashMap">
        <selectKey resultClass="java.lang.String" keyProperty="SEQ" >
            SELECT F_PGM_SERI('','','','','','') SEQ FROM DUAL
        </selectKey>
        INSERT INTO  ( 
             ) VALUES ( 
             )
    </insert>    
    
    <!--
    ==================================================================   
      # 설명    : 직원개인성과 중간면담 수정
      #    기능    : UPDATE
      #    TABLE    : 
    ==================================================================
    -->    
    <update id="updateData" parameterClass="hashMap">
        UPDATE  
           SET          WHERE 1 = 1 
        
    </update>    
    

    <!--
    ==================================================================   
      # 설명    : 직원개인성과 중간면담 삭제
      #    기능    : UPDATE
      #    TABLE    : 
    ==================================================================
    -->    
    <update id="deleteData" parameterClass="hashMap">
        DELETE FROM  
         WHERE 1 = 1 

    </update>
    
    
</sqlMap>


