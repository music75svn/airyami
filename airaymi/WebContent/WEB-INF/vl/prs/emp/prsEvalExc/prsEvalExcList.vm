#*************************************************************************
* CLASS 명      : prsEvalExcList
* 작 업 자      : 신인수
* 작 업 일      : 2013년 6월 22일
* 기    능      : 직원개인평가(평가대상제외자)
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자     작   업   일       변 경 내 용           비  고
* ----  --------  -----------------  -------------------------  -----------
*  1     신인수      2013년 6월 22일             최 초 작 업
**************************************************************************#
#set($curr_url = $!{context_path} + "/prs/emp/prsEvalExc/prsEvalExcList.vw")
<script type="text/javascript" language="javascript" >
//<![CDATA[

    var J = jQuery;

    J(document).ready(function(){

        /******************************************
         * 데이터 그리드 출력
         ******************************************/
        var str = J('#formFind').serialize();

        jQuery("#list").jqGrid({
            url          :"$!{context_path}/prs/emp/prsEvalExc/prsEvalExcList_xml.vw" + "?" + str,
            mtype        :"POST",
            datatype     :"json",
            jsonReader   : {
                            page   : "page",
                            total  : "total",
                            root   : "rows",
                            records: function(obj){return obj.length;},
                            repeatitems: false,
                            id     : "id"
                           },
            height       : $!{jqGrid_height},
            width        : $!{jqGrid_width},
            colNames     :['평가년도', '코드', '평가제외구분', '설명', '대상인원', '등급', '등급'],
            colModel     :[
                            {name:'YEAR'                 ,index:'YEAR'                 ,width:150   ,align:'center' },
                            {name:'CODE_ID'              ,index:'CODE_ID'              ,width:150   ,align:'center' },
                            {name:'CODE_NM'              ,index:'CODE_NM'              ,width:200   ,align:'center' ,formatter:linkUpdate1},
							{name:'CONTENT'              ,index:'CONTENT'              ,width:250   ,align:'center' },
                            {name:'EXCEPT_COUNT'         ,index:'EXCEPT_COUNT'         ,width:50   ,align:'center' ,formatter:linkUpdate},
							{name:'ETC1'                 ,index:'ETC1'                 ,width:50   ,align:'center' },
							{name:'ETC2'                 ,index:'ETC2'                 ,width:50   ,align:'center' }
                            ],
            rowNum       : $!{jqGrid_rownum},
            autowidth    : false,
            viewrecords  : true,
            loadonce     : true,
            multiselect  : true,
            cellEdit     : true,
            loadComplete : function() {
    							var ids = J("#list").jqGrid('getDataIDs');
    							J("#list input:checkbox").each(function(index) {
    								var rowdata = J("#list").getRowData(ids[index]);
									J("#list input:checkbox[name=jqg_list_" + (1) + "]").hide();
									J("#list input:checkbox[name=jqg_list_" + (2) + "]").hide();
    							});
                           },
            gridview     : true,
            caption:"직원개인평가(평가대상제외자)"
        }).jqGrid('hideCol',"YEAR").jqGrid('hideCol',"CODE_ID").jqGrid('hideCol',"ETC2").setGridWidth($!{jqGrid_width});

        /******************************************
         * 조회
         ******************************************/
        J("#formFind").submit(function(event) {
            //submit 하기전 작업추가
        });

        /******************************************
         * 신규 등록
         ******************************************/
        J("#btnInsert").click(function() {
            J("#year").val(J("#findYear").val());
            J("#mode").val("ADD1");
            J("#formList").attr("action", "$!{context_path}/prs/emp/prsEvalExc/prsEvalExcNew.vw?type=template").submit();
        });



        /******************************************
         * 삭제 버튼 클릭 이벤트
         ******************************************/
        J("#btnDelete").click(function() {
            goDelete();
            return false;
        });

		/******************************************
         * 평가제외 대상자 가져오기
         ******************************************/
        J("#btnProc").click(function() {
			goExecute();
			return false;
		});

    });

	/******************************************
	 * 평가제외 대상자 가져오기 집계
	 ******************************************/
	function goExecute() {
		J.showConfirmBox("평가제외 대상자 가져오기를 하시면 기존에 입력한 데이터가 삭제됩니다. 진행하시겠습니까?", "executeDo"); //executeDo() 콜백함수 호출
	}

	/******************************************
	 * 평가제외 대상자 가져오기 집계
	 ******************************************/
	function executeDo() {
		J("#year").val(J("#execYear").val());
		J("#mode").val("CALL");
		J.showMsgBox("실행합니다.<br/> 완료될 때까지 잠시만 기다려 주십시요.", null, null);
		J("#formList").attr("action", "$!{context_path}/prs/emp/prsEvalExc/prsEvalExcProcess.vw?type=template").submit();

	}

    /******************************************
     * jqGrid 수정페이지 링크
     ******************************************/
    function linkUpdate(cellvalue, options, rowObject) {
        return '<a href=javascript:goModify(' + options.rowId + ')>' + cellvalue + '<//a>';
    }

    /******************************************
	 * jqGrid 수정페이지 링크
	 ******************************************/
	function linkUpdate1(cellvalue, options, rowObject) {
		return '<a href=javascript:goModify1(' + options.rowId + ')>' + cellvalue + '<//a>';
	}

	/******************************************
	 * 수정
	 ******************************************/
	function goModify1(rowId) {
		var ret = J("#list").jqGrid('getRowData',rowId);
		J("#codeId").val(ret.CODE_ID);
		J("#year").val(J("#findYear").val());
		J("#codeGrpId").val(J("#findCodeGrpId").val());
		J("#useYn").val(J("#findUseYn").val());
		J("#mode").val("MOD1");
		J("#formList").attr("action", "$!{context_path}/prs/emp/prsEvalExc/prsEvalExcNew.vw?type=template").submit();
	}

    /******************************************
     * 수정
     ******************************************/
    function goModify(rowId) {
        var ret = J("#list").jqGrid('getRowData',rowId);

        J("#year").val(J("#findYear").val());
        J("#mode").val("MOD");
		J("#exceptCd").val(ret.CODE_ID);
        J("#formList").attr("action", "$!{context_path}/prs/emp/prsEvalExc/prsEvalExcModify.vw?type=template").submit();
    }

    /******************************************
     * 삭제
     ******************************************/
    function goDelete() {
        if(!J.gridSelectChk("list")){
            J.showMsgBox("삭제할 데이터를 선택하십시요", null, null);
        } else {
            J.showConfirmBox("삭제하시겠습니까?", "deleteDo"); //deleteDo() 콜백함수 호출
        }
    }

    /******************************************
     * 삭제처리
     ******************************************/
    function deleteDo() {
        var id = J("#list").getGridParam('selarrrow');
        var ids = J("#list").jqGrid('getDataIDs');
        var rowdata = "";
        var codeIds = "";


        for (var i = 0; i < ids.length; i++) {
            J.each(id, function (index, value) {
                if (value == ids[i]) {
                    rowdata = J("#list").getRowData(ids[i]);
                    codeIds += rowdata.CODE_ID + '|';

                }
            });
        }

		J("#codeIds").val(codeIds);
        J("#mode").val("DEL");
        J("#year").val(J("#findYear").val());
        J("#formList").attr("action", "$!{context_path}/prs/emp/prsEvalExc/prsEvalExcProcess.vw?type=template").submit();
        return false;
    }

    /******************************************
     * 엑셀다운로드
     ******************************************/
    function excelDownload(){
        J("#yearNm").val(J("#findYear > option:selected").text());
        J("#formList").attr("action", "$!{context_path}/prs/emp/prsEvalExc/prsEvalExcListExcel.vw?type=excel").submit();
        return false;
    }

//]]>
</script>

<div id="Table">
    <div id="Table_blockContainer">
        <h1 class="none">직원개인평가(평가대상제외자)</h1>
        <div class="tableTop">
            #parse("/WEB-INF/vl/common/template/tabs.vm")

            <!-- search S -->
            <form id="formFind" name="formFind" method="post" action="$!{context_path}/prs/emp/prsEvalExc/prsEvalExcList.vw?type=template">
                <input type="hidden"    id="findHighPgmId"  name="findHighPgmId"    value="$!{searchMap.txt2html("findHighPgmId")}" />
                <input type="hidden"    id="findSubPgmId"   name="findSubPgmId"     value="$!{searchMap.txt2html("findSubPgmId")}" />
                <input type="hidden"    id="findPgmId"      name="findPgmId"        value="$!{searchMap.txt2html("findPgmId")}" />
                <input type="hidden"    id="findPgmId"      name="findPgmId"        value="$!{searchMap.txt2html("findPgmId")}" />
                <input type="hidden"	id="findCodeGrpId"	name="findCodeGrpId"	value="$!{searchMap.txt2html("findCodeGrpId")}" />

                <div class="searchBox">
                    <div><div><div>
                    <table summary="직원개인평가(평가대상제외자)검색 조건">
                        <caption class="none">직원개인평가(평가대상제외자) 검색 조건</caption>
                        <thead><tr><th></th></tr></thead>
                        <tbody>
                            <tr>
                                <td class="searchBox_tit w250">
                                    <span><label for="findYear">$!{YEAR}</label></span>
                                    <span class="searchBar">
                                        <select id="findYear" name="findYear" class="select w80">
                                            $!CS_CODE.getCodeOption("017", $!{searchMap.txt2html("findYear")})
                                        </select>
                                    </span>
                                </td>
                                <!--
                                <td class="searchBox_tit w250">
                                    <span><label for="findCodeGrpNm">코드명</label></span>
                                    <span class="searchBar"><input type="text" id="findCodeGrpNm" name="findCodeGrpNm" class="text" value="$!{searchMap.txt2html("findCodeGrpNm")}"  maxlength="10" title="공통코드명 "/> </span>
                                </td>
                                <td class="searchBox_tit w250">
                                    <span><label for="findUseYn">사용여부</label></span>
                                    <span class="searchBar">
                                        <select id="findUseYn" name="findUseYn" class="select w70">
                                            $!CS_CODE.getCodeOption("011", $!{searchMap.txt2html("findUseYn")})
                                        </select>
                                    </span>
                                </td>
                                -->
                            </tr>
                        </tbody>
                    </table>
                    <input type="image" class="btnSearch" src="$!{img_path}/common/btn_search.gif" align="middle" alt="검색" />
                    </div></div></div>
                </div>
            </form>
            <!-- search E -->
            <div class="clear"></div>
        </div>

        <form id="formList" name="formList" method="post" action="$!{context_path}/prs/emp/prsEvalExc/prsEvalExcProcess.vw?type=template">
            <input type="hidden" id="mode"       name="mode" />
            <input type="hidden" id="year"       name="year" />
            <input type="hidden" id="yearNm"     name="yearNm" />
			<input type="hidden" id="exceptCd"   name="exceptCd" />
			<input type="hidden" id="codeId"	name="codeId"  		value="" />
			<input type="hidden" id="codeIds" 	name="codeIds"  	value="" />
			<input type="hidden" id="codeGrpId"	name="codeGrpId"	value="$!{searchMap.txt2html("codeGrpId")}" />

            $!{searchMap.makeHiddenFind()}
            <div id="splitterBox">
                <div>
                    <!-- 데이터그리드 Start -->
                    <div class="blockGridListTable">
                        <table id="list" summary="직원개인평가(평가대상제외자) 조회결과">
                            <caption class="none">직원개인평가(평가대상제외자) 조회</caption>
                            <thead><tr><th></th></tr></thead>
                            <tbody><tr><td></td></tr></tbody>
                        </table>
                        <div id="pager"></div>
                    </div>
                    <!--// 데이터그리드 End -->
                    <div class="blockButton_all floatLeft">
                        <div class="blockButton" style="float:left; text-align:left; width:300px;">
                            <ul>
                                <li><input type="button" id="btnProc" value="평가제외대상자가져오기" /></li>
                            </ul>
                        </div>
                        <div class="blockButton">
							<ul>
								<li><input type="button" id="btnInsert" value="신규" /></li>
								<li><input type="submit" id="btnDelete" value="삭제" /></li>
							</ul>
						</div>
                    </div>
                </div>
            </div>
        </form>

    </div>
    <div class="clear"></div>
</div>
