<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="bsc.system.attFile">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: 게시판관리 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: 
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">

        SELECT T.*                                                                      
             , (SELECT DEPT_NM FROM V_ROLE_USER WHERE USER_ID = BBS_REGISTER) AS DEPT_NM 
        FROM (
           SELECT A.*, B.BBS_TOTAL, ROWNUM AS RM                                      
           FROM (
              SELECT YEAR, T.BBS_ID, BBS_SEQ, BBS_PSEQ, BBS_SORT1, BBS_SORT2, BBS_DEPT      
               , BBS_CATEGORY, BBS_TITLE, BBS_READ, BBS_RECOMMAND, BBS_REGISTER
               , BBS_REGISTER_NAME, BBS_PASSWD, TO_CHAR(CREATE_DT,'YYYY.MM.DD HH24:MI') CREATE_DT, BBS_CONTENTS
               , CASE WHEN TO_CHAR(CREATE_DT, 'YYYYMMDD') = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN 'Y' ELSE 'N' END AS IS_NEW                
              FROM BSC_COMMON_BOARD_BODY T
              WHERE T.YEAR = #findYear# AND BBS_ID = #findBbsId# AND DELETE_DT IS NULL
              AND (BBS_CATEGORY = NVL(#findBbsCategory#, '999') OR BBS_CATEGORY IS NULL)      
              <isNotEmpty prepend="AND" property="findBbsTitle">
              	UPPER(BBS_TITLE) LIKE '%'||UPPER(#findBbsTitle#)||'%'
              </isNotEmpty>   
              <isNotEmpty prepend="AND" property="findBbsRegisterName">
              	NVL(UPPER(BBS_REGISTER_NAME),' ') LIKE '%'||UPPER(#findBbsRegisterName#)||'%'
              </isNotEmpty>
             ORDER BY BBS_PSEQ DESC, BBS_SORT2
           ) A, (                        
              SELECT COUNT(1) AS BBS_TOTAL                                            
              FROM BSC_COMMON_BOARD_BODY                                                  
              WHERE YEAR = #findYear# AND BBS_ID = #findBbsId# AND DELETE_DT IS NULL                                  
              AND (BBS_CATEGORY = NVL(#findBbsCategory#, '999') OR BBS_CATEGORY IS NULL )   
              <isNotEmpty prepend="AND" property="findBbsTitle">
              	UPPER(BBS_TITLE) LIKE '%'||UPPER(#findBbsTitle#)||'%'
              </isNotEmpty>                      
              <isNotEmpty prepend="AND" property="findBbsRegisterName">
              	NVL(UPPER(BBS_REGISTER_NAME),' ') LIKE '%'||UPPER(#findBbsRegisterName#)||'%'
              </isNotEmpty>
          ) B
          ORDER BY BBS_PSEQ DESC, BBS_SORT2
        ) T

	</select>
	
	<!--
	==================================================================   
	  # 설명	: 게시판관리 상세 보기
	  #	기능	: SELECT
	  #	TABLE	: 
	==================================================================
	-->
	<select id="getDetail" parameterClass="hashMap" resultClass="hashMap">
           
		SELECT YEAR, BBS_ID, BBS_SEQ, BBS_PSEQ, BBS_SORT1, BBS_SORT2, BBS_DEPT, BBS_CATEGORY      
		, BBS_TITLE, BBS_CONTENTS, BBS_READ, BBS_RECOMMAND, BBS_REGISTER, BBS_REGISTER_NAME 
		, BBS_PASSWD, CREATE_DT, UPDATE_DT                                                  
		, (SELECT DEPT_NM FROM V_ROLE_USER WHERE USER_ID = BBS_REGISTER) AS DEPT_NM         
		FROM BSC_COMMON_BOARD_BODY T                                                            
		WHERE YEAR = #findYear# AND BBS_ID = #findBbsId# AND BBS_SEQ = #bbsSeq#                                                    
		           
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 게시판관리 수정
	  #	기능	: UPDATE
	  #	TABLE	: 
	==================================================================
	-->	
	<update id="updateData" parameterClass="hashMap">
		
		UPDATE BSC_COMMON_BOARD_BODY SET                   
		       BBS_CATEGORY = #bbsCategory#, BBS_TITLE = #bbsTitle#,        
		       BBS_CONTENTS = #bbsContents#, UPDATE_DT = SYSDATE   
		WHERE YEAR = #findYear# AND BBS_ID = #findBbsId# AND BBS_SEQ = #bbsSeq#              
		
	</update>	
	
	
	<!--
	==================================================================   
	  # 설명	: 내부경영평가편람여부 체크
	  #	기능	: UPDATE
	  #	TABLE	: 
	==================================================================
	-->	
	<select id="selectCount" parameterClass="hashMap" resultClass="String">
		
		SELECT COUNT(YEAR) CNT                                   
		  FROM BSC_INTERMANUAL_ATTACH A                 
		 WHERE A.YEAR = #findYear#          
		
	</select>

	<!--
	==================================================================   
	  # 설명	: 첨부파일 등록
	  #	기능	: INSERT
	  #	TABLE	: BSC_COMMON_BOARD_ATTACH
	==================================================================
	-->	
	<insert id="insertFileInfo" parameterClass="hashMap">
		INSERT INTO BSC_INTERMANUAL_ATTACH (
			   YEAR	
             , ATTACH_FILE_NM
             , ATTACH_FILE_FNM
             , ATTACH_FILE_SUFFIX
             , ATTACH_FILE_PATH
             , CREATE_DT
           ) VALUES (
           	   #findYear#	
             , #attachFileNm#
             , #attachFileFnm#
             , #attachFileSufix#
             , #attachFilePath#
             , SYSDATE
    	   )       
	</insert>
	
	<!--
	==================================================================   
	  # 설명	: 첨부파일 삭제
	  #	기능	: INSERT
	  #	TABLE	: BSC_COMMON_BOARD_ATTACH
	==================================================================
	-->	
	<delete id="deleteFileInfo" parameterClass="hashMap">
		DELETE FROM BSC_INTERMANUAL_ATTACH
		 WHERE YEAR = #findYear# 
	</delete>
	
	<!--
	==================================================================   
	  # 설명	: 상세 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_COMMON_BOARD_ATTACH
	==================================================================
	-->
	<select id="getFileList" parameterClass="hashMap" resultClass="hashMap">
 		SELECT A.YEAR
 			 , A.ATTACH_FILE_NM
	         , A.ATTACH_FILE_FNM
	         , A.ATTACH_FILE_SUFFIX
	         , F_ENCRYPT(A.ATTACH_FILE_PATH, #encryptionCode#) ATTACH_FILE_PATH 
         FROM BSC_INTERMANUAL_ATTACH A
        WHERE A.YEAR = #findYear#
	</select>
	
</sqlMap>


