<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="product">

<typeAlias alias="ValueMap" type="egovframework.airyami.cmm.util.ValueMap"/>
	
	<select id="product.getProductCount" parameterClass="Map" resultClass="java.lang.Integer">
	SELECT /* Product_Mysql.xml  product.getProductCount */
	       COUNT(1) 
	  FROM TB_PRODUCT_MASTER A
	     , TB_PRODUCT_NAME B
	 WHERE 1 = 1
	   AND A.PROD_NO = B.PROD_NO
	   AND B.LANG_CD = #LANG_CD#
	 <isNotEmpty property="SEARCH_PROD_NO">
	   AND A.PROD_NO = #SEARCH_PROD_NO#
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_PROD_NM">
	   AND (
	   		B.PROD_NM LIKE CONCAT('%',#SEARCH_PROD_NM#,'%')
	   		B.PROD_SHORT_NM LIKE CONCAT('%',#SEARCH_PROD_NM#,'%')
	   		)
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_PROD_CATE_CD">
	   AND A.PROD_CATE_CD = #SEARCH_PROD_CATE_CD#
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_PROD_MID_CD">
	   AND A.PROD_MID_CD = #SEARCH_PROD_MID_CD#
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_PROD_GRP_CD">
	   AND A.PROD_GRP_CD = #SEARCH_PROD_GRP_CD#
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_BRAND_CD">
	   AND A.BRAND_CD = #SEARCH_BRAND_CD#
	 </isNotEmpty>
	</select>
	
	<select id="product.getProductList" parameterClass="Map" resultClass="ValueMap" remapResults="true">
	<isEqual property="EXCEL_YN" compareValue="N">
	<include refid="pagingPrefixSQL"/>
	</isEqual>
	SELECT /* Product_Mysql.xml  product.getProductList */
           A.PROD_NO             
         , B.PROD_NM
         , B.PROD_SHORT_NM  
         , A.BRAND_CD
         , FN_GET_CODE_NM('BRAND', A.BRAND_CD, #LANG_CD#) AS BRAND_NM  
         , A.PROD_CATE_CD 
         , A.PROD_MID_CD 
         , A.PROD_GRP_CD
         , '대분류>중분류>소분류' AS CATEGORY_NM
         , A.WORKING_YN          
         , A.SELLER_BIZ_ENTITY_ID
         , A.MAKE_COUNTRY        
         , A.SUPPLY_COUNTRY      
         , A.SUPPLY_CURRENCY     
         , A.ORG_PRICE           
         , A.DUTY_FREE_YN        
         , A.VOLUME_UNIT         
         , A.VOLUME              
         , A.WEIGHT_NIT          
         , A.WEIGHT              
         , A.SALES_SKU           
         , A.PER_BOX_PROD_CNT    
         , A.SELL_VALID_MONTHS   
         , A.SEEN_CUSTOMER_YN    
         , A.SEEN_PARTNER_YN     
         , A.SALES_START_DT      
         , A.SALES_END_DT      
	  FROM TB_PRODUCT_MASTER A
	     , TB_PRODUCT_NAME B
	 WHERE 1 = 1
	   AND A.PROD_NO = B.PROD_NO
	   AND B.LANG_CD = #LANG_CD#
	 <isNotEmpty property="SEARCH_PROD_NO">
	   AND A.PROD_NO = #SEARCH_PROD_NO#
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_PROD_NM">
	   AND (
	   		B.PROD_NM LIKE CONCAT('%',#SEARCH_PROD_NM#,'%')
	   		B.PROD_SHORT_NM LIKE CONCAT('%',#SEARCH_PROD_NM#,'%')
	   		)
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_PROD_CATE_CD">
	   AND A.PROD_CATE_CD = #SEARCH_PROD_CATE_CD#
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_PROD_MID_CD">
	   AND A.PROD_MID_CD = #SEARCH_PROD_MID_CD#
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_PROD_GRP_CD">
	   AND A.PROD_GRP_CD = #SEARCH_PROD_GRP_CD#
	 </isNotEmpty>
	 <isNotEmpty property="SEARCH_BRAND_CD">
	   AND A.BRAND_CD = #SEARCH_BRAND_CD#
	 </isNotEmpty>
	 <isNotEmpty property="SORT_COL">
	 	<include refid="orderbySQL"/>
	 </isNotEmpty>
	 <isEmpty property="SORT_COL">
	 ORDER BY A.INSERT_DT DESC
	 </isEmpty>
	<isEqual property="EXCEL_YN" compareValue="N">
	<include refid="pagingSuffixSQL"/>
	</isEqual>
	</select>
 
	<!-- TB_PRODUCT_MASTER 상세조회 -->
	<select id="product.getProductDetail" parameterClass="Map" resultClass="ValueMap">
	SELECT /* Product_Mysql.xml  product.getProductDetail */
           PROD_NO             
         , BRAND_CD            
         , PROD_CATE_CD
         , PROD_MID_CD      
         , PROD_GRP_CD         
         , WORKING_YN          
         , SELLER_BIZ_ENTITY_ID
         , MAKE_COUNTRY        
         , SUPPLY_COUNTRY      
         , SUPPLY_CURRENCY     
         , ORG_PRICE           
         , DUTY_FREE_YN        
         , VOLUME_UNIT         
         , VOLUME              
         , WEIGHT_NIT          
         , WEIGHT              
         , SALES_SKU           
         , PER_BOX_PROD_CNT    
         , SELL_VALID_MONTHS   
         , SEEN_CUSTOMER_YN    
         , SEEN_PARTNER_YN     
         , SALES_START_DT      
         , SALES_END_DT     
	  FROM TB_PRODUCT_MASTER A
	 WHERE A.PROD_NO= #SEARCH_PROD_NO#
	</select>
	
	<!-- TB_CODE 코드명 조회 -->
	<select id="product.getProductNameList" parameterClass="Map" resultClass="ValueMap" remapResults="true">
	SELECT /* Comm_Code_Mysql.xml  commcode.getCodeNameList */
	       LANG_CD
		 , A.PROD_SHORT_NM
		 , A.PROD_NM
		 , A.PRODUCT_EXPL_TEXT
	  FROM TB_PRODUCT_NAME A
	 WHERE 1 = 1
	   AND A.PROD_NO= #SEARCH_PROD_NO#
	</select>
	
	<select id="product.getProdNo" parameterClass="Map" resultClass="java.lang.String">
	SELECT /* Company_Mysql.xml  product.getProdNo */
		   CONCAT(#SUPPLY_COUNTRY#,  
	              IFNULL((SELECT 
	                            LPAD(MAX(SUBSTR(PROD_NO, 3, 5))+1, 5, '0') AS SERIAL_NO
	                        FROM
	                            TB_PRODUCT_MASTER), '00001'))
      FROM DUAL;
	</select>
	
	<insert id="product.insertProduct" parameterClass="Map">
	INSERT /* Product_Mysql.xml  product.insertProduct */
	  INTO TB_PRODUCT_MASTER
		(
           BRAND_CD            
         , PROD_CATE_CD
         , PROD_MID_CD      
         , PROD_GRP_CD         
         , WORKING_YN          
         , SELLER_BIZ_ENTITY_ID
         , MAKE_COUNTRY        
         , SUPPLY_COUNTRY      
         , SUPPLY_CURRENCY     
         , ORG_PRICE           
         , DUTY_FREE_YN        
         , VOLUME_UNIT         
         , VOLUME              
         , WEIGHT_NIT          
         , WEIGHT              
         , SALES_SKU           
         , PER_BOX_PROD_CNT    
         , SELL_VALID_MONTHS   
         , SEEN_CUSTOMER_YN    
         , SEEN_PARTNER_YN     
         , SALES_START_DT      
         , SALES_END_DT     
		 , INSERT_USER_ID
		 , INSERT_DT)
		VALUES
		(
           #BRAND_CD#
         , #PROD_CATE_CD#
         , #PROD_MID_CD#
         , #PROD_GRP_CD#
         , #WORKING_YN#
         , #SELLER_BIZ_ENTITY_ID#
         , #MAKE_COUNTRY#
         , #SUPPLY_COUNTRY#
         , #SUPPLY_CURRENCY#
         , #ORG_PRICE#
         , #DUTY_FREE_YN#
         , #VOLUME_UNIT#
         , #VOLUME#
         , #WEIGHT_NIT#
         , #WEIGHT#
         , #SALES_SKU#
         , #PER_BOX_PROD_CNT#
         , #SELL_VALID_MONTHS#
         , #SEEN_CUSTOMER_YN#
         , #SEEN_PARTNER_YN#
         , #SALES_START_DT#
         , #SALES_END_DT# 
		 , #LOGIN_ID#
		 , DATE_FORMAT(now(), '%Y%m%d%H%i%s')
		)
	</insert>
	
	<update id="product.updateProduct" parameterClass="Map">
	UPDATE /* Product_Mysql.xml  product.updateProduct */
	       TB_PRODUCT_MASTER
	   SET BRAND_CD               = #BRAND_CD#    
         , PROD_CATE_CD           = #PROD_CATE_CD#
         , PROD_MID_CD            = #PROD_MID_CD#
         , PROD_GRP_CD            = #PROD_GRP_CD#
         , WORKING_YN             = #WORKING_YN#
         , SELLER_BIZ_ENTITY_ID   = #SELLER_BIZ_ENTITY_ID#
         , MAKE_COUNTRY           = #MAKE_COUNTRY#
         , SUPPLY_COUNTRY         = #SUPPLY_COUNTRY#
         , SUPPLY_CURRENCY        = #SUPPLY_CURRENCY#
         , ORG_PRICE              = #ORG_PRICE#
         , DUTY_FREE_YN           = #DUTY_FREE_YN#
         , VOLUME_UNIT            = #VOLUME_UNIT#
         , VOLUME                 = #VOLUME#
         , WEIGHT_NIT             = #WEIGHT_NIT#
         , WEIGHT                 = #WEIGHT#
         , SALES_SKU              = #SALES_SKU#
         , PER_BOX_PROD_CNT       = #PER_BOX_PROD_CNT#
         , SELL_VALID_MONTHS      = #SELL_VALID_MONTHS#
         , SEEN_CUSTOMER_YN       = #SEEN_CUSTOMER_YN#
         , SEEN_PARTNER_YN        = #SEEN_PARTNER_YN#
         , SALES_START_DT         = #SALES_START_DT#
         , SALES_END_DT           = #SALES_END_DT#
	     , UPDATE_PROD_NO         = #LOGIN_ID#
	     , UPDATE_DT              = DATE_FORMAT(now(), '%Y%m%d%H%i%s')
	 WHERE PROD_NO                = #PROD_NO#
	</update>
	
	<insert id="product.saveProdNm" parameterClass="Map">
	INSERT /* Product_Mysql.xml  product.saveProdNm */
	  INTO TB_PRODUCT_NAME
		(
		   PROD_NO
		 , LANG_CD
		 , PROD_NM
		 , PROD_SHORT_NM
		 , PRODUCT_EXPL_TEX
		 , INSERT_USER_ID
		 , INSERT_DT)
		VALUES
		(
		   #PROD_NO#
		 , #LANG_CD#
		 , #PROD_NM#
		 , #PROD_SHORT_NM#
		 , #PRODUCT_EXPL_TEX#
		 , #LOGIN_ID#
		 , DATE_FORMAT(now(), '%Y%m%d%H%i%s')
		)
	ON DUPLICATE KEY UPDATE
		   PROD_NM = #PROD_NM#
		 , PROD_SHORT_NM = #PROD_SHORT_NM#
		 , PRODUCT_EXPL_TEX = #PRODUCT_EXPL_TEX#
		 , UPDATE_USER_ID = #LOGIN_ID#,
		 , UPDATE_DT = DATE_FORMAT(now(), '%Y%m%d%H%i%s'
		)
	</insert>
	
	<delete id="product.deleteProduct" parameterClass="Map">
	DELETE /* Product_Mysql.xml  product.deleteProduct */
	  FROM TB_PRODUCT_MASTER
	 WHERE PROD_NO = #PROD_NO#
	</delete>
	
	<delete id="product.deleteProductNm" parameterClass="Map">
	DELETE /* Product_Mysql.xml  product.deleteProductNm */
	  FROM TB_PRODUCT_NAME
	 WHERE PROD_NO = #PROD_NO#
	</delete>
</sqlMap>