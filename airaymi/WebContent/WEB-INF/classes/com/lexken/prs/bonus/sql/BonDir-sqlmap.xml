<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="prs.bonus.bonDir">

	<!--
	==================================================================
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: BON_DIR
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />


	<!--
	==================================================================
	  # 설명	: 임원성과연봉 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BON_DIR
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT
			  D.YEAR
			, D.EMPN
			, P.KOR_NM
			, C.DEPT_KOR_NM
			, D.DEPT_CD
			, D.CAST_TC
			, O.CODE_NM AS CAST_TC_NM
			, D.POS_TC
			, E.CODE_NM AS POS_TC_NM
			, (  SELECT MIN (ORG_PCMT_DATE) ORG_PCMT_DATE
                              FROM BSC_INSA_PCMT BB
                          GROUP BY BB.EMPN
                            HAVING BB.EMPN = D.EMPN)  ORG_PCMT_DATE
         	, (  SELECT MIN (START_PCMT_DATE) START_PCMT_DATE
                              FROM BSC_INSA_PCMT BB
                          GROUP BY BB.EMPN
                            HAVING BB.EMPN = D.EMPN) START_PCMT_DATE
            , (  SELECT MAX (END_PCMT_DATE) END_PCMT_DATE
                              FROM BSC_INSA_PCMT BB
                          GROUP BY BB.EMPN
                            HAVING BB.EMPN = D.EMPN) END_PCMT_DATE
			, TO_CHAR(D.SALARY) AS SALARY
			, D.RATE
			, D.WORK_MON
			, TO_CHAR(NVL(D.VERI_TOT_BON_SAL, D.TOT_BON_SAL)) AS TOT_BON_SAL
			, D.CONTENT
			, DECODE(D.POS_TC,'02','01', D.POS_TC) POS_TC_ORDER
		FROM BON_DIR_CONF D
		LEFT OUTER JOIN BSC_INSA_DEPT C
					ON D.YEAR = C.YEAR
					AND D.DEPT_CD = C.DEPT_CD
 		LEFT OUTER JOIN BSC_CODE O
					ON O.CODE_GRP_ID = '170'
					AND D.YEAR = O.YEAR
					AND D.CAST_TC = O.CODE_ID
		LEFT OUTER JOIN BSC_CODE E
					ON E.CODE_GRP_ID = '171'
					AND D.YEAR = E.YEAR
					AND D.POS_TC = E.CODE_ID
		LEFT OUTER JOIN BSC_INSA P
					ON D.YEAR = P.YEAR
					AND D.EMPN = P.EMPN
		WHERE D.YEAR = #findYear#
	    AND D.DEPT_CD NOT IN ('1040 ', '1050')
        AND D.POS_TC NOT IN ('06', '08')
		ORDER BY POS_TC_ORDER, DEPT_CD DESC
	</select>

	<!--
    ==================================================================
      # 설명  : 임원성과연봉 수정
      # 기능  : INSERT
      # TABLE : BON_DIR_CONF
    ==================================================================
    -->
	<insert id="insertData" parameterClass="hashMap">
		INSERT INTO BON_DIR_CONF (
			  YEAR
			, EMPN
			, DEPT_CD
			, CAST_TC
			, POS_TC
			, SALARY
			, RATE
			, WORK_MON
			, TOT_BON_SAL
		) VALUES (
			  #findYear#
			, #empn#
			, #deptCd#
			, #castTc#
			, #posTc#
			, #salary#
			, #rate#
			, #workMon#
			, #totBonSal#
				)
	</insert>

	<!--
    ==================================================================
      # 설명    : 임원성과연봉 삭제
      # 기능    : DELETE
      # TABLE   : BON_DIR_CONF
    ==================================================================
    -->
    <delete id="deleteData" parameterClass="hashMap">
        DELETE FROM BON_DIR_CONF
         WHERE YEAR				= #findYear#

    </delete>



</sqlMap>


