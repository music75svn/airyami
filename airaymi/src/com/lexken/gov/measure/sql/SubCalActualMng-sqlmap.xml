<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="gov.measure.subCalActualMng">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: 세부요소입력 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: GOV_SUB_CAL
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.YEAR
	         , A.SUB_CAL_ID
	         , A.SUB_CAL_NM
	         , A.UNIT
	         , F_CODE_NM('013', A.UNIT, A.YEAR) UNIT_NM
	         , A.INSERT_USER_ID
	         , C.USER_NM
	         , MAX(CASE WHEN B.MON = '01' THEN B.ACTUAL END) ACTUAL_01
	         , MAX(CASE WHEN B.MON = '02' THEN B.ACTUAL END) ACTUAL_02
	         , MAX(CASE WHEN B.MON = '03' THEN B.ACTUAL END) ACTUAL_03
	         , MAX(CASE WHEN B.MON = '04' THEN B.ACTUAL END) ACTUAL_04
	         , MAX(CASE WHEN B.MON = '05' THEN B.ACTUAL END) ACTUAL_05
	         , MAX(CASE WHEN B.MON = '06' THEN B.ACTUAL END) ACTUAL_06
	         , MAX(CASE WHEN B.MON = '07' THEN B.ACTUAL END) ACTUAL_07
	         , MAX(CASE WHEN B.MON = '08' THEN B.ACTUAL END) ACTUAL_08
	         , MAX(CASE WHEN B.MON = '09' THEN B.ACTUAL END) ACTUAL_09
	         , MAX(CASE WHEN B.MON = '10' THEN B.ACTUAL END) ACTUAL_10
	         , MAX(CASE WHEN B.MON = '11' THEN B.ACTUAL END) ACTUAL_11
	         , MAX(CASE WHEN B.MON = '12' THEN B.ACTUAL END) ACTUAL_12
		FROM GOV_SUB_CAL A
	          LEFT OUTER JOIN GOV_SUB_CAL_ACTUAL B ON A.YEAR = B.YEAR AND A.SUB_CAL_ID = B.SUB_CAL_ID
	          LEFT OUTER JOIN V_ROLE_USER C ON A.INSERT_USER_ID = C.USER_ID  
		WHERE A.YEAR = #findYear#
        
        <dynamic>
			<isNotEmpty prepend="AND" property="findInsertUserId">
	            A.INSERT_USER_ID = #findInsertUserId#
		   	</isNotEmpty>
		   	<isNotEmpty prepend="AND" property="findSubCalNm">
		   		UPPER(A.SUB_CAL_NM) LIKE  '%' || TRIM(UPPER(#findSubCalNm#)) ||'%'
		   	</isNotEmpty>
		</dynamic> 
		
		GROUP BY A.YEAR, A.SUB_CAL_ID, A.SUB_CAL_NM, A.UNIT, A.INSERT_USER_ID, C.USER_NM, A.SORT_ORDER
		ORDER BY A.SORT_ORDER   
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 세부요소입력 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: GOV_SUB_CAL
	==================================================================
	-->
	<select id="getInsertUserList" parameterClass="hashMap" resultClass="hashMap">
		SELECT DISTINCT
		       A.INSERT_USER_ID
		     , B.USER_NM AS INSERT_USER_NM
		FROM GOV_SUB_CAL A
		     INNER JOIN V_ROLE_USER B ON A.INSERT_USER_ID = B.USER_ID
		WHERE A.YEAR = #findYear#
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 세부요소입력 등록
	  #	기능	: INSERT
	  #	TABLE	: 
	==================================================================
	-->	
	<insert id="insertData" parameterClass="hashMap">
		INSERT INTO GOV_SUB_CAL_ACTUAL (
		       YEAR
		     , MON
		     , SUB_CAL_ID
		     , ACTUAL
		     , CREATE_DT 
			 ) VALUES (
			   #year#
		     , #mon#
		     , #subCalId#
		     , #actual#
		     , SYSDATE 
			 )
	</insert>	

	<!--
	==================================================================   
	  # 설명	: 세부요소입력 삭제
	  #	기능	: UPDATE
	  #	TABLE	: 
	==================================================================
	-->	
	<update id="deleteData" parameterClass="hashMap">
		DELETE FROM GOV_SUB_CAL_ACTUAL
		 WHERE YEAR = #year#
           AND SUB_CAL_ID = #subCalId#
	</update>
	
	<!--
	==================================================================   
	  # 설명	: 파라미터 맵
	  #	기능	: SETTING
	  #	TABLE	: 
	==================================================================
	-->
	<parameterMap id="paramMap" class="java.util.HashMap">
		<parameter property="year" 			jdbcType="VARCHAR"  javaType="java.lang.String" mode="IN"/>	
	</parameterMap>			
	
	<!--
	==================================================================   
	  # 설명	: 실적등록
	  #	기능	: PROCEDURES
	  #	TABLE	: BSC_ACTUAL
	==================================================================
	-->
	<procedure id="execDB" parameterMap="paramMap">  
		{CALL SP_GOV_ACTUAL_KGS(?)}
	</procedure>	
	
	
</sqlMap>


