<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="mem.base.memNonMetricRate">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: MEM_NON_METRIC_RATE
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />

	<!--
	==================================================================   
	  # 설명	: 비계량지표평가자비율설정 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: MEM_NON_METRIC_RATE
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT
		       #findYear# AS YEAR
			 , A.CODE_ID AS EVAL_USER_GUBUN_ID
		     , A.CODE_NM AS EVAL_USER_GUBUN_NM
		     , B.EVAL_RATE
		  FROM BSC_CODE A
		     , MEM_NON_METRIC_RATE B
		 WHERE A.CODE_ID = B.EVAL_USER_GUBUN_ID(+)
		   AND A.CODE_GRP_ID = '237'
		   AND A.DELETE_DT IS NULL
		   AND B.YEAR(+) = #findYear#
		   AND A.CODE_ID != '03'
		   AND A.YEAR IN (SELECT CASE YEAR_YN WHEN 'Y' THEN #findYear# ELSE '9999' END FROM BSC_CODE_GRP WHERE CODE_GRP_ID = '237' AND DELETE_DT IS NULL)    
		 ORDER BY A.SORT_ORDER
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 비계량지표평가자비율설정 정렬순서 일괄 저장
	  #	기능	: UPDATE
	  #	TABLE	: MEM_NON_METRIC_RATE
	==================================================================
	-->	
	<insert id="allSaveData" parameterClass="hashMap">
	 	 MERGE INTO MEM_NON_METRIC_RATE A
		       USING (SELECT #findYear# YEAR, #evalUserGubunId# EVAL_USER_GUBUN_ID FROM DUAL) B
		          ON (A.YEAR = B.YEAR AND A.EVAL_USER_GUBUN_ID = B.EVAL_USER_GUBUN_ID)
		  WHEN MATCHED THEN
		       UPDATE SET 
		              EVAL_RATE = #evalRate#
		            , MODIFY_DT = SYSDATE
		  WHEN NOT MATCHED THEN
		       INSERT (
		              YEAR
		            , EVAL_USER_GUBUN_ID
		            , EVAL_RATE
		            , CREATE_DT
		       ) VALUES (
		              #findYear#
		            , #evalUserGubunId#
		            , #evalRate#
		            , SYSDATE
		       )		             
	</insert>	
	

</sqlMap>


