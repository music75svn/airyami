#*************************************************************************
* CLASS 명		: targetTree.vm
* 작 업 자		: 안요한
* 작 업 일		: 2013년 05월 08일 
* 기    능			: 지표목표입력 트리
* ---------------------------- 변 경 이 력 --------------------------------
* 번호  작 업 자     작   업   일           변 경 내 용             비고
* ----  --------  -----------------  -------------------------    --------
*   1    안 요 한     2013년 05월 08일         최 초 작 업 
**************************************************************************#

<script language="javascript" type="text/javascript">
//<![CDATA[

	var J = jQuery;
	
	J(document).ready(function(){
	
		//하위 노드가 없는 엘리먼트 삭제
		J("#treeData ul:empty").remove();
		
		//디폴트 선택 엘리먼트 설정
		var choiceElement = J("#$!{searchMap.txt2html("csfId")}");

		choiceElement.children().addClass("choiceTreeNode");
		
		//디폴트 선택된 엘리먼트의 상위 엘리먼트를 펼쳐진 상태로 설정
		for(var i = 0; i < 10; i++) {
			choiceElement.addClass("expanded");
			choiceElement = choiceElement.parent().parent();
			
			if(choiceElement.attr("id") == "tree") break;
		}
		
		//dyna 트리 기본설정
		J(".deptTree").dynatree({
			checkbox: true,
			selectMode: 3,
			onActivate: function(node) {
				try {
					J(".deptTree div").removeClass("choiceTreeNode");
					goAction(node.data.key, node.data.title);
				} catch(error) {}
			},
			onDblClick: function(node, event) {
				try {
					goDblClickAction(node.data.key, node.data.title);
				} catch(error) {}
			},
			onClick: function(node, event) {
				try {
					goClickAction(node.data.key, node.data.title);
				} catch(error) {}
			}
		});
	
		//입력완료 상태가 아닌 노드는 체크박스 제외
		var tree = J("#tree").dynatree("getTree");
		var node;
		#if($!{searchMap.txt2html("findActualType")} == "input")
    		#foreach($list in $mngTreeList4)
    			#if($!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "01" || $!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "03" || $!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "04" || $!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "06")
        			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.MAN_KPI_ID)}");
        			node.data.hideCheckbox = true;
    				node.data.unselectable = true;
    				//node.select = true;
        			node.render(true);
    			#end
    		#end
		#elseif($!{searchMap.txt2html("findActualType")} == "check")
			#foreach($list in $mngTreeList4)
    			#if($!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "01" || $!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "02" || $!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "03" || $!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "04" || $!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "05")
        			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.MAN_KPI_ID)}");
        			node.data.hideCheckbox = true;
    				node.data.unselectable = true;
    				//node.select = true;
        			node.render(true);
    			#end
    		#end
		#else
			#foreach($list in $mngTreeList4)
    			#if($!{CS_HTML.txt2html($list.TGT_STATUS_ID)} == "01" || $!{CS_HTML.txt2html($list.TGT_STATUS_ID)} != "03" && $!{CS_HTML.txt2html($list.TGT_STATUS_ID)} != "04"  )
        			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.MAN_KPI_ID)}");
        			node.data.hideCheckbox = true;
    				node.data.unselectable = true;
    				//node.select = true;
        			node.render(true);
    			#end
    		#end
		#end
		
	});
	
	function fncSelecter(selectAll){
	
		var flag = false;
		var rootNode = J(".deptTree").dynatree("getRoot");
		var children = rootNode.getChildren() ;
		
		var tree = J(".deptTree").dynatree("getTree");
	
		if(children != null){
		 	flag = true
		}
		
		if(selectAll && flag){
			//전체 체크박스 선택		
            #foreach($list in $mngTreeList1)
    			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.MAN_ID)}");
    			node.select();
    		#end

			#foreach($list in $mngTreeList2)
    			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.STRAT_ID)}");
    			node.select();
    		#end

			#foreach($list in $mngTreeList3)
    			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.CSF_ID)}");
    			node.select();
    		#end

			#foreach($list in $mngTreeList4)
    			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.MAN_KPI_ID)}");
    			node.select();
    		#end
			
		}else if (!selectAll && flag){
			//전체 체크박스 해제
			
			#foreach($list in $mngTreeList1)
    			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.MAN_ID)}");
    			node.select(false);
    		#end

			#foreach($list in $mngTreeList2)
    			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.STRAT_ID)}");
    			node.select(false);
    		#end

			#foreach($list in $mngTreeList3)
    			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.CSF_ID)}");
    			node.select(false);
    		#end

			#foreach($list in $mngTreeList4)
    			node = tree.getNodeByKey("$!{CS_HTML.txt2html($list.MAN_KPI_ID)}");
    			node.select(false);
    		#end
		}
	}
	
//]]>
</script>


<div id="tree" class="deptTree">
    <ul id="treeData" class="none">
		#foreach($list1 in $mngTreeList1)
		<li id="$!{CS_HTML.txt2html($list1.MAN_ID)}" class="expanded">
			<div class="$!{CS_HTML.txt2html($list1.PARAM)}" dpetClass="1">$!{CS_HTML.txt2html($list1.MAN_NM)}</div>
    			<ul>
    				#foreach($list2 in $mngTreeList2)
    					#if($list1.MAN_ID == $list2.MAN_ID)
    					<li id="$!{CS_HTML.txt2html($list2.STRAT_ID)}"  class="expanded">
    						<div class="$!{CS_HTML.txt2html($list2.PARAM)}" dpetClass="2">$!{CS_HTML.txt2html($list2.STRAT_NM)}</div>
    						<ul>
    							#foreach($list3 in $mngTreeList3)
			    					#if($list2.STRAT_ID == $list3.STRAT_ID)
			    					<li id="$!{CS_HTML.txt2html($list3.CSF_ID)}"  class="expanded">
			    						<div class="$!{CS_HTML.txt2html($list3.PARAM)}" dpetClass="3">$!{CS_HTML.txt2html($list3.CSF_NM)}</div>
			    						<ul>
			    							#foreach($list4 in $mngTreeList4)
							    				#if($list3.CSF_ID == $list4.CSF_ID)
							    				<li id="$!{CS_HTML.txt2html($list4.MAN_KPI_ID)}">
							    					<div class="$!{CS_HTML.txt2html($list4.TGT_STATUS_ID)}" dpetClass="4"></div>
							    					<div class="$!{CS_HTML.txt2html($list4.TGT_STATUS_ID)}" dpetClass="4">($!{CS_HTML.txt2html($list4.TGT_STATUS_NM)}) $!{CS_HTML.txt2html($list4.MAN_KPI_NM)}</div>
		    									</li>
			    								#end
			    							#end
			    						</ul>	
			    					</li>
							    	#end
						    	#end		
						   </ul>
						</li>
						#end	   
					#end
    			</ul>
    		</li>
    	#end
    <ul>
</div> 



 