<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="bsc.ahp.ahpItemMapping">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: BSC_AHP_EVAL_USER_GRP 
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 

	<!--
	==================================================================   
	  # 설명	: AHP 평가대상그룹매핑 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: BSC_AHP_EVAL_USER_GRP 
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.YEAR
             , A.EVAL_USER_GRP_ID
             , A.EVAL_USER_GRP_NM 
             , C.ITEM_GRP_ID
             , C.ITEM_GRP_NM 
             , B.TOT_WEIGHT
             , COUNT(A.YEAR) OVER(PARTITION BY A.YEAR, A.EVAL_USER_GRP_ID) AS USER_GRP_CNT
             , ROW_NUMBER() OVER(PARTITION BY A.YEAR, A.EVAL_USER_GRP_ID ORDER BY A.SORT_ORDER, C.SORT_ORDER) AS USER_GRP_INDEX
		FROM BSC_AHP_EVAL_USER_GRP A
		         LEFT OUTER JOIN BSC_AHP_EVAL_MAPPING B ON A.YEAR = B.YEAR AND A.EVAL_USER_GRP_ID = B.EVAL_USER_GRP_ID
		         LEFT OUTER JOIN BSC_AHP_ITEM_GRP C ON B.YEAR = C.YEAR AND B.ITEM_GRP_ID = C.ITEM_GRP_ID 
		WHERE A.YEAR = #findYear#
		
		  <isNotEmpty prepend="AND" property="findEvalUserGrpId">
		  	A.EVAL_USER_GRP_ID = #findEvalUserGrpId#
		  </isNotEmpty>
		  
		ORDER BY A.SORT_ORDER, C.SORT_ORDER
	</select>
	
	<!--
	==================================================================   
	  # 설명	: AHP 평가대상그룹 전체 조회
	  #	기능	: SELECT
	  #	TABLE	: BSC_AHP_ITEM_GRP
	==================================================================
	-->
	<select id="getTotList" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.YEAR 
		     , A.ITEM_GRP_ID
		     , A.ITEM_GRP_NM
		 FROM BSC_AHP_ITEM_GRP A
		WHERE A.YEAR = #year#
		  AND A.ITEM_GRP_ID NOT IN ( SELECT ITEM_GRP_ID
		                               FROM BSC_AHP_EVAL_MAPPING
		                              WHERE YEAR = #year#
		                                AND EVAL_USER_GRP_ID = #evalUserGrpId#) 
		ORDER BY A.SORT_ORDER
	</select>
	
	<!--
	==================================================================   
	  # 설명	: AHP 평가대상그룹 전체 조회
	  #	기능	: SELECT
	  #	TABLE	: BSC_AHP_ITEM_GRP
	==================================================================
	-->
	<select id="getSelList" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.YEAR 
		     , A.ITEM_GRP_ID
		     , A.ITEM_GRP_NM
		 FROM BSC_AHP_ITEM_GRP A
		WHERE A.YEAR = #year#
		  AND A.ITEM_GRP_ID IN ( SELECT ITEM_GRP_ID
		                           FROM BSC_AHP_EVAL_MAPPING
		                          WHERE YEAR = #year#
		                            AND EVAL_USER_GRP_ID = #evalUserGrpId#) 
		ORDER BY A.SORT_ORDER
	</select>

	<!--
	==================================================================   
	  # 설명	: AHP 평가단명 조회
	  #	기능	: SELECT
	  #	TABLE	: BSC_AHP_EVAL_USER_GRP
	==================================================================
	-->
	<select id="getEvalUserGrpNm" parameterClass="hashMap" resultClass="java.lang.String">
		SELECT EVAL_USER_GRP_NM
	  	  FROM BSC_AHP_EVAL_USER_GRP
         WHERE YEAR = #year#
		   AND EVAL_USER_GRP_ID = #evalUserGrpId#
	</select>	
	
	<!--
	==================================================================   
	  # 설명	: AHP 평가대상그룹매핑 등록
	  #	기능	: INSERT
	  #	TABLE	: BSC_AHP_EVAL_USER_GRP 
	==================================================================
	-->	
	<insert id="insertData" parameterClass="hashMap">
		INSERT INTO BSC_AHP_EVAL_MAPPING (
			   YEAR
			 , EVAL_USER_GRP_ID
			 , ITEM_GRP_ID
			 , CREATE_DT
             ) VALUES (
               #year#
             , #evalUserGrpId#
             , #itemGrpId#
             , SYSDATE
             )
	</insert>	
	
	<!--
	==================================================================   
	  # 설명	: AHP 평가대상그룹매핑 삭제
	  #	기능	: UPDATE
	  #	TABLE	: BSC_AHP_EVAL_MAPPING
	==================================================================
	-->	
	<update id="deleteData" parameterClass="hashMap">
	  	DELETE FROM BSC_AHP_EVAL_MAPPING
         WHERE YEAR = #year#
		   AND EVAL_USER_GRP_ID = #evalUserGrpId#
	</update>
	
	
</sqlMap>


