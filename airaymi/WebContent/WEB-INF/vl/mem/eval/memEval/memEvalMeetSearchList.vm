#*************************************************************************
* CLASS 명      : memEvalActSearchList
* 작 업 자      : 유연주
* 작 업 일      : 2017년 03월30일 
* 기    능      : 실적조회  
* ---------------------------- 변 경 이 력 --------------------------------
* 번호    작 업 자    작     업     일        변 경 내 용                비고
* ----  --------  -----------------  -------------------------  --------
*  1    유연주      2017년 03월 30일             최 초 작 업 
**************************************************************************# 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko">

#set($main_url = $!{searchMap.txt2html("mainUrl")})
#set($curr_url = $!{context_path} + "/mem/eval/memActIn/popMemSelfEvalList.vw")

<head>
	#parse("/WEB-INF/vl/common/template/head.vm")
<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;
	var grdRowId = 0;
	
	J(document).ready(function(){
		/******************************************
		 * 데이터 그리드 출력
		 ******************************************/
		var str = J('#form1').serialize();

		jQuery("#list").jqGrid({
			url          :"$!{context_path}/mem/eval/memEval/memEvalMeetSearchList_xml.vw" + "?" + str,
			mtype        :"POST",
			datatype     :"json",
			jsonReader   : {
    						page   : "page",
    						total  : "total",
    						root   : "rows",
    						records: function(obj){return obj.length;},
    						repeatitems: false,
    						id     : "id"
    				       },
			height       : 120,
			width        : $!{jqGrid_width},
			colNames     :['기준년도', '순번', '순번', '면담일자', '면담자사번', '면담자', '면담상태코드', '면담상태', '종합의견'],
			colModel     :[
							{name:'YEAR'                 ,index:'YEAR'                 ,width:0     ,align:'center' },
                            {name:'SEQ'                  ,index:'SEQ'                  ,width:30    ,align:'center' },
                            {name:'MEET_DT_TMP'          ,index:'MEET_DT_TMP'          ,width:0     ,align:'center' },
							{name:'MEET_DT'              ,index:'MEET_DT'              ,width:60    ,align:'center' ,formatter:linkUpdate},
                            {name:'EMP_NO'               ,index:'EMP_NO'               ,width:0     ,align:'center' },
							{name:'EVAL_1_EMP_NM'        ,index:'EVAL_1_EMP_NM'        ,width:60    ,align:'center' },
							{name:'MEET_STATE'           ,index:'MEET_STATE'           ,width:0     ,align:'center' },
							{name:'MEET_STATE_NM'        ,index:'MEET_STATE_NM'        ,width:60    ,align:'center' },
                            {name:'TOT_OPINION'          ,index:'TOT_OPINION'          ,width:400   ,align:'left'   }
							],
			rowNum       : $!{jqGrid_rownum},
			autowidth    : false,
			viewrecords  : true,
			loadonce     : true,
			multiselect  : false,
			cellEdit     : true,
			gridview     : true,
			##cmTemplate   : {sortable:false},
			loadComplete : function() {
                           },
			caption:"중간면담상세"
		}).jqGrid('hideCol',"YEAR").jqGrid('hideCol',"SEQ").jqGrid('hideCol',"EMP_NO").jqGrid('hideCol',"MEET_STATE").jqGrid('hideCol',"MEET_DT_TMP").jqGrid('hideCol',"CAL_CNT").jqGrid('hideCol',"CAL_NUM").setGridWidth($!{jqGrid_width});
		
		/******************************************
		 * 닫기버튼 이벤트
		 ******************************************/
		J("#btnClose").click(function(e) {
			self.close();
		});
	});
	

	/******************************************
	 * jqGrid 수정페이지 링크
	 ******************************************/
	function linkUpdate(cellvalue, options, rowObject) {
		return '<a href=javascript:goMeetMetricList(' + options.rowId + ')>' + cellvalue + '<//a>';
	}

	/******************************************
	 * 조회
	 ******************************************/
    function goMeetMetricList(rowId) {
    	var ret = J("#list").jqGrid('getRowData',rowId);
    	
		var year = J("#year").val();
		var seq = ret.SEQ;
		var empNo = ret.EMP_NO;
		
		J.ajax({
        	url      : "$!{context_path}/mem/eval/memEval/memMeetMetricList.vw",
        	cache    : false,
        	type     : "POST",
			data     : "year=" + year + "&amp;seq=" + seq + "&amp;findYear=" + year + "&amp;empNo=" + empNo,
        	dataType : "html",
        	contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        	success  : function (data) {
        		J("#detailMeetMetricData").empty();  //body부분 div를 empty 시켜줌(empty를 시키지 않을 경우 메모리릭 발생)
        		J("#detailMeetMetricData").append(data);
        	}
    	});
	}
//]]>
</script>    
 
<form id="form1" name="form1" method="post" enctype="multipart/form-data" action="$!{context_path}/mem/eval/memActIn/memActInProcess.vw?type=template">
    <input type="hidden" 	id="mode"		    name="mode"		      value="$!{searchMap.txt2html("mode")}" />
	<input type="hidden"	id="empNo"          name="empNo"          value="$!{searchMap.txt2html("empNo")}" />
	<input type="hidden" 	id="year"       	name="year" 		  value="$!{searchMap.txt2html("year")}" />
	
    $!{searchMap.makeHiddenFind()}
	<br>
    <div id="Table">
    	<div id="Table_blockContainer">
    		<div class="tableTop">
    			#parse("/WEB-INF/vl/common/template/tabs.vm")
    			<div class="clear"></div>
    		</div>
			<div class="tableTop">
                <!-- 검색 테이블 Start -->
                <div class="searchBox">
                <div><div><div>   
                    <table summary="검색조건">        
                        <caption class="none">검색조건</caption>
                        <thead><tr><th></th><th></th></tr></thead>
                        <tbody>
                            <tr>
								<td class="searchBox_tit w250">$!{YEAR} <span class="searchBar">$!{searchMap.txt2html("findYear")}년</span></td>
								<td class="searchBox_tit w250">평가대상자 <span class="searchBar">$empInfo.EMP_NM</span></td>
							</tr>
                        </tbody>
                    </table>
                </div></div></div>
                </div>
                <!--// 검색 테이블 End -->
                <div class="clear"></div>
            </div>
    	</div>
		<div id="Table_blockContainer">
			<div id="splitterBox">
				<div>
					<!-- 데이터그리드 Start -->
					<div class="blockGridListTable">
						<table id="list" summary="중간면담 조회결과">
							<caption class="none">중간면담 조회</caption>
							<thead><tr><th></th></tr></thead>
							<tbody><tr><td></td></tr></tbody>
						</table>
						<div id="pager"></div>
					</div>
					<!-- 데이터그리드 End -->
					
					<!-- 지표별 중간면담 Start -->
					<div id="detailMeetMetricData" class="blockGridListTable"></div>
					<!-- 지표별 중간면담 End -->
					
					<div class="blockButton_all">
						<div class="blockButton_l">
							##<input id="btnExcelDown" type="image" src="$!{img_path}/btn_excel.gif" align="middle" alt="엑셀다운로드" />
						</div>
						<div class="blockButton">
							<ul>
			    				<li><input type="button" id="btnClose"   value="닫기" /></li>&nbsp;
							</ul>
						</div>
					</div>
					<br><br>
				</div>
			</div>
		</div>
	</div>
</form>
