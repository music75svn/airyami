<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="supplyRate">

<typeAlias alias="ValueMap" type="egovframework.airyami.cmm.util.ValueMap"/>

<select id="supplyRate.selectSupplyRateListCnt" parameterClass="Map" resultClass="java.lang.Integer">
	SELECT COUNT(1) 
	  FROM TB_SUPPLY_RATE A
	      ,TB_COMPANY_MASTER C1
	      ,TB_COMPANY_MASTER C2
	 WHERE A.BIZ_ENTITY_ID = C1.BIZ_ENTITY_ID
	   AND A.BUYER_BIZ_ENTITY_ID = C2.BIZ_ENTITY_ID
	 <isNotEmpty property="COMP_ID">
	   AND (A.BIZ_ENTITY_ID = #COMP_ID# OR A.BUYER_BIZ_ENTITY_ID = #COMP_ID#)
	 </isNotEmpty>
	 <isNotEmpty property="PROD_NO">
	   AND A.PROD_NO = #PROD_NO#
	 </isNotEmpty>
	 <isNotEmpty property="VALID_YN">
	   AND A.VALID_YN = #VALID_YN#
	 </isNotEmpty>
</select>
		
<select id="supplyRate.selectSupplyRateList" parameterClass="Map" resultClass="ValueMap" remapResults="true">
	<isEqual property="EXCEL_YN" compareValue="N">
	<include refid="pagingPrefixSQL"/>
	</isEqual>
	SELECT /* SupplyRate_Mysql.xml  supplyRate.selectSupplyRateList */
	       A.BIZ_ENTITY_ID
	      ,C1.COMP_NM
	      ,A.BUYER_BIZ_ENTITY_ID
	      ,C2.COMP_NM 	AS BUYER_COMP_NM
	      ,FN_GET_CODE_NM('CURRENCY',  A.CURRENCY, #LANG_CD#) AS CURRENCY_NM
	      ,CONCAT(DATE_FORMAT(STR_TO_DATE(A.VALID_START_DATE,'%Y%m%d'), '%Y-%m-%d'), ' ~ ', DATE_FORMAT(STR_TO_DATE(A.VALID_END_DATE,'%Y%m%d'), '%Y-%m-%d') ) AS GIGAN
	      ,A.SUPPLY_RATE
	      ,A.PRICE
	      ,A.DC_MIN_QTY
	      ,A.DC_SUPPLY_RATE
	      ,A.DC_SUPPLY_PRICE
	      ,A.VALID_YN
	  FROM TB_SUPPLY_RATE A
	      ,TB_COMPANY_MASTER C1
	      ,TB_COMPANY_MASTER C2
	 WHERE A.BIZ_ENTITY_ID = C1.BIZ_ENTITY_ID
	   AND A.BUYER_BIZ_ENTITY_ID = C2.BIZ_ENTITY_ID
	 <isNotEmpty property="COMP_ID">
	   AND (A.BIZ_ENTITY_ID = #COMP_ID# OR A.BUYER_BIZ_ENTITY_ID = #COMP_ID#)
	 </isNotEmpty>
	 <isNotEmpty property="PROD_NO">
	   AND A.PROD_NO = #PROD_NO#
	 </isNotEmpty>
	 <isNotEmpty property="VALID_YN">
	   AND A.VALID_YN = #VALID_YN#
	 </isNotEmpty>
	 <isNotEmpty property="SORT_COL">
	 	<include refid="orderbySQL"/>
	 </isNotEmpty>
	 <isEmpty property="SORT_COL">
	 ORDER BY SEQ DESC
	 </isEmpty>
	<isEqual property="EXCEL_YN" compareValue="N">
	<include refid="pagingSuffixSQL"/>
	</isEqual>
</select>



<select id="supplyRate.getSupplyRateDetail" parameterClass="Map" resultClass="ValueMap">
	SELECT /* SupplyRate_Mysql.xml  "supplyRate.getSupplyRateDetail" */
	       A.CURRENCY
		  ,A.VALID_START_DATE
		  ,A.VALID_END_DATE
	      ,A.SUPPLY_RATE
	      ,A.PRICE
	      ,A.DC_MIN_QTY
	      ,A.DC_SUPPLY_RATE
	      ,A.DC_SUPPLY_PRICE
	      ,A.VALID_YN
	  FROM TB_SUPPLY_RATE A
	 WHERE A.BIZ_ENTITY_ID = #BIZ_ENTITY_ID#
	   AND A.PROD_NO = #PROD_NO#
	   AND A.BUYER_BIZ_ENTITY_ID = #BUYER_BIZ_ENTITY_ID#
</select>



<insert id="supplyRate.insertSupplyRate" parameterClass="Map">
	INSERT /* SupplyRate_Mysql.xml  supplyRate.insertSupplyRate */
	  INTO TB_SUPPLY_RATE
		(
		BIZ_DT,
		FR_CURRENCY,
		TO_CURRENCY,
		BASIC_EXT_RATE,
		BIZ_EXT_RATE,
		INSERT_USER_ID,
		INSERT_DT)
		VALUES
		(
		#BIZ_DT#,
		#FR_CURRENCY#,
		#TO_CURRENCY#,
		#BASIC_EXT_RATE#,
		#BIZ_EXT_RATE#,
		#LOGIN_ID#,
		DATE_FORMAT(now(), '%Y%m%d%H%i%s')
		)
	
</insert>

<update id="supplyRate.updateSupplyRate" parameterClass="Map">
	UPDATE TB_SUPPLY_RATE /* SupplyRate_Mysql.xml  supplyRate.saveSupplyRate */
	   SET BASIC_EXT_RATE 	= #BASIC_EXT_RATE#,
		   BIZ_EXT_RATE 	= #BIZ_EXT_RATE#,
		   UPDATE_USER_ID 	= #LOGIN_ID#,
		   UPDATE_DT 		= DATE_FORMAT(now(), '%Y%m%d%H%i%s')
	 WHERE BIZ_ENTITY_ID = #BIZ_ENTITY_ID#
	   AND PROD_NO = #PROD_NO#
	   AND BUYER_BIZ_ENTITY_ID = #BUYER_BIZ_ENTITY_ID#
</update>

<delete id="supplyRate.deleteSupplyRate" parameterClass="Map">
	DELETE /* SupplyRate_Mysql.xml  supplyRate.deleteSupplyRate */
	  FROM TB_SUPPLY_RATE
	 WHERE BIZ_ENTITY_ID = #BIZ_ENTITY_ID#
	   AND PROD_NO = #PROD_NO#
	   AND BUYER_BIZ_ENTITY_ID = #BUYER_BIZ_ENTITY_ID#
</delete>


	
</sqlMap>