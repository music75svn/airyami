#*************************************************************************
* CLASS 명      : popScDeptList.vm
* 작 업 자      : 하윤식
* 작 업 일      : 2012.07.17
* 기    능      : 지표복사 대상 조직리스트
* ---------------------------- 변 경 이 력 --------------------------------
* 번호   작 업 자     작   업   일        변 경 내 용             비고
* ----  --------  -----------------  -------------------------  --------
*  1     하 윤 식      2012.07.17          최 초 작 업 
**************************************************************************# 

<script type="text/javascript" language="javascript" >
//<![CDATA[

	var J = jQuery;
	
	J(document).ready(function(){
	
		/******************************************
		 * 데이터 그리드 출력
		 ******************************************/
		var str = J('#formFindPop').serialize();
		
		jQuery("#popList").jqGrid({
			url          :"$!{searchMap.txt2html("context")}/bsc/module/commModule/popScDeptList_xml.vw" + "?" + str,
			mtype        :"POST",
			datatype     :"json",
			jsonReader   : {   
    						page   : "page",
    						total  : "total",
    						root   : "rows", 
    						records: function(obj){return obj.length;},
    						repeatitems: false, 
    						id     : "id"
    				       },
			height       : 320,
			colNames     :['대상조직코드','대상조직', '$!{searchMap.txt2html("METRIC_NM")}수', '조직평가그룹'],
			colModel     :[
							{name:'SC_DEPT_ID'  	,index:'SC_DEPT_ID'     ,width:50   ,align:'center' },
							{name:'SC_DEPT_NM'  	,index:'SC_DEPT_NM'     ,width:200  ,align:'left'   },
							{name:'METRIC_CNT'  	,index:'METRIC_CNT'     ,width:80   ,align:'center' },
							{name:'SC_DEPT_GRP_NM'	,index:'SC_DEPT_GRP_NM' ,width:150  ,align:'center' }
							],
			rowNum       : 100000,
			autowidth    : false,
			viewrecords  : true,
			loadonce     : false,
			multiselect  : true,
			cellEdit     : true,
			loadComplete : function() {
    							J("#findMetricGrpNm").select();
                           },
			caption:"대상조직조회"
		}).jqGrid('hideCol',"SC_DEPT_ID").setGridWidth(680);
        
    	/******************************************
    	 * 검색 엔터키 이벤트
    	 ******************************************/
		J("#findScDeptNm").keyup(function(e)  {
        	if(e.keyCode == 13) {
        		$("#formFindPop").submit();
        	}
        });
		
		/******************************************
		 * 입력완료 버튼 이벤트
		 ******************************************/
		J("#btnTargetInsert").click(function() {
			 //setTargetDeptSet();
			 goSelectChk();
		});
		
		try {
			$("input", ".blockButton" ).button(); //버튼 ui 적용
		} catch(err) { }
		
	});
	
	/******************************************
	 * submit 이벤트
	 ******************************************/
	$("#formFindPop").submit(function() { 
		J("#popList").setGridParam({url:"$!{searchMap.txt2html("context")}/bsc/module/commModule/popScDeptList_xml.vw?"+J("#formFindPop").serialize()}); 
		J("#popList").trigger("reloadGrid");
		return false;
	});
	
	/******************************************
	 * 그리드 선택 체크
	 ******************************************/
	function goSelectChk() {
		if(!J.gridSelectChk("popList")){
			alert("선택된 데이터가 없습니다.");
		} else {
			setTargetDeptSet();
		}
	}
	
	/******************************************
	 * setting
	 ******************************************/
	function setTargetDeptSet() {
		var id = J("#popList").getGridParam('selarrrow');
		var ids = J("#popList").jqGrid('getDataIDs');
		var rowdata = "";
		var targetScDeptIds = "";
        
		for (var i = 0; i < ids.length; i++) {
			J.each(id, function (index, value) {
				if (value == ids[i]) {
					rowdata = J("#popList").getRowData(ids[i]);
					targetScDeptIds += rowdata.SC_DEPT_ID + '|';
				}
			});
		}
        
		J("#targetScDeptIds").val(targetScDeptIds);
		J.fancybox.close();
		metricCopyDo();
	}

//]]>
</script>

<form id="formFindPop" name="formFindPop" method="post" action="$!{searchMap.txt2html("context")}/bsc/module/commModule/popMetricGrpSearch.vw?type=template">
	<input type="hidden" name="findYear" value="$!{searchMap.txt2html("findYear")}" />
	<input type="hidden" name="scDeptId" value="$!{searchMap.txt2html("scDeptId")}" />
	
    <div style="width:700px;height:430px;">
    	<div id="popMetricGrpArea" style="margin-left:15px;">
    		<h1 class="none">대상조직리스트</h1>
    		<div>
				<span class="strong">$!{searchMap.txt2html("SC_DEPT_NM")}</span> : <input type="text" id="findScDeptNm" name="findScDeptNm" value="$!{searchMap.txt2html("findScDeptNm")}" />
			</div>
			<div id="userData">
    			<!-- 데이터그리드 Start -->
    			<div class="blockGridListTable">
    				<table id="popList" summary="대상조직조회">
    					<caption class="none">대상조직조회</caption>
    					<thead><tr><th></th></tr></thead>
    					<tbody><tr><td></td></tr></tbody>
    				</table>
    				<div id="pager"></div>
    			</div>
    			<!--// 데이터그리드 End -->	
			</div>
			
			<div class="blockButton_all">			
    			<div class="blockButton_l"></div>
    			<div class="blockButton">
    				<ul>
    					<li><input type="button" id="btnTargetInsert" value="입력완료" /></li>
    				</ul>
    			</div>
    		</div>
    	</div>
    </div>
</form>
