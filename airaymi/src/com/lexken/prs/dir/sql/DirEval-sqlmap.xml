<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="prs.dir.dirEval">

	<!--
	==================================================================   
	  # 설명	: typeAlias 선언
	  #	기능	: SETTING
	  #	TABLE	: PRS_EVAL_GRP
	==================================================================
	-->
	<typeAlias alias="hashMap" 			type="java.util.HashMap" />
	 
	<!--
	==================================================================   
	  # 설명	: 임원리더쉽평가 마감여부
	  #	기능	: SELECT
	  #	TABLE	: PRS_CLOSING
	==================================================================
	-->
	<select id="getList" parameterClass="hashMap" resultClass="hashMap">
		SELECT DECODE (COUNT (DIR_LEADERSHIP_YN), 0, 'N', 'Y') DIR_LEADERSHIP_YN
		  FROM PRS_CLOSING
		 WHERE year = #findYear#
		   AND DIR_LEADERSHIP_YN = 'Y'
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 임원리더쉽평가 대상자 목록 보기
	  #	기능	: SELECT
	  #	TABLE	: PRS_DIR_EVAL_MEMBER
	==================================================================
	-->
	<select id="getList_xml" parameterClass="hashMap" resultClass="hashMap">
		SELECT A.YEAR
		     , A.EMPN
		     , A.KOR_NM
		     , A.DEPT_CD
		     , A.CAST_TC
		     , A.POS_TC
		     , A.LEADERSHIP_GRADE
		     , TO_CHAR(A.LEADERSHIP_1ST, 99.999) LEADERSHIP_1ST
		     , TO_CHAR(A.LEADERSHIP_2ND, 99.999) LEADERSHIP_2ND
		     , TO_CHAR(A.LEADERSHIP_SCORE, 99.999) LEADERSHIP_SCORE
		     , A.DUTY_START_DT
		     , A.DUTY_END_DT
		     , A.LEADERSHIP_YN
		     , A.EVAL_YN
		  FROM PRS_DIR_EVAL_MEMBER A
		 WHERE A.YEAR = #findYear#
		   AND A.EVAL_YN = 'Y'
		   AND SUBSTR(A.DUTY_END_DT, 5, 8) = '1231'
		ORDER BY A.KOR_NM  
	</select>
	
	<!--
	==================================================================   
	  # 설명	: 임원리더쉽평가 점수
	  #	기능	: UPDATE
	  #	TABLE	: PRS_DIR_EVAL_MEMBER
	==================================================================
	-->	
	<update id="updateEvalData" parameterClass="hashMap">
		UPDATE PRS_DIR_EVAL_MEMBER
	   	   SET LEADERSHIP_SCORE = #leadershipScore#
	   	   	 , LEADERSHIP_1ST	= #leadershipScore1st#
	   	   	 , LEADERSHIP_2ND	= #leadershipScore2nd#
	   	 <isEqual property="mode" compareValue="CON">
	   	   	 , LEADERSHIP_YN	= #leadershipYn#
	   	 </isEqual>  	 
		 WHERE EMPN = #empn#
		   AND YEAR = #findYear#
	</update>
	
	<!--
	==================================================================   
	  # 설명	: 임원리더쉽평가 점수 확정
	  #	기능	: UPDATE
	  #	TABLE	: PRS_CLOSING
	==================================================================
	-->	
	<update id="updateEvalConfirm" parameterClass="hashMap">
		MERGE INTO PRS_CLOSING AA
		     USING (SELECT #findYear# YEAR, #leadershipYn# DIR_LEADERSHIP_YN FROM DUAL) BB
		        ON (AA.YEAR = BB.YEAR)
		WHEN MATCHED
		THEN
		   UPDATE SET AA.DIR_LEADERSHIP_YN = BB.DIR_LEADERSHIP_YN, AA.MODIFY_DT = SYSDATE
		WHEN NOT MATCHED
		THEN
		   INSERT     (YEAR, DIR_LEADERSHIP_YN, CREATE_DT)
		       VALUES (BB.YEAR, BB.DIR_LEADERSHIP_YN, SYSDATE)
	</update>
		
</sqlMap>


